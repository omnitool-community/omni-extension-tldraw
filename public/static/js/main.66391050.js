/*! For license information please see main.66391050.js.LICENSE.txt */
(()=>{var e={1694:(e,t)=>{var n;!function(){"use strict";var r={}.hasOwnProperty;function i(){for(var e=[],t=0;t<arguments.length;t++){var n=arguments[t];if(n){var o=typeof n;if("string"===o||"number"===o)e.push(n);else if(Array.isArray(n)){if(n.length){var s=i.apply(null,n);s&&e.push(s)}}else if("object"===o){if(n.toString!==Object.prototype.toString&&!n.toString.toString().includes("[native code]")){e.push(n.toString());continue}for(var a in n)r.call(n,a)&&n[a]&&e.push(a)}}}return e.join(" ")}e.exports?(i.default=i,e.exports=i):void 0===(n=function(){return i}.apply(t,[]))||(e.exports=n)}()},7143:e=>{"use strict";var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,r,o,s){if("function"!==typeof r)throw new TypeError("The listener must be a function");var a=new i(r,o||e,s),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],a]:e._events[l].push(a):(e._events[l]=a,e._eventsCount++),e}function s(e,t){0===--e._eventsCount?e._events=new r:delete e._events[t]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),a.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},a.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,s=new Array(o);i<o;i++)s[i]=r[i].fn;return s},a.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},a.prototype.emit=function(e,t,r,i,o,s){var a=n?n+e:e;if(!this._events[a])return!1;var l,c,u=this._events[a],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,i),!0;case 5:return u.fn.call(u.context,t,r,i,o),!0;case 6:return u.fn.call(u.context,t,r,i,o,s),!0}for(c=1,l=new Array(d-1);c<d;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var h,p=u.length;for(c=0;c<p;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),d){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,r);break;case 4:u[c].fn.call(u[c].context,t,r,i);break;default:if(!l)for(h=1,l=new Array(d-1);h<d;h++)l[h-1]=arguments[h];u[c].fn.apply(u[c].context,l)}}return!0},a.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},a.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},a.prototype.removeListener=function(e,t,r,i){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return s(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||i&&!a.once||r&&a.context!==r||s(this,o);else{for(var l=0,c=[],u=a.length;l<u;l++)(a[l].fn!==t||i&&!a[l].once||r&&a[l].context!==r)&&c.push(a[l]);c.length?this._events[o]=1===c.length?c[0]:c:s(this,o)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&s(this,t)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,e.exports=a},2467:(e,t,n)=>{e=n.nmd(e);var r="__lodash_hash_undefined__",i=1,o=2,s=9007199254740991,a="[object Arguments]",l="[object Array]",c="[object AsyncFunction]",u="[object Boolean]",d="[object Date]",h="[object Error]",p="[object Function]",f="[object GeneratorFunction]",g="[object Map]",m="[object Number]",y="[object Null]",v="[object Object]",b="[object Promise]",w="[object Proxy]",x="[object RegExp]",S="[object Set]",k="[object String]",_="[object Symbol]",P="[object Undefined]",C="[object WeakMap]",E="[object ArrayBuffer]",I="[object DataView]",M=/^\[object .+?Constructor\]$/,T=/^(?:0|[1-9]\d*)$/,A={};A["[object Float32Array]"]=A["[object Float64Array]"]=A["[object Int8Array]"]=A["[object Int16Array]"]=A["[object Int32Array]"]=A["[object Uint8Array]"]=A["[object Uint8ClampedArray]"]=A["[object Uint16Array]"]=A["[object Uint32Array]"]=!0,A[a]=A[l]=A[E]=A[u]=A[I]=A[d]=A[h]=A[p]=A[g]=A[m]=A[v]=A[x]=A[S]=A[k]=A[C]=!1;var j="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,O="object"==typeof self&&self&&self.Object===Object&&self,L=j||O||Function("return this")(),z=t&&!t.nodeType&&t,R=z&&e&&!e.nodeType&&e,D=R&&R.exports===z,N=D&&j.process,F=function(){try{return N&&N.binding&&N.binding("util")}catch(e){}}(),B=F&&F.isTypedArray;function U(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function H(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}function V(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var K,W,$=Array.prototype,Y=Function.prototype,q=Object.prototype,G=L["__core-js_shared__"],X=Y.toString,Q=q.hasOwnProperty,Z=function(){var e=/[^.]+$/.exec(G&&G.keys&&G.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),J=q.toString,ee=RegExp("^"+X.call(Q).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),te=D?L.Buffer:void 0,ne=L.Symbol,re=L.Uint8Array,ie=q.propertyIsEnumerable,oe=$.splice,se=ne?ne.toStringTag:void 0,ae=Object.getOwnPropertySymbols,le=te?te.isBuffer:void 0,ce=(K=Object.keys,W=Object,function(e){return K(W(e))}),ue=Ne(L,"DataView"),de=Ne(L,"Map"),he=Ne(L,"Promise"),pe=Ne(L,"Set"),fe=Ne(L,"WeakMap"),ge=Ne(Object,"create"),me=He(ue),ye=He(de),ve=He(he),be=He(pe),we=He(fe),xe=ne?ne.prototype:void 0,Se=xe?xe.valueOf:void 0;function ke(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function _e(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Pe(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Ce(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Pe;++t<n;)this.add(e[t])}function Ee(e){var t=this.__data__=new _e(e);this.size=t.size}function Ie(e,t){var n=We(e),r=!n&&Ke(e),i=!n&&!r&&$e(e),o=!n&&!r&&!i&&Qe(e),s=n||r||i||o,a=s?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],l=a.length;for(var c in e)!t&&!Q.call(e,c)||s&&("length"==c||i&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Ue(c,l))||a.push(c);return a}function Me(e,t){for(var n=e.length;n--;)if(Ve(e[n][0],t))return n;return-1}function Te(e){return null==e?void 0===e?P:y:se&&se in Object(e)?function(e){var t=Q.call(e,se),n=e[se];try{e[se]=void 0;var r=!0}catch(o){}var i=J.call(e);r&&(t?e[se]=n:delete e[se]);return i}(e):function(e){return J.call(e)}(e)}function Ae(e){return Xe(e)&&Te(e)==a}function je(e,t,n,r,s){return e===t||(null==e||null==t||!Xe(e)&&!Xe(t)?e!==e&&t!==t:function(e,t,n,r,s,c){var p=We(e),f=We(t),y=p?l:Be(e),b=f?l:Be(t),w=(y=y==a?v:y)==v,P=(b=b==a?v:b)==v,C=y==b;if(C&&$e(e)){if(!$e(t))return!1;p=!0,w=!1}if(C&&!w)return c||(c=new Ee),p||Qe(e)?ze(e,t,n,r,s,c):function(e,t,n,r,s,a,l){switch(n){case I:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case E:return!(e.byteLength!=t.byteLength||!a(new re(e),new re(t)));case u:case d:case m:return Ve(+e,+t);case h:return e.name==t.name&&e.message==t.message;case x:case k:return e==t+"";case g:var c=H;case S:var p=r&i;if(c||(c=V),e.size!=t.size&&!p)return!1;var f=l.get(e);if(f)return f==t;r|=o,l.set(e,t);var y=ze(c(e),c(t),r,s,a,l);return l.delete(e),y;case _:if(Se)return Se.call(e)==Se.call(t)}return!1}(e,t,y,n,r,s,c);if(!(n&i)){var M=w&&Q.call(e,"__wrapped__"),T=P&&Q.call(t,"__wrapped__");if(M||T){var A=M?e.value():e,j=T?t.value():t;return c||(c=new Ee),s(A,j,n,r,c)}}if(!C)return!1;return c||(c=new Ee),function(e,t,n,r,o,s){var a=n&i,l=Re(e),c=l.length,u=Re(t),d=u.length;if(c!=d&&!a)return!1;var h=c;for(;h--;){var p=l[h];if(!(a?p in t:Q.call(t,p)))return!1}var f=s.get(e);if(f&&s.get(t))return f==t;var g=!0;s.set(e,t),s.set(t,e);var m=a;for(;++h<c;){var y=e[p=l[h]],v=t[p];if(r)var b=a?r(v,y,p,t,e,s):r(y,v,p,e,t,s);if(!(void 0===b?y===v||o(y,v,n,r,s):b)){g=!1;break}m||(m="constructor"==p)}if(g&&!m){var w=e.constructor,x=t.constructor;w==x||!("constructor"in e)||!("constructor"in t)||"function"==typeof w&&w instanceof w&&"function"==typeof x&&x instanceof x||(g=!1)}return s.delete(e),s.delete(t),g}(e,t,n,r,s,c)}(e,t,n,r,je,s))}function Oe(e){return!(!Ge(e)||function(e){return!!Z&&Z in e}(e))&&(Ye(e)?ee:M).test(He(e))}function Le(e){if(!function(e){var t=e&&e.constructor,n="function"==typeof t&&t.prototype||q;return e===n}(e))return ce(e);var t=[];for(var n in Object(e))Q.call(e,n)&&"constructor"!=n&&t.push(n);return t}function ze(e,t,n,r,s,a){var l=n&i,c=e.length,u=t.length;if(c!=u&&!(l&&u>c))return!1;var d=a.get(e);if(d&&a.get(t))return d==t;var h=-1,p=!0,f=n&o?new Ce:void 0;for(a.set(e,t),a.set(t,e);++h<c;){var g=e[h],m=t[h];if(r)var y=l?r(m,g,h,t,e,a):r(g,m,h,e,t,a);if(void 0!==y){if(y)continue;p=!1;break}if(f){if(!U(t,(function(e,t){if(i=t,!f.has(i)&&(g===e||s(g,e,n,r,a)))return f.push(t);var i}))){p=!1;break}}else if(g!==m&&!s(g,m,n,r,a)){p=!1;break}}return a.delete(e),a.delete(t),p}function Re(e){return function(e,t,n){var r=t(e);return We(e)?r:function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}(r,n(e))}(e,Ze,Fe)}function De(e,t){var n=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?n["string"==typeof t?"string":"hash"]:n.map}function Ne(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return Oe(n)?n:void 0}ke.prototype.clear=function(){this.__data__=ge?ge(null):{},this.size=0},ke.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},ke.prototype.get=function(e){var t=this.__data__;if(ge){var n=t[e];return n===r?void 0:n}return Q.call(t,e)?t[e]:void 0},ke.prototype.has=function(e){var t=this.__data__;return ge?void 0!==t[e]:Q.call(t,e)},ke.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=ge&&void 0===t?r:t,this},_e.prototype.clear=function(){this.__data__=[],this.size=0},_e.prototype.delete=function(e){var t=this.__data__,n=Me(t,e);return!(n<0)&&(n==t.length-1?t.pop():oe.call(t,n,1),--this.size,!0)},_e.prototype.get=function(e){var t=this.__data__,n=Me(t,e);return n<0?void 0:t[n][1]},_e.prototype.has=function(e){return Me(this.__data__,e)>-1},_e.prototype.set=function(e,t){var n=this.__data__,r=Me(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},Pe.prototype.clear=function(){this.size=0,this.__data__={hash:new ke,map:new(de||_e),string:new ke}},Pe.prototype.delete=function(e){var t=De(this,e).delete(e);return this.size-=t?1:0,t},Pe.prototype.get=function(e){return De(this,e).get(e)},Pe.prototype.has=function(e){return De(this,e).has(e)},Pe.prototype.set=function(e,t){var n=De(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},Ce.prototype.add=Ce.prototype.push=function(e){return this.__data__.set(e,r),this},Ce.prototype.has=function(e){return this.__data__.has(e)},Ee.prototype.clear=function(){this.__data__=new _e,this.size=0},Ee.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Ee.prototype.get=function(e){return this.__data__.get(e)},Ee.prototype.has=function(e){return this.__data__.has(e)},Ee.prototype.set=function(e,t){var n=this.__data__;if(n instanceof _e){var r=n.__data__;if(!de||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Pe(r)}return n.set(e,t),this.size=n.size,this};var Fe=ae?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var s=e[n];t(s,n,e)&&(o[i++]=s)}return o}(ae(e),(function(t){return ie.call(e,t)})))}:function(){return[]},Be=Te;function Ue(e,t){return!!(t=null==t?s:t)&&("number"==typeof e||T.test(e))&&e>-1&&e%1==0&&e<t}function He(e){if(null!=e){try{return X.call(e)}catch(t){}try{return e+""}catch(t){}}return""}function Ve(e,t){return e===t||e!==e&&t!==t}(ue&&Be(new ue(new ArrayBuffer(1)))!=I||de&&Be(new de)!=g||he&&Be(he.resolve())!=b||pe&&Be(new pe)!=S||fe&&Be(new fe)!=C)&&(Be=function(e){var t=Te(e),n=t==v?e.constructor:void 0,r=n?He(n):"";if(r)switch(r){case me:return I;case ye:return g;case ve:return b;case be:return S;case we:return C}return t});var Ke=Ae(function(){return arguments}())?Ae:function(e){return Xe(e)&&Q.call(e,"callee")&&!ie.call(e,"callee")},We=Array.isArray;var $e=le||function(){return!1};function Ye(e){if(!Ge(e))return!1;var t=Te(e);return t==p||t==f||t==c||t==w}function qe(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=s}function Ge(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Xe(e){return null!=e&&"object"==typeof e}var Qe=B?function(e){return function(t){return e(t)}}(B):function(e){return Xe(e)&&qe(e.length)&&!!A[Te(e)]};function Ze(e){return null!=(t=e)&&qe(t.length)&&!Ye(t)?Ie(e):Le(e);var t}e.exports=function(e,t){return je(e,t)}},3881:(e,t,n)=>{var r="Expected a function",i=NaN,o="[object Symbol]",s=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,c=/^0o[0-7]+$/i,u=parseInt,d="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,h="object"==typeof self&&self&&self.Object===Object&&self,p=d||h||Function("return this")(),f=Object.prototype.toString,g=Math.max,m=Math.min,y=function(){return p.Date.now()};function v(e,t,n){var i,o,s,a,l,c,u=0,d=!1,h=!1,p=!0;if("function"!=typeof e)throw new TypeError(r);function f(t){var n=i,r=o;return i=o=void 0,u=t,a=e.apply(r,n)}function v(e){var n=e-c;return void 0===c||n>=t||n<0||h&&e-u>=s}function x(){var e=y();if(v(e))return S(e);l=setTimeout(x,function(e){var n=t-(e-c);return h?m(n,s-(e-u)):n}(e))}function S(e){return l=void 0,p&&i?f(e):(i=o=void 0,a)}function k(){var e=y(),n=v(e);if(i=arguments,o=this,c=e,n){if(void 0===l)return function(e){return u=e,l=setTimeout(x,t),d?f(e):a}(c);if(h)return l=setTimeout(x,t),f(c)}return void 0===l&&(l=setTimeout(x,t)),a}return t=w(t)||0,b(n)&&(d=!!n.leading,s=(h="maxWait"in n)?g(w(n.maxWait)||0,t):s,p="trailing"in n?!!n.trailing:p),k.cancel=function(){void 0!==l&&clearTimeout(l),u=0,i=c=o=l=void 0},k.flush=function(){return void 0===l?a:S(y())},k}function b(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function w(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&f.call(e)==o}(e))return i;if(b(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=b(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(s,"");var n=l.test(e);return n||c.test(e)?u(e.slice(2),n?2:8):a.test(e)?i:+e}e.exports=function(e,t,n){var i=!0,o=!0;if("function"!=typeof e)throw new TypeError(r);return b(n)&&(i="leading"in n?!!n.leading:i,o="trailing"in n?!!n.trailing:o),v(e,t,{leading:i,maxWait:t,trailing:o})}},9409:(e,t,n)=>{var r=200,i="__lodash_hash_undefined__",o="[object Function]",s="[object GeneratorFunction]",a=/^\[object .+?Constructor\]$/,l="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,c="object"==typeof self&&self&&self.Object===Object&&self,u=l||c||Function("return this")();function d(e,t){return!!(e?e.length:0)&&function(e,t,n){if(t!==t)return function(e,t,n,r){var i=e.length,o=n+(r?1:-1);for(;r?o--:++o<i;)if(t(e[o],o,e))return o;return-1}(e,p,n);var r=n-1,i=e.length;for(;++r<i;)if(e[r]===t)return r;return-1}(e,t,0)>-1}function h(e,t,n){for(var r=-1,i=e?e.length:0;++r<i;)if(n(t,e[r]))return!0;return!1}function p(e){return e!==e}function f(e,t){return e.has(t)}function g(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var m=Array.prototype,y=Function.prototype,v=Object.prototype,b=u["__core-js_shared__"],w=function(){var e=/[^.]+$/.exec(b&&b.keys&&b.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),x=y.toString,S=v.hasOwnProperty,k=v.toString,_=RegExp("^"+x.call(S).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),P=m.splice,C=D(u,"Map"),E=D(u,"Set"),I=D(Object,"create");function M(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function T(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function A(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function j(e){var t=-1,n=e?e.length:0;for(this.__data__=new A;++t<n;)this.add(e[t])}function O(e,t){for(var n,r,i=e.length;i--;)if((n=e[i][0])===(r=t)||n!==n&&r!==r)return i;return-1}function L(e){if(!N(e)||(t=e,w&&w in t))return!1;var t,n=function(e){var t=N(e)?k.call(e):"";return t==o||t==s}(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(n){}return t}(e)?_:a;return n.test(function(e){if(null!=e){try{return x.call(e)}catch(t){}try{return e+""}catch(t){}}return""}(e))}M.prototype.clear=function(){this.__data__=I?I(null):{}},M.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},M.prototype.get=function(e){var t=this.__data__;if(I){var n=t[e];return n===i?void 0:n}return S.call(t,e)?t[e]:void 0},M.prototype.has=function(e){var t=this.__data__;return I?void 0!==t[e]:S.call(t,e)},M.prototype.set=function(e,t){return this.__data__[e]=I&&void 0===t?i:t,this},T.prototype.clear=function(){this.__data__=[]},T.prototype.delete=function(e){var t=this.__data__,n=O(t,e);return!(n<0)&&(n==t.length-1?t.pop():P.call(t,n,1),!0)},T.prototype.get=function(e){var t=this.__data__,n=O(t,e);return n<0?void 0:t[n][1]},T.prototype.has=function(e){return O(this.__data__,e)>-1},T.prototype.set=function(e,t){var n=this.__data__,r=O(n,e);return r<0?n.push([e,t]):n[r][1]=t,this},A.prototype.clear=function(){this.__data__={hash:new M,map:new(C||T),string:new M}},A.prototype.delete=function(e){return R(this,e).delete(e)},A.prototype.get=function(e){return R(this,e).get(e)},A.prototype.has=function(e){return R(this,e).has(e)},A.prototype.set=function(e,t){return R(this,e).set(e,t),this},j.prototype.add=j.prototype.push=function(e){return this.__data__.set(e,i),this},j.prototype.has=function(e){return this.__data__.has(e)};var z=E&&1/g(new E([,-0]))[1]==1/0?function(e){return new E(e)}:function(){};function R(e,t){var n=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?n["string"==typeof t?"string":"hash"]:n.map}function D(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return L(n)?n:void 0}function N(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}e.exports=function(e){return e&&e.length?function(e,t,n){var i=-1,o=d,s=e.length,a=!0,l=[],c=l;if(n)a=!1,o=h;else if(s>=r){var u=t?null:z(e);if(u)return g(u);a=!1,o=f,c=new j}else c=t?[]:l;e:for(;++i<s;){var p=e[i],m=t?t(p):p;if(p=n||0!==p?p:0,a&&m===m){for(var y=c.length;y--;)if(c[y]===m)continue e;t&&c.push(m),l.push(p)}else o(c,m,n)||(c!==l&&c.push(m),l.push(p))}return l}(e):[]}},4235:(e,t,n)=>{var r,i=function(){var e=String.fromCharCode,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",r={};function i(e,t){if(!r[e]){r[e]={};for(var n=0;n<e.length;n++)r[e][e.charAt(n)]=n}return r[e][t]}var o={compressToBase64:function(e){if(null==e)return"";var n=o._compress(e,6,(function(e){return t.charAt(e)}));switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:o._decompress(e.length,32,(function(n){return i(t,e.charAt(n))}))},compressToUTF16:function(t){return null==t?"":o._compress(t,15,(function(t){return e(t+32)}))+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:o._decompress(e.length,16384,(function(t){return e.charCodeAt(t)-32}))},compressToUint8Array:function(e){for(var t=o.compress(e),n=new Uint8Array(2*t.length),r=0,i=t.length;r<i;r++){var s=t.charCodeAt(r);n[2*r]=s>>>8,n[2*r+1]=s%256}return n},decompressFromUint8Array:function(t){if(null===t||void 0===t)return o.decompress(t);for(var n=new Array(t.length/2),r=0,i=n.length;r<i;r++)n[r]=256*t[2*r]+t[2*r+1];var s=[];return n.forEach((function(t){s.push(e(t))})),o.decompress(s.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":o._compress(e,6,(function(e){return n.charAt(e)}))},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),o._decompress(e.length,32,(function(t){return i(n,e.charAt(t))})))},compress:function(t){return o._compress(t,16,(function(t){return e(t)}))},_compress:function(e,t,n){if(null==e)return"";var r,i,o,s={},a={},l="",c="",u="",d=2,h=3,p=2,f=[],g=0,m=0;for(o=0;o<e.length;o+=1)if(l=e.charAt(o),Object.prototype.hasOwnProperty.call(s,l)||(s[l]=h++,a[l]=!0),c=u+l,Object.prototype.hasOwnProperty.call(s,c))u=c;else{if(Object.prototype.hasOwnProperty.call(a,u)){if(u.charCodeAt(0)<256){for(r=0;r<p;r++)g<<=1,m==t-1?(m=0,f.push(n(g)),g=0):m++;for(i=u.charCodeAt(0),r=0;r<8;r++)g=g<<1|1&i,m==t-1?(m=0,f.push(n(g)),g=0):m++,i>>=1}else{for(i=1,r=0;r<p;r++)g=g<<1|i,m==t-1?(m=0,f.push(n(g)),g=0):m++,i=0;for(i=u.charCodeAt(0),r=0;r<16;r++)g=g<<1|1&i,m==t-1?(m=0,f.push(n(g)),g=0):m++,i>>=1}0==--d&&(d=Math.pow(2,p),p++),delete a[u]}else for(i=s[u],r=0;r<p;r++)g=g<<1|1&i,m==t-1?(m=0,f.push(n(g)),g=0):m++,i>>=1;0==--d&&(d=Math.pow(2,p),p++),s[c]=h++,u=String(l)}if(""!==u){if(Object.prototype.hasOwnProperty.call(a,u)){if(u.charCodeAt(0)<256){for(r=0;r<p;r++)g<<=1,m==t-1?(m=0,f.push(n(g)),g=0):m++;for(i=u.charCodeAt(0),r=0;r<8;r++)g=g<<1|1&i,m==t-1?(m=0,f.push(n(g)),g=0):m++,i>>=1}else{for(i=1,r=0;r<p;r++)g=g<<1|i,m==t-1?(m=0,f.push(n(g)),g=0):m++,i=0;for(i=u.charCodeAt(0),r=0;r<16;r++)g=g<<1|1&i,m==t-1?(m=0,f.push(n(g)),g=0):m++,i>>=1}0==--d&&(d=Math.pow(2,p),p++),delete a[u]}else for(i=s[u],r=0;r<p;r++)g=g<<1|1&i,m==t-1?(m=0,f.push(n(g)),g=0):m++,i>>=1;0==--d&&(d=Math.pow(2,p),p++)}for(i=2,r=0;r<p;r++)g=g<<1|1&i,m==t-1?(m=0,f.push(n(g)),g=0):m++,i>>=1;for(;;){if(g<<=1,m==t-1){f.push(n(g));break}m++}return f.join("")},decompress:function(e){return null==e?"":""==e?null:o._decompress(e.length,32768,(function(t){return e.charCodeAt(t)}))},_decompress:function(t,n,r){var i,o,s,a,l,c,u,d=[],h=4,p=4,f=3,g="",m=[],y={val:r(0),position:n,index:1};for(i=0;i<3;i+=1)d[i]=i;for(s=0,l=Math.pow(2,2),c=1;c!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),s|=(a>0?1:0)*c,c<<=1;switch(s){case 0:for(s=0,l=Math.pow(2,8),c=1;c!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),s|=(a>0?1:0)*c,c<<=1;u=e(s);break;case 1:for(s=0,l=Math.pow(2,16),c=1;c!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),s|=(a>0?1:0)*c,c<<=1;u=e(s);break;case 2:return""}for(d[3]=u,o=u,m.push(u);;){if(y.index>t)return"";for(s=0,l=Math.pow(2,f),c=1;c!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),s|=(a>0?1:0)*c,c<<=1;switch(u=s){case 0:for(s=0,l=Math.pow(2,8),c=1;c!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),s|=(a>0?1:0)*c,c<<=1;d[p++]=e(s),u=p-1,h--;break;case 1:for(s=0,l=Math.pow(2,16),c=1;c!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),s|=(a>0?1:0)*c,c<<=1;d[p++]=e(s),u=p-1,h--;break;case 2:return m.join("")}if(0==h&&(h=Math.pow(2,f),f++),d[u])g=d[u];else{if(u!==p)return null;g=o+o.charAt(0)}m.push(g),d[p++]=o+g.charAt(0),o=g,0==--h&&(h=Math.pow(2,f),f++)}}};return o}();void 0===(r=function(){return i}.call(t,n,t,e))||(e.exports=r)},4463:(e,t,n)=>{"use strict";var r=n(2791),i=n(5296);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,a={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(a[e]=t,e=0;e<t.length;e++)s.add(t[e])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={};function g(e,t,n,r,i,o,s){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=s}var m={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){m[e]=new g(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];m[t]=new g(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){m[e]=new g(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){m[e]=new g(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){m[e]=new g(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){m[e]=new g(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){m[e]=new g(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){m[e]=new g(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){m[e]=new g(e,5,!1,e.toLowerCase(),null,!1,!1)}));var y=/[\-:]([a-z])/g;function v(e){return e[1].toUpperCase()}function b(e,t,n,r){var i=m.hasOwnProperty(t)?m[t]:null;(null!==i?0!==i.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!d.call(f,e)||!d.call(p,e)&&(h.test(e)?f[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(y,v);m[t]=new g(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(y,v);m[t]=new g(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(y,v);m[t]=new g(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){m[e]=new g(e,1,!1,e.toLowerCase(),null,!1,!1)})),m.xlinkHref=new g("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){m[e]=new g(e,1,!1,e.toLowerCase(),null,!0,!0)}));var w=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,x=Symbol.for("react.element"),S=Symbol.for("react.portal"),k=Symbol.for("react.fragment"),_=Symbol.for("react.strict_mode"),P=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),E=Symbol.for("react.context"),I=Symbol.for("react.forward_ref"),M=Symbol.for("react.suspense"),T=Symbol.for("react.suspense_list"),A=Symbol.for("react.memo"),j=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var O=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var L=Symbol.iterator;function z(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=L&&e[L]||e["@@iterator"])?e:null}var R,D=Object.assign;function N(e){if(void 0===R)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);R=t&&t[1]||""}return"\n"+R+e}var F=!1;function B(e,t){if(!e||F)return"";F=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var i=c.stack.split("\n"),o=r.stack.split("\n"),s=i.length-1,a=o.length-1;1<=s&&0<=a&&i[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(i[s]!==o[a]){if(1!==s||1!==a)do{if(s--,0>--a||i[s]!==o[a]){var l="\n"+i[s].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=s&&0<=a);break}}}finally{F=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?N(e):""}function U(e){switch(e.tag){case 5:return N(e.type);case 16:return N("Lazy");case 13:return N("Suspense");case 19:return N("SuspenseList");case 0:case 2:case 15:return e=B(e.type,!1);case 11:return e=B(e.type.render,!1);case 1:return e=B(e.type,!0);default:return""}}function H(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case k:return"Fragment";case S:return"Portal";case P:return"Profiler";case _:return"StrictMode";case M:return"Suspense";case T:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case E:return(e.displayName||"Context")+".Consumer";case C:return(e._context.displayName||"Context")+".Provider";case I:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case A:return null!==(t=e.displayName||null)?t:H(e.type)||"Memo";case j:t=e._payload,e=e._init;try{return H(e(t))}catch(n){}}return null}function V(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return H(t);case 8:return t===_?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function K(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function W(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function $(e){e._valueTracker||(e._valueTracker=function(e){var t=W(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Y(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=W(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function q(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function G(e,t){var n=t.checked;return D({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function X(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=K(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Q(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function Z(e,t){Q(e,t);var n=K(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,K(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function J(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&q(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+K(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return D({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ie(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(o(92));if(te(n)){if(1<n.length)throw Error(o(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:K(n)}}function oe(e,t){var n=K(t.value),r=K(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function se(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function ae(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?ae(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue,de=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return ue(e,t)}))}:ue);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fe=["Webkit","ms","Moz","O"];function ge(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function me(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=ge(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(pe).forEach((function(e){fe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]}))}));var ye=D({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ve(e,t){if(t){if(ye[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(o(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var we=null;function xe(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Se=null,ke=null,_e=null;function Pe(e){if(e=bi(e)){if("function"!==typeof Se)throw Error(o(280));var t=e.stateNode;t&&(t=xi(t),Se(e.stateNode,e.type,t))}}function Ce(e){ke?_e?_e.push(e):_e=[e]:ke=e}function Ee(){if(ke){var e=ke,t=_e;if(_e=ke=null,Pe(e),t)for(e=0;e<t.length;e++)Pe(t[e])}}function Ie(e,t){return e(t)}function Me(){}var Te=!1;function Ae(e,t,n){if(Te)return e(t,n);Te=!0;try{return Ie(e,t,n)}finally{Te=!1,(null!==ke||null!==_e)&&(Me(),Ee())}}function je(e,t){var n=e.stateNode;if(null===n)return null;var r=xi(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(o(231,t,typeof n));return n}var Oe=!1;if(u)try{var Le={};Object.defineProperty(Le,"passive",{get:function(){Oe=!0}}),window.addEventListener("test",Le,Le),window.removeEventListener("test",Le,Le)}catch(ue){Oe=!1}function ze(e,t,n,r,i,o,s,a,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(u){this.onError(u)}}var Re=!1,De=null,Ne=!1,Fe=null,Be={onError:function(e){Re=!0,De=e}};function Ue(e,t,n,r,i,o,s,a,l){Re=!1,De=null,ze.apply(Be,arguments)}function He(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Ve(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ke(e){if(He(e)!==e)throw Error(o(188))}function We(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=He(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var s=i.alternate;if(null===s){if(null!==(r=i.return)){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return Ke(i),e;if(s===r)return Ke(i),t;s=s.sibling}throw Error(o(188))}if(n.return!==r.return)n=i,r=s;else{for(var a=!1,l=i.child;l;){if(l===n){a=!0,n=i,r=s;break}if(l===r){a=!0,r=i,n=s;break}l=l.sibling}if(!a){for(l=s.child;l;){if(l===n){a=!0,n=s,r=i;break}if(l===r){a=!0,r=s,n=i;break}l=l.sibling}if(!a)throw Error(o(189))}}if(n.alternate!==r)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}(e))?$e(e):null}function $e(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=$e(e);if(null!==t)return t;e=e.sibling}return null}var Ye=i.unstable_scheduleCallback,qe=i.unstable_cancelCallback,Ge=i.unstable_shouldYield,Xe=i.unstable_requestPaint,Qe=i.unstable_now,Ze=i.unstable_getCurrentPriorityLevel,Je=i.unstable_ImmediatePriority,et=i.unstable_UserBlockingPriority,tt=i.unstable_NormalPriority,nt=i.unstable_LowPriority,rt=i.unstable_IdlePriority,it=null,ot=null;var st=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(at(e)/lt|0)|0},at=Math.log,lt=Math.LN2;var ct=64,ut=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,o=e.pingedLanes,s=268435455&n;if(0!==s){var a=s&~i;0!==a?r=dt(a):0!==(o&=s)&&(r=dt(o))}else 0!==(s=n&~i)?r=dt(s):0!==o&&(r=dt(o));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&i)&&((i=r&-r)>=(o=t&-t)||16===i&&0!==(4194240&o)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-st(t)),r|=e[n],t&=~i;return r}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ft(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function gt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function mt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function yt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-st(t)]=n}function vt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-st(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var bt=0;function wt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var xt,St,kt,_t,Pt,Ct=!1,Et=[],It=null,Mt=null,Tt=null,At=new Map,jt=new Map,Ot=[],Lt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function zt(e,t){switch(e){case"focusin":case"focusout":It=null;break;case"dragenter":case"dragleave":Mt=null;break;case"mouseover":case"mouseout":Tt=null;break;case"pointerover":case"pointerout":At.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":jt.delete(t.pointerId)}}function Rt(e,t,n,r,i,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},null!==t&&(null!==(t=bi(t))&&St(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function Dt(e){var t=vi(e.target);if(null!==t){var n=He(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Ve(n)))return e.blockedOn=t,void Pt(e.priority,(function(){kt(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Nt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Gt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=bi(n))&&St(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);we=r,n.target.dispatchEvent(r),we=null,t.shift()}return!0}function Ft(e,t,n){Nt(e)&&n.delete(t)}function Bt(){Ct=!1,null!==It&&Nt(It)&&(It=null),null!==Mt&&Nt(Mt)&&(Mt=null),null!==Tt&&Nt(Tt)&&(Tt=null),At.forEach(Ft),jt.forEach(Ft)}function Ut(e,t){e.blockedOn===t&&(e.blockedOn=null,Ct||(Ct=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Bt)))}function Ht(e){function t(t){return Ut(t,e)}if(0<Et.length){Ut(Et[0],e);for(var n=1;n<Et.length;n++){var r=Et[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==It&&Ut(It,e),null!==Mt&&Ut(Mt,e),null!==Tt&&Ut(Tt,e),At.forEach(t),jt.forEach(t),n=0;n<Ot.length;n++)(r=Ot[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Ot.length&&null===(n=Ot[0]).blockedOn;)Dt(n),null===n.blockedOn&&Ot.shift()}var Vt=w.ReactCurrentBatchConfig,Kt=!0;function Wt(e,t,n,r){var i=bt,o=Vt.transition;Vt.transition=null;try{bt=1,Yt(e,t,n,r)}finally{bt=i,Vt.transition=o}}function $t(e,t,n,r){var i=bt,o=Vt.transition;Vt.transition=null;try{bt=4,Yt(e,t,n,r)}finally{bt=i,Vt.transition=o}}function Yt(e,t,n,r){if(Kt){var i=Gt(e,t,n,r);if(null===i)Kr(e,t,r,qt,n),zt(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return It=Rt(It,e,t,n,r,i),!0;case"dragenter":return Mt=Rt(Mt,e,t,n,r,i),!0;case"mouseover":return Tt=Rt(Tt,e,t,n,r,i),!0;case"pointerover":var o=i.pointerId;return At.set(o,Rt(At.get(o)||null,e,t,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,jt.set(o,Rt(jt.get(o)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(zt(e,r),4&t&&-1<Lt.indexOf(e)){for(;null!==i;){var o=bi(i);if(null!==o&&xt(o),null===(o=Gt(e,t,n,r))&&Kr(e,t,r,qt,n),o===i)break;i=o}null!==i&&r.stopPropagation()}else Kr(e,t,r,null,n)}}var qt=null;function Gt(e,t,n,r){if(qt=null,null!==(e=vi(e=xe(r))))if(null===(t=He(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Ve(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return qt=e,null}function Xt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ze()){case Je:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Qt=null,Zt=null,Jt=null;function en(){if(Jt)return Jt;var e,t,n=Zt,r=n.length,i="value"in Qt?Qt.value:Qt.textContent,o=i.length;for(e=0;e<r&&n[e]===i[e];e++);var s=r-e;for(t=1;t<=s&&n[r-t]===i[o-t];t++);return Jt=i.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function on(e){function t(t,n,r,i,o){for(var s in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(i):i[s]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return D(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var sn,an,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=on(cn),dn=D({},cn,{view:0,detail:0}),hn=on(dn),pn=D({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Pn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(sn=e.screenX-ln.screenX,an=e.screenY-ln.screenY):an=sn=0,ln=e),sn)},movementY:function(e){return"movementY"in e?e.movementY:an}}),fn=on(pn),gn=on(D({},pn,{dataTransfer:0})),mn=on(D({},dn,{relatedTarget:0})),yn=on(D({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),vn=D({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=on(vn),wn=on(D({},cn,{data:0})),xn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Sn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},kn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function _n(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=kn[e])&&!!t[e]}function Pn(){return _n}var Cn=D({},dn,{key:function(e){if(e.key){var t=xn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Sn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Pn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),En=on(Cn),In=on(D({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Mn=on(D({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Pn})),Tn=on(D({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),An=D({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),jn=on(An),On=[9,13,27,32],Ln=u&&"CompositionEvent"in window,zn=null;u&&"documentMode"in document&&(zn=document.documentMode);var Rn=u&&"TextEvent"in window&&!zn,Dn=u&&(!Ln||zn&&8<zn&&11>=zn),Nn=String.fromCharCode(32),Fn=!1;function Bn(e,t){switch(e){case"keyup":return-1!==On.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Un(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Hn=!1;var Vn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Kn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Vn[e.type]:"textarea"===t}function Wn(e,t,n,r){Ce(r),0<(t=$r(t,"onChange")).length&&(n=new un("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var $n=null,Yn=null;function qn(e){Nr(e,0)}function Gn(e){if(Y(wi(e)))return e}function Xn(e,t){if("change"===e)return t}var Qn=!1;if(u){var Zn;if(u){var Jn="oninput"in document;if(!Jn){var er=document.createElement("div");er.setAttribute("oninput","return;"),Jn="function"===typeof er.oninput}Zn=Jn}else Zn=!1;Qn=Zn&&(!document.documentMode||9<document.documentMode)}function tr(){$n&&($n.detachEvent("onpropertychange",nr),Yn=$n=null)}function nr(e){if("value"===e.propertyName&&Gn(Yn)){var t=[];Wn(t,Yn,e,xe(e)),Ae(qn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Yn=n,($n=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ir(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Gn(Yn)}function or(e,t){if("click"===e)return Gn(t)}function sr(e,t){if("input"===e||"change"===e)return Gn(t)}var ar="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function lr(e,t){if(ar(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!d.call(t,i)||!ar(e[i],t[i]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ur(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function dr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?dr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hr(){for(var e=window,t=q();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=q((e=t.contentWindow).document)}return t}function pr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function fr(e){var t=hr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&dr(n.ownerDocument.documentElement,n)){if(null!==r&&pr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,o=Math.min(r.start,i);r=void 0===r.end?o:Math.min(r.end,i),!e.extend&&o>r&&(i=r,r=o,o=i),i=ur(n,o);var s=ur(n,r);i&&s&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),o>r?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var gr=u&&"documentMode"in document&&11>=document.documentMode,mr=null,yr=null,vr=null,br=!1;function wr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;br||null==mr||mr!==q(r)||("selectionStart"in(r=mr)&&pr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},vr&&lr(vr,r)||(vr=r,0<(r=$r(yr,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=mr)))}function xr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Sr={animationend:xr("Animation","AnimationEnd"),animationiteration:xr("Animation","AnimationIteration"),animationstart:xr("Animation","AnimationStart"),transitionend:xr("Transition","TransitionEnd")},kr={},_r={};function Pr(e){if(kr[e])return kr[e];if(!Sr[e])return e;var t,n=Sr[e];for(t in n)if(n.hasOwnProperty(t)&&t in _r)return kr[e]=n[t];return e}u&&(_r=document.createElement("div").style,"AnimationEvent"in window||(delete Sr.animationend.animation,delete Sr.animationiteration.animation,delete Sr.animationstart.animation),"TransitionEvent"in window||delete Sr.transitionend.transition);var Cr=Pr("animationend"),Er=Pr("animationiteration"),Ir=Pr("animationstart"),Mr=Pr("transitionend"),Tr=new Map,Ar="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function jr(e,t){Tr.set(e,t),l(t,[e])}for(var Or=0;Or<Ar.length;Or++){var Lr=Ar[Or];jr(Lr.toLowerCase(),"on"+(Lr[0].toUpperCase()+Lr.slice(1)))}jr(Cr,"onAnimationEnd"),jr(Er,"onAnimationIteration"),jr(Ir,"onAnimationStart"),jr("dblclick","onDoubleClick"),jr("focusin","onFocus"),jr("focusout","onBlur"),jr(Mr,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var zr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Rr=new Set("cancel close invalid load scroll toggle".split(" ").concat(zr));function Dr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,s,a,l,c){if(Ue.apply(this,arguments),Re){if(!Re)throw Error(o(198));var u=De;Re=!1,De=null,Ne||(Ne=!0,Fe=u)}}(r,t,void 0,e),e.currentTarget=null}function Nr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var o=void 0;if(t)for(var s=r.length-1;0<=s;s--){var a=r[s],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==o&&i.isPropagationStopped())break e;Dr(i,a,c),o=l}else for(s=0;s<r.length;s++){if(l=(a=r[s]).instance,c=a.currentTarget,a=a.listener,l!==o&&i.isPropagationStopped())break e;Dr(i,a,c),o=l}}}if(Ne)throw e=Fe,Ne=!1,Fe=null,e}function Fr(e,t){var n=t[gi];void 0===n&&(n=t[gi]=new Set);var r=e+"__bubble";n.has(r)||(Vr(t,e,2,!1),n.add(r))}function Br(e,t,n){var r=0;t&&(r|=4),Vr(n,e,r,t)}var Ur="_reactListening"+Math.random().toString(36).slice(2);function Hr(e){if(!e[Ur]){e[Ur]=!0,s.forEach((function(t){"selectionchange"!==t&&(Rr.has(t)||Br(t,!1,e),Br(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Ur]||(t[Ur]=!0,Br("selectionchange",!1,t))}}function Vr(e,t,n,r){switch(Xt(t)){case 1:var i=Wt;break;case 4:i=$t;break;default:i=Yt}n=i.bind(null,t,n,e),i=void 0,!Oe||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Kr(e,t,n,r,i){var o=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var s=r.tag;if(3===s||4===s){var a=r.stateNode.containerInfo;if(a===i||8===a.nodeType&&a.parentNode===i)break;if(4===s)for(s=r.return;null!==s;){var l=s.tag;if((3===l||4===l)&&((l=s.stateNode.containerInfo)===i||8===l.nodeType&&l.parentNode===i))return;s=s.return}for(;null!==a;){if(null===(s=vi(a)))return;if(5===(l=s.tag)||6===l){r=o=s;continue e}a=a.parentNode}}r=r.return}Ae((function(){var r=o,i=xe(n),s=[];e:{var a=Tr.get(e);if(void 0!==a){var l=un,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=En;break;case"focusin":c="focus",l=mn;break;case"focusout":c="blur",l=mn;break;case"beforeblur":case"afterblur":l=mn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=fn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=gn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Mn;break;case Cr:case Er:case Ir:l=yn;break;case Mr:l=Tn;break;case"scroll":l=hn;break;case"wheel":l=jn;break;case"copy":case"cut":case"paste":l=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=In}var u=0!==(4&t),d=!u&&"scroll"===e,h=u?null!==a?a+"Capture":null:a;u=[];for(var p,f=r;null!==f;){var g=(p=f).stateNode;if(5===p.tag&&null!==g&&(p=g,null!==h&&(null!=(g=je(f,h))&&u.push(Wr(f,g,p)))),d)break;f=f.return}0<u.length&&(a=new l(a,c,null,n,i),s.push({event:a,listeners:u}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||n===we||!(c=n.relatedTarget||n.fromElement)||!vi(c)&&!c[fi])&&(l||a)&&(a=i.window===i?i:(a=i.ownerDocument)?a.defaultView||a.parentWindow:window,l?(l=r,null!==(c=(c=n.relatedTarget||n.toElement)?vi(c):null)&&(c!==(d=He(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=r),l!==c)){if(u=fn,g="onMouseLeave",h="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=In,g="onPointerLeave",h="onPointerEnter",f="pointer"),d=null==l?a:wi(l),p=null==c?a:wi(c),(a=new u(g,f+"leave",l,n,i)).target=d,a.relatedTarget=p,g=null,vi(i)===r&&((u=new u(h,f+"enter",c,n,i)).target=p,u.relatedTarget=d,g=u),d=g,l&&c)e:{for(h=c,f=0,p=u=l;p;p=Yr(p))f++;for(p=0,g=h;g;g=Yr(g))p++;for(;0<f-p;)u=Yr(u),f--;for(;0<p-f;)h=Yr(h),p--;for(;f--;){if(u===h||null!==h&&u===h.alternate)break e;u=Yr(u),h=Yr(h)}u=null}else u=null;null!==l&&qr(s,a,l,u,!1),null!==c&&null!==d&&qr(s,d,c,u,!0)}if("select"===(l=(a=r?wi(r):window).nodeName&&a.nodeName.toLowerCase())||"input"===l&&"file"===a.type)var m=Xn;else if(Kn(a))if(Qn)m=sr;else{m=ir;var y=rr}else(l=a.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(m=or);switch(m&&(m=m(e,r))?Wn(s,m,n,i):(y&&y(e,a,r),"focusout"===e&&(y=a._wrapperState)&&y.controlled&&"number"===a.type&&ee(a,"number",a.value)),y=r?wi(r):window,e){case"focusin":(Kn(y)||"true"===y.contentEditable)&&(mr=y,yr=r,vr=null);break;case"focusout":vr=yr=mr=null;break;case"mousedown":br=!0;break;case"contextmenu":case"mouseup":case"dragend":br=!1,wr(s,n,i);break;case"selectionchange":if(gr)break;case"keydown":case"keyup":wr(s,n,i)}var v;if(Ln)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Hn?Bn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(Dn&&"ko"!==n.locale&&(Hn||"onCompositionStart"!==b?"onCompositionEnd"===b&&Hn&&(v=en()):(Zt="value"in(Qt=i)?Qt.value:Qt.textContent,Hn=!0)),0<(y=$r(r,b)).length&&(b=new wn(b,e,null,n,i),s.push({event:b,listeners:y}),v?b.data=v:null!==(v=Un(n))&&(b.data=v))),(v=Rn?function(e,t){switch(e){case"compositionend":return Un(t);case"keypress":return 32!==t.which?null:(Fn=!0,Nn);case"textInput":return(e=t.data)===Nn&&Fn?null:e;default:return null}}(e,n):function(e,t){if(Hn)return"compositionend"===e||!Ln&&Bn(e,t)?(e=en(),Jt=Zt=Qt=null,Hn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Dn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=$r(r,"onBeforeInput")).length&&(i=new wn("onBeforeInput","beforeinput",null,n,i),s.push({event:i,listeners:r}),i.data=v))}Nr(s,t)}))}function Wr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function $r(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,o=i.stateNode;5===i.tag&&null!==o&&(i=o,null!=(o=je(e,n))&&r.unshift(Wr(e,o,i)),null!=(o=je(e,t))&&r.push(Wr(e,o,i))),e=e.return}return r}function Yr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function qr(e,t,n,r,i){for(var o=t._reactName,s=[];null!==n&&n!==r;){var a=n,l=a.alternate,c=a.stateNode;if(null!==l&&l===r)break;5===a.tag&&null!==c&&(a=c,i?null!=(l=je(n,o))&&s.unshift(Wr(n,l,a)):i||null!=(l=je(n,o))&&s.push(Wr(n,l,a))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}var Gr=/\r\n?/g,Xr=/\u0000|\uFFFD/g;function Qr(e){return("string"===typeof e?e:""+e).replace(Gr,"\n").replace(Xr,"")}function Zr(e,t,n){if(t=Qr(t),Qr(e)!==t&&n)throw Error(o(425))}function Jr(){}var ei=null,ti=null;function ni(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ri="function"===typeof setTimeout?setTimeout:void 0,ii="function"===typeof clearTimeout?clearTimeout:void 0,oi="function"===typeof Promise?Promise:void 0,si="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof oi?function(e){return oi.resolve(null).then(e).catch(ai)}:ri;function ai(e){setTimeout((function(){throw e}))}function li(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===r)return e.removeChild(i),void Ht(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=i}while(n);Ht(t)}function ci(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ui(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var di=Math.random().toString(36).slice(2),hi="__reactFiber$"+di,pi="__reactProps$"+di,fi="__reactContainer$"+di,gi="__reactEvents$"+di,mi="__reactListeners$"+di,yi="__reactHandles$"+di;function vi(e){var t=e[hi];if(t)return t;for(var n=e.parentNode;n;){if(t=n[fi]||n[hi]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ui(e);null!==e;){if(n=e[hi])return n;e=ui(e)}return t}n=(e=n).parentNode}return null}function bi(e){return!(e=e[hi]||e[fi])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function wi(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function xi(e){return e[pi]||null}var Si=[],ki=-1;function _i(e){return{current:e}}function Pi(e){0>ki||(e.current=Si[ki],Si[ki]=null,ki--)}function Ci(e,t){ki++,Si[ki]=e.current,e.current=t}var Ei={},Ii=_i(Ei),Mi=_i(!1),Ti=Ei;function Ai(e,t){var n=e.type.contextTypes;if(!n)return Ei;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,o={};for(i in n)o[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function ji(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Oi(){Pi(Mi),Pi(Ii)}function Li(e,t,n){if(Ii.current!==Ei)throw Error(o(168));Ci(Ii,t),Ci(Mi,n)}function zi(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in t))throw Error(o(108,V(e)||"Unknown",i));return D({},n,r)}function Ri(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ei,Ti=Ii.current,Ci(Ii,e),Ci(Mi,Mi.current),!0}function Di(e,t,n){var r=e.stateNode;if(!r)throw Error(o(169));n?(e=zi(e,t,Ti),r.__reactInternalMemoizedMergedChildContext=e,Pi(Mi),Pi(Ii),Ci(Ii,e)):Pi(Mi),Ci(Mi,n)}var Ni=null,Fi=!1,Bi=!1;function Ui(e){null===Ni?Ni=[e]:Ni.push(e)}function Hi(){if(!Bi&&null!==Ni){Bi=!0;var e=0,t=bt;try{var n=Ni;for(bt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Ni=null,Fi=!1}catch(i){throw null!==Ni&&(Ni=Ni.slice(e+1)),Ye(Je,Hi),i}finally{bt=t,Bi=!1}}return null}var Vi=[],Ki=0,Wi=null,$i=0,Yi=[],qi=0,Gi=null,Xi=1,Qi="";function Zi(e,t){Vi[Ki++]=$i,Vi[Ki++]=Wi,Wi=e,$i=t}function Ji(e,t,n){Yi[qi++]=Xi,Yi[qi++]=Qi,Yi[qi++]=Gi,Gi=e;var r=Xi;e=Qi;var i=32-st(r)-1;r&=~(1<<i),n+=1;var o=32-st(t)+i;if(30<o){var s=i-i%5;o=(r&(1<<s)-1).toString(32),r>>=s,i-=s,Xi=1<<32-st(t)+i|n<<i|r,Qi=o+e}else Xi=1<<o|n<<i|r,Qi=e}function eo(e){null!==e.return&&(Zi(e,1),Ji(e,1,0))}function to(e){for(;e===Wi;)Wi=Vi[--Ki],Vi[Ki]=null,$i=Vi[--Ki],Vi[Ki]=null;for(;e===Gi;)Gi=Yi[--qi],Yi[qi]=null,Qi=Yi[--qi],Yi[qi]=null,Xi=Yi[--qi],Yi[qi]=null}var no=null,ro=null,io=!1,oo=null;function so(e,t){var n=jc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function ao(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,no=e,ro=ci(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,no=e,ro=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Gi?{id:Xi,overflow:Qi}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=jc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,no=e,ro=null,!0);default:return!1}}function lo(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function co(e){if(io){var t=ro;if(t){var n=t;if(!ao(e,t)){if(lo(e))throw Error(o(418));t=ci(n.nextSibling);var r=no;t&&ao(e,t)?so(r,n):(e.flags=-4097&e.flags|2,io=!1,no=e)}}else{if(lo(e))throw Error(o(418));e.flags=-4097&e.flags|2,io=!1,no=e}}}function uo(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;no=e}function ho(e){if(e!==no)return!1;if(!io)return uo(e),io=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ni(e.type,e.memoizedProps)),t&&(t=ro)){if(lo(e))throw po(),Error(o(418));for(;t;)so(e,t),t=ci(t.nextSibling)}if(uo(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ro=ci(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ro=null}}else ro=no?ci(e.stateNode.nextSibling):null;return!0}function po(){for(var e=ro;e;)e=ci(e.nextSibling)}function fo(){ro=no=null,io=!1}function go(e){null===oo?oo=[e]:oo.push(e)}var mo=w.ReactCurrentBatchConfig;function yo(e,t){if(e&&e.defaultProps){for(var n in t=D({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var vo=_i(null),bo=null,wo=null,xo=null;function So(){xo=wo=bo=null}function ko(e){var t=vo.current;Pi(vo),e._currentValue=t}function _o(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Po(e,t){bo=e,xo=wo=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(wa=!0),e.firstContext=null)}function Co(e){var t=e._currentValue;if(xo!==e)if(e={context:e,memoizedValue:t,next:null},null===wo){if(null===bo)throw Error(o(308));wo=e,bo.dependencies={lanes:0,firstContext:e}}else wo=wo.next=e;return t}var Eo=null;function Io(e){null===Eo?Eo=[e]:Eo.push(e)}function Mo(e,t,n,r){var i=t.interleaved;return null===i?(n.next=n,Io(t)):(n.next=i.next,i.next=n),t.interleaved=n,To(e,r)}function To(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Ao=!1;function jo(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Oo(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Lo(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function zo(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Ml)){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,To(e,n)}return null===(i=r.interleaved)?(t.next=t,Io(r)):(t.next=i.next,i.next=t),r.interleaved=t,To(e,n)}function Ro(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,vt(e,n)}}function Do(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===o?i=o=s:o=o.next=s,n=n.next}while(null!==n);null===o?i=o=t:o=o.next=t}else i=o=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function No(e,t,n,r){var i=e.updateQueue;Ao=!1;var o=i.firstBaseUpdate,s=i.lastBaseUpdate,a=i.shared.pending;if(null!==a){i.shared.pending=null;var l=a,c=l.next;l.next=null,null===s?o=c:s.next=c,s=l;var u=e.alternate;null!==u&&((a=(u=u.updateQueue).lastBaseUpdate)!==s&&(null===a?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(null!==o){var d=i.baseState;for(s=0,u=c=l=null,a=o;;){var h=a.lane,p=a.eventTime;if((r&h)===h){null!==u&&(u=u.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var f=e,g=a;switch(h=t,p=n,g.tag){case 1:if("function"===typeof(f=g.payload)){d=f.call(p,d,h);break e}d=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(h="function"===typeof(f=g.payload)?f.call(p,d,h):f)||void 0===h)break e;d=D({},d,h);break e;case 2:Ao=!0}}null!==a.callback&&0!==a.lane&&(e.flags|=64,null===(h=i.effects)?i.effects=[a]:h.push(a))}else p={eventTime:p,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===u?(c=u=p,l=d):u=u.next=p,s|=h;if(null===(a=a.next)){if(null===(a=i.shared.pending))break;a=(h=a).next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}if(null===u&&(l=d),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,null!==(t=i.shared.interleaved)){i=t;do{s|=i.lane,i=i.next}while(i!==t)}else null===o&&(i.shared.lanes=0);Dl|=s,e.lanes=s,e.memoizedState=d}}function Fo(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!==typeof i)throw Error(o(191,i));i.call(r)}}}var Bo=(new r.Component).refs;function Uo(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:D({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Ho={isMounted:function(e){return!!(e=e._reactInternals)&&He(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=tc(),i=nc(e),o=Lo(r,i);o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=zo(e,o,i))&&(rc(t,e,i,r),Ro(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=tc(),i=nc(e),o=Lo(r,i);o.tag=1,o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=zo(e,o,i))&&(rc(t,e,i,r),Ro(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=tc(),r=nc(e),i=Lo(n,r);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),null!==(t=zo(e,i,r))&&(rc(t,e,r,n),Ro(t,e,r))}};function Vo(e,t,n,r,i,o,s){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,o,s):!t.prototype||!t.prototype.isPureReactComponent||(!lr(n,r)||!lr(i,o))}function Ko(e,t,n){var r=!1,i=Ei,o=t.contextType;return"object"===typeof o&&null!==o?o=Co(o):(i=ji(t)?Ti:Ii.current,o=(r=null!==(r=t.contextTypes)&&void 0!==r)?Ai(e,i):Ei),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Ho,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=o),t}function Wo(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Ho.enqueueReplaceState(t,t.state,null)}function $o(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=Bo,jo(e);var o=t.contextType;"object"===typeof o&&null!==o?i.context=Co(o):(o=ji(t)?Ti:Ii.current,i.context=Ai(e,o)),i.state=e.memoizedState,"function"===typeof(o=t.getDerivedStateFromProps)&&(Uo(e,t,o,n),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&Ho.enqueueReplaceState(i,i.state,null),No(e,n,i,r),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4194308)}function Yo(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var r=n.stateNode}if(!r)throw Error(o(147,e));var i=r,s=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===s?t.ref:(t=function(e){var t=i.refs;t===Bo&&(t=i.refs={}),null===e?delete t[s]:t[s]=e},t._stringRef=s,t)}if("string"!==typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function qo(e,t){throw e=Object.prototype.toString.call(t),Error(o(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Go(e){return(0,e._init)(e._payload)}function Xo(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Lc(e,t)).index=0,e.sibling=null,e}function s(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function a(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=Nc(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function c(e,t,n,r){var o=n.type;return o===k?d(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===o||"object"===typeof o&&null!==o&&o.$$typeof===j&&Go(o)===t.type)?((r=i(t,n.props)).ref=Yo(e,t,n),r.return=e,r):((r=zc(n.type,n.key,n.props,null,e.mode,r)).ref=Yo(e,t,n),r.return=e,r)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Fc(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function d(e,t,n,r,o){return null===t||7!==t.tag?((t=Rc(n,e.mode,r,o)).return=e,t):((t=i(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Nc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case x:return(n=zc(t.type,t.key,t.props,null,e.mode,n)).ref=Yo(e,null,t),n.return=e,n;case S:return(t=Fc(t,e.mode,n)).return=e,t;case j:return h(e,(0,t._init)(t._payload),n)}if(te(t)||z(t))return(t=Rc(t,e.mode,n,null)).return=e,t;qo(e,t)}return null}function p(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==i?null:l(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case x:return n.key===i?c(e,t,n,r):null;case S:return n.key===i?u(e,t,n,r):null;case j:return p(e,t,(i=n._init)(n._payload),r)}if(te(n)||z(n))return null!==i?null:d(e,t,n,r,null);qo(e,n)}return null}function f(e,t,n,r,i){if("string"===typeof r&&""!==r||"number"===typeof r)return l(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case x:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i);case S:return u(t,e=e.get(null===r.key?n:r.key)||null,r,i);case j:return f(e,t,n,(0,r._init)(r._payload),i)}if(te(r)||z(r))return d(t,e=e.get(n)||null,r,i,null);qo(t,r)}return null}function g(i,o,a,l){for(var c=null,u=null,d=o,g=o=0,m=null;null!==d&&g<a.length;g++){d.index>g?(m=d,d=null):m=d.sibling;var y=p(i,d,a[g],l);if(null===y){null===d&&(d=m);break}e&&d&&null===y.alternate&&t(i,d),o=s(y,o,g),null===u?c=y:u.sibling=y,u=y,d=m}if(g===a.length)return n(i,d),io&&Zi(i,g),c;if(null===d){for(;g<a.length;g++)null!==(d=h(i,a[g],l))&&(o=s(d,o,g),null===u?c=d:u.sibling=d,u=d);return io&&Zi(i,g),c}for(d=r(i,d);g<a.length;g++)null!==(m=f(d,i,g,a[g],l))&&(e&&null!==m.alternate&&d.delete(null===m.key?g:m.key),o=s(m,o,g),null===u?c=m:u.sibling=m,u=m);return e&&d.forEach((function(e){return t(i,e)})),io&&Zi(i,g),c}function m(i,a,l,c){var u=z(l);if("function"!==typeof u)throw Error(o(150));if(null==(l=u.call(l)))throw Error(o(151));for(var d=u=null,g=a,m=a=0,y=null,v=l.next();null!==g&&!v.done;m++,v=l.next()){g.index>m?(y=g,g=null):y=g.sibling;var b=p(i,g,v.value,c);if(null===b){null===g&&(g=y);break}e&&g&&null===b.alternate&&t(i,g),a=s(b,a,m),null===d?u=b:d.sibling=b,d=b,g=y}if(v.done)return n(i,g),io&&Zi(i,m),u;if(null===g){for(;!v.done;m++,v=l.next())null!==(v=h(i,v.value,c))&&(a=s(v,a,m),null===d?u=v:d.sibling=v,d=v);return io&&Zi(i,m),u}for(g=r(i,g);!v.done;m++,v=l.next())null!==(v=f(g,i,m,v.value,c))&&(e&&null!==v.alternate&&g.delete(null===v.key?m:v.key),a=s(v,a,m),null===d?u=v:d.sibling=v,d=v);return e&&g.forEach((function(e){return t(i,e)})),io&&Zi(i,m),u}return function e(r,o,s,l){if("object"===typeof s&&null!==s&&s.type===k&&null===s.key&&(s=s.props.children),"object"===typeof s&&null!==s){switch(s.$$typeof){case x:e:{for(var c=s.key,u=o;null!==u;){if(u.key===c){if((c=s.type)===k){if(7===u.tag){n(r,u.sibling),(o=i(u,s.props.children)).return=r,r=o;break e}}else if(u.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===j&&Go(c)===u.type){n(r,u.sibling),(o=i(u,s.props)).ref=Yo(r,u,s),o.return=r,r=o;break e}n(r,u);break}t(r,u),u=u.sibling}s.type===k?((o=Rc(s.props.children,r.mode,l,s.key)).return=r,r=o):((l=zc(s.type,s.key,s.props,null,r.mode,l)).ref=Yo(r,o,s),l.return=r,r=l)}return a(r);case S:e:{for(u=s.key;null!==o;){if(o.key===u){if(4===o.tag&&o.stateNode.containerInfo===s.containerInfo&&o.stateNode.implementation===s.implementation){n(r,o.sibling),(o=i(o,s.children||[])).return=r,r=o;break e}n(r,o);break}t(r,o),o=o.sibling}(o=Fc(s,r.mode,l)).return=r,r=o}return a(r);case j:return e(r,o,(u=s._init)(s._payload),l)}if(te(s))return g(r,o,s,l);if(z(s))return m(r,o,s,l);qo(r,s)}return"string"===typeof s&&""!==s||"number"===typeof s?(s=""+s,null!==o&&6===o.tag?(n(r,o.sibling),(o=i(o,s)).return=r,r=o):(n(r,o),(o=Nc(s,r.mode,l)).return=r,r=o),a(r)):n(r,o)}}var Qo=Xo(!0),Zo=Xo(!1),Jo={},es=_i(Jo),ts=_i(Jo),ns=_i(Jo);function rs(e){if(e===Jo)throw Error(o(174));return e}function is(e,t){switch(Ci(ns,t),Ci(ts,e),Ci(es,Jo),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Pi(es),Ci(es,t)}function os(){Pi(es),Pi(ts),Pi(ns)}function ss(e){rs(ns.current);var t=rs(es.current),n=le(t,e.type);t!==n&&(Ci(ts,e),Ci(es,n))}function as(e){ts.current===e&&(Pi(es),Pi(ts))}var ls=_i(0);function cs(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var us=[];function ds(){for(var e=0;e<us.length;e++)us[e]._workInProgressVersionPrimary=null;us.length=0}var hs=w.ReactCurrentDispatcher,ps=w.ReactCurrentBatchConfig,fs=0,gs=null,ms=null,ys=null,vs=!1,bs=!1,ws=0,xs=0;function Ss(){throw Error(o(321))}function ks(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!ar(e[n],t[n]))return!1;return!0}function _s(e,t,n,r,i,s){if(fs=s,gs=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,hs.current=null===e||null===e.memoizedState?aa:la,e=n(r,i),bs){s=0;do{if(bs=!1,ws=0,25<=s)throw Error(o(301));s+=1,ys=ms=null,t.updateQueue=null,hs.current=ca,e=n(r,i)}while(bs)}if(hs.current=sa,t=null!==ms&&null!==ms.next,fs=0,ys=ms=gs=null,vs=!1,t)throw Error(o(300));return e}function Ps(){var e=0!==ws;return ws=0,e}function Cs(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ys?gs.memoizedState=ys=e:ys=ys.next=e,ys}function Es(){if(null===ms){var e=gs.alternate;e=null!==e?e.memoizedState:null}else e=ms.next;var t=null===ys?gs.memoizedState:ys.next;if(null!==t)ys=t,ms=e;else{if(null===e)throw Error(o(310));e={memoizedState:(ms=e).memoizedState,baseState:ms.baseState,baseQueue:ms.baseQueue,queue:ms.queue,next:null},null===ys?gs.memoizedState=ys=e:ys=ys.next=e}return ys}function Is(e,t){return"function"===typeof t?t(e):t}function Ms(e){var t=Es(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=ms,i=r.baseQueue,s=n.pending;if(null!==s){if(null!==i){var a=i.next;i.next=s.next,s.next=a}r.baseQueue=i=s,n.pending=null}if(null!==i){s=i.next,r=r.baseState;var l=a=null,c=null,u=s;do{var d=u.lane;if((fs&d)===d)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=h,a=r):c=c.next=h,gs.lanes|=d,Dl|=d}u=u.next}while(null!==u&&u!==s);null===c?a=r:c.next=l,ar(r,t.memoizedState)||(wa=!0),t.memoizedState=r,t.baseState=a,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){i=e;do{s=i.lane,gs.lanes|=s,Dl|=s,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Ts(e){var t=Es(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,s=t.memoizedState;if(null!==i){n.pending=null;var a=i=i.next;do{s=e(s,a.action),a=a.next}while(a!==i);ar(s,t.memoizedState)||(wa=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),n.lastRenderedState=s}return[s,r]}function As(){}function js(e,t){var n=gs,r=Es(),i=t(),s=!ar(r.memoizedState,i);if(s&&(r.memoizedState=i,wa=!0),r=r.queue,Ks(zs.bind(null,n,r,e),[e]),r.getSnapshot!==t||s||null!==ys&&1&ys.memoizedState.tag){if(n.flags|=2048,Fs(9,Ls.bind(null,n,r,i,t),void 0,null),null===Tl)throw Error(o(349));0!==(30&fs)||Os(n,t,i)}return i}function Os(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=gs.updateQueue)?(t={lastEffect:null,stores:null},gs.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Ls(e,t,n,r){t.value=n,t.getSnapshot=r,Rs(t)&&Ds(e)}function zs(e,t,n){return n((function(){Rs(t)&&Ds(e)}))}function Rs(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!ar(e,n)}catch(r){return!0}}function Ds(e){var t=To(e,1);null!==t&&rc(t,e,1,-1)}function Ns(e){var t=Cs();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Is,lastRenderedState:e},t.queue=e,e=e.dispatch=na.bind(null,gs,e),[t.memoizedState,e]}function Fs(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=gs.updateQueue)?(t={lastEffect:null,stores:null},gs.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Bs(){return Es().memoizedState}function Us(e,t,n,r){var i=Cs();gs.flags|=e,i.memoizedState=Fs(1|t,n,void 0,void 0===r?null:r)}function Hs(e,t,n,r){var i=Es();r=void 0===r?null:r;var o=void 0;if(null!==ms){var s=ms.memoizedState;if(o=s.destroy,null!==r&&ks(r,s.deps))return void(i.memoizedState=Fs(t,n,o,r))}gs.flags|=e,i.memoizedState=Fs(1|t,n,o,r)}function Vs(e,t){return Us(8390656,8,e,t)}function Ks(e,t){return Hs(2048,8,e,t)}function Ws(e,t){return Hs(4,2,e,t)}function $s(e,t){return Hs(4,4,e,t)}function Ys(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function qs(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Hs(4,4,Ys.bind(null,t,e),n)}function Gs(){}function Xs(e,t){var n=Es();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&ks(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Qs(e,t){var n=Es();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&ks(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Zs(e,t,n){return 0===(21&fs)?(e.baseState&&(e.baseState=!1,wa=!0),e.memoizedState=n):(ar(n,t)||(n=gt(),gs.lanes|=n,Dl|=n,e.baseState=!0),t)}function Js(e,t){var n=bt;bt=0!==n&&4>n?n:4,e(!0);var r=ps.transition;ps.transition={};try{e(!1),t()}finally{bt=n,ps.transition=r}}function ea(){return Es().memoizedState}function ta(e,t,n){var r=nc(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},ra(e))ia(t,n);else if(null!==(n=Mo(e,t,n,r))){rc(n,e,r,tc()),oa(n,t,r)}}function na(e,t,n){var r=nc(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(ra(e))ia(t,i);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var s=t.lastRenderedState,a=o(s,n);if(i.hasEagerState=!0,i.eagerState=a,ar(a,s)){var l=t.interleaved;return null===l?(i.next=i,Io(t)):(i.next=l.next,l.next=i),void(t.interleaved=i)}}catch(c){}null!==(n=Mo(e,t,i,r))&&(rc(n,e,r,i=tc()),oa(n,t,r))}}function ra(e){var t=e.alternate;return e===gs||null!==t&&t===gs}function ia(e,t){bs=vs=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function oa(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,vt(e,n)}}var sa={readContext:Co,useCallback:Ss,useContext:Ss,useEffect:Ss,useImperativeHandle:Ss,useInsertionEffect:Ss,useLayoutEffect:Ss,useMemo:Ss,useReducer:Ss,useRef:Ss,useState:Ss,useDebugValue:Ss,useDeferredValue:Ss,useTransition:Ss,useMutableSource:Ss,useSyncExternalStore:Ss,useId:Ss,unstable_isNewReconciler:!1},aa={readContext:Co,useCallback:function(e,t){return Cs().memoizedState=[e,void 0===t?null:t],e},useContext:Co,useEffect:Vs,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Us(4194308,4,Ys.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Us(4194308,4,e,t)},useInsertionEffect:function(e,t){return Us(4,2,e,t)},useMemo:function(e,t){var n=Cs();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Cs();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=ta.bind(null,gs,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Cs().memoizedState=e},useState:Ns,useDebugValue:Gs,useDeferredValue:function(e){return Cs().memoizedState=e},useTransition:function(){var e=Ns(!1),t=e[0];return e=Js.bind(null,e[1]),Cs().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=gs,i=Cs();if(io){if(void 0===n)throw Error(o(407));n=n()}else{if(n=t(),null===Tl)throw Error(o(349));0!==(30&fs)||Os(r,t,n)}i.memoizedState=n;var s={value:n,getSnapshot:t};return i.queue=s,Vs(zs.bind(null,r,s,e),[e]),r.flags|=2048,Fs(9,Ls.bind(null,r,s,n,t),void 0,null),n},useId:function(){var e=Cs(),t=Tl.identifierPrefix;if(io){var n=Qi;t=":"+t+"R"+(n=(Xi&~(1<<32-st(Xi)-1)).toString(32)+n),0<(n=ws++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=xs++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},la={readContext:Co,useCallback:Xs,useContext:Co,useEffect:Ks,useImperativeHandle:qs,useInsertionEffect:Ws,useLayoutEffect:$s,useMemo:Qs,useReducer:Ms,useRef:Bs,useState:function(){return Ms(Is)},useDebugValue:Gs,useDeferredValue:function(e){return Zs(Es(),ms.memoizedState,e)},useTransition:function(){return[Ms(Is)[0],Es().memoizedState]},useMutableSource:As,useSyncExternalStore:js,useId:ea,unstable_isNewReconciler:!1},ca={readContext:Co,useCallback:Xs,useContext:Co,useEffect:Ks,useImperativeHandle:qs,useInsertionEffect:Ws,useLayoutEffect:$s,useMemo:Qs,useReducer:Ts,useRef:Bs,useState:function(){return Ts(Is)},useDebugValue:Gs,useDeferredValue:function(e){var t=Es();return null===ms?t.memoizedState=e:Zs(t,ms.memoizedState,e)},useTransition:function(){return[Ts(Is)[0],Es().memoizedState]},useMutableSource:As,useSyncExternalStore:js,useId:ea,unstable_isNewReconciler:!1};function ua(e,t){try{var n="",r=t;do{n+=U(r),r=r.return}while(r);var i=n}catch(o){i="\nError generating stack: "+o.message+"\n"+o.stack}return{value:e,source:t,stack:i,digest:null}}function da(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function ha(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var pa="function"===typeof WeakMap?WeakMap:Map;function fa(e,t,n){(n=Lo(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Wl||(Wl=!0,$l=r),ha(0,t)},n}function ga(e,t,n){(n=Lo(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){ha(0,t)}}var o=e.stateNode;return null!==o&&"function"===typeof o.componentDidCatch&&(n.callback=function(){ha(0,t),"function"!==typeof r&&(null===Yl?Yl=new Set([this]):Yl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ma(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new pa;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=Cc.bind(null,e,t,n),t.then(e,e))}function ya(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function va(e,t,n,r,i){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Lo(-1,1)).tag=2,zo(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=i,e)}var ba=w.ReactCurrentOwner,wa=!1;function xa(e,t,n,r){t.child=null===e?Zo(t,null,n,r):Qo(t,e.child,n,r)}function Sa(e,t,n,r,i){n=n.render;var o=t.ref;return Po(t,i),r=_s(e,t,n,r,o,i),n=Ps(),null===e||wa?(io&&n&&eo(t),t.flags|=1,xa(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Wa(e,t,i))}function ka(e,t,n,r,i){if(null===e){var o=n.type;return"function"!==typeof o||Oc(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=zc(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,_a(e,t,o,r,i))}if(o=e.child,0===(e.lanes&i)){var s=o.memoizedProps;if((n=null!==(n=n.compare)?n:lr)(s,r)&&e.ref===t.ref)return Wa(e,t,i)}return t.flags|=1,(e=Lc(o,r)).ref=t.ref,e.return=t,t.child=e}function _a(e,t,n,r,i){if(null!==e){var o=e.memoizedProps;if(lr(o,r)&&e.ref===t.ref){if(wa=!1,t.pendingProps=r=o,0===(e.lanes&i))return t.lanes=e.lanes,Wa(e,t,i);0!==(131072&e.flags)&&(wa=!0)}}return Ea(e,t,n,r,i)}function Pa(e,t,n){var r=t.pendingProps,i=r.children,o=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ci(Ll,Ol),Ol|=n;else{if(0===(1073741824&n))return e=null!==o?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ci(Ll,Ol),Ol|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==o?o.baseLanes:n,Ci(Ll,Ol),Ol|=r}else null!==o?(r=o.baseLanes|n,t.memoizedState=null):r=n,Ci(Ll,Ol),Ol|=r;return xa(e,t,i,n),t.child}function Ca(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ea(e,t,n,r,i){var o=ji(n)?Ti:Ii.current;return o=Ai(t,o),Po(t,i),n=_s(e,t,n,r,o,i),r=Ps(),null===e||wa?(io&&r&&eo(t),t.flags|=1,xa(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Wa(e,t,i))}function Ia(e,t,n,r,i){if(ji(n)){var o=!0;Ri(t)}else o=!1;if(Po(t,i),null===t.stateNode)Ka(e,t),Ko(t,n,r),$o(t,n,r,i),r=!0;else if(null===e){var s=t.stateNode,a=t.memoizedProps;s.props=a;var l=s.context,c=n.contextType;"object"===typeof c&&null!==c?c=Co(c):c=Ai(t,c=ji(n)?Ti:Ii.current);var u=n.getDerivedStateFromProps,d="function"===typeof u||"function"===typeof s.getSnapshotBeforeUpdate;d||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a!==r||l!==c)&&Wo(t,s,r,c),Ao=!1;var h=t.memoizedState;s.state=h,No(t,r,s,i),l=t.memoizedState,a!==r||h!==l||Mi.current||Ao?("function"===typeof u&&(Uo(t,n,u,r),l=t.memoizedState),(a=Ao||Vo(t,n,a,r,h,l,c))?(d||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||("function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"===typeof s.componentDidMount&&(t.flags|=4194308)):("function"===typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),s.props=r,s.state=l,s.context=c,r=a):("function"===typeof s.componentDidMount&&(t.flags|=4194308),r=!1)}else{s=t.stateNode,Oo(e,t),a=t.memoizedProps,c=t.type===t.elementType?a:yo(t.type,a),s.props=c,d=t.pendingProps,h=s.context,"object"===typeof(l=n.contextType)&&null!==l?l=Co(l):l=Ai(t,l=ji(n)?Ti:Ii.current);var p=n.getDerivedStateFromProps;(u="function"===typeof p||"function"===typeof s.getSnapshotBeforeUpdate)||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a!==d||h!==l)&&Wo(t,s,r,l),Ao=!1,h=t.memoizedState,s.state=h,No(t,r,s,i);var f=t.memoizedState;a!==d||h!==f||Mi.current||Ao?("function"===typeof p&&(Uo(t,n,p,r),f=t.memoizedState),(c=Ao||Vo(t,n,c,r,h,f,l)||!1)?(u||"function"!==typeof s.UNSAFE_componentWillUpdate&&"function"!==typeof s.componentWillUpdate||("function"===typeof s.componentWillUpdate&&s.componentWillUpdate(r,f,l),"function"===typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(r,f,l)),"function"===typeof s.componentDidUpdate&&(t.flags|=4),"function"===typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof s.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=f),s.props=r,s.state=f,s.context=l,r=c):("function"!==typeof s.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return Ma(e,t,n,r,o,i)}function Ma(e,t,n,r,i,o){Ca(e,t);var s=0!==(128&t.flags);if(!r&&!s)return i&&Di(t,n,!1),Wa(e,t,o);r=t.stateNode,ba.current=t;var a=s&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&s?(t.child=Qo(t,e.child,null,o),t.child=Qo(t,null,a,o)):xa(e,t,a,o),t.memoizedState=r.state,i&&Di(t,n,!0),t.child}function Ta(e){var t=e.stateNode;t.pendingContext?Li(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Li(0,t.context,!1),is(e,t.containerInfo)}function Aa(e,t,n,r,i){return fo(),go(i),t.flags|=256,xa(e,t,n,r),t.child}var ja,Oa,La,za,Ra={dehydrated:null,treeContext:null,retryLane:0};function Da(e){return{baseLanes:e,cachePool:null,transitions:null}}function Na(e,t,n){var r,i=t.pendingProps,s=ls.current,a=!1,l=0!==(128&t.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&0!==(2&s)),r?(a=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(s|=1),Ci(ls,1&s),null===e)return co(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=i.children,e=i.fallback,a?(i=t.mode,a=t.child,l={mode:"hidden",children:l},0===(1&i)&&null!==a?(a.childLanes=0,a.pendingProps=l):a=Dc(l,i,0,null),e=Rc(e,i,n,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=Da(n),t.memoizedState=Ra,e):Fa(t,l));if(null!==(s=e.memoizedState)&&null!==(r=s.dehydrated))return function(e,t,n,r,i,s,a){if(n)return 256&t.flags?(t.flags&=-257,Ba(e,t,a,r=da(Error(o(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(s=r.fallback,i=t.mode,r=Dc({mode:"visible",children:r.children},i,0,null),(s=Rc(s,i,a,null)).flags|=2,r.return=t,s.return=t,r.sibling=s,t.child=r,0!==(1&t.mode)&&Qo(t,e.child,null,a),t.child.memoizedState=Da(a),t.memoizedState=Ra,s);if(0===(1&t.mode))return Ba(e,t,a,null);if("$!"===i.data){if(r=i.nextSibling&&i.nextSibling.dataset)var l=r.dgst;return r=l,Ba(e,t,a,r=da(s=Error(o(419)),r,void 0))}if(l=0!==(a&e.childLanes),wa||l){if(null!==(r=Tl)){switch(a&-a){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=0!==(i&(r.suspendedLanes|a))?0:i)&&i!==s.retryLane&&(s.retryLane=i,To(e,i),rc(r,e,i,-1))}return mc(),Ba(e,t,a,r=da(Error(o(421))))}return"$?"===i.data?(t.flags|=128,t.child=e.child,t=Ic.bind(null,e),i._reactRetry=t,null):(e=s.treeContext,ro=ci(i.nextSibling),no=t,io=!0,oo=null,null!==e&&(Yi[qi++]=Xi,Yi[qi++]=Qi,Yi[qi++]=Gi,Xi=e.id,Qi=e.overflow,Gi=t),t=Fa(t,r.children),t.flags|=4096,t)}(e,t,l,i,r,s,n);if(a){a=i.fallback,l=t.mode,r=(s=e.child).sibling;var c={mode:"hidden",children:i.children};return 0===(1&l)&&t.child!==s?((i=t.child).childLanes=0,i.pendingProps=c,t.deletions=null):(i=Lc(s,c)).subtreeFlags=14680064&s.subtreeFlags,null!==r?a=Lc(r,a):(a=Rc(a,l,n,null)).flags|=2,a.return=t,i.return=t,i.sibling=a,t.child=i,i=a,a=t.child,l=null===(l=e.child.memoizedState)?Da(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},a.memoizedState=l,a.childLanes=e.childLanes&~n,t.memoizedState=Ra,i}return e=(a=e.child).sibling,i=Lc(a,{mode:"visible",children:i.children}),0===(1&t.mode)&&(i.lanes=n),i.return=t,i.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i}function Fa(e,t){return(t=Dc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Ba(e,t,n,r){return null!==r&&go(r),Qo(t,e.child,null,n),(e=Fa(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Ua(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),_o(e.return,t,n)}function Ha(e,t,n,r,i){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i)}function Va(e,t,n){var r=t.pendingProps,i=r.revealOrder,o=r.tail;if(xa(e,t,r.children,n),0!==(2&(r=ls.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Ua(e,n,t);else if(19===e.tag)Ua(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ci(ls,r),0===(1&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===cs(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Ha(t,!1,i,n,o);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===cs(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Ha(t,!0,n,null,o);break;case"together":Ha(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ka(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Wa(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Dl|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=Lc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Lc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function $a(e,t){if(!io)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Ya(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function qa(e,t,n){var r=t.pendingProps;switch(to(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ya(t),null;case 1:case 17:return ji(t.type)&&Oi(),Ya(t),null;case 3:return r=t.stateNode,os(),Pi(Mi),Pi(Ii),ds(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(ho(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==oo&&(ac(oo),oo=null))),Oa(e,t),Ya(t),null;case 5:as(t);var i=rs(ns.current);if(n=t.type,null!==e&&null!=t.stateNode)La(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(o(166));return Ya(t),null}if(e=rs(es.current),ho(t)){r=t.stateNode,n=t.type;var s=t.memoizedProps;switch(r[hi]=t,r[pi]=s,e=0!==(1&t.mode),n){case"dialog":Fr("cancel",r),Fr("close",r);break;case"iframe":case"object":case"embed":Fr("load",r);break;case"video":case"audio":for(i=0;i<zr.length;i++)Fr(zr[i],r);break;case"source":Fr("error",r);break;case"img":case"image":case"link":Fr("error",r),Fr("load",r);break;case"details":Fr("toggle",r);break;case"input":X(r,s),Fr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Fr("invalid",r);break;case"textarea":ie(r,s),Fr("invalid",r)}for(var l in ve(n,s),i=null,s)if(s.hasOwnProperty(l)){var c=s[l];"children"===l?"string"===typeof c?r.textContent!==c&&(!0!==s.suppressHydrationWarning&&Zr(r.textContent,c,e),i=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(!0!==s.suppressHydrationWarning&&Zr(r.textContent,c,e),i=["children",""+c]):a.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Fr("scroll",r)}switch(n){case"input":$(r),J(r,s,!0);break;case"textarea":$(r),se(r);break;case"select":case"option":break;default:"function"===typeof s.onClick&&(r.onclick=Jr)}r=i,t.updateQueue=r,null!==r&&(t.flags|=4)}else{l=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=ae(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=l.createElement(n,{is:r.is}):(e=l.createElement(n),"select"===n&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,n),e[hi]=t,e[pi]=r,ja(e,t,!1,!1),t.stateNode=e;e:{switch(l=be(n,r),n){case"dialog":Fr("cancel",e),Fr("close",e),i=r;break;case"iframe":case"object":case"embed":Fr("load",e),i=r;break;case"video":case"audio":for(i=0;i<zr.length;i++)Fr(zr[i],e);i=r;break;case"source":Fr("error",e),i=r;break;case"img":case"image":case"link":Fr("error",e),Fr("load",e),i=r;break;case"details":Fr("toggle",e),i=r;break;case"input":X(e,r),i=G(e,r),Fr("invalid",e);break;case"option":default:i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=D({},r,{value:void 0}),Fr("invalid",e);break;case"textarea":ie(e,r),i=re(e,r),Fr("invalid",e)}for(s in ve(n,i),c=i)if(c.hasOwnProperty(s)){var u=c[s];"style"===s?me(e,u):"dangerouslySetInnerHTML"===s?null!=(u=u?u.__html:void 0)&&de(e,u):"children"===s?"string"===typeof u?("textarea"!==n||""!==u)&&he(e,u):"number"===typeof u&&he(e,""+u):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(a.hasOwnProperty(s)?null!=u&&"onScroll"===s&&Fr("scroll",e):null!=u&&b(e,s,u,l))}switch(n){case"input":$(e),J(e,r,!1);break;case"textarea":$(e),se(e);break;case"option":null!=r.value&&e.setAttribute("value",""+K(r.value));break;case"select":e.multiple=!!r.multiple,null!=(s=r.value)?ne(e,!!r.multiple,s,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof i.onClick&&(e.onclick=Jr)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Ya(t),null;case 6:if(e&&null!=t.stateNode)za(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(o(166));if(n=rs(ns.current),rs(es.current),ho(t)){if(r=t.stateNode,n=t.memoizedProps,r[hi]=t,(s=r.nodeValue!==n)&&null!==(e=no))switch(e.tag){case 3:Zr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Zr(r.nodeValue,n,0!==(1&e.mode))}s&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[hi]=t,t.stateNode=r}return Ya(t),null;case 13:if(Pi(ls),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(io&&null!==ro&&0!==(1&t.mode)&&0===(128&t.flags))po(),fo(),t.flags|=98560,s=!1;else if(s=ho(t),null!==r&&null!==r.dehydrated){if(null===e){if(!s)throw Error(o(318));if(!(s=null!==(s=t.memoizedState)?s.dehydrated:null))throw Error(o(317));s[hi]=t}else fo(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Ya(t),s=!1}else null!==oo&&(ac(oo),oo=null),s=!0;if(!s)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&ls.current)?0===zl&&(zl=3):mc())),null!==t.updateQueue&&(t.flags|=4),Ya(t),null);case 4:return os(),Oa(e,t),null===e&&Hr(t.stateNode.containerInfo),Ya(t),null;case 10:return ko(t.type._context),Ya(t),null;case 19:if(Pi(ls),null===(s=t.memoizedState))return Ya(t),null;if(r=0!==(128&t.flags),null===(l=s.rendering))if(r)$a(s,!1);else{if(0!==zl||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=cs(e))){for(t.flags|=128,$a(s,!1),null!==(r=l.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(s=n).flags&=14680066,null===(l=s.alternate)?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,e=l.dependencies,s.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ci(ls,1&ls.current|2),t.child}e=e.sibling}null!==s.tail&&Qe()>Vl&&(t.flags|=128,r=!0,$a(s,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=cs(l))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),$a(s,!0),null===s.tail&&"hidden"===s.tailMode&&!l.alternate&&!io)return Ya(t),null}else 2*Qe()-s.renderingStartTime>Vl&&1073741824!==n&&(t.flags|=128,r=!0,$a(s,!1),t.lanes=4194304);s.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=s.last)?n.sibling=l:t.child=l,s.last=l)}return null!==s.tail?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=Qe(),t.sibling=null,n=ls.current,Ci(ls,r?1&n|2:1&n),t):(Ya(t),null);case 22:case 23:return hc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Ol)&&(Ya(t),6&t.subtreeFlags&&(t.flags|=8192)):Ya(t),null;case 24:case 25:return null}throw Error(o(156,t.tag))}function Ga(e,t){switch(to(t),t.tag){case 1:return ji(t.type)&&Oi(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return os(),Pi(Mi),Pi(Ii),ds(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return as(t),null;case 13:if(Pi(ls),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(o(340));fo()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Pi(ls),null;case 4:return os(),null;case 10:return ko(t.type._context),null;case 22:case 23:return hc(),null;default:return null}}ja=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Oa=function(){},La=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,rs(es.current);var o,s=null;switch(n){case"input":i=G(e,i),r=G(e,r),s=[];break;case"select":i=D({},i,{value:void 0}),r=D({},r,{value:void 0}),s=[];break;case"textarea":i=re(e,i),r=re(e,r),s=[];break;default:"function"!==typeof i.onClick&&"function"===typeof r.onClick&&(e.onclick=Jr)}for(u in ve(n,r),n=null,i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&null!=i[u])if("style"===u){var l=i[u];for(o in l)l.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(a.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in r){var c=r[u];if(l=null!=i?i[u]:void 0,r.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(s||(s=[]),s.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(s=s||[]).push(u,c)):"children"===u?"string"!==typeof c&&"number"!==typeof c||(s=s||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(a.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&Fr("scroll",e),s||l===c||(s=[])):(s=s||[]).push(u,c))}n&&(s=s||[]).push("style",n);var u=s;(t.updateQueue=u)&&(t.flags|=4)}},za=function(e,t,n,r){n!==r&&(t.flags|=4)};var Xa=!1,Qa=!1,Za="function"===typeof WeakSet?WeakSet:Set,Ja=null;function el(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){Pc(e,t,r)}else n.current=null}function tl(e,t,n){try{n()}catch(r){Pc(e,t,r)}}var nl=!1;function rl(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var o=i.destroy;i.destroy=void 0,void 0!==o&&tl(t,n,o)}i=i.next}while(i!==r)}}function il(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function ol(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function sl(e){var t=e.alternate;null!==t&&(e.alternate=null,sl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[hi],delete t[pi],delete t[gi],delete t[mi],delete t[yi])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function al(e){return 5===e.tag||3===e.tag||4===e.tag}function ll(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||al(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function cl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Jr));else if(4!==r&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}function ul(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(ul(e,t,n),e=e.sibling;null!==e;)ul(e,t,n),e=e.sibling}var dl=null,hl=!1;function pl(e,t,n){for(n=n.child;null!==n;)fl(e,t,n),n=n.sibling}function fl(e,t,n){if(ot&&"function"===typeof ot.onCommitFiberUnmount)try{ot.onCommitFiberUnmount(it,n)}catch(a){}switch(n.tag){case 5:Qa||el(n,t);case 6:var r=dl,i=hl;dl=null,pl(e,t,n),hl=i,null!==(dl=r)&&(hl?(e=dl,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):dl.removeChild(n.stateNode));break;case 18:null!==dl&&(hl?(e=dl,n=n.stateNode,8===e.nodeType?li(e.parentNode,n):1===e.nodeType&&li(e,n),Ht(e)):li(dl,n.stateNode));break;case 4:r=dl,i=hl,dl=n.stateNode.containerInfo,hl=!0,pl(e,t,n),dl=r,hl=i;break;case 0:case 11:case 14:case 15:if(!Qa&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){i=r=r.next;do{var o=i,s=o.destroy;o=o.tag,void 0!==s&&(0!==(2&o)||0!==(4&o))&&tl(n,t,s),i=i.next}while(i!==r)}pl(e,t,n);break;case 1:if(!Qa&&(el(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){Pc(n,t,a)}pl(e,t,n);break;case 21:pl(e,t,n);break;case 22:1&n.mode?(Qa=(r=Qa)||null!==n.memoizedState,pl(e,t,n),Qa=r):pl(e,t,n);break;default:pl(e,t,n)}}function gl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Za),t.forEach((function(t){var r=Mc.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function ml(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var s=e,a=t,l=a;e:for(;null!==l;){switch(l.tag){case 5:dl=l.stateNode,hl=!1;break e;case 3:case 4:dl=l.stateNode.containerInfo,hl=!0;break e}l=l.return}if(null===dl)throw Error(o(160));fl(s,a,i),dl=null,hl=!1;var c=i.alternate;null!==c&&(c.return=null),i.return=null}catch(u){Pc(i,t,u)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)yl(t,e),t=t.sibling}function yl(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ml(t,e),vl(e),4&r){try{rl(3,e,e.return),il(3,e)}catch(m){Pc(e,e.return,m)}try{rl(5,e,e.return)}catch(m){Pc(e,e.return,m)}}break;case 1:ml(t,e),vl(e),512&r&&null!==n&&el(n,n.return);break;case 5:if(ml(t,e),vl(e),512&r&&null!==n&&el(n,n.return),32&e.flags){var i=e.stateNode;try{he(i,"")}catch(m){Pc(e,e.return,m)}}if(4&r&&null!=(i=e.stateNode)){var s=e.memoizedProps,a=null!==n?n.memoizedProps:s,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===s.type&&null!=s.name&&Q(i,s),be(l,a);var u=be(l,s);for(a=0;a<c.length;a+=2){var d=c[a],h=c[a+1];"style"===d?me(i,h):"dangerouslySetInnerHTML"===d?de(i,h):"children"===d?he(i,h):b(i,d,h,u)}switch(l){case"input":Z(i,s);break;case"textarea":oe(i,s);break;case"select":var p=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var f=s.value;null!=f?ne(i,!!s.multiple,f,!1):p!==!!s.multiple&&(null!=s.defaultValue?ne(i,!!s.multiple,s.defaultValue,!0):ne(i,!!s.multiple,s.multiple?[]:"",!1))}i[pi]=s}catch(m){Pc(e,e.return,m)}}break;case 6:if(ml(t,e),vl(e),4&r){if(null===e.stateNode)throw Error(o(162));i=e.stateNode,s=e.memoizedProps;try{i.nodeValue=s}catch(m){Pc(e,e.return,m)}}break;case 3:if(ml(t,e),vl(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Ht(t.containerInfo)}catch(m){Pc(e,e.return,m)}break;case 4:default:ml(t,e),vl(e);break;case 13:ml(t,e),vl(e),8192&(i=e.child).flags&&(s=null!==i.memoizedState,i.stateNode.isHidden=s,!s||null!==i.alternate&&null!==i.alternate.memoizedState||(Hl=Qe())),4&r&&gl(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?(Qa=(u=Qa)||d,ml(t,e),Qa=u):ml(t,e),vl(e),8192&r){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!d&&0!==(1&e.mode))for(Ja=e,d=e.child;null!==d;){for(h=Ja=d;null!==Ja;){switch(f=(p=Ja).child,p.tag){case 0:case 11:case 14:case 15:rl(4,p,p.return);break;case 1:el(p,p.return);var g=p.stateNode;if("function"===typeof g.componentWillUnmount){r=p,n=p.return;try{t=r,g.props=t.memoizedProps,g.state=t.memoizedState,g.componentWillUnmount()}catch(m){Pc(r,n,m)}}break;case 5:el(p,p.return);break;case 22:if(null!==p.memoizedState){Sl(h);continue}}null!==f?(f.return=p,Ja=f):Sl(h)}d=d.sibling}e:for(d=null,h=e;;){if(5===h.tag){if(null===d){d=h;try{i=h.stateNode,u?"function"===typeof(s=i.style).setProperty?s.setProperty("display","none","important"):s.display="none":(l=h.stateNode,a=void 0!==(c=h.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=ge("display",a))}catch(m){Pc(e,e.return,m)}}}else if(6===h.tag){if(null===d)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(m){Pc(e,e.return,m)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:ml(t,e),vl(e),4&r&&gl(e);case 21:}}function vl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(al(n)){var r=n;break e}n=n.return}throw Error(o(160))}switch(r.tag){case 5:var i=r.stateNode;32&r.flags&&(he(i,""),r.flags&=-33),ul(e,ll(e),i);break;case 3:case 4:var s=r.stateNode.containerInfo;cl(e,ll(e),s);break;default:throw Error(o(161))}}catch(a){Pc(e,e.return,a)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function bl(e,t,n){Ja=e,wl(e,t,n)}function wl(e,t,n){for(var r=0!==(1&e.mode);null!==Ja;){var i=Ja,o=i.child;if(22===i.tag&&r){var s=null!==i.memoizedState||Xa;if(!s){var a=i.alternate,l=null!==a&&null!==a.memoizedState||Qa;a=Xa;var c=Qa;if(Xa=s,(Qa=l)&&!c)for(Ja=i;null!==Ja;)l=(s=Ja).child,22===s.tag&&null!==s.memoizedState?kl(i):null!==l?(l.return=s,Ja=l):kl(i);for(;null!==o;)Ja=o,wl(o,t,n),o=o.sibling;Ja=i,Xa=a,Qa=c}xl(e)}else 0!==(8772&i.subtreeFlags)&&null!==o?(o.return=i,Ja=o):xl(e)}}function xl(e){for(;null!==Ja;){var t=Ja;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Qa||il(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Qa)if(null===n)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:yo(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;null!==s&&Fo(t,s,r);break;case 3:var a=t.updateQueue;if(null!==a){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Fo(t,a,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var d=u.memoizedState;if(null!==d){var h=d.dehydrated;null!==h&&Ht(h)}}}break;default:throw Error(o(163))}Qa||512&t.flags&&ol(t)}catch(p){Pc(t,t.return,p)}}if(t===e){Ja=null;break}if(null!==(n=t.sibling)){n.return=t.return,Ja=n;break}Ja=t.return}}function Sl(e){for(;null!==Ja;){var t=Ja;if(t===e){Ja=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Ja=n;break}Ja=t.return}}function kl(e){for(;null!==Ja;){var t=Ja;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{il(4,t)}catch(l){Pc(t,n,l)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()}catch(l){Pc(t,i,l)}}var o=t.return;try{ol(t)}catch(l){Pc(t,o,l)}break;case 5:var s=t.return;try{ol(t)}catch(l){Pc(t,s,l)}}}catch(l){Pc(t,t.return,l)}if(t===e){Ja=null;break}var a=t.sibling;if(null!==a){a.return=t.return,Ja=a;break}Ja=t.return}}var _l,Pl=Math.ceil,Cl=w.ReactCurrentDispatcher,El=w.ReactCurrentOwner,Il=w.ReactCurrentBatchConfig,Ml=0,Tl=null,Al=null,jl=0,Ol=0,Ll=_i(0),zl=0,Rl=null,Dl=0,Nl=0,Fl=0,Bl=null,Ul=null,Hl=0,Vl=1/0,Kl=null,Wl=!1,$l=null,Yl=null,ql=!1,Gl=null,Xl=0,Ql=0,Zl=null,Jl=-1,ec=0;function tc(){return 0!==(6&Ml)?Qe():-1!==Jl?Jl:Jl=Qe()}function nc(e){return 0===(1&e.mode)?1:0!==(2&Ml)&&0!==jl?jl&-jl:null!==mo.transition?(0===ec&&(ec=gt()),ec):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Xt(e.type)}function rc(e,t,n,r){if(50<Ql)throw Ql=0,Zl=null,Error(o(185));yt(e,n,r),0!==(2&Ml)&&e===Tl||(e===Tl&&(0===(2&Ml)&&(Nl|=n),4===zl&&lc(e,jl)),ic(e,r),1===n&&0===Ml&&0===(1&t.mode)&&(Vl=Qe()+500,Fi&&Hi()))}function ic(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,o=e.pendingLanes;0<o;){var s=31-st(o),a=1<<s,l=i[s];-1===l?0!==(a&n)&&0===(a&r)||(i[s]=pt(a,t)):l<=t&&(e.expiredLanes|=a),o&=~a}}(e,t);var r=ht(e,e===Tl?jl:0);if(0===r)null!==n&&qe(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&qe(n),1===t)0===e.tag?function(e){Fi=!0,Ui(e)}(cc.bind(null,e)):Ui(cc.bind(null,e)),si((function(){0===(6&Ml)&&Hi()})),n=null;else{switch(wt(r)){case 1:n=Je;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Tc(n,oc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function oc(e,t){if(Jl=-1,ec=0,0!==(6&Ml))throw Error(o(327));var n=e.callbackNode;if(kc()&&e.callbackNode!==n)return null;var r=ht(e,e===Tl?jl:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=yc(e,r);else{t=r;var i=Ml;Ml|=2;var s=gc();for(Tl===e&&jl===t||(Kl=null,Vl=Qe()+500,pc(e,t));;)try{bc();break}catch(l){fc(e,l)}So(),Cl.current=s,Ml=i,null!==Al?t=0:(Tl=null,jl=0,t=zl)}if(0!==t){if(2===t&&(0!==(i=ft(e))&&(r=i,t=sc(e,i))),1===t)throw n=Rl,pc(e,0),lc(e,r),ic(e,Qe()),n;if(6===t)lc(e,r);else{if(i=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],o=i.getSnapshot;i=i.value;try{if(!ar(o(),i))return!1}catch(a){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)&&(2===(t=yc(e,r))&&(0!==(s=ft(e))&&(r=s,t=sc(e,s))),1===t))throw n=Rl,pc(e,0),lc(e,r),ic(e,Qe()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(o(345));case 2:case 5:Sc(e,Ul,Kl);break;case 3:if(lc(e,r),(130023424&r)===r&&10<(t=Hl+500-Qe())){if(0!==ht(e,0))break;if(((i=e.suspendedLanes)&r)!==r){tc(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=ri(Sc.bind(null,e,Ul,Kl),t);break}Sc(e,Ul,Kl);break;case 4:if(lc(e,r),(4194240&r)===r)break;for(t=e.eventTimes,i=-1;0<r;){var a=31-st(r);s=1<<a,(a=t[a])>i&&(i=a),r&=~s}if(r=i,10<(r=(120>(r=Qe()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Pl(r/1960))-r)){e.timeoutHandle=ri(Sc.bind(null,e,Ul,Kl),r);break}Sc(e,Ul,Kl);break;default:throw Error(o(329))}}}return ic(e,Qe()),e.callbackNode===n?oc.bind(null,e):null}function sc(e,t){var n=Bl;return e.current.memoizedState.isDehydrated&&(pc(e,t).flags|=256),2!==(e=yc(e,t))&&(t=Ul,Ul=n,null!==t&&ac(t)),e}function ac(e){null===Ul?Ul=e:Ul.push.apply(Ul,e)}function lc(e,t){for(t&=~Fl,t&=~Nl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-st(t),r=1<<n;e[n]=-1,t&=~r}}function cc(e){if(0!==(6&Ml))throw Error(o(327));kc();var t=ht(e,0);if(0===(1&t))return ic(e,Qe()),null;var n=yc(e,t);if(0!==e.tag&&2===n){var r=ft(e);0!==r&&(t=r,n=sc(e,r))}if(1===n)throw n=Rl,pc(e,0),lc(e,t),ic(e,Qe()),n;if(6===n)throw Error(o(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Sc(e,Ul,Kl),ic(e,Qe()),null}function uc(e,t){var n=Ml;Ml|=1;try{return e(t)}finally{0===(Ml=n)&&(Vl=Qe()+500,Fi&&Hi())}}function dc(e){null!==Gl&&0===Gl.tag&&0===(6&Ml)&&kc();var t=Ml;Ml|=1;var n=Il.transition,r=bt;try{if(Il.transition=null,bt=1,e)return e()}finally{bt=r,Il.transition=n,0===(6&(Ml=t))&&Hi()}}function hc(){Ol=Ll.current,Pi(Ll)}function pc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ii(n)),null!==Al)for(n=Al.return;null!==n;){var r=n;switch(to(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Oi();break;case 3:os(),Pi(Mi),Pi(Ii),ds();break;case 5:as(r);break;case 4:os();break;case 13:case 19:Pi(ls);break;case 10:ko(r.type._context);break;case 22:case 23:hc()}n=n.return}if(Tl=e,Al=e=Lc(e.current,null),jl=Ol=t,zl=0,Rl=null,Fl=Nl=Dl=0,Ul=Bl=null,null!==Eo){for(t=0;t<Eo.length;t++)if(null!==(r=(n=Eo[t]).interleaved)){n.interleaved=null;var i=r.next,o=n.pending;if(null!==o){var s=o.next;o.next=i,r.next=s}n.pending=r}Eo=null}return e}function fc(e,t){for(;;){var n=Al;try{if(So(),hs.current=sa,vs){for(var r=gs.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}vs=!1}if(fs=0,ys=ms=gs=null,bs=!1,ws=0,El.current=null,null===n||null===n.return){zl=1,Rl=t,Al=null;break}e:{var s=e,a=n.return,l=n,c=t;if(t=jl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,d=l,h=d.tag;if(0===(1&d.mode)&&(0===h||11===h||15===h)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var f=ya(a);if(null!==f){f.flags&=-257,va(f,a,l,0,t),1&f.mode&&ma(s,u,t),c=u;var g=(t=f).updateQueue;if(null===g){var m=new Set;m.add(c),t.updateQueue=m}else g.add(c);break e}if(0===(1&t)){ma(s,u,t),mc();break e}c=Error(o(426))}else if(io&&1&l.mode){var y=ya(a);if(null!==y){0===(65536&y.flags)&&(y.flags|=256),va(y,a,l,0,t),go(ua(c,l));break e}}s=c=ua(c,l),4!==zl&&(zl=2),null===Bl?Bl=[s]:Bl.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t,Do(s,fa(0,c,t));break e;case 1:l=c;var v=s.type,b=s.stateNode;if(0===(128&s.flags)&&("function"===typeof v.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===Yl||!Yl.has(b)))){s.flags|=65536,t&=-t,s.lanes|=t,Do(s,ga(s,l,t));break e}}s=s.return}while(null!==s)}xc(n)}catch(w){t=w,Al===n&&null!==n&&(Al=n=n.return);continue}break}}function gc(){var e=Cl.current;return Cl.current=sa,null===e?sa:e}function mc(){0!==zl&&3!==zl&&2!==zl||(zl=4),null===Tl||0===(268435455&Dl)&&0===(268435455&Nl)||lc(Tl,jl)}function yc(e,t){var n=Ml;Ml|=2;var r=gc();for(Tl===e&&jl===t||(Kl=null,pc(e,t));;)try{vc();break}catch(i){fc(e,i)}if(So(),Ml=n,Cl.current=r,null!==Al)throw Error(o(261));return Tl=null,jl=0,zl}function vc(){for(;null!==Al;)wc(Al)}function bc(){for(;null!==Al&&!Ge();)wc(Al)}function wc(e){var t=_l(e.alternate,e,Ol);e.memoizedProps=e.pendingProps,null===t?xc(e):Al=t,El.current=null}function xc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=qa(n,t,Ol)))return void(Al=n)}else{if(null!==(n=Ga(n,t)))return n.flags&=32767,void(Al=n);if(null===e)return zl=6,void(Al=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Al=t);Al=t=e}while(null!==t);0===zl&&(zl=5)}function Sc(e,t,n){var r=bt,i=Il.transition;try{Il.transition=null,bt=1,function(e,t,n,r){do{kc()}while(null!==Gl);if(0!==(6&Ml))throw Error(o(327));n=e.finishedWork;var i=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(o(177));e.callbackNode=null,e.callbackPriority=0;var s=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-st(n),o=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~o}}(e,s),e===Tl&&(Al=Tl=null,jl=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||ql||(ql=!0,Tc(tt,(function(){return kc(),null}))),s=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||s){s=Il.transition,Il.transition=null;var a=bt;bt=1;var l=Ml;Ml|=4,El.current=null,function(e,t){if(ei=Kt,pr(e=hr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch(x){n=null;break e}var a=0,l=-1,c=-1,u=0,d=0,h=e,p=null;t:for(;;){for(var f;h!==n||0!==i&&3!==h.nodeType||(l=a+i),h!==s||0!==r&&3!==h.nodeType||(c=a+r),3===h.nodeType&&(a+=h.nodeValue.length),null!==(f=h.firstChild);)p=h,h=f;for(;;){if(h===e)break t;if(p===n&&++u===i&&(l=a),p===s&&++d===r&&(c=a),null!==(f=h.nextSibling))break;p=(h=p).parentNode}h=f}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ti={focusedElem:e,selectionRange:n},Kt=!1,Ja=t;null!==Ja;)if(e=(t=Ja).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Ja=e;else for(;null!==Ja;){t=Ja;try{var g=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==g){var m=g.memoizedProps,y=g.memoizedState,v=t.stateNode,b=v.getSnapshotBeforeUpdate(t.elementType===t.type?m:yo(t.type,m),y);v.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var w=t.stateNode.containerInfo;1===w.nodeType?w.textContent="":9===w.nodeType&&w.documentElement&&w.removeChild(w.documentElement);break;default:throw Error(o(163))}}catch(x){Pc(t,t.return,x)}if(null!==(e=t.sibling)){e.return=t.return,Ja=e;break}Ja=t.return}g=nl,nl=!1}(e,n),yl(n,e),fr(ti),Kt=!!ei,ti=ei=null,e.current=n,bl(n,e,i),Xe(),Ml=l,bt=a,Il.transition=s}else e.current=n;if(ql&&(ql=!1,Gl=e,Xl=i),s=e.pendingLanes,0===s&&(Yl=null),function(e){if(ot&&"function"===typeof ot.onCommitFiberRoot)try{ot.onCommitFiberRoot(it,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),ic(e,Qe()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)i=t[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(Wl)throw Wl=!1,e=$l,$l=null,e;0!==(1&Xl)&&0!==e.tag&&kc(),s=e.pendingLanes,0!==(1&s)?e===Zl?Ql++:(Ql=0,Zl=e):Ql=0,Hi()}(e,t,n,r)}finally{Il.transition=i,bt=r}return null}function kc(){if(null!==Gl){var e=wt(Xl),t=Il.transition,n=bt;try{if(Il.transition=null,bt=16>e?16:e,null===Gl)var r=!1;else{if(e=Gl,Gl=null,Xl=0,0!==(6&Ml))throw Error(o(331));var i=Ml;for(Ml|=4,Ja=e.current;null!==Ja;){var s=Ja,a=s.child;if(0!==(16&Ja.flags)){var l=s.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Ja=u;null!==Ja;){var d=Ja;switch(d.tag){case 0:case 11:case 15:rl(8,d,s)}var h=d.child;if(null!==h)h.return=d,Ja=h;else for(;null!==Ja;){var p=(d=Ja).sibling,f=d.return;if(sl(d),d===u){Ja=null;break}if(null!==p){p.return=f,Ja=p;break}Ja=f}}}var g=s.alternate;if(null!==g){var m=g.child;if(null!==m){g.child=null;do{var y=m.sibling;m.sibling=null,m=y}while(null!==m)}}Ja=s}}if(0!==(2064&s.subtreeFlags)&&null!==a)a.return=s,Ja=a;else e:for(;null!==Ja;){if(0!==(2048&(s=Ja).flags))switch(s.tag){case 0:case 11:case 15:rl(9,s,s.return)}var v=s.sibling;if(null!==v){v.return=s.return,Ja=v;break e}Ja=s.return}}var b=e.current;for(Ja=b;null!==Ja;){var w=(a=Ja).child;if(0!==(2064&a.subtreeFlags)&&null!==w)w.return=a,Ja=w;else e:for(a=b;null!==Ja;){if(0!==(2048&(l=Ja).flags))try{switch(l.tag){case 0:case 11:case 15:il(9,l)}}catch(S){Pc(l,l.return,S)}if(l===a){Ja=null;break e}var x=l.sibling;if(null!==x){x.return=l.return,Ja=x;break e}Ja=l.return}}if(Ml=i,Hi(),ot&&"function"===typeof ot.onPostCommitFiberRoot)try{ot.onPostCommitFiberRoot(it,e)}catch(S){}r=!0}return r}finally{bt=n,Il.transition=t}}return!1}function _c(e,t,n){e=zo(e,t=fa(0,t=ua(n,t),1),1),t=tc(),null!==e&&(yt(e,1,t),ic(e,t))}function Pc(e,t,n){if(3===e.tag)_c(e,e,n);else for(;null!==t;){if(3===t.tag){_c(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Yl||!Yl.has(r))){t=zo(t,e=ga(t,e=ua(n,e),1),1),e=tc(),null!==t&&(yt(t,1,e),ic(t,e));break}}t=t.return}}function Cc(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=tc(),e.pingedLanes|=e.suspendedLanes&n,Tl===e&&(jl&n)===n&&(4===zl||3===zl&&(130023424&jl)===jl&&500>Qe()-Hl?pc(e,0):Fl|=n),ic(e,t)}function Ec(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ut,0===(130023424&(ut<<=1))&&(ut=4194304)));var n=tc();null!==(e=To(e,t))&&(yt(e,t,n),ic(e,n))}function Ic(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Ec(e,n)}function Mc(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(o(314))}null!==r&&r.delete(t),Ec(e,n)}function Tc(e,t){return Ye(e,t)}function Ac(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function jc(e,t,n,r){return new Ac(e,t,n,r)}function Oc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Lc(e,t){var n=e.alternate;return null===n?((n=jc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function zc(e,t,n,r,i,s){var a=2;if(r=e,"function"===typeof e)Oc(e)&&(a=1);else if("string"===typeof e)a=5;else e:switch(e){case k:return Rc(n.children,i,s,t);case _:a=8,i|=8;break;case P:return(e=jc(12,n,t,2|i)).elementType=P,e.lanes=s,e;case M:return(e=jc(13,n,t,i)).elementType=M,e.lanes=s,e;case T:return(e=jc(19,n,t,i)).elementType=T,e.lanes=s,e;case O:return Dc(n,i,s,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case C:a=10;break e;case E:a=9;break e;case I:a=11;break e;case A:a=14;break e;case j:a=16,r=null;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=jc(a,n,t,i)).elementType=e,t.type=r,t.lanes=s,t}function Rc(e,t,n,r){return(e=jc(7,e,r,t)).lanes=n,e}function Dc(e,t,n,r){return(e=jc(22,e,r,t)).elementType=O,e.lanes=n,e.stateNode={isHidden:!1},e}function Nc(e,t,n){return(e=jc(6,e,null,t)).lanes=n,e}function Fc(e,t,n){return(t=jc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Bc(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mt(0),this.expirationTimes=mt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mt(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Uc(e,t,n,r,i,o,s,a,l){return e=new Bc(e,t,n,a,l),1===t?(t=1,!0===o&&(t|=8)):t=0,o=jc(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},jo(o),e}function Hc(e){if(!e)return Ei;e:{if(He(e=e._reactInternals)!==e||1!==e.tag)throw Error(o(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(ji(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(o(171))}if(1===e.tag){var n=e.type;if(ji(n))return zi(e,n,t)}return t}function Vc(e,t,n,r,i,o,s,a,l){return(e=Uc(n,r,!0,e,0,o,0,a,l)).context=Hc(null),n=e.current,(o=Lo(r=tc(),i=nc(n))).callback=void 0!==t&&null!==t?t:null,zo(n,o,i),e.current.lanes=i,yt(e,i,r),ic(e,r),e}function Kc(e,t,n,r){var i=t.current,o=tc(),s=nc(i);return n=Hc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Lo(o,s)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=zo(i,t,s))&&(rc(e,i,s,o),Ro(e,i,s)),s}function Wc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function $c(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Yc(e,t){$c(e,t),(e=e.alternate)&&$c(e,t)}_l=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Mi.current)wa=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return wa=!1,function(e,t,n){switch(t.tag){case 3:Ta(t),fo();break;case 5:ss(t);break;case 1:ji(t.type)&&Ri(t);break;case 4:is(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;Ci(vo,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ci(ls,1&ls.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Na(e,t,n):(Ci(ls,1&ls.current),null!==(e=Wa(e,t,n))?e.sibling:null);Ci(ls,1&ls.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return Va(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ci(ls,ls.current),r)break;return null;case 22:case 23:return t.lanes=0,Pa(e,t,n)}return Wa(e,t,n)}(e,t,n);wa=0!==(131072&e.flags)}else wa=!1,io&&0!==(1048576&t.flags)&&Ji(t,$i,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Ka(e,t),e=t.pendingProps;var i=Ai(t,Ii.current);Po(t,n),i=_s(null,t,r,e,i,n);var s=Ps();return t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,ji(r)?(s=!0,Ri(t)):s=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,jo(t),i.updater=Ho,t.stateNode=i,i._reactInternals=t,$o(t,r,e,n),t=Ma(null,t,r,!0,s,n)):(t.tag=0,io&&s&&eo(t),xa(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Ka(e,t),e=t.pendingProps,r=(i=r._init)(r._payload),t.type=r,i=t.tag=function(e){if("function"===typeof e)return Oc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===I)return 11;if(e===A)return 14}return 2}(r),e=yo(r,e),i){case 0:t=Ea(null,t,r,e,n);break e;case 1:t=Ia(null,t,r,e,n);break e;case 11:t=Sa(null,t,r,e,n);break e;case 14:t=ka(null,t,r,yo(r.type,e),n);break e}throw Error(o(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,Ea(e,t,r,i=t.elementType===r?i:yo(r,i),n);case 1:return r=t.type,i=t.pendingProps,Ia(e,t,r,i=t.elementType===r?i:yo(r,i),n);case 3:e:{if(Ta(t),null===e)throw Error(o(387));r=t.pendingProps,i=(s=t.memoizedState).element,Oo(e,t),No(t,r,null,n);var a=t.memoizedState;if(r=a.element,s.isDehydrated){if(s={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=s,t.memoizedState=s,256&t.flags){t=Aa(e,t,r,n,i=ua(Error(o(423)),t));break e}if(r!==i){t=Aa(e,t,r,n,i=ua(Error(o(424)),t));break e}for(ro=ci(t.stateNode.containerInfo.firstChild),no=t,io=!0,oo=null,n=Zo(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fo(),r===i){t=Wa(e,t,n);break e}xa(e,t,r,n)}t=t.child}return t;case 5:return ss(t),null===e&&co(t),r=t.type,i=t.pendingProps,s=null!==e?e.memoizedProps:null,a=i.children,ni(r,i)?a=null:null!==s&&ni(r,s)&&(t.flags|=32),Ca(e,t),xa(e,t,a,n),t.child;case 6:return null===e&&co(t),null;case 13:return Na(e,t,n);case 4:return is(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Qo(t,null,r,n):xa(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,Sa(e,t,r,i=t.elementType===r?i:yo(r,i),n);case 7:return xa(e,t,t.pendingProps,n),t.child;case 8:case 12:return xa(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,s=t.memoizedProps,a=i.value,Ci(vo,r._currentValue),r._currentValue=a,null!==s)if(ar(s.value,a)){if(s.children===i.children&&!Mi.current){t=Wa(e,t,n);break e}}else for(null!==(s=t.child)&&(s.return=t);null!==s;){var l=s.dependencies;if(null!==l){a=s.child;for(var c=l.firstContext;null!==c;){if(c.context===r){if(1===s.tag){(c=Lo(-1,n&-n)).tag=2;var u=s.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}s.lanes|=n,null!==(c=s.alternate)&&(c.lanes|=n),_o(s.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===s.tag)a=s.type===t.type?null:s.child;else if(18===s.tag){if(null===(a=s.return))throw Error(o(341));a.lanes|=n,null!==(l=a.alternate)&&(l.lanes|=n),_o(a,n,t),a=s.sibling}else a=s.child;if(null!==a)a.return=s;else for(a=s;null!==a;){if(a===t){a=null;break}if(null!==(s=a.sibling)){s.return=a.return,a=s;break}a=a.return}s=a}xa(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,Po(t,n),r=r(i=Co(i)),t.flags|=1,xa(e,t,r,n),t.child;case 14:return i=yo(r=t.type,t.pendingProps),ka(e,t,r,i=yo(r.type,i),n);case 15:return _a(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:yo(r,i),Ka(e,t),t.tag=1,ji(r)?(e=!0,Ri(t)):e=!1,Po(t,n),Ko(t,r,i),$o(t,r,i,n),Ma(null,t,r,!0,e,n);case 19:return Va(e,t,n);case 22:return Pa(e,t,n)}throw Error(o(156,t.tag))};var qc="function"===typeof reportError?reportError:function(e){console.error(e)};function Gc(e){this._internalRoot=e}function Xc(e){this._internalRoot=e}function Qc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Zc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Jc(){}function eu(e,t,n,r,i){var o=n._reactRootContainer;if(o){var s=o;if("function"===typeof i){var a=i;i=function(){var e=Wc(s);a.call(e)}}Kc(t,s,e,i)}else s=function(e,t,n,r,i){if(i){if("function"===typeof r){var o=r;r=function(){var e=Wc(s);o.call(e)}}var s=Vc(t,r,e,0,null,!1,0,"",Jc);return e._reactRootContainer=s,e[fi]=s.current,Hr(8===e.nodeType?e.parentNode:e),dc(),s}for(;i=e.lastChild;)e.removeChild(i);if("function"===typeof r){var a=r;r=function(){var e=Wc(l);a.call(e)}}var l=Uc(e,0,!1,null,0,!1,0,"",Jc);return e._reactRootContainer=l,e[fi]=l.current,Hr(8===e.nodeType?e.parentNode:e),dc((function(){Kc(t,l,n,r)})),l}(n,t,e,i,r);return Wc(s)}Xc.prototype.render=Gc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(o(409));Kc(e,t,null,null)},Xc.prototype.unmount=Gc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;dc((function(){Kc(null,e,null,null)})),t[fi]=null}},Xc.prototype.unstable_scheduleHydration=function(e){if(e){var t=_t();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Ot.length&&0!==t&&t<Ot[n].priority;n++);Ot.splice(n,0,e),0===n&&Dt(e)}},xt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(vt(t,1|n),ic(t,Qe()),0===(6&Ml)&&(Vl=Qe()+500,Hi()))}break;case 13:dc((function(){var t=To(e,1);if(null!==t){var n=tc();rc(t,e,1,n)}})),Yc(e,1)}},St=function(e){if(13===e.tag){var t=To(e,134217728);if(null!==t)rc(t,e,134217728,tc());Yc(e,134217728)}},kt=function(e){if(13===e.tag){var t=nc(e),n=To(e,t);if(null!==n)rc(n,e,t,tc());Yc(e,t)}},_t=function(){return bt},Pt=function(e,t){var n=bt;try{return bt=e,t()}finally{bt=n}},Se=function(e,t,n){switch(t){case"input":if(Z(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=xi(r);if(!i)throw Error(o(90));Y(r),Z(r,i)}}}break;case"textarea":oe(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ie=uc,Me=dc;var tu={usingClientEntryPoint:!1,Events:[bi,wi,xi,Ce,Ee,uc]},nu={findFiberByHostInstance:vi,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},ru={bundleType:nu.bundleType,version:nu.version,rendererPackageName:nu.rendererPackageName,rendererConfig:nu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:w.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=We(e))?null:e.stateNode},findFiberByHostInstance:nu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var iu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!iu.isDisabled&&iu.supportsFiber)try{it=iu.inject(ru),ot=iu}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Qc(t))throw Error(o(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:S,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Qc(e))throw Error(o(299));var n=!1,r="",i=qc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(i=t.onRecoverableError)),t=Uc(e,1,!1,null,0,n,0,r,i),e[fi]=t.current,Hr(8===e.nodeType?e.parentNode:e),new Gc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw e=Object.keys(e).join(","),Error(o(268,e))}return e=null===(e=We(t))?null:e.stateNode},t.flushSync=function(e){return dc(e)},t.hydrate=function(e,t,n){if(!Zc(t))throw Error(o(200));return eu(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Qc(e))throw Error(o(405));var r=null!=n&&n.hydratedSources||null,i=!1,s="",a=qc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(s=n.identifierPrefix),void 0!==n.onRecoverableError&&(a=n.onRecoverableError)),t=Vc(t,null,e,1,null!=n?n:null,i,0,s,a),e[fi]=t.current,Hr(e),r)for(e=0;e<r.length;e++)i=(i=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new Xc(t)},t.render=function(e,t,n){if(!Zc(t))throw Error(o(200));return eu(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Zc(e))throw Error(o(40));return!!e._reactRootContainer&&(dc((function(){eu(null,null,e,!1,(function(){e._reactRootContainer=null,e[fi]=null}))})),!0)},t.unstable_batchedUpdates=uc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Zc(n))throw Error(o(200));if(null==e||void 0===e._reactInternals)throw Error(o(38));return eu(e,t,n,!1,r)},t.version="18.2.0-next-9e3b772b8-20220608"},4164:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(4463)},6374:(e,t,n)=>{"use strict";var r=n(2791),i=Symbol.for("react.element"),o=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,o={},c=null,u=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)s.call(t,r)&&!l.hasOwnProperty(r)&&(o[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===o[r]&&(o[r]=t[r]);return{$$typeof:i,type:e,key:c,ref:u,props:o,_owner:a.current}}t.Fragment=o,t.jsx=c,t.jsxs=c},9117:(e,t)=>{"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,m={};function y(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||f}function v(){}function b(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||f}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=y.prototype;var w=b.prototype=new v;w.constructor=b,g(w,y.prototype),w.isPureReactComponent=!0;var x=Array.isArray,S=Object.prototype.hasOwnProperty,k={current:null},_={key:!0,ref:!0,__self:!0,__source:!0};function P(e,t,r){var i,o={},s=null,a=null;if(null!=t)for(i in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(s=""+t.key),t)S.call(t,i)&&!_.hasOwnProperty(i)&&(o[i]=t[i]);var l=arguments.length-2;if(1===l)o.children=r;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];o.children=c}if(e&&e.defaultProps)for(i in l=e.defaultProps)void 0===o[i]&&(o[i]=l[i]);return{$$typeof:n,type:e,key:s,ref:a,props:o,_owner:k.current}}function C(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var E=/\/+/g;function I(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function M(e,t,i,o,s){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var l=!1;if(null===e)l=!0;else switch(a){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case r:l=!0}}if(l)return s=s(l=e),e=""===o?"."+I(l,0):o,x(s)?(i="",null!=e&&(i=e.replace(E,"$&/")+"/"),M(s,t,i,"",(function(e){return e}))):null!=s&&(C(s)&&(s=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(s,i+(!s.key||l&&l.key===s.key?"":(""+s.key).replace(E,"$&/")+"/")+e)),t.push(s)),1;if(l=0,o=""===o?".":o+":",x(e))for(var c=0;c<e.length;c++){var u=o+I(a=e[c],c);l+=M(a,t,i,u,s)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),c=0;!(a=e.next()).done;)l+=M(a=a.value,t,i,u=o+I(a,c++),s);else if("object"===a)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function T(e,t,n){if(null==e)return e;var r=[],i=0;return M(e,r,"","",(function(e){return t.call(n,e,i++)})),r}function A(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var j={current:null},O={transition:null},L={ReactCurrentDispatcher:j,ReactCurrentBatchConfig:O,ReactCurrentOwner:k};t.Children={map:T,forEach:function(e,t,n){T(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return T(e,(function(){t++})),t},toArray:function(e){return T(e,(function(e){return e}))||[]},only:function(e){if(!C(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=y,t.Fragment=i,t.Profiler=s,t.PureComponent=b,t.StrictMode=o,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=L,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=g({},e.props),o=e.key,s=e.ref,a=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,a=k.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)S.call(t,c)&&!_.hasOwnProperty(c)&&(i[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)i.children=r;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];i.children=l}return{$$typeof:n,type:e.type,key:o,ref:s,props:i,_owner:a}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=P,t.createFactory=function(e){var t=P.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=C,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:A}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=O.transition;O.transition={};try{e()}finally{O.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return j.current.useCallback(e,t)},t.useContext=function(e){return j.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return j.current.useDeferredValue(e)},t.useEffect=function(e,t){return j.current.useEffect(e,t)},t.useId=function(){return j.current.useId()},t.useImperativeHandle=function(e,t,n){return j.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return j.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return j.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return j.current.useMemo(e,t)},t.useReducer=function(e,t,n){return j.current.useReducer(e,t,n)},t.useRef=function(e){return j.current.useRef(e)},t.useState=function(e){return j.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return j.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return j.current.useTransition()},t.version="18.2.0"},2791:(e,t,n)=>{"use strict";e.exports=n(9117)},184:(e,t,n)=>{"use strict";e.exports=n(6374)},6813:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<o(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,s=i>>>1;r<s;){var a=2*(r+1)-1,l=e[a],c=a+1,u=e[c];if(0>o(l,n))c<i&&0>o(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[a]=n,r=a);else{if(!(c<i&&0>o(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var c=[],u=[],d=1,h=null,p=3,f=!1,g=!1,m=!1,y="function"===typeof setTimeout?setTimeout:null,v="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function w(e){for(var t=r(u);null!==t;){if(null===t.callback)i(u);else{if(!(t.startTime<=e))break;i(u),t.sortIndex=t.expirationTime,n(c,t)}t=r(u)}}function x(e){if(m=!1,w(e),!g)if(null!==r(c))g=!0,O(S);else{var t=r(u);null!==t&&L(x,t.startTime-e)}}function S(e,n){g=!1,m&&(m=!1,v(C),C=-1),f=!0;var o=p;try{for(w(n),h=r(c);null!==h&&(!(h.expirationTime>n)||e&&!M());){var s=h.callback;if("function"===typeof s){h.callback=null,p=h.priorityLevel;var a=s(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof a?h.callback=a:h===r(c)&&i(c),w(n)}else i(c);h=r(c)}if(null!==h)var l=!0;else{var d=r(u);null!==d&&L(x,d.startTime-n),l=!1}return l}finally{h=null,p=o,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var k,_=!1,P=null,C=-1,E=5,I=-1;function M(){return!(t.unstable_now()-I<E)}function T(){if(null!==P){var e=t.unstable_now();I=e;var n=!0;try{n=P(!0,e)}finally{n?k():(_=!1,P=null)}}else _=!1}if("function"===typeof b)k=function(){b(T)};else if("undefined"!==typeof MessageChannel){var A=new MessageChannel,j=A.port2;A.port1.onmessage=T,k=function(){j.postMessage(null)}}else k=function(){y(T,0)};function O(e){P=e,_||(_=!0,k())}function L(e,n){C=y((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){g||f||(g=!0,O(S))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,i,o){var s=t.unstable_now();switch("object"===typeof o&&null!==o?o="number"===typeof(o=o.delay)&&0<o?s+o:s:o=s,e){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return e={id:d++,callback:i,priorityLevel:e,startTime:o,expirationTime:a=o+a,sortIndex:-1},o>s?(e.sortIndex=o,n(u,e),null===r(c)&&e===r(u)&&(m?(v(C),C=-1):m=!0,L(x,o-s))):(e.sortIndex=a,n(c,e),g||f||(g=!0,O(S))),e},t.unstable_shouldYield=M,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},5296:(e,t,n)=>{"use strict";e.exports=n(6813)},5230:(e,t,n)=>{"use strict";var r=n(7176),i=n(7798),o=TypeError;e.exports=function(e){if(r(e))return e;throw new o(i(e)+" is not a function")}},9297:(e,t,n)=>{"use strict";var r=n(2899),i=n(6257),o=n(1369).f,s=r("unscopables"),a=Array.prototype;void 0===a[s]&&o(a,s,{configurable:!0,value:i(null)}),e.exports=function(e){a[s][e]=!0}},675:(e,t,n)=>{"use strict";var r=n(9803).charAt;e.exports=function(e,t,n){return t+(n?r(e,t).length:1)}},2786:(e,t,n)=>{"use strict";var r=n(903),i=String,o=TypeError;e.exports=function(e){if(r(e))return e;throw new o(i(e)+" is not an object")}},2265:(e,t,n)=>{"use strict";var r=n(4958),i=n(3742),o=n(1214),s=function(e){return function(t,n,s){var a,l=r(t),c=o(l),u=i(s,c);if(e&&n!==n){for(;c>u;)if((a=l[u++])!==a)return!0}else for(;c>u;u++)if((e||u in l)&&l[u]===n)return e||u||0;return!e&&-1}};e.exports={includes:s(!0),indexOf:s(!1)}},3318:(e,t,n)=>{"use strict";var r=n(3322),i=r({}.toString),o=r("".slice);e.exports=function(e){return o(i(e),8,-1)}},9024:(e,t,n)=>{"use strict";var r=n(8468),i=n(7176),o=n(3318),s=n(2899)("toStringTag"),a=Object,l="Arguments"===o(function(){return arguments}());e.exports=r?o:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(n){}}(t=a(e),s))?n:l?o(t):"Object"===(r=o(t))&&i(t.callee)?"Arguments":r}},3678:(e,t,n)=>{"use strict";var r=n(6225),i=n(2876),o=n(3718),s=n(1369);e.exports=function(e,t,n){for(var a=i(t),l=s.f,c=o.f,u=0;u<a.length;u++){var d=a[u];r(e,d)||n&&r(n,d)||l(e,d,c(t,d))}}},6958:(e,t,n)=>{"use strict";var r=n(8307),i=n(1369),o=n(837);e.exports=r?function(e,t,n){return i.f(e,t,o(1,n))}:function(e,t,n){return e[t]=n,e}},837:e=>{"use strict";e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},8825:(e,t,n)=>{"use strict";var r=n(7176),i=n(1369),o=n(1899),s=n(6478);e.exports=function(e,t,n,a){a||(a={});var l=a.enumerable,c=void 0!==a.name?a.name:t;if(r(n)&&o(n,c,a),a.global)l?e[t]=n:s(t,n);else{try{a.unsafe?e[t]&&(l=!0):delete e[t]}catch(u){}l?e[t]=n:i.f(e,t,{value:n,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return e}},6478:(e,t,n)=>{"use strict";var r=n(5187),i=Object.defineProperty;e.exports=function(e,t){try{i(r,e,{value:t,configurable:!0,writable:!0})}catch(n){r[e]=t}return t}},8307:(e,t,n)=>{"use strict";var r=n(2542);e.exports=!r((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))},7130:e=>{"use strict";var t="object"==typeof document&&document.all,n="undefined"==typeof t&&void 0!==t;e.exports={all:t,IS_HTMLDDA:n}},6197:(e,t,n)=>{"use strict";var r=n(5187),i=n(903),o=r.document,s=i(o)&&i(o.createElement);e.exports=function(e){return s?o.createElement(e):{}}},3727:e=>{"use strict";e.exports="undefined"!=typeof navigator&&String(navigator.userAgent)||""},1991:(e,t,n)=>{"use strict";var r,i,o=n(5187),s=n(3727),a=o.process,l=o.Deno,c=a&&a.versions||l&&l.version,u=c&&c.v8;u&&(i=(r=u.split("."))[0]>0&&r[0]<4?1:+(r[0]+r[1])),!i&&s&&(!(r=s.match(/Edge\/(\d+)/))||r[1]>=74)&&(r=s.match(/Chrome\/(\d+)/))&&(i=+r[1]),e.exports=i},8587:e=>{"use strict";e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},5369:(e,t,n)=>{"use strict";var r=n(5187),i=n(3718).f,o=n(6958),s=n(8825),a=n(6478),l=n(3678),c=n(1103);e.exports=function(e,t){var n,u,d,h,p,f=e.target,g=e.global,m=e.stat;if(n=g?r:m?r[f]||a(f,{}):(r[f]||{}).prototype)for(u in t){if(h=t[u],d=e.dontCallGetSet?(p=i(n,u))&&p.value:n[u],!c(g?u:f+(m?".":"#")+u,e.forced)&&void 0!==d){if(typeof h==typeof d)continue;l(h,d)}(e.sham||d&&d.sham)&&o(h,"sham",!0),s(n,u,h,e)}}},2542:e=>{"use strict";e.exports=function(e){try{return!!e()}catch(t){return!0}}},6296:(e,t,n)=>{"use strict";n(5701);var r=n(5705),i=n(8825),o=n(1691),s=n(2542),a=n(2899),l=n(6958),c=a("species"),u=RegExp.prototype;e.exports=function(e,t,n,d){var h=a(e),p=!s((function(){var t={};return t[h]=function(){return 7},7!==""[e](t)})),f=p&&!s((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[c]=function(){return n},n.flags="",n[h]=/./[h]),n.exec=function(){return t=!0,null},n[h](""),!t}));if(!p||!f||n){var g=r(/./[h]),m=t(h,""[e],(function(e,t,n,i,s){var a=r(e),l=t.exec;return l===o||l===u.exec?p&&!s?{done:!0,value:g(t,n,i)}:{done:!0,value:a(n,t,i)}:{done:!1}}));i(String.prototype,e,m[0]),i(u,h,m[1])}d&&l(u[h],"sham",!0)}},5042:(e,t,n)=>{"use strict";var r=n(2085),i=Function.prototype,o=i.apply,s=i.call;e.exports="object"==typeof Reflect&&Reflect.apply||(r?s.bind(o):function(){return s.apply(o,arguments)})},2085:(e,t,n)=>{"use strict";var r=n(2542);e.exports=!r((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))},3011:(e,t,n)=>{"use strict";var r=n(2085),i=Function.prototype.call;e.exports=r?i.bind(i):function(){return i.apply(i,arguments)}},6408:(e,t,n)=>{"use strict";var r=n(8307),i=n(6225),o=Function.prototype,s=r&&Object.getOwnPropertyDescriptor,a=i(o,"name"),l=a&&"something"===function(){}.name,c=a&&(!r||r&&s(o,"name").configurable);e.exports={EXISTS:a,PROPER:l,CONFIGURABLE:c}},5705:(e,t,n)=>{"use strict";var r=n(3318),i=n(3322);e.exports=function(e){if("Function"===r(e))return i(e)}},3322:(e,t,n)=>{"use strict";var r=n(2085),i=Function.prototype,o=i.call,s=r&&i.bind.bind(o,o);e.exports=r?s:function(e){return function(){return o.apply(e,arguments)}}},7808:(e,t,n)=>{"use strict";var r=n(5187),i=n(7176);e.exports=function(e,t){return arguments.length<2?(n=r[e],i(n)?n:void 0):r[e]&&r[e][t];var n}},5377:(e,t,n)=>{"use strict";var r=n(5230),i=n(4135);e.exports=function(e,t){var n=e[t];return i(n)?void 0:r(n)}},3168:(e,t,n)=>{"use strict";var r=n(3322),i=n(4656),o=Math.floor,s=r("".charAt),a=r("".replace),l=r("".slice),c=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,u=/\$([$&'`]|\d{1,2})/g;e.exports=function(e,t,n,r,d,h){var p=n+e.length,f=r.length,g=u;return void 0!==d&&(d=i(d),g=c),a(h,g,(function(i,a){var c;switch(s(a,0)){case"$":return"$";case"&":return e;case"`":return l(t,0,n);case"'":return l(t,p);case"<":c=d[l(a,1,-1)];break;default:var u=+a;if(0===u)return i;if(u>f){var h=o(u/10);return 0===h?i:h<=f?void 0===r[h-1]?s(a,1):r[h-1]+s(a,1):i}c=r[u-1]}return void 0===c?"":c}))}},5187:function(e,t,n){"use strict";var r=function(e){return e&&e.Math===Math&&e};e.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof n.g&&n.g)||function(){return this}()||this||Function("return this")()},6225:(e,t,n)=>{"use strict";var r=n(3322),i=n(4656),o=r({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return o(i(e),t)}},6690:e=>{"use strict";e.exports={}},5767:(e,t,n)=>{"use strict";var r=n(7808);e.exports=r("document","documentElement")},4570:(e,t,n)=>{"use strict";var r=n(8307),i=n(2542),o=n(6197);e.exports=!r&&!i((function(){return 7!==Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}))},5564:(e,t,n)=>{"use strict";var r=n(3322),i=n(2542),o=n(3318),s=Object,a=r("".split);e.exports=i((function(){return!s("z").propertyIsEnumerable(0)}))?function(e){return"String"===o(e)?a(e,""):s(e)}:s},6530:(e,t,n)=>{"use strict";var r=n(3322),i=n(7176),o=n(2879),s=r(Function.toString);i(o.inspectSource)||(o.inspectSource=function(e){return s(e)}),e.exports=o.inspectSource},6589:(e,t,n)=>{"use strict";var r,i,o,s=n(6519),a=n(5187),l=n(903),c=n(6958),u=n(6225),d=n(2879),h=n(1868),p=n(6690),f="Object already initialized",g=a.TypeError,m=a.WeakMap;if(s||d.state){var y=d.state||(d.state=new m);y.get=y.get,y.has=y.has,y.set=y.set,r=function(e,t){if(y.has(e))throw new g(f);return t.facade=e,y.set(e,t),t},i=function(e){return y.get(e)||{}},o=function(e){return y.has(e)}}else{var v=h("state");p[v]=!0,r=function(e,t){if(u(e,v))throw new g(f);return t.facade=e,c(e,v,t),t},i=function(e){return u(e,v)?e[v]:{}},o=function(e){return u(e,v)}}e.exports={set:r,get:i,has:o,enforce:function(e){return o(e)?i(e):r(e,{})},getterFor:function(e){return function(t){var n;if(!l(t)||(n=i(t)).type!==e)throw new g("Incompatible receiver, "+e+" required");return n}}}},7176:(e,t,n)=>{"use strict";var r=n(7130),i=r.all;e.exports=r.IS_HTMLDDA?function(e){return"function"==typeof e||e===i}:function(e){return"function"==typeof e}},1103:(e,t,n)=>{"use strict";var r=n(2542),i=n(7176),o=/#|\.prototype\./,s=function(e,t){var n=l[a(e)];return n===u||n!==c&&(i(t)?r(t):!!t)},a=s.normalize=function(e){return String(e).replace(o,".").toLowerCase()},l=s.data={},c=s.NATIVE="N",u=s.POLYFILL="P";e.exports=s},4135:e=>{"use strict";e.exports=function(e){return null===e||void 0===e}},903:(e,t,n)=>{"use strict";var r=n(7176),i=n(7130),o=i.all;e.exports=i.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:r(e)||e===o}:function(e){return"object"==typeof e?null!==e:r(e)}},1602:e=>{"use strict";e.exports=!1},7523:(e,t,n)=>{"use strict";var r=n(7808),i=n(7176),o=n(5119),s=n(7836),a=Object;e.exports=s?function(e){return"symbol"==typeof e}:function(e){var t=r("Symbol");return i(t)&&o(t.prototype,a(e))}},1214:(e,t,n)=>{"use strict";var r=n(1193);e.exports=function(e){return r(e.length)}},1899:(e,t,n)=>{"use strict";var r=n(3322),i=n(2542),o=n(7176),s=n(6225),a=n(8307),l=n(6408).CONFIGURABLE,c=n(6530),u=n(6589),d=u.enforce,h=u.get,p=String,f=Object.defineProperty,g=r("".slice),m=r("".replace),y=r([].join),v=a&&!i((function(){return 8!==f((function(){}),"length",{value:8}).length})),b=String(String).split("String"),w=e.exports=function(e,t,n){"Symbol("===g(p(t),0,7)&&(t="["+m(p(t),/^Symbol\(([^)]*)\)/,"$1")+"]"),n&&n.getter&&(t="get "+t),n&&n.setter&&(t="set "+t),(!s(e,"name")||l&&e.name!==t)&&(a?f(e,"name",{value:t,configurable:!0}):e.name=t),v&&n&&s(n,"arity")&&e.length!==n.arity&&f(e,"length",{value:n.arity});try{n&&s(n,"constructor")&&n.constructor?a&&f(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(i){}var r=d(e);return s(r,"source")||(r.source=y(b,"string"==typeof t?t:"")),e};Function.prototype.toString=w((function(){return o(this)&&h(this).source||c(this)}),"toString")},6596:e=>{"use strict";var t=Math.ceil,n=Math.floor;e.exports=Math.trunc||function(e){var r=+e;return(r>0?n:t)(r)}},6257:(e,t,n)=>{"use strict";var r,i=n(2786),o=n(9225),s=n(8587),a=n(6690),l=n(5767),c=n(6197),u=n(1868),d="prototype",h="script",p=u("IE_PROTO"),f=function(){},g=function(e){return"<"+h+">"+e+"</"+h+">"},m=function(e){e.write(g("")),e.close();var t=e.parentWindow.Object;return e=null,t},y=function(){try{r=new ActiveXObject("htmlfile")}catch(t){}y="undefined"!=typeof document?document.domain&&r?m(r):function(){var e,t=c("iframe"),n="java"+h+":";return t.style.display="none",l.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(g("document.F=Object")),e.close(),e.F}():m(r);for(var e=s.length;e--;)delete y[d][s[e]];return y()};a[p]=!0,e.exports=Object.create||function(e,t){var n;return null!==e?(f[d]=i(e),n=new f,f[d]=null,n[p]=e):n=y(),void 0===t?n:o.f(n,t)}},9225:(e,t,n)=>{"use strict";var r=n(8307),i=n(5915),o=n(1369),s=n(2786),a=n(4958),l=n(4956);t.f=r&&!i?Object.defineProperties:function(e,t){s(e);for(var n,r=a(t),i=l(t),c=i.length,u=0;c>u;)o.f(e,n=i[u++],r[n]);return e}},1369:(e,t,n)=>{"use strict";var r=n(8307),i=n(4570),o=n(5915),s=n(2786),a=n(1665),l=TypeError,c=Object.defineProperty,u=Object.getOwnPropertyDescriptor,d="enumerable",h="configurable",p="writable";t.f=r?o?function(e,t,n){if(s(e),t=a(t),s(n),"function"===typeof e&&"prototype"===t&&"value"in n&&p in n&&!n[p]){var r=u(e,t);r&&r[p]&&(e[t]=n.value,n={configurable:h in n?n[h]:r[h],enumerable:d in n?n[d]:r[d],writable:!1})}return c(e,t,n)}:c:function(e,t,n){if(s(e),t=a(t),s(n),i)try{return c(e,t,n)}catch(r){}if("get"in n||"set"in n)throw new l("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},3718:(e,t,n)=>{"use strict";var r=n(8307),i=n(3011),o=n(5305),s=n(837),a=n(4958),l=n(1665),c=n(6225),u=n(4570),d=Object.getOwnPropertyDescriptor;t.f=r?d:function(e,t){if(e=a(e),t=l(t),u)try{return d(e,t)}catch(n){}if(c(e,t))return s(!i(o.f,e,t),e[t])}},248:(e,t,n)=>{"use strict";var r=n(7806),i=n(8587).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},2703:(e,t)=>{"use strict";t.f=Object.getOwnPropertySymbols},5119:(e,t,n)=>{"use strict";var r=n(3322);e.exports=r({}.isPrototypeOf)},7806:(e,t,n)=>{"use strict";var r=n(3322),i=n(6225),o=n(4958),s=n(2265).indexOf,a=n(6690),l=r([].push);e.exports=function(e,t){var n,r=o(e),c=0,u=[];for(n in r)!i(a,n)&&i(r,n)&&l(u,n);for(;t.length>c;)i(r,n=t[c++])&&(~s(u,n)||l(u,n));return u}},4956:(e,t,n)=>{"use strict";var r=n(7806),i=n(8587);e.exports=Object.keys||function(e){return r(e,i)}},5305:(e,t)=>{"use strict";var n={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,i=r&&!n.call({1:2},1);t.f=i?function(e){var t=r(this,e);return!!t&&t.enumerable}:n},3737:(e,t,n)=>{"use strict";var r=n(3011),i=n(7176),o=n(903),s=TypeError;e.exports=function(e,t){var n,a;if("string"===t&&i(n=e.toString)&&!o(a=r(n,e)))return a;if(i(n=e.valueOf)&&!o(a=r(n,e)))return a;if("string"!==t&&i(n=e.toString)&&!o(a=r(n,e)))return a;throw new s("Can't convert object to primitive value")}},2876:(e,t,n)=>{"use strict";var r=n(7808),i=n(3322),o=n(248),s=n(2703),a=n(2786),l=i([].concat);e.exports=r("Reflect","ownKeys")||function(e){var t=o.f(a(e)),n=s.f;return n?l(t,n(e)):t}},8987:(e,t,n)=>{"use strict";var r=n(3011),i=n(2786),o=n(7176),s=n(3318),a=n(1691),l=TypeError;e.exports=function(e,t){var n=e.exec;if(o(n)){var c=r(n,e,t);return null!==c&&i(c),c}if("RegExp"===s(e))return r(a,e,t);throw new l("RegExp#exec called on incompatible receiver")}},1691:(e,t,n)=>{"use strict";var r=n(3011),i=n(3322),o=n(8021),s=n(2061),a=n(8434),l=n(2217),c=n(6257),u=n(6589).get,d=n(2444),h=n(5761),p=l("native-string-replace",String.prototype.replace),f=RegExp.prototype.exec,g=f,m=i("".charAt),y=i("".indexOf),v=i("".replace),b=i("".slice),w=function(){var e=/a/,t=/b*/g;return r(f,e,"a"),r(f,t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),x=a.BROKEN_CARET,S=void 0!==/()??/.exec("")[1];(w||S||x||d||h)&&(g=function(e){var t,n,i,a,l,d,h,k=this,_=u(k),P=o(e),C=_.raw;if(C)return C.lastIndex=k.lastIndex,t=r(g,C,P),k.lastIndex=C.lastIndex,t;var E=_.groups,I=x&&k.sticky,M=r(s,k),T=k.source,A=0,j=P;if(I&&(M=v(M,"y",""),-1===y(M,"g")&&(M+="g"),j=b(P,k.lastIndex),k.lastIndex>0&&(!k.multiline||k.multiline&&"\n"!==m(P,k.lastIndex-1))&&(T="(?: "+T+")",j=" "+j,A++),n=new RegExp("^(?:"+T+")",M)),S&&(n=new RegExp("^"+T+"$(?!\\s)",M)),w&&(i=k.lastIndex),a=r(f,I?n:k,j),I?a?(a.input=b(a.input,A),a[0]=b(a[0],A),a.index=k.lastIndex,k.lastIndex+=a[0].length):k.lastIndex=0:w&&a&&(k.lastIndex=k.global?a.index+a[0].length:i),S&&a&&a.length>1&&r(p,a[0],n,(function(){for(l=1;l<arguments.length-2;l++)void 0===arguments[l]&&(a[l]=void 0)})),a&&E)for(a.groups=d=c(null),l=0;l<E.length;l++)d[(h=E[l])[0]]=a[h[1]];return a}),e.exports=g},2061:(e,t,n)=>{"use strict";var r=n(2786);e.exports=function(){var e=r(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}},8434:(e,t,n)=>{"use strict";var r=n(2542),i=n(5187).RegExp,o=r((function(){var e=i("a","y");return e.lastIndex=2,null!==e.exec("abcd")})),s=o||r((function(){return!i("a","y").sticky})),a=o||r((function(){var e=i("^r","gy");return e.lastIndex=2,null!==e.exec("str")}));e.exports={BROKEN_CARET:a,MISSED_STICKY:s,UNSUPPORTED_Y:o}},2444:(e,t,n)=>{"use strict";var r=n(2542),i=n(5187).RegExp;e.exports=r((function(){var e=i(".","s");return!(e.dotAll&&e.test("\n")&&"s"===e.flags)}))},5761:(e,t,n)=>{"use strict";var r=n(2542),i=n(5187).RegExp;e.exports=r((function(){var e=i("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")}))},3060:(e,t,n)=>{"use strict";var r=n(4135),i=TypeError;e.exports=function(e){if(r(e))throw new i("Can't call method on "+e);return e}},1868:(e,t,n)=>{"use strict";var r=n(2217),i=n(9892),o=r("keys");e.exports=function(e){return o[e]||(o[e]=i(e))}},2879:(e,t,n)=>{"use strict";var r=n(5187),i=n(6478),o="__core-js_shared__",s=r[o]||i(o,{});e.exports=s},2217:(e,t,n)=>{"use strict";var r=n(1602),i=n(2879);(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.33.2",mode:r?"pure":"global",copyright:"\xa9 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.33.2/LICENSE",source:"https://github.com/zloirock/core-js"})},9803:(e,t,n)=>{"use strict";var r=n(3322),i=n(1305),o=n(8021),s=n(3060),a=r("".charAt),l=r("".charCodeAt),c=r("".slice),u=function(e){return function(t,n){var r,u,d=o(s(t)),h=i(n),p=d.length;return h<0||h>=p?e?"":void 0:(r=l(d,h))<55296||r>56319||h+1===p||(u=l(d,h+1))<56320||u>57343?e?a(d,h):r:e?c(d,h,h+2):u-56320+(r-55296<<10)+65536}};e.exports={codeAt:u(!1),charAt:u(!0)}},6180:(e,t,n)=>{"use strict";var r=n(1991),i=n(2542),o=n(5187).String;e.exports=!!Object.getOwnPropertySymbols&&!i((function(){var e=Symbol("symbol detection");return!o(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&r&&r<41}))},3742:(e,t,n)=>{"use strict";var r=n(1305),i=Math.max,o=Math.min;e.exports=function(e,t){var n=r(e);return n<0?i(n+t,0):o(n,t)}},4958:(e,t,n)=>{"use strict";var r=n(5564),i=n(3060);e.exports=function(e){return r(i(e))}},1305:(e,t,n)=>{"use strict";var r=n(6596);e.exports=function(e){var t=+e;return t!==t||0===t?0:r(t)}},1193:(e,t,n)=>{"use strict";var r=n(1305),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},4656:(e,t,n)=>{"use strict";var r=n(3060),i=Object;e.exports=function(e){return i(r(e))}},4993:(e,t,n)=>{"use strict";var r=n(3011),i=n(903),o=n(7523),s=n(5377),a=n(3737),l=n(2899),c=TypeError,u=l("toPrimitive");e.exports=function(e,t){if(!i(e)||o(e))return e;var n,l=s(e,u);if(l){if(void 0===t&&(t="default"),n=r(l,e,t),!i(n)||o(n))return n;throw new c("Can't convert object to primitive value")}return void 0===t&&(t="number"),a(e,t)}},1665:(e,t,n)=>{"use strict";var r=n(4993),i=n(7523);e.exports=function(e){var t=r(e,"string");return i(t)?t:t+""}},8468:(e,t,n)=>{"use strict";var r={};r[n(2899)("toStringTag")]="z",e.exports="[object z]"===String(r)},8021:(e,t,n)=>{"use strict";var r=n(9024),i=String;e.exports=function(e){if("Symbol"===r(e))throw new TypeError("Cannot convert a Symbol value to a string");return i(e)}},7798:e=>{"use strict";var t=String;e.exports=function(e){try{return t(e)}catch(n){return"Object"}}},9892:(e,t,n)=>{"use strict";var r=n(3322),i=0,o=Math.random(),s=r(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+s(++i+o,36)}},7836:(e,t,n)=>{"use strict";var r=n(6180);e.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},5915:(e,t,n)=>{"use strict";var r=n(8307),i=n(2542);e.exports=r&&i((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},6519:(e,t,n)=>{"use strict";var r=n(5187),i=n(7176),o=r.WeakMap;e.exports=i(o)&&/native code/.test(String(o))},2899:(e,t,n)=>{"use strict";var r=n(5187),i=n(2217),o=n(6225),s=n(9892),a=n(6180),l=n(7836),c=r.Symbol,u=i("wks"),d=l?c.for||c:c&&c.withoutSetter||s;e.exports=function(e){return o(u,e)||(u[e]=a&&o(c,e)?c[e]:d("Symbol."+e)),u[e]}},1167:(e,t,n)=>{"use strict";n(9297)("flatMap")},1230:(e,t,n)=>{"use strict";n(9297)("flat")},5701:(e,t,n)=>{"use strict";var r=n(5369),i=n(1691);r({target:"RegExp",proto:!0,forced:/./.exec!==i},{exec:i})},2414:(e,t,n)=>{"use strict";var r=n(5042),i=n(3011),o=n(3322),s=n(6296),a=n(2542),l=n(2786),c=n(7176),u=n(4135),d=n(1305),h=n(1193),p=n(8021),f=n(3060),g=n(675),m=n(5377),y=n(3168),v=n(8987),b=n(2899)("replace"),w=Math.max,x=Math.min,S=o([].concat),k=o([].push),_=o("".indexOf),P=o("".slice),C="$0"==="a".replace(/./,"$0"),E=!!/./[b]&&""===/./[b]("a","$0");s("replace",(function(e,t,n){var o=E?"$":"$0";return[function(e,n){var r=f(this),o=u(e)?void 0:m(e,b);return o?i(o,e,r,n):i(t,p(r),e,n)},function(e,i){var s=l(this),a=p(e);if("string"==typeof i&&-1===_(i,o)&&-1===_(i,"$<")){var u=n(t,s,a,i);if(u.done)return u.value}var f=c(i);f||(i=p(i));var m,b=s.global;b&&(m=s.unicode,s.lastIndex=0);for(var C,E=[];null!==(C=v(s,a))&&(k(E,C),b);){""===p(C[0])&&(s.lastIndex=g(a,h(s.lastIndex),m))}for(var I,M="",T=0,A=0;A<E.length;A++){for(var j,O=p((C=E[A])[0]),L=w(x(d(C.index),a.length),0),z=[],R=1;R<C.length;R++)k(z,void 0===(I=C[R])?I:String(I));var D=C.groups;if(f){var N=S([O],z,L,a);void 0!==D&&k(N,D),j=p(r(i,void 0,N))}else j=y(O,a,L,z,D,i);L>=T&&(M+=P(a,T,L)+j,T=L+O.length)}return M+P(a,T)}]}),!!a((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}))||!C||E)}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,i){if(1&i&&(r=this(r)),8&i)return r;if("object"===typeof r&&r){if(4&i&&r.__esModule)return r;if(16&i&&"function"===typeof r.then)return r}var o=Object.create(null);n.r(o);var s={};e=e||[null,t({}),t([]),t(t)];for(var a=2&i&&r;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>s[e]=()=>r[e]));return s.default=()=>r,n.d(o,s),o}})(),n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),n.nc=void 0,(()=>{"use strict";var e=n(4164),t=n(2791),r=n.t(t,2);n(1230),n(1167),n(2414);function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function o(e){var t=function(e,t){if("object"!==i(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===i(t)?t:String(t)}function s(e,t,n){return(t=o(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class a{constructor(){s(this,"arraySize",0),s(this,"array",Array(8)),s(this,"set",null)}get isEmpty(){if(this.array)return 0===this.arraySize;if(this.set)return 0===this.set.size;throw new Error("no set or array")}add(e){if(this.array){return-1===this.array.indexOf(e)&&(this.arraySize<8?(this.array[this.arraySize]=e,this.arraySize++,!0):(this.set=new Set(this.array),this.array=null,this.set.add(e),!0))}if(this.set)return!this.set.has(e)&&(this.set.add(e),!0);throw new Error("no set or array")}remove(e){if(this.array){const t=this.array.indexOf(e);return-1!==t&&(this.array[t]=void 0,this.arraySize--,t!==this.arraySize&&(this.array[t]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return!!this.set.has(e)&&(this.set.delete(e),!0);throw new Error("no set or array")}visit(e){if(this.array)for(let t=0;t<this.arraySize;t++){const n=this.array[t];"undefined"!==typeof n&&e(n)}else{if(!this.set)throw new Error("no set or array");this.set.forEach(e)}}}function l(e){return e&&"object"===typeof e&&"parents"in e}function c(e){for(let t=0,n=e.parents.length;t<n;t++)if(e.parents[t].__unsafe__getWithoutCapture(),e.parents[t].lastChangedEpoch!==e.parentEpochs[t])return!0;return!1}const u=(e,t)=>{if(e.children.remove(t)&&e.children.isEmpty&&l(e))for(let n=0,r=e.parents.length;n<r;n++)u(e.parents[n],e)},d=(e,t)=>{if(e.children.add(t)&&l(e))for(let n=0,r=e.parents.length;n<r;n++)d(e.parents[n],e)};function h(e,t){return e===t||Object.is(e,t)||Boolean(e&&t&&"function"===typeof e.equals&&e.equals(t))}const p=Object.freeze([]),f=Symbol.for("__@tldraw/state__"),g=globalThis;g[f]?console.error('Multiple versions of @tldraw/state detected. This will cause unexpected behavior. Please add "resolutions" (yarn/pnpm) or "overrides" (npm) in your package.json to ensure only one version of @tldraw/state is loaded.'):g[f]=!0;class m{constructor(e,t){s(this,"offset",0),s(this,"numNewParents",0),s(this,"maybeRemoved",void 0),this.below=e,this.child=t}}let y=null;function v(e){y=new m(y,e)}function b(){var e;const t=y;y=t.below;if(t.numNewParents>0||t.offset!==t.child.parents.length){for(let e=t.offset;e<t.child.parents.length;e++){const n=t.child.parents[e];t.child.parents.indexOf(n)>=t.offset&&u(n,t.child)}if(t.child.parents.length=t.offset,t.child.parentEpochs.length=t.offset,null!==(e=y)&&void 0!==e&&e.maybeRemoved)for(let e=0;e<y.maybeRemoved.length;e++){const n=y.maybeRemoved[e];-1===t.child.parents.indexOf(n)&&u(n,t.child)}}}function w(e){if(y){const t=y.child.parents.indexOf(e);if(t<0&&(y.numNewParents++,y.child.isActivelyListening&&d(e,y.child)),t<0||t>=y.offset){if(t!==y.offset&&t>0){const e=y.child.parents[y.offset];y.maybeRemoved?-1===y.maybeRemoved.indexOf(e)&&y.maybeRemoved.push(e):y.maybeRemoved=[e]}y.child.parents[y.offset]=e,y.child.parentEpochs[y.offset]=e.lastChangedEpoch,y.offset++}}}const x=Symbol("RESET_VALUE");class S{constructor(e){s(this,"index",0),s(this,"buffer",void 0),this.capacity=e,this.buffer=new Array(e)}pushEntry(e,t,n){void 0!==n&&(n!==x?(this.buffer[this.index]=[e,t,n],this.index=(this.index+1)%this.capacity):this.clear())}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(e){const{index:t,capacity:n,buffer:r}=this;for(let i=0;i<n;i++){const o=(t-1+n-i)%n,s=r[o];if(!s)return x;const[a,l]=s;if(0===i&&e>=l)return[];if(a<=e&&e<l){const e=i+1,t=new Array(e);for(let i=0;i<e;i++)t[i]=r[(o+i)%n][2];return t}}return x}}const k=-1;let _=0,P=!1;class C{constructor(e){s(this,"initialAtomValues",new Map),this.parent=e}get isRoot(){return null===this.parent}commit(){if(this.isRoot){const e=this.initialAtomValues;this.initialAtomValues=new Map,E(e.keys())}else this.initialAtomValues.forEach(((e,t)=>{this.parent.initialAtomValues.has(t)||this.parent.initialAtomValues.set(t,e)}))}abort(){_++,this.initialAtomValues.forEach(((e,t)=>{var n;t.set(e),null===(n=t.historyBuffer)||void 0===n||n.clear()})),this.commit()}}function E(e){if(P)throw new Error("cannot change atoms during reaction cycle");try{P=!0;const t=new Set,n=e=>{e.lastTraversedEpoch!==_&&(e.lastTraversedEpoch=_,"maybeScheduleEffect"in e?t.add(e):e.children.visit(n))};for(const r of e)r.children.visit(n);for(const e of t)e.maybeScheduleEffect()}finally{P=!1}}let I=null;function M(e){return I?e():function(e){const t=new C(I);I=t;try{let n=!1;const r=e((()=>n=!0));return n?t.abort():t.commit(),r}catch(ZI){throw t.abort(),ZI}finally{I=I.parent}}(e)}class T{constructor(e,t,n){var r;s(this,"isEqual",void 0),s(this,"computeDiff",void 0),s(this,"lastChangedEpoch",_),s(this,"children",new a),s(this,"historyBuffer",void 0),this.name=e,this.current=t,this.isEqual=null!==(r=null===n||void 0===n?void 0:n.isEqual)&&void 0!==r?r:null,n&&(n.historyLength&&(this.historyBuffer=new S(n.historyLength)),this.computeDiff=n.computeDiff)}__unsafe__getWithoutCapture(){return this.current}get value(){return w(this),this.current}set(e,t){var n,r,i,o;if(null!==(n=null===(r=this.isEqual)||void 0===r?void 0:r.call(this,this.current,e))&&void 0!==n?n:h(this.current,e))return this.current;(_++,this.historyBuffer)&&this.historyBuffer.pushEntry(this.lastChangedEpoch,_,null!==(i=null!==t&&void 0!==t?t:null===(o=this.computeDiff)||void 0===o?void 0:o.call(this,this.current,e,this.lastChangedEpoch,_))&&void 0!==i?i:x);this.lastChangedEpoch=_;const s=this.current;return this.current=e,function(e,t){I?I.initialAtomValues.has(e)||I.initialAtomValues.set(e,t):E([e])}(this,s),e}update(e){return this.set(e(this.current))}getDiffSince(e){var t,n;return w(this),e>=this.lastChangedEpoch?p:null!==(t=null===(n=this.historyBuffer)||void 0===n?void 0:n.getChangesSince(e))&&void 0!==t?t:x}}function A(e,t,n){return new T(e,t,n)}const j=Symbol("UNINITIALIZED"),O=e=>e===j;class L{constructor(e,t){this.value=e,this.diff=t}}function z(e,t){return new L(e,t)}class R{constructor(e,t,n){var r;s(this,"lastChangedEpoch",k),s(this,"lastTraversedEpoch",k),s(this,"lastCheckedEpoch",k),s(this,"parents",[]),s(this,"parentEpochs",[]),s(this,"children",new a),s(this,"historyBuffer",void 0),s(this,"state",j),s(this,"computeDiff",void 0),s(this,"isEqual",void 0),this.name=e,this.derive=t,null!==n&&void 0!==n&&n.historyLength&&(this.historyBuffer=new S(n.historyLength)),this.computeDiff=null===n||void 0===n?void 0:n.computeDiff,this.isEqual=null!==(r=null===n||void 0===n?void 0:n.isEqual)&&void 0!==r?r:h}get isActivelyListening(){return!this.children.isEmpty}__unsafe__getWithoutCapture(){const e=this.lastChangedEpoch===k;if(!e&&(this.lastCheckedEpoch===_||!c(this)))return this.lastCheckedEpoch=_,this.state;try{v(this);const r=this.derive(this.state,this.lastCheckedEpoch),i=r instanceof L?r.value:r;if(this.state===j||!this.isEqual(i,this.state)){if(this.historyBuffer&&!e){var t,n;const e=r instanceof L?r.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,_,null!==(t=null!==e&&void 0!==e?e:null===(n=this.computeDiff)||void 0===n?void 0:n.call(this,this.state,i,this.lastCheckedEpoch,_))&&void 0!==t?t:x)}this.lastChangedEpoch=_,this.state=i}return this.lastCheckedEpoch=_,this.state}finally{b()}}get value(){const e=this.__unsafe__getWithoutCapture();return w(this),e}getDiffSince(e){var t,n;return this.value,e>=this.lastChangedEpoch?p:null!==(t=null===(n=this.historyBuffer)||void 0===n?void 0:n.getChangesSince(e))&&void 0!==t?t:x}}function D(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;const r=n.get,i=Symbol.for("__@tldraw/state__computed__"+t);return n.get=function(){let n=this[i];return n||(n=new R(t,r.bind(this),e),Object.defineProperty(this,i,{enumerable:!1,configurable:!1,writable:!1,value:n})),n.value},n}function N(){if(1===arguments.length){const e=arguments[0];return(t,n,r)=>D(e,t,n,r)}return"string"===typeof arguments[0]?new R(arguments[0],arguments[1],arguments[2]):D(void 0,arguments[0],arguments[1],arguments[2])}class F{constructor(e,t,n){s(this,"_isActivelyListening",!1),s(this,"lastTraversedEpoch",k),s(this,"lastReactedEpoch",k),s(this,"_scheduleCount",0),s(this,"parentEpochs",[]),s(this,"parents",[]),s(this,"_scheduleEffect",void 0),s(this,"maybeExecute",(()=>{this._isActivelyListening&&this.execute()})),this.name=e,this.runEffect=t,this._scheduleEffect=null===n||void 0===n?void 0:n.scheduleEffect}get isActivelyListening(){return this._isActivelyListening}get scheduleCount(){return this._scheduleCount}maybeScheduleEffect(){this._isActivelyListening&&this.lastReactedEpoch!==_&&(!this.parents.length||c(this)?this.scheduleEffect():this.lastReactedEpoch=_)}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}attach(){this._isActivelyListening=!0;for(let e=0,t=this.parents.length;e<t;e++)d(this.parents[e],this)}detach(){this._isActivelyListening=!1;for(let e=0,t=this.parents.length;e<t;e++)u(this.parents[e],this)}execute(){try{v(this);const e=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=_,e}finally{b()}}}function B(e,t,n){const r=new F(e,t,n);return r.attach(),r.scheduleEffect(),()=>{r.detach()}}function U(e,n){const r=t.useRef(n);r.current=n;const[i,o,s]=t.useMemo((()=>{let t=null;const n=new F("useStateTracking(".concat(e,")"),(()=>{var e;return null===(e=r.current)||void 0===e?void 0:e.call(r)}),{scheduleEffect(){var e;null===(e=t)||void 0===e||e()}});return[n,e=>(t=e,()=>{t=null}),()=>n.scheduleCount]}),[e]);return t.useSyncExternalStore(o,s,s),t.useEffect((()=>(i.attach(),i.maybeScheduleEffect(),()=>{i.detach()})),[i]),i.execute()}const H={apply(e,t,n){var r,i;return U(null!==(r=null!==(i=e.displayName)&&void 0!==i?i:e.name)&&void 0!==r?r:"tracked(???)",(()=>e.apply(t,n)))}},V=Symbol.for("react.memo"),K=Symbol.for("react.forward_ref");function W(e){let n=null;const r=e.$$typeof;return r===V&&(n=(e=e.type).compare),r===K?(0,t.memo)((0,t.forwardRef)(new Proxy(e.render,H))):(0,t.memo)(new Proxy(e,H),n)}function $(){const e=arguments[0],n=arguments[1],r=3===arguments.length?void 0:arguments[2],i=3===arguments.length?arguments[2]:arguments[3];return(0,t.useMemo)((()=>N("useComputed(".concat(e,")"),n,r)),i)}function Y(e,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p;(0,t.useEffect)((()=>{const t=new F(e,n);return t.attach(),t.execute(),()=>{t.detach()}}),r)}function q(){const e=arguments,n=3===e.length?e[2]:[e[0]],r=3===e.length?e[0]:"useValue(".concat(e[0].name,")"),i=(0,t.useRef)(!0);i.current=!0;const o=(0,t.useMemo)((()=>1===e.length?e[0]:N(r,(()=>{if(i.current)return e[1]();try{return e[1]()}catch{return{}}}))),n);try{const{subscribe:e,getSnapshot:n}=(0,t.useMemo)((()=>({subscribe:e=>B("useValue(".concat(r,")"),(()=>{o.value,e()})),getSnapshot:()=>o.value})),[o]);return(0,t.useSyncExternalStore)(e,n,n)}finally{i.current=!1}}class G{constructor(e){s(this,"nextValue",void 0),s(this,"diff",void 0),this.previousValue=e}get(){var e,t,n,r;const i=null!==(e=null===(t=this.diff)||void 0===t||null===(t=t.removed)||void 0===t?void 0:t.size)&&void 0!==e?e:0,o=null!==(n=null===(r=this.diff)||void 0===r||null===(r=r.added)||void 0===r?void 0:r.size)&&void 0!==n?n:0;if(0!==i||0!==o)return{value:this.nextValue,diff:this.diff}}_add(e,t){var n,r,i,o,s;(null!==(n=this.nextValue)&&void 0!==n||(this.nextValue=new Set(this.previousValue)),this.nextValue.add(e),null!==(r=this.diff)&&void 0!==r||(this.diff={}),t)?null===(i=this.diff.removed)||void 0===i||i.delete(e):(null!==(s=(o=this.diff).added)&&void 0!==s||(o.added=new Set),this.diff.added.add(e))}add(e){var t;const n=this.previousValue.has(e);if(n){var r;if(!(null===(r=this.diff)||void 0===r||null===(r=r.removed)||void 0===r?void 0:r.has(e)))return;return this._add(e,n)}(null===(t=this.nextValue)||void 0===t?void 0:t.has(e))||this._add(e,n)}_remove(e,t){var n,r,i,o,s;(null!==(n=this.nextValue)&&void 0!==n||(this.nextValue=new Set(this.previousValue)),this.nextValue.delete(e),null!==(r=this.diff)&&void 0!==r||(this.diff={}),t)?(null!==(o=(i=this.diff).removed)&&void 0!==o||(i.removed=new Set),this.diff.removed.add(e)):null===(s=this.diff.added)||void 0===s||s.delete(e)}remove(e){var t;const n=this.previousValue.has(e);if(!n){var r;if(!(null===(r=this.diff)||void 0===r||null===(r=r.added)||void 0===r?void 0:r.has(e)))return;return this._remove(e,n)}(null===(t=this.diff)||void 0===t||null===(t=t.removed)||void 0===t?void 0:t.has(e))||this._remove(e,n)}}function X(e,t){const n=[];e:for(const r of e){for(const e of n)if(t?t(r,e):r===e)continue e;n.push(r)}return n}function Q(e){return e.filter((e=>void 0!==e&&null!==e))}function Z(e){return e[e.length-1]}function J(e){const t=function(){try{return e(...arguments)}catch(n){throw n instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(n,t),n}};return t}function ee(e,t){const n=t&&e&&"object"===typeof e&&t in e?e[t]:e;throw new Error("Unknown switch case ".concat(n))}const te=J(((e,t)=>{if(!e)throw new Error(t||"Assertion Error")})),ne=J(((e,t)=>{if(null==e)throw new Error(null!==t&&void 0!==t?t:"value must be defined");return e}));function re(e,t){let n;const r=function(){n||(n={},n.promise=new Promise(((e,t)=>{n.resolve=e,n.reject=t}))),clearTimeout(n.timeout);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return n.latestArgs=i,n.timeout=setTimeout((()=>{const t=n;n=void 0;try{t.resolve(e(...t.latestArgs))}catch(ZI){t.reject(ZI)}}),t),n.promise};return r.cancel=()=>{n&&clearTimeout(n.timeout)},r}const ie=new WeakMap;function oe(e,t){if("object"!==typeof e||null===e)return;let n=ie.get(e);n||(n={tags:{},extras:{}},ie.set(e,n)),t.tags&&(n.tags={...n.tags,...t.tags}),t.extras&&(n.extras={...n.extras,...t.extras})}function se(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t+""}class ae{static async base64ToFile(e){return fetch(e).then((function(e){return e.arrayBuffer()}))}static async fileToBase64(e){return await new Promise(((t,n)=>{if(e){const r=new FileReader;r.readAsDataURL(e),r.onload=()=>t(r.result),r.onerror=e=>n(e),r.onabort=e=>n(e)}}))}}let le=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];"undefined"!==typeof Int32Array&&(le=new Int32Array(le));class ce{static isPng(e,t){return 137===e.getUint8(t+0)&&80===e.getUint8(t+1)&&78===e.getUint8(t+2)&&71===e.getUint8(t+3)&&13===e.getUint8(t+4)&&10===e.getUint8(t+5)&&26===e.getUint8(t+6)&&10===e.getUint8(t+7)}static getChunkType(e,t){return[String.fromCharCode(e.getUint8(t)),String.fromCharCode(e.getUint8(t+1)),String.fromCharCode(e.getUint8(t+2)),String.fromCharCode(e.getUint8(t+3))].join("")}static readChunks(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n={};if(!ce.isPng(e,t))throw new Error("Not a PNG");for(t+=8;t<=e.buffer.byteLength;){const r=t,i=e.getInt32(t);t+=4;const o=ce.getChunkType(e,t);if("IDAT"===o&&n[o])t+=i+4+4;else{if("IEND"===o)break;n[o]={start:r,dataOffset:t+4,size:i},t+=i+4+4}}return n}static parsePhys(e,t){return{ppux:e.getUint32(t),ppuy:e.getUint32(t+4),unit:e.getUint8(t+4)}}static findChunk(e,t){return ce.readChunks(e)[t]}static setPhysChunk(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0,r=46,i=0;const o=ce.findChunk(e,"pHYs");o&&(r=o.start,i=o.size);const s=ce.findChunk(e,"IDAT");s&&(r=s.start,i=0);const a=new ArrayBuffer(21),l=new DataView(a);l.setUint32(0,9),l.setUint8(4,"p".charCodeAt(0)),l.setUint8(5,"H".charCodeAt(0)),l.setUint8(6,"Y".charCodeAt(0)),l.setUint8(7,"s".charCodeAt(0));const c=2835.5;l.setInt32(8,c*t),l.setInt32(12,c*t),l.setInt8(16,1);const u=new Uint8Array(a.slice(4,17));l.setInt32(17,((e,t)=>{let n=0===t?0:-1^~~t;for(let r=0;r<e.length;r++)n=le[255&(n^e[r])]^n>>>8;return-1^n})(u));const d=e.buffer.slice(0,r),h=e.buffer.slice(r+i);return new Blob([d,a,h],n)}}class ue{static async getVideoSizeFromSrc(e){return await new Promise(((t,n)=>{const r=document.createElement("video");r.onloadeddata=()=>t({w:r.videoWidth,h:r.videoHeight}),r.onerror=e=>{console.error(e),n(new Error("Could not get video size"))},r.crossOrigin="anonymous",r.src=e}))}static async getImageSizeFromSrc(e){return await new Promise(((t,n)=>{const r=new Image;r.onload=async()=>{try{const n=await ae.base64ToFile(e),i=new DataView(n);if(ce.isPng(i,0)){const e=ce.findChunk(i,"pHYs");if(e){const n=ce.parsePhys(i,e.dataOffset);if(0===n.unit&&n.ppux===n.ppuy){const e=Math.round(n.ppux/2834.5);return void t({w:r.width/e,h:r.height/e})}}}t({w:r.width,h:r.height})}catch(n){console.error(n),t({w:r.width,h:r.height})}},r.onerror=e=>{console.error(e),n(new Error("Could not get image size"))},r.crossOrigin="anonymous",r.src=e}))}}function de(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=0,n=0,r=0,i=0;function o(){const e=t^t<<11;return t=n,n=r,r=i,i^=(i>>>19^e^e>>>8)>>>0,i/4294967296*2}for(let s=0;s<e.length+64;s++)t^=0|e.charCodeAt(s),o();return o}function he(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const[i,o]=t,[s,a]=n,l=s+(e-i)/(o-i)*(a-s);return r?s<a?Math.max(Math.min(l,a),s):Math.max(Math.min(l,s),a):l}function pe(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function fe(e,t){if(pe(e,t))return e[t]}function ge(e){if(!e)return e;if(Array.isArray(e)){const t=[],n=e.length;for(let r=0;r<n;r++)t.push(ge(e[r]));return t}if("object"===typeof e){const t=Object.keys(e),n=t.length,r={};for(let i=0;i<n;i++){const n=t[i];r[n]=ge(e[n])}return r}return e}function me(e){return Object.keys(e)}function ye(e){return Object.values(e)}function ve(e){return Object.entries(e)}function be(e){return Object.fromEntries(e)}function we(e,t){const n={};let r=!1;for(const[i,o]of ve(e))t(i,o)?n[i]=o:r=!0;return r?n:e}function xe(e,t){const n={};for(const[r,i]of ve(e)){const e=t(r,i);n[r]=e}return n}const Se=()=>"undefined"!==typeof process&&!1,ke=[],_e=()=>{const e=ke.splice(0,ke.length);for(const t of e)t()};let Pe;function Ce(){Pe||(Pe=requestAnimationFrame((()=>{Pe=void 0,_e()})))}function Ee(e,t){return e.id>t.id?1:-1}const Ie=new RegExp(/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:[/?#]\S*)?$/i);function Me(e){return Ie.test(e)}function Te(e){return null!==e}const Ae="undefined"!==typeof window&&window.structuredClone?window.structuredClone:e=>e?JSON.parse(JSON.stringify(e)):e;let je=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:21;return crypto.getRandomValues(new Uint8Array(e)).reduce(((e,t)=>e+=(t&=63)<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():t>62?"-":"_"),"")};class Oe{constructor(e,t){var n,r;s(this,"createDefaultProperties",void 0),s(this,"migrations",void 0),s(this,"validator",void 0),s(this,"scope",void 0),s(this,"isInstance",(e=>(null===e||void 0===e?void 0:e.typeName)===this.typeName)),this.typeName=e,this.createDefaultProperties=t.createDefaultProperties,this.migrations=t.migrations,this.validator=null!==(n=t.validator)&&void 0!==n?n:{validate:e=>e},this.scope=null!==(r=t.scope)&&void 0!==r?r:"document"}create(e){const t={...this.createDefaultProperties(),id:this.createId()};for(const[n,r]of Object.entries(e))void 0!==r&&(t[n]=r);return t.typeName=this.typeName,t}clone(e){return{...Ae(e),id:this.createId()}}createId(e){return this.typeName+":"+(null!==e&&void 0!==e?e:je())}createCustomId(e){return this.typeName+":"+e}parseId(e){if(!this.isId(e))throw new Error('ID "'.concat(e,'" is not a valid ID for type "').concat(this.typeName,'"'));return e.slice(this.typeName.length+1)}isId(e){if(!e)return!1;for(let t=0;t<this.typeName.length;t++)if(e[t]!==this.typeName[t])return!1;return":"===e[this.typeName.length]}withDefaultProperties(e){return new Oe(this.typeName,{createDefaultProperties:e,migrations:this.migrations,validator:this.validator,scope:this.scope})}validate(e){return this.validator.validate(e)}}function Le(e,t){var n;return new Oe(e,{createDefaultProperties:()=>({}),migrations:null!==(n=t.migrations)&&void 0!==n?n:{currentVersion:0,firstVersion:0,migrators:{}},validator:t.validator,scope:t.scope})}class ze{constructor(){s(this,"items",new WeakMap)}get(e,t){return this.items.has(e)||this.items.set(e,t(e)),this.items.get(e)}}var Re=n(2467);function De(e,t){for(const[n,r]of Object.entries(e)){const e=r,i=t[n];if("eq"in e&&i!==e.eq)return!1;if("neq"in e&&i===e.neq)return!1;if("gt"in e&&("number"!==typeof i||i<=e.gt))return!1}return!0}function Ne(e,t,n){const r=Object.fromEntries(Object.keys(n).map((e=>[e,new Set])));for(const[i,o]of Object.entries(n))if("eq"in o){const n=e.index(t,i).value.get(o.eq);if(n)for(const e of n)r[i].add(e)}else if("neq"in o){const n=e.index(t,i);for(const[e,t]of n.value)if(e!==o.neq)for(const n of t)r[i].add(n)}else if("gt"in o){const n=e.index(t,i);for(const[e,t]of n.value)if(e>o.gt)for(const n of t)r[i].add(n)}return function(e){if(0===e.length)return new Set;const t=e[0],n=e.slice(1),r=new Set;for(const i of t)n.every((e=>e.has(i)))&&r.add(i);return r}(Object.values(r))}class Fe{constructor(e,t){s(this,"indexCache",new Map),s(this,"historyCache",new Map),this.atoms=e,this.history=t}filterHistory(e){if(this.historyCache.has(e))return this.historyCache.get(e);const t=N("filterHistory:"+e,((t,n)=>{if(O(t))return this.history.value;const r=this.history.getDiffSince(n);if(r===x)return this.history.value;const i={added:{},removed:{},updated:{}};let o=0,s=0,a=0;for(const l of r){for(const t of ye(l.added))if(t.typeName===e)if(i.removed[t.id]){const e=i.removed[t.id];delete i.removed[t.id],s--,e!==t&&(i.updated[t.id]=[e,t],a++)}else i.added[t.id]=t,o++;for(const[t,n]of ye(l.updated))n.typeName===e&&(i.added[n.id]?i.added[n.id]=n:i.updated[n.id]?i.updated[n.id]=[i.updated[n.id][0],n]:(i.updated[n.id]=[t,n],a++));for(const t of ye(l.removed))t.typeName===e&&(i.added[t.id]?(delete i.added[t.id],o--):i.updated[t.id]?(i.removed[t.id]=i.updated[t.id][0],delete i.updated[t.id],a--,s++):(i.removed[t.id]=t,s++))}return o||s||a?z(this.history.value,i):t}),{historyLength:100});return this.historyCache.set(e,t),t}index(e,t){const n=e+":"+t;if(this.indexCache.has(n))return this.indexCache.get(n);const r=this.__uncached_createIndex(e,t);return this.indexCache.set(n,r),r}__uncached_createIndex(e,t){const n=this.filterHistory(e),r=()=>{n.value;const r=new Map;for(const n of ye(this.atoms.value)){const i=n.value;if(i.typeName===e){const e=i[t];r.has(e)||r.set(e,new Set),r.get(e).add(i.id)}}return r};return N("index:"+e+":"+t,((i,o)=>{if(O(i))return r();const s=n.getDiffSince(o);if(s===x)return r();const a=new Map,l=(e,t)=>{var n;let r=a.get(e);r||(r=new G(null!==(n=i.get(e))&&void 0!==n?n:new Set)),r.add(t),a.set(e,r)},c=(e,t)=>{var n;let r=a.get(e);r||(r=new G(null!==(n=i.get(e))&&void 0!==n?n:new Set)),r.remove(t),a.set(e,r)};for(const n of s){for(const r of ye(n.added))if(r.typeName===e){l(r[t],r.id)}for(const[r,i]of ye(n.updated))if(i.typeName===e){const e=r[t],n=i[t];e!==n&&(c(e,i.id),l(n,i.id))}for(const r of ye(n.removed))if(r.typeName===e){c(r[t],r.id)}}let u,d;for(const[e,t]of a){const n=t.get();n&&(u||(u=new Map(i)),d||(d=new Map),0===n.value.size?u.delete(e):u.set(e,n.value),d.set(e,n.diff))}return u&&d?z(u,d):i}),{historyLength:100})}record(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>({}),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"record:"+e+(t?":"+t.toString():"");const r=this.ids(e,t,n);return N(n,(()=>{for(const t of r.value){var e;return null===(e=this.atoms.value[t])||void 0===e?void 0:e.value}}))}records(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>({}),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"records:"+e+(t?":"+t.toString():"");const r=this.ids(e,t,"ids:"+n);return N(n,(()=>[...r.value].map((e=>{const t=this.atoms.value[e];if(!t)throw new Error("no atom found for record id: "+e);return t.value}))))}ids(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>({}),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ids:"+e+(t?":"+t.toString():"");const r=this.filterHistory(e),i=()=>{r.value;const n=t();return 0===Object.keys(n).length?new Set(ye(this.atoms.value).flatMap((t=>{const n=t.value;return n.typeName===e?n.id:[]}))):Ne(this,e,n)},o=e=>{const t=i(),n=function(e,t){const n={};for(const o of t){var r;e.has(o)||(null!==(r=n.added)&&void 0!==r||(n.added=new Set),n.added.add(o))}for(const o of e){var i;t.has(o)||(null!==(i=n.removed)&&void 0!==i||(n.removed=new Set),n.removed.add(o))}return n.added||n.removed?n:void 0}(e,t);return n?z(t,n):e},s=N("ids_query:"+n,t,{isEqual:Re});return N("query:"+n,((t,n)=>{const a=s.value;if(O(t))return i();if(n<s.lastChangedEpoch)return o(t);const l=r.getDiffSince(n);if(l===x)return o(t);const c=new G(t);for(const r of l){for(const t of ye(r.added))t.typeName===e&&De(a,t)&&c.add(t.id);for(const[t,n]of ye(r.updated))n.typeName===e&&(De(a,n)?c.add(n.id):c.remove(n.id));for(const t of ye(r.removed))t.typeName===e&&c.remove(t.id)}const u=c.get();return u?z(u.value,u.diff):t}),{historyLength:50})}exec(e,t){const n=Ne(this,e,t);if(0===n.size)return p;const r=this.atoms.value;return[...n].map((e=>r[e].value))}}class Be{constructor(e){var t=this;s(this,"id",je()),s(this,"atoms",A("store_atoms",{})),s(this,"history",A("history",0,{historyLength:1e3})),s(this,"query",new Fe(this.atoms,this.history)),s(this,"listeners",new Set),s(this,"historyAccumulator",new He),s(this,"historyReactor",void 0),s(this,"schema",void 0),s(this,"props",void 0),s(this,"scopedTypes",void 0),s(this,"onBeforeCreate",void 0),s(this,"onAfterCreate",void 0),s(this,"onBeforeChange",void 0),s(this,"onAfterChange",void 0),s(this,"onBeforeDelete",void 0),s(this,"onAfterDelete",void 0),s(this,"_runCallbacks",!0),s(this,"put",((e,t)=>{M((()=>{const n={},r={},i=this.atoms.__unsafe__getWithoutCapture();let o,s=null,a=!1;const l=this.onBeforeCreate&&this._runCallbacks?this.onBeforeCreate:null,c=this.onBeforeChange&&this._runCallbacks?this.onBeforeChange:null,u=this.isMergingRemoteChanges?"remote":"user";for(let h=0,p=e.length;h<p;h++){var d;o=e[h];const p=(null!==(d=s)&&void 0!==d?d:i)[o.id];if(p){c&&(o=c(p.value,o,u));const e=p.__unsafe__getWithoutCapture();o=this.schema.validateRecord(this,o,null!==t&&void 0!==t?t:"updateRecord",e),p.set(o);const r=p.__unsafe__getWithoutCapture();e!==r&&(a=!0,n[o.id]=[e,r])}else l&&(o=l(o,u)),a=!0,o=this.schema.validateRecord(this,o,null!==t&&void 0!==t?t:"createRecord",null),r[o.id]=o,s||(s={...i}),s[o.id]=A("atom:"+o.id,o)}if(s&&this.atoms.set(s),a&&(this.updateHistory({added:r,updated:n,removed:{}}),this._runCallbacks)){const{onAfterCreate:e,onAfterChange:t}=this;e&&Object.values(r).forEach((t=>{e(t,u)})),t&&Object.values(n).forEach((e=>{let[n,r]=e;t(n,r,u)}))}}))})),s(this,"remove",(e=>{M((()=>{const t=[],n=this.isMergingRemoteChanges?"remote":"user";if(this.onBeforeDelete&&this._runCallbacks)for(const i of e){const e=this.atoms.__unsafe__getWithoutCapture()[i];e&&(!1===this.onBeforeDelete(e.value,n)&&t.push(i))}let r;if(this.atoms.update((n=>{var i;let o;for(const s of e)t.includes(s)||s in n&&(o||(o={...n}),r||(r={}),delete o[s],r[s]=n[s].value);return null!==(i=o)&&void 0!==i?i:n})),r&&(this.updateHistory({added:{},updated:{},removed:r}),this.onAfterDelete&&this._runCallbacks)){let t;for(let i=0,o=e.length;i<o;i++)t=r[e[i]],t&&this.onAfterDelete(t,n)}}))})),s(this,"get",(e=>{var t;return null===(t=this.atoms.value[e])||void 0===t?void 0:t.value})),s(this,"unsafeGetWithoutCapture",(e=>{var t;return null===(t=this.atoms.value[e])||void 0===t?void 0:t.__unsafe__getWithoutCapture()})),s(this,"serialize",(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"document";const n={};for(const[r,i]of ve(t.atoms.value)){const o=i.value;("all"===e||t.scopedTypes[e].has(o.typeName))&&(n[r]=o)}return n})),s(this,"allRecords",(()=>ye(this.atoms.value).map((e=>e.value)))),s(this,"clear",(()=>{this.remove(me(this.atoms.value))})),s(this,"update",((e,t)=>{const n=this.atoms.value[e];n?this.put([t(n.__unsafe__getWithoutCapture())]):console.error("Record ".concat(e," not found. This is probably an error"))})),s(this,"has",(e=>!!this.atoms.value[e])),s(this,"listen",((e,t)=>{var n,r;this._flushHistory();const i={onHistory:e,filters:{source:null!==(n=null===t||void 0===t?void 0:t.source)&&void 0!==n?n:"all",scope:null!==(r=null===t||void 0===t?void 0:t.scope)&&void 0!==r?r:"all"}};return this.listeners.add(i),this.historyReactor.scheduler.isActivelyListening||this.historyReactor.start(),()=>{this.listeners.delete(i),0===this.listeners.size&&this.historyReactor.stop()}})),s(this,"isMergingRemoteChanges",!1),s(this,"mergeRemoteChanges",(e=>{if(this.isMergingRemoteChanges)return e();try{this.isMergingRemoteChanges=!0,M(e)}finally{this.isMergingRemoteChanges=!1}})),s(this,"createComputedCache",((e,t,n)=>{const r=new ze;return{get:i=>{const o=this.atoms.value[i];if(o)return r.get(o,(()=>{const r=n?N(o.name+":equals",(()=>o.value),{isEqual:n}):o;return N(e+":"+i,(()=>t(r.value)))})).value}}})),s(this,"createSelectedComputedCache",((e,t,n)=>{const r=new ze;return{get:i=>{const o=this.atoms.value[i];if(!o)return;const s=N(e+":"+i+":selector",(()=>t(o.value)));return r.get(o,(()=>N(e+":"+i,(()=>n(s.value))))).value}}})),s(this,"getRecordType",(e=>{const t=this.schema.types[e.typeName];if(!t)throw new Error("Record type ".concat(e.typeName," not found"));return t})),s(this,"_integrityChecker",void 0),s(this,"_isPossiblyCorrupted",!1);const{initialData:n,schema:r}=e;this.schema=r,this.props=e.props,n&&this.atoms.set(be(ve(n).map((e=>{let[t,n]=e;return[t,A("atom:"+t,this.schema.validateRecord(this,n,"initialize",null))]})))),this.historyReactor=function(e,t,n){const r=new F(e,t,n);return{scheduler:r,start:e=>{var t;const n=null!==(t=null===e||void 0===e?void 0:e.force)&&void 0!==t&&t;r.attach(),n?r.scheduleEffect():r.maybeScheduleEffect()},stop:()=>{r.detach()}}}("Store.historyReactor",(()=>{this.history.value,this._flushHistory()}),{scheduleEffect:e=>function(e){if(Se())return e();ke.includes(e)||(ke.push(e),Ce())}(e)}),this.scopedTypes={document:new Set(ye(this.schema.types).filter((e=>"document"===e.scope)).map((e=>e.typeName))),session:new Set(ye(this.schema.types).filter((e=>"session"===e.scope)).map((e=>e.typeName))),presence:new Set(ye(this.schema.types).filter((e=>"presence"===e.scope)).map((e=>e.typeName)))}}_flushHistory(){if(this.historyAccumulator.hasChanges()){const r=this.historyAccumulator.flush();for(const{changes:i,source:o}of r){let r=null,s=null,a=null;for(const{onHistory:l,filters:c}of this.listeners)if("all"===c.source||c.source===o)if("all"!==c.scope)if("document"===c.scope){var e;if(null!==(e=s)&&void 0!==e||(s=this.filterChangesByScope(i,"document")),!s)continue;l({changes:s,source:o})}else if("session"===c.scope){var t;if(null!==(t=r)&&void 0!==t||(r=this.filterChangesByScope(i,"session")),!r)continue;l({changes:r,source:o})}else{var n;if(null!==(n=a)&&void 0!==n||(a=this.filterChangesByScope(i,"presence")),!a)continue;l({changes:a,source:o})}else l({changes:i,source:o})}}}filterChangesByScope(e,t){const n={added:we(e.added,((e,n)=>this.scopedTypes[t].has(n.typeName))),updated:we(e.updated,((e,n)=>this.scopedTypes[t].has(n[1].typeName))),removed:we(e.removed,((e,n)=>this.scopedTypes[t].has(n.typeName)))};return 0===Object.keys(n.added).length&&0===Object.keys(n.updated).length&&0===Object.keys(n.removed).length?null:n}updateHistory(e){this.historyAccumulator.add({changes:e,source:this.isMergingRemoteChanges?"remote":"user"}),0===this.listeners.size&&this.historyAccumulator.clear(),this.history.set(this.history.value+1,e)}validate(e){this.allRecords().forEach((t=>this.schema.validateRecord(this,t,e,null)))}getSnapshot(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"document";return{store:this.serialize(e),schema:this.schema.serialize()}}migrateSnapshot(e){const t=this.schema.migrateStoreSnapshot(e);if("error"===t.type)throw new Error("Failed to migrate snapshot: ".concat(t.reason));return{store:t.value,schema:this.schema.serialize()}}loadSnapshot(e){const t=this.schema.migrateStoreSnapshot(e);if("error"===t.type)throw new Error("Failed to migrate snapshot: ".concat(t.reason));M((()=>{this.clear(),this.put(Object.values(t.value)),this.ensureStoreIsUsable()}))}extractingChanges(e){const t=[],n=this.historyAccumulator.intercepting((e=>t.push(e.changes)));try{return M(e),Ue(t)}finally{n()}}applyDiff(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=this._runCallbacks;try{this._runCallbacks=t,M((()=>{const t=ye(e.added).concat(ye(e.updated).map((e=>{let[t,n]=e;return n}))),n=me(e.removed);t.length&&this.put(t),n.length&&this.remove(n)}))}finally{this._runCallbacks=n}}ensureStoreIsUsable(){var e,t;null!==(e=this._integrityChecker)&&void 0!==e||(this._integrityChecker=this.schema.createIntegrityChecker(this)),null===(t=this._integrityChecker)||void 0===t||t.call(this)}markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}}function Ue(e){const t={added:{},removed:{},updated:{}};for(const n of e){for(const[e,r]of ve(n.added))if(t.removed[e]){const n=t.removed[e];delete t.removed[e],n!==r&&(t.updated[e]=[n,r])}else t.added[e]=r;for(const[e,[r,i]]of ve(n.updated))t.added[e]?(t.added[e]=i,delete t.updated[e],delete t.removed[e]):t.updated[e]?(t.updated[e][1]=i,delete t.removed[e]):(t.updated[e]=n.updated[e],delete t.removed[e]);for(const[e,r]of ve(n.removed))t.added[e]?delete t.added[e]:t.updated[e]?(t.removed[e]=t.updated[e][0],delete t.updated[e]):t.removed[e]=r}return t}class He{constructor(){s(this,"_history",[]),s(this,"_interceptors",new Set)}intercepting(e){return this._interceptors.add(e),()=>{this._interceptors.delete(e)}}add(e){this._history.push(e);for(const t of this._interceptors)t(e)}flush(){const e=function(e){const t=[];let n,r=e[0];for(let i=1,o=e.length;i<o;i++)n=e[i],r.source!==n.source?(t.push(r),r=n):r={source:r.source,changes:Ue([r.changes,n.changes])};return t.push(r),t}(this._history);return this._history=[],e}clear(){this._history=[]}hasChanges(){return this._history.length>0}}function Ve(e){const{currentVersion:t,firstVersion:n,migrators:r={},subTypeKey:i,subTypeMigrations:o}=e;if("number"===typeof t&&"number"===typeof n){if(t===n)throw Error("Current version is equal to initial version.");if(t<n)throw Error("Current version is lower than initial version.")}return{firstVersion:null!==n&&void 0!==n?n:0,currentVersion:null!==t&&void 0!==t?t:0,migrators:r,subTypeKey:i,subTypeMigrations:o}}var Ke=(e=>(e.IncompatibleSubtype="incompatible-subtype",e.UnknownType="unknown-type",e.TargetVersionTooNew="target-version-too-new",e.TargetVersionTooOld="target-version-too-old",e.MigrationError="migration-error",e.UnrecognizedSubtype="unrecognized-subtype",e))(Ke||{});function We(e){let{record:t,migrations:n,fromVersion:r,toVersion:i}=e,o=r;if(!function(e){return"object"===typeof e&&null!==e&&"id"in e&&"typeName"in e}(t))throw new Error("[migrateRecord] object is not a record");const{typeName:s,id:a,...l}=t;let c=l;for(;o<i;){const e=o+1,t=n.migrators[e];if(!t)return{type:"error",reason:"target-version-too-new"};c=t.up(c),o=e}for(;o>i;){const e=o-1,t=n.migrators[o];if(!t)return{type:"error",reason:"target-version-too-old"};c=t.down(c),o=e}return{type:"success",value:{...c,id:a,typeName:s}}}function $e(e){let{value:t,migrations:n,fromVersion:r,toVersion:i}=e,o=r;for(;o<i;){const e=o+1,r=n.migrators[e];if(!r)return{type:"error",reason:"target-version-too-new"};t=r.up(t),o=e}for(;o>i;){const e=o-1,r=n.migrators[o];if(!r)return{type:"error",reason:"target-version-too-old"};t=r.down(t),o=e}return{type:"success",value:t}}class Ye{constructor(e,t){this.types=e,this.options=t}static create(e,t){return new Ye(e,null!==t&&void 0!==t?t:{})}get currentStoreVersion(){var e,t;return null!==(e=null===(t=this.options.snapshotMigrations)||void 0===t?void 0:t.currentVersion)&&void 0!==e?e:0}validateRecord(e,t,n,r){try{const e=fe(this.types,t.typeName);if(!e)throw new Error("Missing definition for record type ".concat(t.typeName));return e.validate(t)}catch(i){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:e,record:t,phase:n,recordBefore:r,error:i});throw i}}migratePersistedRecord(e,t){var n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"up";const i=fe(this.types,e.typeName),o=t.recordVersions[e.typeName];if(!o||!i)return{type:"error",reason:Ke.UnknownType};const s=i.migrations.currentVersion,a=o.version;if(s!==a){const t=We("up"===r?{record:e,migrations:i.migrations,fromVersion:a,toVersion:s}:{record:e,migrations:i.migrations,fromVersion:s,toVersion:a});if("error"===t.type)return t;e=t.value}if(!i.migrations.subTypeKey)return{type:"success",value:e};const l=null===(n=i.migrations.subTypeMigrations)||void 0===n?void 0:n[e[i.migrations.subTypeKey]],c="subTypeVersions"in o?o.subTypeVersions[e[i.migrations.subTypeKey]]:void 0;if(void 0===l)return{type:"error",reason:Ke.UnrecognizedSubtype};if(void 0===c)return{type:"error",reason:Ke.IncompatibleSubtype};const u=We("up"===r?{record:e,migrations:l,fromVersion:c,toVersion:l.currentVersion}:{record:e,migrations:l,fromVersion:l.currentVersion,toVersion:c});return"error"===u.type?u:{type:"success",value:u.value}}migrateStoreSnapshot(e){var t;let{store:n}=e;const r=this.options.snapshotMigrations;if(!r)return{type:"success",value:n};const i=r.currentVersion,o=null!==(t=e.schema.storeVersion)&&void 0!==t?t:0;if(i<o)return{type:"error",reason:Ke.TargetVersionTooOld};if(i>o){const e=$e({value:n,migrations:r,fromVersion:o,toVersion:i});if("error"===e.type)return e;n=e.value}const s=[];for(const a of ye(n)){const t=this.migratePersistedRecord(a,e.schema);if("error"===t.type)return t;t.value&&t.value!==a&&s.push(t.value)}if(s.length){n={...n};for(const e of s)n[e.id]=e}return{type:"success",value:n}}createIntegrityChecker(e){var t,n,r;return null!==(t=null===(n=(r=this.options).createIntegrityChecker)||void 0===n?void 0:n.call(r,e))&&void 0!==t?t:void 0}serialize(){var e,t;return{schemaVersion:1,storeVersion:null!==(e=null===(t=this.options.snapshotMigrations)||void 0===t?void 0:t.currentVersion)&&void 0!==e?e:0,recordVersions:Object.fromEntries(ye(this.types).map((e=>[e.typeName,e.migrations.subTypeKey&&e.migrations.subTypeMigrations?{version:e.migrations.currentVersion,subTypeKey:e.migrations.subTypeKey,subTypeVersions:e.migrations.subTypeMigrations?Object.fromEntries(Object.entries(e.migrations.subTypeMigrations).map((e=>{let[t,n]=e;return[t,n.currentVersion]}))):void 0}:{version:e.migrations.currentVersion}])))}}serializeEarliestVersion(){var e,t;return{schemaVersion:1,storeVersion:null!==(e=null===(t=this.options.snapshotMigrations)||void 0===t?void 0:t.firstVersion)&&void 0!==e?e:0,recordVersions:Object.fromEntries(ye(this.types).map((e=>[e.typeName,e.migrations.subTypeKey&&e.migrations.subTypeMigrations?{version:e.migrations.firstVersion,subTypeKey:e.migrations.subTypeKey,subTypeVersions:e.migrations.subTypeMigrations?Object.fromEntries(Object.entries(e.migrations.subTypeMigrations).map((e=>{let[t,n]=e;return[t,n.firstVersion]}))):void 0}:{version:e.migrations.firstVersion}])))}}}class qe extends Error{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const n=function(e){if(!e.length)return null;let t="";for(const n of e)"number"===typeof n?t+=".".concat(n):n.startsWith("(")?t.endsWith(")")?t="".concat(t.slice(0,-1),", ").concat(n.slice(1)):t+=n:t+=".".concat(n);return t.startsWith(".")?t.slice(1):t}(t),r=e.split("\n").map(((e,t)=>0===t?e:"  ".concat(e))).join("\n");super(t?"At ".concat(n,": ").concat(r):r),s(this,"name","ValidationError"),this.rawMessage=e,this.path=t}}function Ge(e,t){try{return t()}catch(n){if(n instanceof qe)throw new qe(n.rawMessage,[e,...n.path]);throw new qe(n.toString(),[e])}}function Xe(e){if(null===e)return"null";if(Array.isArray(e))return"an array";const t=typeof e;switch(t){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return"a ".concat(t);case"object":return"an ".concat(t);case"undefined":return"undefined";default:ee(t)}}class Qe{constructor(e){this.validationFn=e}validate(e){return this.validationFn(e)}nullable(){return e=this,new Qe((t=>null===t?null:e.validate(t)));var e}optional(){return St(this)}refine(e){return new Qe((t=>e(this.validate(t))))}check(e,t){return"string"===typeof e?this.refine((n=>(Ge("(check ".concat(e,")"),(()=>t(n))),n))):this.refine((t=>(e(t),t)))}}class Ze extends Qe{constructor(e){super((t=>{const n=pt.validate(t);for(let r=0;r<n.length;r++)Ge(r,(()=>e.validate(n[r])));return n})),this.itemValidator=e}nonEmpty(){return this.check((e=>{if(0===e.length)throw new qe("Expected a non-empty array")}))}lengthGreaterThan1(){return this.check((e=>{if(e.length<=1)throw new qe("Expected an array with length greater than 1")}))}}class Je extends Qe{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super((n=>{if("object"!==typeof n||null===n)throw new qe("Expected object, got ".concat(Xe(n)));for(const[t,r]of Object.entries(e))Ge(t,(()=>{r.validate(fe(n,t))}));if(!t)for(const t of Object.keys(n))if(!pe(e,t))throw new qe("Unexpected property",[t]);return n})),this.config=e,this.shouldAllowUnknownProperties=t}allowUnknownProperties(){return new Je(this.config,!0)}extend(e){return new Je({...this.config,...e})}}class et extends Qe{constructor(e,t,n){super((n=>{if("object"!==typeof n||null===n)throw new qe("Expected an object, got ".concat(Xe(n)),[]);const r=fe(n,e);if("string"!==typeof r)throw new qe('Expected a string for key "'.concat(e,'", got ').concat(Xe(r)));const i=pe(t,r)?t[r]:void 0;return void 0===i?this.unknownValueValidation(n,r):Ge("(".concat(e," = ").concat(r,")"),(()=>i.validate(n)))})),this.key=e,this.config=t,this.unknownValueValidation=n}validateUnknownVariants(e){return new et(this.key,this.config,e)}}class tt extends Qe{constructor(e,t){super((n=>{if("object"!==typeof n||null===n)throw new qe("Expected object, got ".concat(Xe(n)));for(const[r,i]of Object.entries(n))Ge(r,(()=>{e.validate(r),t.validate(i)}));return n})),this.keyValidator=e,this.valueValidator=t}}function nt(e){return new Qe((t=>{if(typeof t!==e)throw new qe("Expected ".concat(e,", got ").concat(Xe(t)));return t}))}new Qe((e=>e));const rt=new Qe((e=>e)),it=nt("string"),ot=nt("number").check((e=>{if(Number.isNaN(e))throw new qe("Expected a number, got NaN");if(!Number.isFinite(e))throw new qe("Expected a finite number, got ".concat(e))})),st=ot.check((e=>{if(e<0)throw new qe("Expected a positive number, got ".concat(e))})),at=ot.check((e=>{if(e<=0)throw new qe("Expected a non-zero positive number, got ".concat(e))})),lt=ot.check((e=>{if(!Number.isInteger(e))throw new qe("Expected an integer, got ".concat(e))})),ct=lt.check((e=>{if(e<0)throw new qe("Expected a positive integer, got ".concat(e))})),ut=lt.check((e=>{if(e<=0)throw new qe("Expected a non-zero positive integer, got ".concat(e))})),dt=nt("boolean");nt("bigint");function ht(e){return new Qe((t=>{if(t!==e)throw new qe("Expected ".concat(e,", got ").concat(JSON.stringify(t)));return e}))}const pt=new Qe((e=>{if(!Array.isArray(e))throw new qe("Expected an array, got ".concat(Xe(e)));return e}));function ft(e){return new Ze(e)}new Qe((e=>{if("object"!==typeof e||null===e)throw new qe("Expected object, got ".concat(Xe(e)));return e}));function gt(e){return new Je(e)}function mt(e){return null===e||"number"===typeof e||"string"===typeof e||"boolean"===typeof e||(Array.isArray(e)?e.every(mt):"object"===typeof e&&Object.values(e).every(mt))}const yt=new Qe((e=>{if(mt(e))return e;throw new qe("Expected json serializable value, got ".concat(typeof e))}));function vt(e,t){return new tt(e,t)}function bt(e,t){return new et(e,t,((n,r)=>{throw new qe("Expected one of ".concat(Object.keys(t).map((e=>JSON.stringify(e))).join(" or "),", got ").concat(JSON.stringify(r)),[e])}))}function wt(e,t){return new Qe((n=>Ge(n&&"object"===typeof n&&"id"in n&&"string"===typeof n.id?"".concat(e,"(id = ").concat(n.id,")"):e,(()=>t.validate(n)))))}function xt(e){return new Qe((t=>{if(!e.has(t)){const n=Array.from(e,(e=>JSON.stringify(e))).join(" or ");throw new qe("Expected ".concat(n,", got ").concat(t))}return t}))}function St(e){return new Qe((t=>{if(void 0!==t)return e.validate(t)}))}function kt(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return xt(new Set(t))}function _t(e){return it.refine((t=>{if(!t.startsWith("".concat(e,":")))throw new Error("".concat(e,' ID must start with "').concat(e,':"'));return t}))}const Pt=_t("asset");function Ct(e,t){return gt({id:Pt,typeName:ht("asset"),type:ht(e),props:t,meta:yt})}const Et=wt("camera",gt({typeName:ht("camera"),id:_t("camera"),x:ot,y:ot,z:ot,meta:yt})),It=1,Mt=Ve({currentVersion:It,migrators:{[It]:{up:e=>({...e,meta:{}}),down:e=>{let{meta:t,...n}=e;return{...n}}}}}),Tt=Le("camera",{validator:Et,migrations:Mt,scope:"session"}).withDefaultProperties((()=>({x:0,y:0,z:1,meta:{}}))),At=gt({x:ot,y:ot,z:ot.optional()}),jt=gt({x:ot,y:ot,w:ot,h:ot}),Ot=xt(new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"])),Lt=gt({type:Ot,rotation:ot}),zt=ot.check((e=>{if(e<0||e>1)throw new qe("Opacity must be between 0 and 1")})),Rt=xt(new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"])),Dt=new Set(["starting","paused","active","stopping"]),Nt=gt({id:it,points:ft(At),size:st,color:Rt,opacity:ot,state:xt(Dt),delay:ot,shrink:ot,taper:dt}),Ft=_t("page"),Bt=wt("page",gt({typeName:ht("page"),id:Ft,name:it,index:it,meta:yt})),Ut=1,Ht=Ve({currentVersion:Ut,migrators:{[Ut]:{up:e=>({...e,meta:{}}),down:e=>{let{meta:t,...n}=e;return{...n}}}}}),Vt=Le("page",{validator:Bt,migrations:Ht,scope:"document"}).withDefaultProperties((()=>({meta:{}})));function Kt(e){return Vt.isId(e)}_t("instance");const Wt=22,$t=Ve({currentVersion:Wt,migrators:{[1]:{up:e=>({...e,exportBackground:!0}),down:e=>{let{exportBackground:t,...n}=e;return n}},[2]:{up:e=>{let{dialog:t,...n}=e;return n},down:e=>({...e,dialog:null})},[3]:{up:e=>({...e,isToolLocked:!1}),down:e=>{let{isToolLocked:t,...n}=e;return n}},[4]:{up:e=>{let{propsForNextShape:t,...n}=e;return{...n,propsForNextShape:Object.fromEntries(Object.entries(t).filter((e=>{let[t]=e;return["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(t)})))}},down:e=>e},[5]:{up:e=>{let{propsForNextShape:t,...n}=e;return{...n,propsForNextShape:{...t,labelColor:"black"}}},down:e=>{const{labelColor:t,...n}=e.propsForNextShape;return{...e,propsForNextShape:{...n}}}},[6]:{up:e=>({...e,followingUserId:null}),down:e=>{let{followingUserId:t,...n}=e;return n}},[7]:{up:e=>{let t=e.propsForNextShape.align;return"justify"===t&&(t="start"),{...e,propsForNextShape:{...e.propsForNextShape,align:t}}},down:e=>({...e})},[8]:{up:e=>({...e,zoomBrush:null}),down:e=>{let{zoomBrush:t,...n}=e;return n}},[9]:{up:e=>({...e,propsForNextShape:{...e.propsForNextShape,verticalAlign:"middle"}}),down:e=>{const{verticalAlign:t,...n}=e.propsForNextShape;return{...e,propsForNextShape:n}}},[10]:{up:e=>null!==e.scribble?{...e,scribble:{...e.scribble,delay:0}}:{...e},down:e=>{if(null!==e.scribble){const{delay:t,...n}=e.scribble;return{...e,scribble:n}}return{...e}}},[11]:{up:e=>{let{userId:t,...n}=e;return n},down:e=>({...e,userId:"user:none"})},[12]:{up:e=>({...e,isPenMode:!1,isGridMode:!1}),down:e=>{let{isPenMode:t,isGridMode:n,...r}=e;return r}},[13]:{up:e=>{let{propsForNextShape:{opacity:t,...n},...r}=e;return{...r,opacityForNextShape:Number(null!==t&&void 0!==t?t:"1"),propsForNextShape:n}},down:e=>{let{opacityForNextShape:t,...n}=e;return{...n,propsForNextShape:{...n.propsForNextShape,opacity:t<.175?"0.1":t<.375?"0.25":t<.625?"0.5":t<.875?"0.75":"1"}}}},[14]:{up:e=>({...e,chatMessage:"",isChatting:!1}),down:e=>{let{chatMessage:t,isChatting:n,...r}=e;return r}},[15]:{up:e=>({...e,highlightedUserIds:[]}),down:e=>{let{highlightedUserIds:t,...n}=e;return n}},[16]:{up:e=>{let{propsForNextShape:t,...n}=e;return{...n,stylesForNextShape:{}}},down:e=>{let{stylesForNextShape:t,...n}=e;return{...n,propsForNextShape:{color:"black",labelColor:"black",dash:"draw",fill:"none",size:"m",icon:"file",font:"draw",align:"middle",verticalAlign:"middle",geo:"rectangle",arrowheadStart:"none",arrowheadEnd:"arrow",spline:"line"}}}},[17]:{up:e=>({...e,meta:{}}),down:e=>{let{meta:t,...n}=e;return{...n}}},[18]:{up:e=>{const{color:t,...n}=e.cursor;return{...e,cursor:n}},down:e=>({...e,cursor:{...e.cursor,color:"black"}})},[19]:{up:e=>({...e,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1}),down:e=>{let{canMoveCamera:t,isFocused:n,devicePixelRatio:r,isCoarsePointer:i,openMenus:o,isChangingStyle:s,isReadOnly:a,...l}=e;return{...l}}},[20]:{up:e=>{let{isReadOnly:t,...n}=e;return{...n,isReadonly:t}},down:e=>{let{isReadonly:t,...n}=e;return{...n,isReadOnly:t}}},[21]:{up:e=>({...e,isHoveringCanvas:null}),down:e=>{let{isHoveringCanvas:t,...n}=e;return{...n}}},[Wt]:{up:e=>{let{scribble:t,...n}=e;return{...n,scribbles:[]}},down:e=>{let{scribbles:t,...n}=e;return{...n,scribble:null}}}}}),Yt="instance:instance",qt=it.refine((e=>{if(!e.startsWith("page:")&&!e.startsWith("shape:"))throw new Error('Parent ID must start with "page:" or "shape:"');return e})),Gt=_t("shape");const Xt=wt("instance_page_state",gt({typeName:ht("instance_page_state"),id:_t("instance_page_state"),pageId:Ft,selectedShapeIds:ft(Gt),hintingShapeIds:ft(Gt),erasingShapeIds:ft(Gt),hoveredShapeId:Gt.nullable(),editingShapeId:Gt.nullable(),croppingShapeId:Gt.nullable(),focusedGroupId:Gt.nullable(),meta:yt})),Qt=5,Zt=Ve({currentVersion:Qt,migrators:{[1]:{up:e=>({...e,croppingShapeId:null}),down(e){let{croppingShapeId:t,...n}=e;return n}},[2]:{up(e){let{instanceId:t,cameraId:n,...r}=e;return r},down:e=>({...e,instanceId:Yt,cameraId:Tt.createId("void")})},[3]:{up:e=>({...e,meta:{}}),down:e=>{let{meta:t,...n}=e;return{...n}}},[4]:{up:e=>{const{selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}=e;return{selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}},down:e=>{const{selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}=e;return{selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}}},[Qt]:{up:e=>{const{selectedIds:t,hintingIds:n,erasingIds:r,hoveredId:i,editingId:o,croppingId:s,focusLayerId:a,...l}=e;return{...l,selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a}},down:e=>{const{selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}=e;return{...l,selectedIds:t,hintingIds:n,erasingIds:r,hoveredId:i,editingId:o,croppingId:s,focusLayerId:a}}}}}),Jt=Le("instance_page_state",{migrations:Zt,validator:Xt,scope:"session"}).withDefaultProperties((()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}}))),en=wt("pointer",gt({typeName:ht("pointer"),id:_t("pointer"),x:ot,y:ot,lastActivityTimestamp:ot,meta:yt})),tn=1,nn=Ve({currentVersion:tn,migrators:{[tn]:{up:e=>({...e,meta:{}}),down:e=>{let{meta:t,...n}=e;return{...n}}}}}),rn=Le("pointer",{validator:en,migrations:nn,scope:"session"}).withDefaultProperties((()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}}))),on=rn.createId("pointer"),sn=wt("instance_presence",gt({typeName:ht("instance_presence"),id:_t("instance_presence"),userId:it,userName:it,lastActivityTimestamp:ot,followingUserId:it.nullable(),cursor:gt({x:ot,y:ot,type:Ot,rotation:ot}),color:it,camera:gt({x:ot,y:ot,z:ot}),screenBounds:jt,selectedShapeIds:ft(_t("shape")),currentPageId:_t("page"),brush:jt.nullable(),scribbles:ft(Nt),chatMessage:it,meta:yt})),an=5,ln=Ve({currentVersion:an,migrators:{[1]:{up:e=>null!==e.scribble?{...e,scribble:{...e.scribble,delay:0}}:{...e},down:e=>{if(null!==e.scribble){const{delay:t,...n}=e.scribble;return{...e,scribble:n}}return{...e}}},[2]:{up:e=>{let{instanceId:t,...n}=e;return n},down:e=>({...e,instanceId:Yt})},[3]:{up:e=>({...e,chatMessage:""}),down:e=>{let{chatMessage:t,...n}=e;return n}},[4]:{up:e=>({...e,meta:{}}),down:e=>{let{meta:t,...n}=e;return{...n}}},[an]:{up:e=>{const{selectedShapeIds:t,...n}=e;return{selectedShapeIds:t,...n}},down:e=>{const{selectedShapeIds:t,...n}=e;return{selectedShapeIds:t,...n}}}}}),cn=Le("instance_presence",{migrations:ln,validator:sn,scope:"presence"}).withDefaultProperties((()=>({lastActivityTimestamp:0,followingUserId:null,color:"#FF0000",camera:{x:0,y:0,z:1},cursor:{x:0,y:0,type:"default",rotation:0},screenBounds:{x:0,y:0,w:1,h:1},selectedShapeIds:[],brush:null,scribbles:[],chatMessage:"",meta:{}}))),un=wt("document",gt({typeName:ht("document"),id:ht("document:document"),gridSize:ot,name:it,meta:yt})),dn=2,hn=Ve({currentVersion:dn,migrators:{[1]:{up:e=>({...e,name:""}),down:e=>{let{name:t,...n}=e;return n}},[dn]:{up:e=>({...e,meta:{}}),down:e=>{let{meta:t,...n}=e;return{...n}}}}}),pn=Le("document",{migrations:hn,validator:un,scope:"document"}).withDefaultProperties((()=>({gridSize:10,name:"",meta:{}}))),fn=pn.createId("document");function gn(e,t){return e.index<t.index?-1:e.index>t.index?1:0}function mn(e){"asset"===e.typeName&&("src"in e&&(e.src="<redacted>"),"src"in e.props&&(e.props.src="<redacted>"))}const yn=e=>{let{error:t,phase:n,record:r,recordBefore:i}=e;throw oe(t,{tags:{origin:"store.validateRecord",storePhase:n,isExistingValidationIssue:"initialize"===n},extras:{recordBefore:i?mn(Ae(i)):void 0,recordAfter:mn(Ae(r))}}),t};function vn(e){const t=e.query.ids("page"),n=()=>{if(!e.has(fn))return e.put([pn.create({id:fn,name:e.props.defaultName})]),n();if(!e.has(on))return e.put([rn.create({id:on})]),n();const r=t.value;if(0===r.size)return e.put([Vt.create({id:"page:page",name:"Page 1",index:"a1",meta:{}})]),n();const i=()=>[...r].map((t=>e.get(t))).sort(gn)[0].id,o=e.get(Yt);if(!o)return e.put([e.schema.types.instance.create({id:Yt,currentPageId:i(),exportBackground:!0})]),n();if(!r.has(o.currentPageId))return e.put([{...o,currentPageId:i()}]),n();const s=new Set,a=new Set;for(const t of r){const n=Jt.createId(t);e.has(n)||s.add(n);const r=Tt.createId(t);e.has(r)||a.add(r)}s.size>0&&e.put([...s].map((e=>Jt.create({id:e,pageId:Jt.parseId(e)})))),a.size>0&&e.put([...a].map((e=>Tt.create({id:e}))))};return n}const bn=Ct("bookmark",gt({title:it,description:it,image:it,src:it.nullable()})),wn=Ve({}),xn=Ct("image",gt({w:ot,h:ot,name:it,isAnimated:dt,mimeType:it.nullable(),src:it.nullable()})),Sn=2,kn=Ve({currentVersion:Sn,migrators:{[1]:{up:e=>({...e,props:{...e.props,isAnimated:!1}}),down:e=>{const{isAnimated:t,...n}=e.props;return{...e,props:n}}},[Sn]:{up:e=>{const{width:t,height:n,...r}=e.props;return{...e,props:{w:t,h:n,...r}}},down:e=>{const{w:t,h:n,...r}=e.props;return{...e,props:{width:t,height:n,...r}}}}}}),_n=Ct("video",gt({w:ot,h:ot,name:it,isAnimated:dt,mimeType:it.nullable(),src:it.nullable()})),Pn=2,Cn=Ve({currentVersion:Pn,migrators:{[1]:{up:e=>({...e,props:{...e.props,isAnimated:!1}}),down:e=>{const{isAnimated:t,...n}=e.props;return{...e,props:n}}},[Pn]:{up:e=>{const{width:t,height:n,...r}=e.props;return{...e,props:{w:t,h:n,...r}}},down:e=>{const{w:t,h:n,...r}=e.props;return{...e,props:{width:t,height:n,...r}}}}}}),En=wt("asset",bt("type",{image:xn,video:_n,bookmark:bn})),In=1,Mn=Ve({subTypeKey:"type",subTypeMigrations:{image:kn,video:Cn,bookmark:wn},currentVersion:In,migrators:{[In]:{up:e=>({...e,meta:{}}),down:e=>{let{meta:t,...n}=e;return{...n}}}}}),Tn=Le("asset",{migrations:Mn,validator:En,scope:"document"}).withDefaultProperties((()=>({meta:{}})));class An{constructor(e,t,n){this.id=e,this.defaultValue=t,this.type=n}static define(e,t){const{defaultValue:n,type:r=rt}=t;return new An(e,n,r)}static defineEnum(e,t){const{defaultValue:n,values:r}=t;return new jn(e,n,r)}validate(e){return this.type.validate(e)}}class jn extends An{constructor(e,t,n){super(e,t,kt(...n)),this.values=n}}const On=3,Ln=Ve({currentVersion:On,migrators:{[1]:{up:e=>({...e,isLocked:!1}),down:e=>{const{isLocked:t,...n}=e;return{...n}}},[2]:{up:e=>{let{props:{opacity:t,...n},...r}=e;return{...r,opacity:Number(null!==t&&void 0!==t?t:"1"),props:n}},down:e=>{let{opacity:t,...n}=e;return{...n,props:{...n.props,opacity:t<.175?"0.1":t<.375?"0.25":t<.625?"0.5":t<.875?"0.75":"1"}}}},[On]:{up:e=>({...e,meta:{}}),down:e=>{let{meta:t,...n}=e;return{...n}}}}});function zn(e){return!!e&&"shape"===e.typeName}function Rn(e){return!!e&&e.startsWith("shape:")}function Dn(e){return"shape:".concat(null!==e&&void 0!==e?e:je())}function Nn(e){const t=new Map;for(const[n,r]of Object.entries(e))if(r instanceof An){if(t.has(r))throw new Error("Duplicate style prop ".concat(r.id,". Each style prop can only be used once within a shape."));t.set(r,n)}return t}function Fn(e){return Le("shape",{migrations:Ve({currentVersion:Ln.currentVersion,firstVersion:Ln.firstVersion,migrators:Ln.migrators,subTypeKey:"type",subTypeMigrations:xe(e,((e,t)=>{var n;return null!==(n=t.migrations)&&void 0!==n?n:Ve({})}))}),scope:"document",validator:wt("shape",bt("type",xe(e,((e,t)=>{let{props:n,meta:r}=t;return function(e,t,n){return gt({id:Gt,typeName:ht("shape"),x:ot,y:ot,rotation:ot,index:it,parentId:qt,type:ht(e),isLocked:dt,opacity:zt,props:t?gt(t):yt,meta:n?gt(n):yt})}(e,n,r)}))))}).withDefaultProperties((()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}})))}const Bn=4,Un=Ve({currentVersion:Bn,migrators:{[1]:{up:e=>Object.fromEntries(Object.entries(e).filter((e=>{let[t,n]=e;return"shape"!==n.typeName||"icon"!==n.type&&"code"!==n.type}))),down:e=>e},[2]:{up:e=>e,down:e=>Object.fromEntries(Object.entries(e).filter((e=>{let[t,n]=e;return"instance_presence"!==n.typeName})))},[3]:{up:e=>Object.fromEntries(Object.entries(e).filter((e=>{let[t,n]=e;return!n.typeName.match(/^(user|user_presence)$/)}))),down:e=>Object.fromEntries(Object.entries(e).filter((e=>{let[t,n]=e;return"pointer"!==n.typeName})))},[Bn]:{up:e=>Object.fromEntries(Object.entries(e).filter((e=>{let[t,n]=e;return!n.typeName.match("user_document")}))),down:e=>e}}});function Hn(e){let{shapes:t}=e;const n=new Map;for(const s of ye(t))for(const e of Nn(null!==(r=s.props)&&void 0!==r?r:{}).keys()){var r;if(n.has(e.id)&&n.get(e.id)!==e)throw new Error("Multiple StyleProp instances with the same id: ".concat(e.id));n.set(e.id,e)}const i=Fn(t),o=function(e){const t={};for(const[r,i]of e)t[r]=St(i);const n=wt("instance",gt({typeName:ht("instance"),id:_t("instance"),currentPageId:Ft,followingUserId:it.nullable(),brush:jt.nullable(),opacityForNextShape:zt,stylesForNextShape:gt(t),cursor:Lt,scribbles:ft(Nt),isFocusMode:dt,isDebugMode:dt,isToolLocked:dt,exportBackground:dt,screenBounds:jt,zoomBrush:jt.nullable(),isPenMode:dt,isGridMode:dt,chatMessage:it,isChatting:dt,highlightedUserIds:ft(it),canMoveCamera:dt,isFocused:dt,devicePixelRatio:ot,isCoarsePointer:dt,isHoveringCanvas:dt.nullable(),openMenus:ft(it),isChangingStyle:dt,isReadonly:dt,meta:yt}));return Le("instance",{migrations:$t,validator:n,scope:"session"}).withDefaultProperties((()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribbles:[],cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],canMoveCamera:!0,isFocused:!1,devicePixelRatio:"undefined"===typeof window?1:window.devicePixelRatio,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{}})))}(n);return Ye.create({asset:Tn,camera:Tt,document:pn,instance:o,instance_page_state:Jt,page:Vt,shape:i,instance_presence:cn,pointer:rn},{snapshotMigrations:Un,onValidationFailure:yn,createIntegrityChecker:vn})}const Vn=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red"],Kn={lightMode:{id:"light",text:"#000000",background:"rgb(249, 250, 251)",solid:"#fcfffe",black:{solid:"#1d1d1d",semi:"#e8e8e8",pattern:"#494949",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},blue:{solid:"#4263eb",semi:"#dce1f8",pattern:"#6681ee",highlight:{srgb:"#10acff",p3:"color(display-p3 0.308 0.6632 0.9996)"}},green:{solid:"#099268",semi:"#d3e9e3",pattern:"#39a785",highlight:{srgb:"#00ffc8",p3:"color(display-p3 0.2536 0.984 0.7981)"}},grey:{solid:"#adb5bd",semi:"#eceef0",pattern:"#bcc3c9",highlight:{srgb:"#cbe7f1",p3:"color(display-p3 0.8163 0.9023 0.9416)"}},"light-blue":{solid:"#4dabf7",semi:"#ddedfa",pattern:"#6fbbf8",highlight:{srgb:"#00f4ff",p3:"color(display-p3 0.1512 0.9414 0.9996)"}},"light-green":{solid:"#40c057",semi:"#dbf0e0",pattern:"#65cb78",highlight:{srgb:"#65f641",p3:"color(display-p3 0.563 0.9495 0.3857)"}},"light-red":{solid:"#ff8787",semi:"#f4dadb",pattern:"#fe9e9e",highlight:{srgb:"#ff7fa3",p3:"color(display-p3 0.9988 0.5301 0.6397)"}},"light-violet":{solid:"#e599f7",semi:"#f5eafa",pattern:"#e9acf8",highlight:{srgb:"#ff88ff",p3:"color(display-p3 0.9676 0.5652 0.9999)"}},orange:{solid:"#f76707",semi:"#f8e2d4",pattern:"#f78438",highlight:{srgb:"#ffa500",p3:"color(display-p3 0.9988 0.6905 0.266)"}},red:{solid:"#e03131",semi:"#f4dadb",pattern:"#e55959",highlight:{srgb:"#ff636e",p3:"color(display-p3 0.9992 0.4376 0.45)"}},violet:{solid:"#ae3ec9",semi:"#ecdcf2",pattern:"#bd63d3",highlight:{srgb:"#c77cff",p3:"color(display-p3 0.7469 0.5089 0.9995)"}},yellow:{solid:"#ffc078",semi:"#f9f0e6",pattern:"#fecb92",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}}},darkMode:{id:"dark",text:"#f8f9fa",background:"#212529",solid:"#28292e",black:{solid:"#e1e1e1",semi:"#2c3036",pattern:"#989898",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},blue:{solid:"#4156be",semi:"#262d40",pattern:"#3a4b9e",highlight:{srgb:"#0079d2",p3:"color(display-p3 0.0032 0.4655 0.7991)"}},green:{solid:"#3b7b5e",semi:"#253231",pattern:"#366a53",highlight:{srgb:"#009774",p3:"color(display-p3 0.0085 0.582 0.4604)"}},grey:{solid:"#93989f",semi:"#33373c",pattern:"#7c8187",highlight:{srgb:"#9cb4cb",p3:"color(display-p3 0.6299 0.7012 0.7856)"}},"light-blue":{solid:"#588fc9",semi:"#2a3642",pattern:"#4d7aa9",highlight:{srgb:"#00bdc8",p3:"color(display-p3 0.0023 0.7259 0.7735)"}},"light-green":{solid:"#599f57",semi:"#2a3830",pattern:"#4e874e",highlight:{srgb:"#00a000",p3:"color(display-p3 0.2711 0.6172 0.0195)"}},"light-red":{solid:"#c67877",semi:"#3b3235",pattern:"#a56767",highlight:{srgb:"#db005b",p3:"color(display-p3 0.7849 0.0585 0.3589)"}},"light-violet":{solid:"#b583c9",semi:"#383442",pattern:"#9770a9",highlight:{srgb:"#c400c7",p3:"color(display-p3 0.7024 0.0403 0.753)"}},orange:{solid:"#bf612e",semi:"#3a2e2a",pattern:"#9f552d",highlight:{srgb:"#d07a00",p3:"color(display-p3 0.7699 0.4937 0.0085)"}},red:{solid:"#aa3c37",semi:"#36292b",pattern:"#8f3734",highlight:{srgb:"#de002c",p3:"color(display-p3 0.7978 0.0509 0.2035)"}},violet:{solid:"#873fa3",semi:"#31293c",pattern:"#763a8b",highlight:{srgb:"#9e00ee",p3:"color(display-p3 0.5651 0.0079 0.8986)"}},yellow:{solid:"#cba371",semi:"#3c3934",pattern:"#fecb92",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}}}};function Wn(e){return e.isDarkMode?Kn.darkMode:Kn.lightMode}const $n=An.defineEnum("tldraw:color",{defaultValue:"black",values:Vn}),Yn=An.defineEnum("tldraw:labelColor",{defaultValue:"black",values:Vn}),qn=An.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),Gn=An.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern"]}),Xn=An.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),Qn={draw:"'tldraw_draw', sans-serif",sans:"'tldraw_sans', sans-serif",serif:"'tldraw_serif', serif",mono:"'tldraw_mono', monospace"},Zn=An.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),Jn=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],er=An.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:Jn}),tr=An.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:Jn}),nr=bt("type",{binding:gt({type:ht("binding"),boundShapeId:Gt,normalizedAnchor:At,isExact:dt}),point:gt({type:ht("point"),x:ot,y:ot})}),rr={labelColor:Yn,color:$n,fill:Gn,dash:qn,size:Zn,arrowheadStart:er,arrowheadEnd:tr,font:Xn,start:nr,end:nr,bend:ot,text:it},ir=1,or=Ve({currentVersion:ir,migrators:{[ir]:{up:e=>({...e,props:{...e.props,labelColor:"black"}}),down:e=>{const{labelColor:t,...n}=e.props;return{...e,props:n}}}}}),sr={w:at,h:at,assetId:Pt.nullable(),url:it},ar=1,lr=Ve({currentVersion:ar,migrators:{[ar]:{up:e=>void 0===e.props.assetId?{...e,props:{...e.props,assetId:null}}:e,down:e=>{if(null===e.props.assetId){const{assetId:t,...n}=e.props;return{...e,props:n}}return e}}}}),cr=gt({type:kt("free","straight"),points:ft(At)}),ur={color:$n,fill:Gn,dash:qn,size:Zn,segments:ft(cr),isComplete:dt,isClosed:dt,isPen:dt},dr=1,hr=Ve({currentVersion:dr,migrators:{[dr]:{up:e=>{const{points:t}=e.props.segments[0];if(0===t.length)return{...e,props:{...e.props,isPen:!1}};let n=!(0===t[0].z||.5===t[0].z);return t[1]&&(n=n&&!(0===t[1].z||.5===t[1].z)),{...e,props:{...e.props,isPen:n}}},down:e=>{const{isPen:t,...n}=e.props;return{...e,props:{...n}}}}}}),pr=/(^\/r\/[^/]+\/?$)/,fr=e=>{try{return new URL(e)}catch(t){return}},gr=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,canUnmount:!0,toEmbedUrl:e=>{const t=fr(e);if(t&&t.pathname.match(pr))return e},fromEmbedUrl:e=>{const t=fr(e);if(t&&t.pathname.match(pr))return e}},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,canUnmount:!0,toEmbedUrl:e=>{if(e.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!e.includes("figma.com/embed"))return"https://www.figma.com/embed?embed_host=share&url=".concat(e)},fromEmbedUrl:e=>{const t=fr(e);if(t&&t.pathname.match(/^\/embed\/?$/)){const e=t.searchParams.get("url");if(e)return e}}},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{if(e.includes("/maps/")){const t=e.match(/@(.*),(.*),(.*)z/);let n;if(t){const[,r,i,o]=t,s=new URL(e).host.replace("www.","");n="https://".concat(s,"/maps/embed/v1/view?key=").concat({NODE_ENV:"production",PUBLIC_URL:"/extensions/omni-extension-tldraw",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.NEXT_PUBLIC_GC_API_KEY,"&center=").concat(r,",").concat(i,"&zoom=").concat(o)}else n="";return n}},fromEmbedUrl:e=>{const t=fr(e);if(!t)return;if(t.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&t.searchParams.has("center")&&t.searchParams.get("zoom")){const e=t.searchParams.get("zoom"),[n,r]=t.searchParams.get("center").split(",");return"https://www.google.com/maps/@".concat(n,",").concat(r,",").concat(e,"z")}}},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{const t=fr(e),n=t&&t.pathname.match(/\/v\/([^/]+)\/?/);if(n)return"https://www.val.town/embed/".concat(n[1])},fromEmbedUrl:e=>{const t=fr(e),n=t&&t.pathname.match(/\/embed\/([^/]+)\/?/);if(n)return"https://www.val.town/v/".concat(n[1])}},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{const t=fr(e),n=t&&t.pathname.match(/\/s\/([^/]+)\/?/);if(n)return"https://codesandbox.io/embed/".concat(n[1])},fromEmbedUrl:e=>{const t=fr(e),n=t&&t.pathname.match(/\/embed\/([^/]+)\/?/);if(n)return"https://codesandbox.io/s/".concat(n[1])}},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{const t=e.match(/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/);if(t){const[e,n,r]=t;return"https://codepen.io/".concat(n,"/embed/").concat(r)}},fromEmbedUrl:e=>{const t=e.match(/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/);if(t){const[e,n,r]=t;return"https://codepen.io/".concat(n,"/pen/").concat(r)}}},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,canUnmount:!1,toEmbedUrl:e=>{const t=e.match(/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/);if(t){const[e,n]=t;return"https://scratch.mit.edu/projects/embed/".concat(n)}},fromEmbedUrl:e=>{const t=e.match(/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/);if(t){const[e,n]=t;return"https://scratch.mit.edu/projects/".concat(n)}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,canUnmount:!1,overridePermissions:{"allow-presentation":!0},isAspectRatioLocked:!0,toEmbedUrl:e=>{const t=fr(e);if(!t)return;const n=t.hostname.replace(/^www./,"");if("youtu.be"===n){const e=t.pathname.split("/").filter(Boolean)[0];return"https://www.youtube.com/embed/".concat(e)}if(("youtube.com"===n||"m.youtube.com"===n)&&t.pathname.match(/^\/watch/)){const e=t.searchParams.get("v");return"https://www.youtube.com/embed/".concat(e)}},fromEmbedUrl:e=>{const t=fr(e);if(!t)return;if("youtube.com"===t.hostname.replace(/^www./,"")){const e=t.pathname.match(/^\/embed\/([^/]+)\/?/);if(e)return"https://www.youtube.com/watch?v=".concat(e[1])}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,canUnmount:!1,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",toEmbedUrl:e=>{const t=fr(e),n=null===t||void 0===t?void 0:t.searchParams.get("cid");if(null!==t&&void 0!==t&&t.pathname.match(/\/calendar\/u\/0/)&&n){t.pathname="/calendar/embed";const e=Array.from(t.searchParams.keys());for(const n of e)t.searchParams.delete(n);return t.searchParams.set("src",n),t.href}},fromEmbedUrl:e=>{const t=fr(e),n=null===t||void 0===t?void 0:t.searchParams.get("src");if(null!==t&&void 0!==t&&t.pathname.match(/\/calendar\/embed/)&&n){t.pathname="/calendar/u/0";const e=Array.from(t.searchParams.keys());for(const n of e)t.searchParams.delete(n);return t.searchParams.set("cid",n),t.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{const t=fr(e);if(null!==t&&void 0!==t&&t.pathname.match(/^\/presentation/)&&null!==t&&void 0!==t&&t.pathname.match(/\/pub\/?$/)){t.pathname=t.pathname.replace(/\/pub$/,"/embed");const e=Array.from(t.searchParams.keys());for(const n of e)t.searchParams.delete(n);return t.href}},fromEmbedUrl:e=>{const t=fr(e);if(null!==t&&void 0!==t&&t.pathname.match(/^\/presentation/)&&null!==t&&void 0!==t&&t.pathname.match(/\/embed\/?$/)){t.pathname=t.pathname.replace(/\/embed$/,"/pub");const e=Array.from(t.searchParams.keys());for(const n of e)t.searchParams.delete(n);return t.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,canUnmount:!0,toEmbedUrl:e=>{const t=fr(e);if(t&&t.pathname.match(/\/([^/]+)\/([^/]+)/)){if(!e.split("/").pop())return;return e}},fromEmbedUrl:e=>{const t=fr(e);if(t&&t.pathname.match(/\/([^/]+)\/([^/]+)/)){if(!e.split("/").pop())return;return e}}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{const t=fr(e);if(t&&t.pathname.match(/\/@([^/]+)\/([^/]+)/))return"".concat(e,"?embed=true")},fromEmbedUrl:e=>{const t=fr(e);if(t&&t.pathname.match(/\/@([^/]+)\/([^/]+)/)&&t.searchParams.has("embed"))return t.searchParams.delete("embed"),t.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{const t=fr(e);if(t&&t.pathname.match(/^\/map\//))return t.origin+"/embed"+t.pathname},fromEmbedUrl:e=>{const t=fr(e);if(t&&t.pathname.match(/^\/embed\/map\//))return t.pathname=t.pathname.replace(/^\/embed/,""),t.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{const t=fr(e);if(t&&t.pathname.match(/^\/(artist|album)\//))return t.origin+"/embed"+t.pathname},fromEmbedUrl:e=>{const t=fr(e);if(t&&t.pathname.match(/^\/embed\/(artist|album)\//))return t.origin+t.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!0,toEmbedUrl:e=>{const t=fr(e);if(t&&"vimeo.com"===t.hostname&&t.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+t.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:e=>{const t=fr(e);if(t&&"player.vimeo.com"===t.hostname){const e=t.pathname.match(/^\/video\/([^/]+)\/?$/);if(e)return"https://vimeo.com/"+e[1]}}},{type:"excalidraw",title:"Excalidraw",hostnames:["excalidraw.com"],width:720,height:500,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!0,toEmbedUrl:e=>{const t=fr(e);if(t&&t.hash.match(/#room=/))return e},fromEmbedUrl:e=>{const t=fr(e);if(t&&t.hash.match(/#room=/))return e}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!1,backgroundColor:"#fff",toEmbedUrl:e=>{const t=fr(e);if(t&&t.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return"".concat(t.origin,"/embed").concat(t.pathname,"?cell=*");if(t&&t.pathname.match(/^\/d\/([^/]+)\/?$/)){const e=t.pathname.replace(/^\/d/,"");return"".concat(t.origin,"/embed").concat(e,"?cell=*")}},fromEmbedUrl:e=>{const t=fr(e);return t&&t.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/)?"".concat(t.origin).concat(t.pathname.replace("/embed",""),"#cell-*"):t&&t.pathname.match(/^\/embed\/([^/]+)\/?$/)?"".concat(t.origin).concat(t.pathname.replace("/embed","/d"),"#cell-*"):void 0}}],mr={"allow-downloads-without-user-activation":!1,"allow-downloads":!1,"allow-modals":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-popups":!0,"allow-popups-to-escape-sandbox":!1,"allow-presentation":!1,"allow-storage-access-by-user-activation":!1,"allow-top-navigation":!1,"allow-top-navigation-by-user-activation":!1,"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0},yr={w:at,h:at,url:it},vr=4,br=Ve({currentVersion:vr,migrators:{[1]:{up:e=>{var t;const n=e.props.url,r=new URL(n).host.replace("www.","");let i;for(const s of gr)if(s.hostnames.includes(r))try{i=s.fromEmbedUrl(n)}catch(o){console.warn(o)}return{...e,props:{...e.props,tmpOldUrl:e.props.url,url:null!==(t=i)&&void 0!==t?t:""}}},down:e=>{var t;let n=e.props.tmpOldUrl;if(!n||""===n){const t=e.props.url,r=new URL(t).host.replace("www.","");for(const e of gr)if(e.hostnames.includes(r))try{n=e.toEmbedUrl(t)}catch(o){console.warn(o)}}const{tmpOldUrl:r,...i}=e.props;return{...e,props:{...i,url:null!==(t=n)&&void 0!==t?t:""}}}},[2]:{up:e=>{const{doesResize:t,...n}=e.props;return{...e,props:{...n}}},down:e=>({...e,props:{...e.props,doesResize:!0}})},[3]:{up:e=>{const{tmpOldUrl:t,...n}=e.props;return{...e,props:{...n}}},down:e=>({...e,props:{...e.props}})},[vr]:{up:e=>{const{overridePermissions:t,...n}=e.props;return{...e,props:{...n}}},down:e=>({...e,props:{...e.props}})}}}),wr={w:at,h:at,name:it},xr=Ve({}),Sr=An.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),kr=An.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),_r=An.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box"]}),Pr={geo:_r,labelColor:Yn,color:$n,fill:Gn,dash:qn,size:Zn,font:Xn,align:Sr,verticalAlign:kr,url:it,w:at,h:at,growY:st,text:it},Cr=7,Er=Ve({currentVersion:Cr,migrators:{[1]:{up:e=>({...e,props:{...e.props,url:""}}),down:e=>{const{url:t,...n}=e.props;return{...e,props:n}}},[2]:{up:e=>({...e,props:{...e.props,labelColor:"black"}}),down:e=>{const{labelColor:t,...n}=e.props;return{...e,props:n}}},[3]:{up:e=>{let t=e.props.align;return"justify"===t&&(t="start"),{...e,props:{...e.props,align:t}}},down:e=>({...e})},[4]:{up:e=>({...e}),down:e=>({...e,props:{...e.props,geo:"check-box"===e.props.geo?"rectangle":e.props.geo}})},[5]:{up:e=>({...e,props:{...e.props,verticalAlign:"middle"}}),down:e=>{const{verticalAlign:t,...n}=e.props;return{...e,props:n}}},[6]:{up:e=>{let t;switch(e.props.align){case"start":t="start-legacy";break;case"end":t="end-legacy";break;default:t="middle-legacy"}return{...e,props:{...e.props,align:t}}},down:e=>{let t;switch(e.props.align){case"start-legacy":t="start";break;case"end-legacy":t="end";break;case"middle-legacy":t="middle";break;default:t=e.props.align}return{...e,props:{...e.props,align:t}}}},[Cr]:{up:e=>e,down:e=>{if("cloud"===e.props.geo)return{...e,props:{...e.props,geo:"rectangle"}}}}}}),Ir=Ve({}),Mr={color:$n,size:Zn,segments:ft(cr),isComplete:dt,isPen:dt},Tr=Ve({}),Ar=gt({topLeft:At,bottomRight:At}),jr={w:at,h:at,playing:dt,url:it,assetId:Pt.nullable(),crop:Ar.nullable()},Or=2,Lr=Ve({currentVersion:Or,migrators:{[1]:{up:e=>({...e,props:{...e.props,url:""}}),down:e=>{const{url:t,...n}=e.props;return{...e,props:n}}},[Or]:{up:e=>({...e,props:{...e.props,crop:null}}),down:e=>{const{crop:t,...n}=e.props;return{...e,props:n}}}}}),zr=gt({id:it,type:xt(new Set(["vertex","virtual","create"])),canBind:dt.optional(),canSnap:dt.optional(),index:it,x:ot,y:ot}),Rr=An.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),Dr={color:$n,dash:qn,size:Zn,spline:Rr,handles:vt(it,zr)},Nr=1,Fr=Ve({currentVersion:Nr,migrators:{[Nr]:{up:e=>{const t=ge(e.props.handles);for(const n in t)t[n].canSnap=!0;return{...e,props:{...e.props,handles:t}}},down:e=>{const t=ge(e.props.handles);for(const n in t)delete t[n].canSnap;return{...e,props:{...e.props,handles:t}}}}}}),Br={color:$n,size:Zn,font:Xn,align:Sr,verticalAlign:kr,growY:st,url:it,text:it},Ur=4,Hr=Ve({currentVersion:Ur,migrators:{[1]:{up:e=>({...e,props:{...e.props,url:""}}),down:e=>{const{url:t,...n}=e.props;return{...e,props:n}}},[2]:{up:e=>{let t=e.props.align;return"justify"===t&&(t="start"),{...e,props:{...e.props,align:t}}},down:e=>({...e})},[3]:{up:e=>{let t;switch(e.props.align){case"start":t="start-legacy";break;case"end":t="end-legacy";break;default:t="middle-legacy"}return{...e,props:{...e.props,align:t}}},down:e=>{let t;switch(e.props.align){case"start-legacy":t="start";break;case"end-legacy":t="end";break;case"middle-legacy":t="middle";break;default:t=e.props.align}return{...e,props:{...e.props,align:t}}}},[Ur]:{up:e=>({...e,props:{...e.props,verticalAlign:"middle"}}),down:e=>{const{verticalAlign:t,...n}=e.props;return{...e,props:n}}}}}),Vr={color:$n,size:Zn,font:Xn,align:Sr,w:at,text:it,scale:at,autoSize:dt},Kr=1,Wr=Ve({currentVersion:Kr,migrators:{[Kr]:{up:e=>{let t=e.props.align;return"justify"===t&&(t="start"),{...e,props:{...e.props,align:t}}},down:e=>({...e})}}}),$r={w:at,h:at,time:ot,playing:dt,url:it,assetId:Pt.nullable()},Yr=1,qr=Ve({currentVersion:Yr,migrators:{[Yr]:{up:e=>({...e,props:{...e.props,url:""}}),down:e=>{const{url:t,...n}=e.props;return{...e,props:n}}}}}),Gr=[{locale:"ar",label:"\u0639\u0631\u0628\u064a"},{locale:"ca",label:"Catal\xe0"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"Espa\xf1ol"},{locale:"fa",label:"\u0641\u0627\u0631\u0633\u06cc"},{locale:"fi",label:"Suomi"},{locale:"fr",label:"Fran\xe7ais"},{locale:"gl",label:"Galego"},{locale:"he",label:"\u05e2\u05d1\u05e8\u05d9\u05ea"},{locale:"it",label:"Italiano"},{locale:"ja",label:"\u65e5\u672c\u8a9e"},{locale:"ko-kr",label:"\ud55c\uad6d\uc5b4"},{locale:"ku",label:"\u06a9\u0648\u0631\u062f\u06cc"},{locale:"hi-in",label:"\u0939\u093f\u0928\u094d\u0926\u0940"},{locale:"hu",label:"Magyar"},{locale:"my",label:"\u1019\u103c\u1014\u103a\u1019\u102c\u1005\u102c"},{locale:"ne",label:"\u0928\u0947\u092a\u093e\u0932\u0940"},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"Portugu\xeas - Brasil"},{locale:"pt-pt",label:"Portugu\xeas - Europeu"},{locale:"ro",label:"Rom\xe2n\u0103"},{locale:"ru",label:"Russian"},{locale:"sv",label:"Svenska"},{locale:"te",label:"\u0c24\u0c46\u0c32\u0c41\u0c17\u0c41"},{locale:"th",label:"\u0e20\u0e32\u0e29\u0e32\u0e44\u0e17\u0e22"},{locale:"tr",label:"T\xfcrk\xe7e"},{locale:"uk",label:"Ukrainian"},{locale:"vi",label:"Ti\u1ebfng Vi\u1ec7t"},{locale:"zh-cn",label:"Chinese - Simplified"},{locale:"zh-tw",label:"\u7e41\u9ad4\u4e2d\u6587 (\u53f0\u7063)"}];const Xr={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"};function Qr(e){const t=Gr.find((t=>t.locale===e.toLowerCase()));if(t)return t.locale;const[n,r]=e.split(/[-_]/).map((e=>e.toLowerCase()));if(r){const e=Gr.find((e=>e.locale===n));if(e)return e.locale}return n in Xr?Xr[n]:null}var Zr=n(184),Jr=n(1694);const ei={},ti={preventDefaultLogging:ni("preventDefaultLogging",{defaults:{all:!1}}),pointerCaptureLogging:ni("pointerCaptureLogging",{defaults:{all:!1}}),pointerCaptureTracking:ni("pointerCaptureTracking",{defaults:{all:!1}}),pointerCaptureTrackingObject:ni("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),elementRemovalLogging:ni("elementRemovalLogging",{defaults:{all:!1}}),debugSvg:ni("debugSvg",{defaults:{all:!1}}),throwToBlob:ni("throwToBlob",{defaults:{all:!1}}),logMessages:ni("uiLog",{defaults:{all:[]}}),resetConnectionEveryPing:ni("resetConnectionEveryPing",{defaults:{all:!1}}),debugCursors:ni("debugCursors",{defaults:{all:!1}}),forceSrgb:ni("forceSrgbColors",{defaults:{all:!1}}),debugGeometry:ni("debugGeometry",{defaults:{all:!1}}),hideShapes:ni("hideShapes",{defaults:{all:!1}})};if("undefined"!==typeof window&&(window.tldrawLog=e=>{ti.logMessages.set(ti.logMessages.value.concat(e))}),"undefined"!==typeof Element){const e=Element.prototype.removeChild;B("element removal logging",(()=>{ti.elementRemovalLogging.value?Element.prototype.removeChild=function(t){return console.warn("[tldraw] removing child:",t),e.call(this,t)}:Element.prototype.removeChild=e}))}function ni(e,t){let{defaults:n,shouldStoreForSession:r=!0}=t;return function(e){const t=function(e){var t,n,r,i,o,s;switch(null!==(t=null!==(n=null!==(r=ri((()=>({NODE_ENV:"production",PUBLIC_URL:"/extensions/omni-extension-tldraw",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.TLDRAW_ENV))))&&void 0!==r?r:ri((()=>({NODE_ENV:"production",PUBLIC_URL:"/extensions/omni-extension-tldraw",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.VERCEL_PUBLIC_TLDRAW_ENV))))&&void 0!==n?n:ri((()=>({NODE_ENV:"production",PUBLIC_URL:"/extensions/omni-extension-tldraw",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.NEXT_PUBLIC_TLDRAW_ENV))))&&void 0!==t?t:"production"){case"production":return null!==(i=e.defaults.production)&&void 0!==i?i:e.defaults.all;case"preview":case"staging":return null!==(o=e.defaults.staging)&&void 0!==o?o:e.defaults.all;default:return null!==(s=e.defaults.development)&&void 0!==s?s:e.defaults.all}}(e),n=e.shouldStoreForSession?function(e){try{var t,n;return JSON.parse(null!==(t=null===(n=window)||void 0===n?void 0:n.sessionStorage.getItem("tldraw_debug:".concat(e)))&&void 0!==t?t:"null")}catch(r){return null}}(e.name):null,r=A("debug:".concat(e.name),null!==n&&void 0!==n?n:t);"undefined"!==typeof window&&(e.shouldStoreForSession&&B("debug:".concat(e.name),(()=>{const n=r.value;try{n===t?window.sessionStorage.removeItem("tldraw_debug:".concat(e.name)):window.sessionStorage.setItem("tldraw_debug:".concat(e.name),JSON.stringify(n))}catch{}})),Object.defineProperty(window,"tldraw".concat(e.name.replace(/^[a-z]/,(e=>e.toUpperCase()))),{get:()=>r.value,set(e){r.set(e)},configurable:!0}));return Object.assign(r,e)}({name:e,defaults:n,shouldStoreForSession:r})}function ri(e){try{return e()}catch{return null}}function ii(e){if(e instanceof HTMLElement)return e;if(e.parentElement)return ii(e.parentElement);throw Error("Could not find a parent element of an HTML type!")}function oi(e){e.preventDefault(),ti.preventDefaultLogging.value&&console.warn("preventDefault called on event:",e)}function si(e,t){if(e.setPointerCapture(t.pointerId),ti.pointerCaptureTracking.value){var n;const t=ti.pointerCaptureTrackingObject.value;t.set(e,(null!==(n=t.get(e))&&void 0!==n?n:0)+1)}ti.pointerCaptureLogging.value&&console.warn("setPointerCapture called on element:",e,t)}function ai(e,t){if(e.hasPointerCapture(t.pointerId)){if(e.releasePointerCapture(t.pointerId),ti.pointerCaptureTracking.value){const t=ti.pointerCaptureTrackingObject.value;1===t.get(e)?t.delete(e):t.has(e)?t.set(e,t.get(e)-1):console.warn("Release without capture")}ti.pointerCaptureLogging.value&&console.warn("releasePointerCapture called on element:",e,t)}}const li=e=>e.stopPropagation();function ci(e){return e.isKilled=!0,{point:{x:e.clientX,y:e.clientY,z:e.pressure},shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey,pointerId:e.pointerId,button:e.button,isPen:"pen"===e.pointerType}}const ui=t.createContext({}),di=()=>t.useContext(ui);const hi=(0,t.createContext)(null);function pi(e){let{container:t,children:n}=e;return(0,Zr.jsx)(hi.Provider,{value:t,children:n})}function fi(){return ne((0,t.useContext)(hi),"useContainer used outside of <Tldraw />")}const gi=["input","select","button","textarea"];function mi(){const{activeElement:e}=document;return!(!e||!(e.getAttribute("contenteditable")||gi.indexOf(e.tagName.toLowerCase())>-1))}const yi={error:null};class vi extends t.Component{constructor(){super(...arguments),s(this,"state",yi)}static getDerivedStateFromError(e){return{error:e}}componentDidCatch(e){var t,n;null===(t=(n=this.props).onError)||void 0===t||t.call(n,e)}render(){const{error:e}=this.state;if(null!==e){const{fallback:t}=this.props;return(0,Zr.jsx)(t,{error:e})}return this.props.children}}function bi(e){let{children:t,fallback:n,...r}=e;return null===n?(0,Zr.jsx)(Zr.Fragment,{children:t}):(0,Zr.jsx)(vi,{fallback:n,...r,children:t})}class wi{constructor(e){this.shape=e}equals(e){var t,n,r,i,o,s;return(null===(t=this.shape)||void 0===t?void 0:t.isLocked)===(null===e||void 0===e||null===(n=e.shape)||void 0===n?void 0:n.isLocked)&&(null===(r=this.shape)||void 0===r?void 0:r.props)===(null===e||void 0===e||null===(i=e.shape)||void 0===i?void 0:i.props)&&(null===(o=this.shape)||void 0===o?void 0:o.meta)===(null===e||void 0===e||null===(s=e.shape)||void 0===s?void 0:s.meta)}}const xi=e=>{let{shape:t,util:n}=e;return U("Indicator:"+t.type,(()=>n.indicator(t)))},Si=e=>{let{editor:t,id:n}=e;const r=q("shape",(()=>new wi(t.store.get(n))),[t,n]),{ShapeIndicatorErrorFallback:i}=Vo();return!r.shape||r.shape.isLocked?null:(0,Zr.jsx)(bi,{fallback:i,onError:e=>t.annotateError(e,{origin:"react.shapeIndicator",willCrashApp:!1}),children:(0,Zr.jsx)(xi,{shape:r.shape,util:t.getShapeUtil(r.shape)},r.shape.id)})},ki=t.memo((e=>{let{id:t,className:n,color:r,opacity:i}=e;const o=di(),s=q("transform",(()=>{const e=o.getShapePageTransform(t);return e?e.toCssString():""}),[o,t]);return(0,Zr.jsx)("svg",{className:Jr("tl-overlays__item",n),children:(0,Zr.jsx)("g",{className:"tl-shape-indicator",transform:s,stroke:null!==r&&void 0!==r?r:"var(--color-selected)",opacity:i,children:(0,Zr.jsx)(Si,{editor:o,id:t})})})}));function _i(){return(0,Zr.jsx)("div",{className:"tl-background"})}function Pi(e,n,r,i,o,s){(0,t.useLayoutEffect)((()=>{const t=e.current;if(!t)return;if(void 0===n)return;let a="translate(".concat(n,"px, ").concat(r,"px)");void 0!==i&&(a+=" scale(".concat(i,")")),void 0!==o&&(a+=" rotate(".concat(o,"rad)")),s&&(a+=" translate(".concat(s.x,"px, ").concat(s.y,"px)")),t.style.transform=a}))}const Ci={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>e*(2-e),easeInOutQuad:e=>e<.5?2*e*e:(4-2*e)*e-1,easeInCubic:e=>e*e*e,easeOutCubic:e=>--e*e*e+1,easeInOutCubic:e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1- --e*e*e*e,easeInOutQuart:e=>e<.5?8*e*e*e*e:1-8*--e*e*e*e,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1+--e*e*e*e*e,easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInExpo:e=>e<=0?0:Math.pow(2,10*e-10),easeOutExpo:e=>e>=1?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>e<=0?0:e>=1?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2};class Ei{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.x=e,this.y=t,this.z=n}get pressure(){return this.z}set(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.x,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.y,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.z;return this.x=e,this.y=t,this.z=n,this}setTo(e){let{x:t=0,y:n=0,z:r=1}=e;return this.x=t,this.y=n,this.z=r,this}rot(e){if(0===e)return this;const{x:t,y:n}=this,r=Math.sin(e),i=Math.cos(e);return this.x=t*i-n*r,this.y=t*r+n*i,this}rotWith(e,t){if(0===t)return this;const n=this.x-e.x,r=this.y-e.y,i=Math.sin(t),o=Math.cos(t);return this.x=e.x+(n*o-r*i),this.y=e.y+(n*i+r*o),this}clone(){const{x:e,y:t,z:n}=this;return new Ei(e,t,n)}sub(e){return this.x-=e.x,this.y-=e.y,this}subXY(e,t){return this.x-=e,this.y-=t,this}subScalar(e){return this.x-=e,this.y-=e,this}add(e){return this.x+=e.x,this.y+=e.y,this}addXY(e,t){return this.x+=e,this.y+=t,this}addScalar(e){return this.x+=e,this.y+=e,this}clamp(e,t){return this.x=Math.max(this.x,e),this.y=Math.max(this.y,e),void 0!==t&&(this.x=Math.min(this.x,t),this.y=Math.min(this.y,t)),this}div(e){return this.x/=e,this.y/=e,this}divV(e){return this.x/=e.x,this.y/=e.y,this}mul(e){return this.x*=e,this.y*=e,this}mulV(e){return this.x*=e.x,this.y*=e.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(e,t){const n=Ei.Tan(e,this);return this.add(n.mul(t))}neg(){return this.x*=-1,this.y*=-1,this}cross(e){return this.x=this.y*e.z-this.z*e.y,this.y=this.z*e.x-this.x*e.z,this}dpr(e){return Ei.Dpr(this,e)}cpr(e){return Ei.Cpr(this,e)}len2(){return Ei.Len2(this)}len(){return Ei.Len(this)}pry(e){return Ei.Pry(this,e)}per(){const{x:e,y:t}=this;return this.x=t,this.y=-e,this}uni(){return Ei.Uni(this)}tan(e){return Ei.Tan(this,e)}dist(e){return Ei.Dist(this,e)}distanceToLineSegment(e,t){return Ei.DistanceToLineSegment(e,t,this)}slope(e){return Ei.Slope(this,e)}snapToGrid(e){return this.x=Math.round(this.x/e)*e,this.y=Math.round(this.y/e)*e,this}angle(e){return Ei.Angle(this,e)}toAngle(){return Ei.ToAngle(this)}lrp(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this}equals(e){return Ei.Equals(this,e)}equalsXY(e,t){return Ei.EqualsXY(this,e,t)}norm(){const e=this.len();return this.x=0===e?0:this.x/e,this.y=0===e?0:this.y/e,this}toFixed(){return Ei.ToFixed(this)}toString(){return Ei.ToString(Ei.ToFixed(this))}toJson(){return Ei.ToJson(this)}toArray(){return Ei.ToArray(this)}static Add(e,t){return new Ei(e.x+t.x,e.y+t.y)}static AddXY(e,t,n){return new Ei(e.x+t,e.y+n)}static Sub(e,t){return new Ei(e.x-t.x,e.y-t.y)}static SubXY(e,t,n){return new Ei(e.x-t,e.y-n)}static AddScalar(e,t){return new Ei(e.x+t,e.y+t)}static SubScalar(e,t){return new Ei(e.x-t,e.y-t)}static Div(e,t){return new Ei(e.x/t,e.y/t)}static Mul(e,t){return new Ei(e.x*t,e.y*t)}static DivV(e,t){return new Ei(e.x/t.x,e.y/t.y)}static MulV(e,t){return new Ei(e.x*t.x,e.y*t.y)}static Neg(e){return new Ei(-e.x,-e.y)}static Per(e){return new Ei(e.y,-e.x)}static Dist2(e,t){return Ei.Sub(e,t).len2()}static Abs(e){return new Ei(Math.abs(e.x),Math.abs(e.y))}static Dist(e,t){return Math.hypot(e.y-t.y,e.x-t.x)}static Dpr(e,t){return e.x*t.x+e.y*t.y}static Cross(e,t){return new Ei(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z)}static Cpr(e,t){return e.x*t.y-t.x*e.y}static Len2(e){return e.x*e.x+e.y*e.y}static Len(e){return Math.hypot(e.x,e.y)}static Pry(e,t){return Ei.Dpr(e,t)/Ei.Len(t)}static Uni(e){return Ei.Div(e,Ei.Len(e))}static Tan(e,t){return Ei.Uni(Ei.Sub(e,t))}static Min(e,t){return new Ei(Math.min(e.x,t.x),Math.min(e.y,t.y))}static Max(e,t){return new Ei(Math.max(e.x,t.x),Math.max(e.y,t.y))}static From(e){let{x:t,y:n,z:r=1}=e;return new Ei(t,n,r)}static FromArray(e){return new Ei(e[0],e[1])}static Rot(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=Math.sin(t),r=Math.cos(t);return new Ei(e.x*r-e.y*n,e.x*n+e.y*r)}static RotWith(e,t,n){const r=e.x-t.x,i=e.y-t.y,o=Math.sin(n),s=Math.cos(n);return new Ei(t.x+(r*s-i*o),t.y+(r*o+i*s))}static NearestPointOnLineThroughPoint(e,t,n){return Ei.Mul(t,Ei.Sub(n,e).pry(t)).add(e)}static NearestPointOnLineSegment(e,t,n){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const i=Ei.Tan(t,e),o=Ei.Add(e,Ei.Mul(i,Ei.Sub(n,e).pry(i)));if(r){if(o.x<Math.min(e.x,t.x))return Ei.Cast(e.x<t.x?e:t);if(o.x>Math.max(e.x,t.x))return Ei.Cast(e.x>t.x?e:t);if(o.y<Math.min(e.y,t.y))return Ei.Cast(e.y<t.y?e:t);if(o.y>Math.max(e.y,t.y))return Ei.Cast(e.y>t.y?e:t)}return o}static DistanceToLineThroughPoint(e,t,n){return Ei.Dist(n,Ei.NearestPointOnLineThroughPoint(e,t,n))}static DistanceToLineSegment(e,t,n){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return Ei.Dist(n,Ei.NearestPointOnLineSegment(e,t,n,r))}static Snap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new Ei(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}static Cast(e){return e instanceof Ei?e:Ei.From(e)}static Slope(e,t){return e.x===t.y?NaN:(e.y-t.y)/(e.x-t.x)}static Angle(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}static Lrp(e,t,n){return Ei.Sub(t,e).mul(n).add(e)}static Med(e,t){return new Ei((e.x+t.x)/2,(e.y+t.y)/2)}static Equals(e,t){return Math.abs(e.x-t.x)<1e-4&&Math.abs(e.y-t.y)<1e-4}static EqualsXY(e,t,n){return e.x===t&&e.y===n}static Clockwise(e,t,n){return(n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y)<0}static Rescale(e,t){const n=Ei.Len(e);return new Ei(t*e.x/n,t*e.y/n)}static ScaleWithOrigin(e,t,n){return Ei.Sub(e,n).mul(t).add(n)}static ToFixed(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return new Ei(+e.x.toFixed(t),+e.y.toFixed(t),+e.z.toFixed(t))}static Nudge(e,t,n){return Ei.Add(e,Ei.Tan(t,e).mul(n))}static ToString(e){return"".concat(e.x,", ").concat(e.y)}static ToAngle(e){let t=Math.atan2(e.y,e.x);return t<0&&(t+=2*Math.PI),t}static FromAngle(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new Ei(Math.cos(e)*t,Math.sin(e)*t)}static ToArray(e){return[e.x,e.y,e.z]}static ToJson(e){const{x:t,y:n,z:r}=e;return{x:t,y:n,z:r}}static Average(e){const t=e.length,n=new Ei(0,0);for(let r=0;r<t;r++)n.add(e[r]);return n.div(t)}static Clamp(e,t,n){return void 0===n?new Ei(Math.min(Math.max(e.x,t)),Math.min(Math.max(e.y,t))):new Ei(Math.min(Math.max(e.x,t),n),Math.min(Math.max(e.y,t),n))}static PointsBetween(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6;const r=[];for(let i=0;i<n;i++){const o=Ci.easeInQuad(i/(n-1)),s=Ei.Lrp(e,t,o);s.z=Math.min(1,.5+.65*Math.abs(.5-Ii(o))),r.push(s)}return r}static SnapToGrid(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;return new Ei(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}}const Ii=e=>e<.5?2*e*e:(4-2*e)*e-1;var Mi;class Ti{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;s(this,"x",0),s(this,"y",0),s(this,"w",0),s(this,"h",0),this.x=e,this.y=t,this.w=n,this.h=r}get point(){return new Ei(this.x,this.y)}set point(e){this.x=e.x,this.y=e.y}get minX(){return this.x}set minX(e){this.x=e}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get minY(){return this.y}set minY(e){this.y=e}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get width(){return this.w}set width(e){this.w=e}get height(){return this.h}set height(e){this.h=e}get aspectRatio(){return this.width/this.height}get center(){return new Ei(this.midX,this.midY)}set center(e){this.minX=e.x-this.width/2,this.minY=e.y-this.height/2}get corners(){return[new Ei(this.minX,this.minY),new Ei(this.maxX,this.minY),new Ei(this.maxX,this.maxY),new Ei(this.minX,this.maxY)]}get snapPoints(){return[new Ei(this.minX,this.minY),new Ei(this.maxX,this.minY),new Ei(this.maxX,this.maxY),new Ei(this.minX,this.maxY),this.center]}get sides(){const{corners:e}=this;return[[e[0],e[1]],[e[1],e[2]],[e[2],e[3]],[e[3],e[0]]]}get size(){return new Ei(this.w,this.h)}toFixed(){return this.x=Fi(this.x),this.y=Fi(this.y),this.w=Fi(this.w),this.h=Fi(this.h),this}setTo(e){return this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this}set(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.x=e,this.y=t,this.w=n,this.h=r,this}expand(e){const t=Math.min(this.minX,e.minX),n=Math.min(this.minY,e.minY),r=Math.max(this.maxX,e.maxX),i=Math.max(this.maxY,e.maxY);return this.x=t,this.y=n,this.w=r-t,this.h=i-n,this}expandBy(e){return this.x-=e,this.y-=e,this.w+=2*e,this.h+=2*e,this}scale(e){return this.x/=e,this.y/=e,this.w/=e,this.h/=e,this}clone(){const{x:e,y:t,w:n,h:r}=this;return new Ti(e,t,n,r)}translate(e){return this.x+=e.x,this.y+=e.y,this}snapToGrid(e){const t=Math.round(this.minX/e)*e,n=Math.round(this.minY/e)*e,r=Math.round(this.maxX/e)*e,i=Math.round(this.maxY/e)*e;this.minX=t,this.minY=n,this.width=Math.max(1,r-t),this.height=Math.max(1,i-n)}collides(e){return Ti.Collides(this,e)}contains(e){return Ti.Contains(this,e)}includes(e){return Ti.Includes(this,e)}containsPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Ti.ContainsPoint(this,e,t)}getHandlePoint(e){switch(e){case"top_left":return new Ei(this.minX,this.minY);case"top_right":return new Ei(this.maxX,this.minY);case"bottom_left":return new Ei(this.minX,this.maxY);case"bottom_right":return new Ei(this.maxX,this.maxY);case"top":return new Ei(this.midX,this.minY);case"right":return new Ei(this.maxX,this.midY);case"bottom":return new Ei(this.midX,this.maxY);case"left":return new Ei(this.minX,this.midY)}}toJson(){return{x:this.minX,y:this.minY,w:this.w,h:this.h}}resize(e,t,n){const{minX:r,minY:i,maxX:o,maxY:s}=this;let{minX:a,minY:l,maxX:c,maxY:u}=this;switch(e){case"left":case"top_left":case"bottom_left":a+=t;break;case"right":case"top_right":case"bottom_right":c+=t}switch(e){case"top":case"top_left":case"top_right":l+=n;break;case"bottom":case"bottom_left":case"bottom_right":u+=n}if((c-a)/(o-r)<0){const e=c;c=a,a=e}if((u-l)/(s-i)<0){const e=u;u=l,l=e}this.minX=a,this.minY=l,this.width=Math.abs(c-a),this.height=Math.abs(u-l)}union(e){const t=Math.min(this.minX,e.x),n=Math.min(this.minY,e.y),r=Math.max(this.maxX,e.w+e.x),i=Math.max(this.maxY,e.h+e.y);return this.x=t,this.y=n,this.width=r-t,this.height=i-n,this}static From(e){return new Ti(e.x,e.y,e.w,e.h)}static FromPoints(e){if(0===e.length)return new Ti;let t,n=1/0,r=1/0,i=-1/0,o=-1/0;for(let s=0,a=e.length;s<a;s++)t=e[s],n=Math.min(t.x,n),r=Math.min(t.y,r),i=Math.max(t.x,i),o=Math.max(t.y,o);return new Ti(n,r,i-n,o-r)}static Expand(e,t){const n=Math.min(t.minX,e.minX),r=Math.min(t.minY,e.minY),i=Math.max(t.maxX,e.maxX),o=Math.max(t.maxY,e.maxY);return new Ti(n,r,i-n,o-r)}static ExpandBy(e,t){return new Ti(e.minX-t,e.minY-t,e.width+2*t,e.height+2*t)}static Resize(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const{minX:o,minY:s,maxX:a,maxY:l}=e;let{minX:c,minY:u,maxX:d,maxY:h}=e;switch(t){case"left":case"top_left":case"bottom_left":c+=n;break;case"right":case"top_right":case"bottom_right":d+=n}switch(t){case"top":case"top_left":case"top_right":u+=r;break;case"bottom":case"bottom_left":case"bottom_right":h+=r}const p=(d-c)/(a-o),f=(h-u)/(l-s),g=p<0,m=f<0;if(i){const e=(a-o)/(l-s),n=Math.abs(d-c),r=Math.abs(h-u),i=n*(f<0?1:-1)*(1/e),g=r*(p<0?1:-1)*e,m=e<n/r;switch(t){case"top_left":m?u=h+i:c=d+g;break;case"top_right":m?u=h+i:d=c-g;break;case"bottom_right":m?h=u-i:d=c-g;break;case"bottom_left":m?h=u-i:c=d+g;break;case"bottom":case"top":{const t=(c+d)/2,n=r*e;c=t-n/2,d=t+n/2;break}case"left":case"right":{const t=(u+h)/2,r=n/e;u=t-r/2,h=t+r/2;break}}}if(g){const e=d;d=c,c=e}if(m){const e=h;h=u,u=e}const y=new Ti(c,u,Math.abs(d-c),Math.abs(h-u));return{box:y,scaleX:+(y.width/e.width*(p>0?1:-1)).toFixed(5),scaleY:+(y.height/e.height*(f>0?1:-1)).toFixed(5)}}equals(e){return Ti.Equals(this,e)}static Equals(e,t){return t.x===e.x&&t.y===e.y&&t.w===e.w&&t.h===e.h}zeroFix(){return this.w=Math.max(1,this.w),this.h=Math.max(1,this.h),this}static ZeroFix(e){return new Ti(e.x,e.y,Math.max(1,e.w),Math.max(1,e.h))}}Mi=Ti,s(Ti,"Collides",((e,t)=>!(e.maxX<t.minX||e.minX>t.maxX||e.maxY<t.minY||e.minY>t.maxY))),s(Ti,"Contains",((e,t)=>e.minX<t.minX&&e.minY<t.minY&&e.maxY>t.maxY&&e.maxX>t.maxX)),s(Ti,"Includes",((e,t)=>Mi.Collides(e,t)||Mi.Contains(e,t))),s(Ti,"ContainsPoint",(function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return!(t.x<e.minX-n||t.y<e.minY-n||t.x>e.maxX+n||t.y>e.maxY+n)})),s(Ti,"Common",(e=>{let t=1/0,n=1/0,r=-1/0,i=-1/0;for(let o=0;o<e.length;o++){const s=e[o];t=Math.min(t,s.minX),n=Math.min(n,s.minY),r=Math.max(r,s.maxX),i=Math.max(i,s.maxY)}return new Mi(t,n,r-t,i-n)})),s(Ti,"Sides",(function(e){const{corners:t}=e;return[[t[0],t[1]],[t[1],t[2]],[t[2],t[3]],[t[3],t[0]]]}));function Ai(e){return"".concat(no(e.x),",").concat(no(e.y)," ")}function ji(e,t){return"".concat(no((e.x+t.x)/2),",").concat(no((e.y+t.y)/2)," ")}const Oi=Math.PI,Li=Oi/2,zi=2*Oi,Ri=Math.PI/180,Di=Math.sin;function Ni(e,t,n){return Math.max(t,"undefined"!==typeof n?Math.min(e,n):e)}function Fi(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e10;return e?Math.round(e*t)/t:0}function Bi(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-6;return Math.abs(e-t)<=n}function Ui(e,t){const n=Math.pow(e-t,2)/Math.pow(e+t,2);return Oi*(e+t)*(1+3*n/(10+Math.sqrt(4-3*n)))}function Hi(e){return(e%=zi)<0?e+=zi:0===e&&(e=0),e}function Vi(e,t){return(e=Hi(e))>(t=Hi(t))&&(t+=zi),t-e}function Ki(e,t){return zi-Vi(e,t)}function Wi(e,t){const n=(t-e)%zi;return 2*n%zi-n}function $i(e,t){return Wi(e,t)}function Yi(e){return(zi+e)%zi}function qi(e,t){const n=zi/t;let r=Math.floor((Yi(e)+n/2)/n)*n%zi;return r<Oi&&(r+=zi),r>Oi&&(r-=zi),r}function Gi(e,t){return e===t||Bi(e%(Math.PI/2)-t%(Math.PI/2),0)}function Xi(e,t,n,r){return new Ei(e+n*Math.cos(r),t+n*Math.sin(r))}function Qi(e,t,n){const r=e/2,i=t/2,o=[];let s=1/0,a=1/0;for(let l=0;l<n;l++){const e=l*(zi/n)-Li,t=r+r*Math.cos(e),c=i+i*Math.sin(e);t<s&&(s=t),c<a&&(a=c),o.push(new Ei(t,c))}if(0!==s||0!==a)for(let l=0;l<o.length;l++){const e=o[l];e.x-=s,e.y-=a}return o}function Zi(e,t,n,r){return e<r&&n<t}function Ji(e,t,n,r){const i=Math.max(e,n),o=Math.min(t,r);return i<=o?[i,o]:null}function eo(e,t,n){return(t.x-e.x)*(n.y-e.y)-(n.x-e.x)*(t.y-e.y)}function to(e,t){let n,r,i=0;for(let o=0;o<t.length;o++)n=t[o],r=t[(o+1)%t.length],n.y<=e.y?r.y>e.y&&eo(n,r,e)>0&&(i+=1):r.y<=e.y&&eo(n,r,e)<0&&(i-=1);return 0!==i}function no(e){return+e.toFixed(4)}function ro(e){return+e.toFixed(2)}const io=e=>Math.abs(e)<Number.MAX_SAFE_INTEGER,oo=e=>{let{brush:n,color:r,opacity:i}=e;const o=(0,t.useRef)(null);Pi(o,n.x,n.y);const s=no(Math.max(1,n.w)),a=no(Math.max(1,n.h));return(0,Zr.jsx)("svg",{className:"tl-overlays__item",ref:o,children:r?(0,Zr.jsxs)("g",{className:"tl-brush",opacity:i,children:[(0,Zr.jsx)("rect",{width:s,height:a,fill:r,opacity:.75}),(0,Zr.jsx)("rect",{width:s,height:a,fill:"none",stroke:r,opacity:.1})]}):(0,Zr.jsx)("rect",{className:"tl-brush tl-brush__default",width:s,height:a})})},so=e=>{let{className:n,zoom:r,point:i,color:o,viewport:s,opacity:a=1}=e;const l=(0,t.useRef)(null);return Pi(l,Ni(i.x,s.minX+5/r,s.maxX-5/r),Ni(i.y,s.minY+5/r,s.maxY-5/r),1/r,Ei.Angle(s.center,i)),(0,Zr.jsxs)("svg",{ref:l,className:Jr("tl-overlays__item",n),children:[(0,Zr.jsx)("use",{href:"#cursor_hint",color:o,strokeWidth:3,stroke:"var(--color-background)"}),(0,Zr.jsx)("use",{href:"#cursor_hint",color:o,opacity:a})]})},ao=(0,t.memo)((e=>{let{className:n,zoom:r,point:i,color:o,name:s,chatMessage:a}=e;const l=(0,t.useRef)(null);return Pi(l,null===i||void 0===i?void 0:i.x,null===i||void 0===i?void 0:i.y,1/r),i?(0,Zr.jsxs)("div",{ref:l,className:Jr("tl-overlays__item",n),children:[(0,Zr.jsx)("svg",{className:"tl-cursor",children:(0,Zr.jsx)("use",{href:"#cursor",color:o})}),a?(0,Zr.jsxs)(Zr.Fragment,{children:[s&&(0,Zr.jsx)("div",{className:"tl-nametag-title",style:{color:o},children:s}),(0,Zr.jsx)("div",{className:"tl-nametag-chat",style:{backgroundColor:o},children:a})]}):s&&(0,Zr.jsx)("div",{className:"tl-nametag",style:{backgroundColor:o},children:s})]}):null})),lo={openWindow:(e,t)=>window.open(e,t,"noopener noreferrer"),refreshPage:()=>window.location.reload(),hardReset:async()=>{var e,t;return await(null===(e=(t=window).__tldraw__hardReset)||void 0===e?void 0:e.call(t))}};function co(){lo.hardReset()}function uo(){}const ho=e=>{let{error:n,editor:r}=e;const i=(0,t.useRef)(null),[o,s]=(0,t.useState)(!1),[a,l]=(0,t.useState)(!1),[c,u]=(0,t.useState)(!1),d=n instanceof Error?n.message:String(n),h=n instanceof Error?n.stack:null,p=q("isDarkMode",(()=>{try{if(r)return r.user.isDarkMode}catch{}return null}),[r]),[f,g]=(0,t.useState)(null);(0,t.useLayoutEffect)((()=>{var e;null!==p&&g(p);let t=null===(e=i.current)||void 0===e?void 0:e.parentElement,n=!1;for(;t;){if(t.classList.contains("tl-theme__dark")||t.classList.contains("tl-theme__light")){n=!0;break}t=t.parentElement}g(n?null:window.matchMedia("(prefers-color-scheme: dark)").matches)}),[p]),(0,t.useEffect)((()=>{if(a){const e=setTimeout((()=>{l(!1)}),2e3);return()=>clearTimeout(e)}}),[a]);const m=new URL("https://github.com/tldraw/tldraw/issues/new");return m.searchParams.set("title",d),m.searchParams.set("labels","bug"),m.searchParams.set("body","Hey, I ran into an error while using tldraw:\n\n```js\n".concat(null!==h&&void 0!==h?h:d,"\n```\n\nMy browser: ").concat(navigator.userAgent)),(0,Zr.jsxs)("div",{ref:i,className:Jr("tl-container tl-error-boundary",null===f?"":f?"tl-theme__dark":"tl-theme__light"),children:[(0,Zr.jsx)("div",{className:"tl-error-boundary__overlay"}),r&&(0,Zr.jsx)(vi,{onError:uo,fallback:()=>null,children:(0,Zr.jsx)(ui.Provider,{value:r,children:(0,Zr.jsx)("div",{className:"tl-overlay tl-error-boundary__canvas",children:(0,Zr.jsx)(ba,{})})})}),(0,Zr.jsx)("div",{className:Jr("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":o&&!c}),children:c?(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsx)("h2",{children:"Are you sure?"}),(0,Zr.jsx)("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),(0,Zr.jsxs)("div",{className:"tl-error-boundary__content__actions",children:[(0,Zr.jsx)("button",{onClick:()=>u(!1),children:"Cancel"}),(0,Zr.jsx)("button",{className:"tl-error-boundary__reset",onClick:async()=>{co()},children:"Reset data"})]})]}):(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsx)("h2",{children:"Something's gone wrong."}),(0,Zr.jsxs)("p",{children:["Sorry, we encountered an error. Please refresh the page to continue. If you keep seeing this error, you can ",(0,Zr.jsx)("a",{href:m.toString(),children:"create a GitHub issue"})," or"," ",(0,Zr.jsx)("a",{href:"https://discord.gg/Cq6cPsTfNy",children:"ask for help on Discord"}),"."]}),o&&(0,Zr.jsxs)("div",{className:"tl-error-boundary__content__error",children:[(0,Zr.jsx)("pre",{children:(0,Zr.jsx)("code",{children:null!==h&&void 0!==h?h:d})}),(0,Zr.jsx)("button",{onClick:()=>{const e=document.createElement("textarea");e.value=null!==h&&void 0!==h?h:d,document.body.appendChild(e),e.select(),document.execCommand("copy"),e.remove(),l(!0)},children:a?"Copied!":"Copy"})]}),(0,Zr.jsxs)("div",{className:"tl-error-boundary__content__actions",children:[(0,Zr.jsx)("button",{onClick:()=>s(!o),children:o?"Hide details":"Show details"}),(0,Zr.jsxs)("div",{className:"tl-error-boundary__content__actions__group",children:[(0,Zr.jsx)("button",{className:"tl-error-boundary__reset",onClick:()=>u(!0),children:"Reset data"}),(0,Zr.jsx)("button",{className:"tl-error-boundary__refresh",onClick:()=>{lo.refreshPage()},children:"Refresh Page"})]})]})]})})]})},po=2e3,fo=320,go=[.1,.25,.5,1,2,4,8],mo=.1,yo=8,vo=32,bo={};for(let n=1;n<=Math.ceil(yo);n++)bo[n+"_dark"]="hash_pattern_zoom_".concat(n,"_dark"),bo[n+"_light"]="hash_pattern_zoom_".concat(n,"_light");const wo={duration:0,easing:Ci.easeInOutCubic},xo=.09,So=[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],ko=6e4,_o=3e3,Po=-10,Co=e=>{let{x:t,y:n,z:r,size:i}=e;return(0,Zr.jsxs)("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[(0,Zr.jsx)("defs",{children:So.map(((e,o)=>{let{min:s,mid:a,step:l}=e;const c=l*i*r,u=.5+t*r,d=.5+n*r,h=u>0?u%c:c+u%c,p=d>0?d%c:c+d%c,f=r<a?he(r,[s,a],[0,1]):1;return(0,Zr.jsx)("pattern",{id:"grid-".concat(l),width:c,height:c,patternUnits:"userSpaceOnUse",children:(0,Zr.jsx)("circle",{className:"tl-grid-dot",cx:h,cy:p,r:1,opacity:f})},"grid-pattern-".concat(o))}))}),So.map(((e,t)=>{let{step:n}=e;return(0,Zr.jsx)("rect",{width:"100%",height:"100%",fill:"url(#grid-".concat(n,")")},"grid-rect-".concat(t))}))]})},Eo=e=>{let{handle:t,isCoarse:n,className:r,zoom:i}=e;const o=(n?20:12)/i,s=("create"===t.type&&n?3:4)/i;return(0,Zr.jsxs)("g",{className:Jr("tl-handle",{"tl-handle__virtual":"virtual"===t.type,"tl-handle__create":"create"===t.type},r),children:[(0,Zr.jsx)("circle",{className:"tl-handle__bg",r:o}),(0,Zr.jsx)("circle",{className:"tl-handle__fg",r:s})]})},Io=e=>{let{children:t}=e;return(0,Zr.jsx)("svg",{className:"tl-user-handles tl-overlays__item",children:t})},Mo=e=>{let{shapeId:t}=e;return(0,Zr.jsx)(ki,{className:"tl-user-indicator__hovered",id:t})};function To(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=e.length;if(n<2)return"";let r=e[0],i=e[1];if(2===n)return"M".concat(Ai(r),"L").concat(Ai(i));let o="";for(let s=2,a=n-1;s<a;s++)r=e[s],i=e[s+1],o+=ji(r,i);return t?"M".concat(ji(e[0],e[1]),"Q").concat(Ai(e[1])).concat(ji(e[1],e[2]),"T").concat(o).concat(ji(e[n-1],e[0])).concat(ji(e[0],e[1]),"Z"):"M".concat(Ai(e[0]),"Q").concat(Ai(e[1])).concat(ji(e[1],e[2])).concat(e.length>3?"T":"").concat(o,"L").concat(Ai(e[n-1]))}const Ao=e=>{let{scribble:t,zoom:n,color:r,opacity:i,className:o}=e;return t.points.length?(0,Zr.jsx)("svg",{className:o?Jr("tl-overlays__item",o):o,children:(0,Zr.jsx)("path",{className:"tl-scribble",d:To(t.points,!1),stroke:null!==r&&void 0!==r?r:"var(--color-".concat(t.color,")"),fill:"none",strokeWidth:8/n,opacity:null!==i&&void 0!==i?i:t.opacity})}):null},jo=e=>{let{bounds:n,rotation:r}=e;const i=t.useRef(null);return Pi(i,n.x,n.y,1,r),t.useLayoutEffect((()=>{const e=i.current;e&&(e.style.width=no(Math.max(1,n.width))+"px",e.style.height=no(Math.max(1,n.height))+"px")}),[n.width,n.height]),(0,Zr.jsx)("div",{ref:i,className:"tl-selection__bg",draggable:!1})},Oo=e=>{var n,r;let{bounds:i,rotation:o}=e;const s=di(),a=(0,t.useRef)(null),l=q("only selected shape",(()=>s.onlySelectedShape),[s]),c=l?s.getShapeUtil(l).expandSelectionOutlinePx(l):0;return Pi(a,null===(n=i)||void 0===n?void 0:n.x,null===(r=i)||void 0===r?void 0:r.y,1,o,{x:-c,y:-c}),i=i.clone().expandBy(c).zeroFix(),(0,Zr.jsx)("svg",{ref:a,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:(0,Zr.jsx)("rect",{className:Jr("tl-selection__fg__outline"),width:no(i.width),height:no(i.height)})})},Lo=()=>(0,Zr.jsx)("div",{className:"tl-shape-error-boundary"}),zo=()=>(0,Zr.jsx)("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"});function Ro(e){let{points:t,zoom:n}=e;const r=2.5/n,i=t.reduce(((e,t)=>Math.min(e,t.x)),1/0),o=t.reduce(((e,t)=>Math.max(e,t.x)),-1/0),s=t.reduce(((e,t)=>Math.min(e,t.y)),1/0),a=t.reduce(((e,t)=>Math.max(e,t.y)),-1/0);let l,c,u,d;return t.some((e=>e.x===i&&e.y===s))?(l=i,c=s,u=o,d=a):(l=i,c=a,u=o,d=s),(0,Zr.jsxs)("g",{className:"tl-snap-line",children:[(0,Zr.jsx)("line",{x1:l,y1:c,x2:u,y2:d}),t.map(((e,t)=>(0,Zr.jsx)("g",{transform:"translate(".concat(e.x,",").concat(e.y,")"),children:(0,Zr.jsx)("path",{className:"tl-snap-point",d:"M ".concat(-r,",").concat(-r," L ").concat(r,",").concat(r," M ").concat(-r,",").concat(r," L ").concat(r,",").concat(-r)})},t)))]})}function Do(e){let{gaps:n,direction:r,zoom:i}=e;const o=3.5/i;let s=[-1/0,1/0],a=null;const l="horizontal"===r;for(const t of n)a=Ji(s[0],s[1],l?t.startEdge[0].y:t.startEdge[0].x,l?t.startEdge[1].y:t.startEdge[1].x),a&&(s=a,a=Ji(s[0],s[1],l?t.endEdge[0].y:t.endEdge[0].x,l?t.endEdge[1].y:t.endEdge[1].x),a&&(s=a));if(null===s)return null;const c=(s[0]+s[1])/2;return(0,Zr.jsx)("g",{className:"tl-snap-line",children:n.map(((e,n)=>{let{startEdge:r,endEdge:i}=e;return(0,Zr.jsx)(t.Fragment,{children:l?(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsx)("line",{x1:r[0].x,y1:c-2*o,x2:r[1].x,y2:c+2*o}),(0,Zr.jsx)("line",{x1:i[0].x,y1:c-2*o,x2:i[1].x,y2:c+2*o}),(0,Zr.jsx)("line",{x1:r[0].x,y1:c,x2:i[0].x,y2:c}),(0,Zr.jsx)("line",{x1:(r[0].x+i[0].x)/2,y1:c-o,x2:(r[0].x+i[0].x)/2,y2:c+o})]}):(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsx)("line",{x1:c-2*o,y1:r[0].y,x2:c+2*o,y2:r[1].y}),(0,Zr.jsx)("line",{x1:c-2*o,y1:i[0].y,x2:c+2*o,y2:i[1].y}),(0,Zr.jsx)("line",{x1:c,y1:r[0].y,x2:c,y2:i[0].y}),(0,Zr.jsx)("line",{x1:c-o,y1:(r[0].y+i[0].y)/2,x2:c+o,y2:(r[0].y+i[0].y)/2})]})},n)}))})}const No=e=>{let{className:t,line:n,zoom:r}=e;return(0,Zr.jsx)("svg",{className:Jr("tl-overlays__item",t),children:"points"===n.type?(0,Zr.jsx)(Ro,{...n,zoom:r}):"gaps"===n.type?(0,Zr.jsx)(Do,{...n,zoom:r}):null})},Fo=()=>(0,Zr.jsx)("svg",{width:16,height:16,viewBox:"0 0 16 16",children:(0,Zr.jsxs)("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[(0,Zr.jsx)("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"var(--color-text-1)"}),(0,Zr.jsx)("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"var(--color-text-1)",children:(0,Zr.jsx)("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})}),Bo=()=>null,Uo=(0,t.createContext)({});function Ho(e){let{overrides:n,children:r}=e;return(0,Zr.jsx)(Uo.Provider,{value:(0,t.useMemo)((()=>({Background:_i,SvgDefs:Bo,Brush:oo,ZoomBrush:oo,CollaboratorBrush:oo,Cursor:ao,CollaboratorCursor:ao,CollaboratorHint:so,CollaboratorShapeIndicator:ki,Grid:Co,Scribble:Ao,SnapLine:No,Handles:Io,Handle:Eo,CollaboratorScribble:Ao,ErrorFallback:ho,ShapeErrorFallback:Lo,ShapeIndicatorErrorFallback:zo,Spinner:Fo,SelectionBackground:jo,SelectionForeground:Oo,HoveredShapeIndicator:Mo,OnTheCanvas:null,InFrontOfTheCanvas:null,...n})),[n]),children:r})}function Vo(){return(0,t.useContext)(Uo)}const Ko=["textarea","input"];const Wo={toVector:(e,t)=>(void 0===e&&(e=t),Array.isArray(e)?e:[e,e]),add:(e,t)=>[e[0]+t[0],e[1]+t[1]],sub:(e,t)=>[e[0]-t[0],e[1]-t[1]],addTo(e,t){e[0]+=t[0],e[1]+=t[1]},subTo(e,t){e[0]-=t[0],e[1]-=t[1]}};function $o(e,t,n){return 0===t||Math.abs(t)===1/0?Math.pow(e,5*n):e*t*n/(t+n*e)}function Yo(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.15;return 0===r?function(e,t,n){return Math.max(t,Math.min(e,n))}(e,t,n):e<t?-$o(t-e,n-t,r)+t:e>n?+$o(e-n,n-t,r)+n:e}function qo(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}function Go(e,t,n){return(t=qo(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Xo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Qo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xo(Object(n),!0).forEach((function(t){Go(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const Zo={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function Jo(e){return e?e[0].toUpperCase()+e.slice(1):""}const es=["enter","leave"];function ts(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=Zo[e],i=r&&r[t]||t;return"on"+Jo(e)+Jo(i)+(function(){let e=arguments.length>1?arguments[1]:void 0;return arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&!es.includes(e)}(n,i)?"Capture":"")}const ns=["gotpointercapture","lostpointercapture"];function rs(e){let t=e.substring(2).toLowerCase();const n=!!~t.indexOf("passive");n&&(t=t.replace("passive",""));const r=ns.includes(t)?"capturecapture":"capture",i=!!~t.indexOf(r);return i&&(t=t.replace("capture","")),{device:t,capture:i,passive:n}}function is(e){return"touches"in e}function os(e){return is(e)?"touch":"pointerType"in e?e.pointerType:"mouse"}function ss(e,t){try{const n=t.clientX-e.clientX,r=t.clientY-e.clientY,i=(t.clientX+e.clientX)/2,o=(t.clientY+e.clientY)/2,s=Math.hypot(n,r),a=-180*Math.atan2(n,r)/Math.PI;return{angle:a,distance:s,origin:[i,o]}}catch(n){}return null}function as(e){return function(e){return Array.from(e.touches).filter((t=>{var n,r;return t.target===e.currentTarget||(null===(n=e.currentTarget)||void 0===n||null===(r=n.contains)||void 0===r?void 0:r.call(n,t.target))}))}(e).map((e=>e.identifier))}function ls(e,t){const[n,r]=Array.from(e.touches).filter((e=>t.includes(e.identifier)));return ss(n,r)}function cs(e){let{deltaX:t,deltaY:n,deltaMode:r}=e;return 1===r?(t*=40,n*=40):2===r&&(t*=800,n*=800),[t,n]}function us(e){if("function"===typeof e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e(...n)}return e}function ds(){}function hs(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?ds:1===t.length?t[0]:function(){let e;for(const n of t)e=n.apply(this,arguments)||e;return e}}function ps(e,t){return Object.assign({},t,e||{})}class fs{constructor(e,t,n){this.ctrl=e,this.args=t,this.key=n,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:t,ingKey:n,args:r}=this;t[n]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=r,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const t=this.state,n=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=n.from?us(n.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){const t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:t,config:n,shared:r}=this;t.args=this.args;let i=0;if(e&&(t.event=e,n.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,r.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,r.locked=!!document.pointerLockElement,Object.assign(r,function(e){const t={};if("buttons"in e&&(t.buttons=e.buttons),"shiftKey"in e){const{shiftKey:n,altKey:r,metaKey:i,ctrlKey:o}=e;Object.assign(t,{shiftKey:n,altKey:r,metaKey:i,ctrlKey:o})}return t}(e)),r.down=r.pressed=r.buttons%2===1||r.touches>0,i=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){const e=t._delta.map(Math.abs);Wo.addTo(t._distance,e)}this.axisIntent&&this.axisIntent(e);const[o,s]=t._movement,[a,l]=n.threshold,{_step:c,values:u}=t;if(n.hasCustomTransform?(!1===c[0]&&(c[0]=Math.abs(o)>=a&&u[0]),!1===c[1]&&(c[1]=Math.abs(s)>=l&&u[1])):(!1===c[0]&&(c[0]=Math.abs(o)>=a&&Math.sign(o)*a),!1===c[1]&&(c[1]=Math.abs(s)>=l&&Math.sign(s)*l)),t.intentional=!1!==c[0]||!1!==c[1],!t.intentional)return;const d=[0,0];if(n.hasCustomTransform){const[e,t]=u;d[0]=!1!==c[0]?e-c[0]:0,d[1]=!1!==c[1]?t-c[1]:0}else d[0]=!1!==c[0]?o-c[0]:0,d[1]=!1!==c[1]?s-c[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(d);const h=t.offset,p=t._active&&!t._blocked||t.active;p&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=r[this.ingKey]=t._active,e&&(t.first&&("bounds"in n&&(t._bounds=us(n.bounds,t)),this.setup&&this.setup()),t.movement=d,this.computeOffset()));const[f,g]=t.offset,[[m,y],[v,b]]=t._bounds;t.overflow=[f<m?-1:f>y?1:0,g<v?-1:g>b?1:0],t._movementBound[0]=!!t.overflow[0]&&(!1===t._movementBound[0]?t._movement[0]:t._movementBound[0]),t._movementBound[1]=!!t.overflow[1]&&(!1===t._movementBound[1]?t._movement[1]:t._movementBound[1]);const w=t._active&&n.rubberband||[0,0];if(t.offset=function(e,t,n){let[r,i]=t,[o,s]=n;const[[a,l],[c,u]]=e;return[Yo(r,a,l,o),Yo(i,c,u,s)]}(t._bounds,t.offset,w),t.delta=Wo.sub(t.offset,h),this.computeMovement(),p&&(!t.last||i>32)){t.delta=Wo.sub(t.offset,h);const e=t.delta.map(Math.abs);Wo.addTo(t.distance,e),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&i>0&&(t.velocity=[e[0]/i,e[1]/i],t.timeDelta=i)}}emit(){const e=this.state,t=this.shared,n=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!n.triggerAllEvents)return;const r=this.handler(Qo(Qo(Qo({},t),e),{},{[this.aliasKey]:e.values}));void 0!==r&&(e.memo=r)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}class gs extends fs{constructor(){super(...arguments),Go(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=Wo.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=Wo.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const t=this.state,n=this.config;if(!t.axis&&e){const r="object"===typeof n.axisThreshold?n.axisThreshold[os(e)]:n.axisThreshold;t.axis=function(e,t){let[n,r]=e;const i=Math.abs(n),o=Math.abs(r);return i>o&&i>t?"x":o>i&&o>t?"y":void 0}(t._movement,r)}t._blocked=(n.lockDirection||!!n.axis)&&!t.axis||!!n.axis&&n.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0}}}const ms=e=>e,ys={enabled(){return!(arguments.length>0&&void 0!==arguments[0])||arguments[0]},eventOptions:(e,t,n)=>Qo(Qo({},n.shared.eventOptions),e),preventDefault(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]},triggerAllEvents(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]},rubberband(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;switch(e){case!0:return[.15,.15];case!1:return[0,0];default:return Wo.toVector(e)}},from:e=>"function"===typeof e?e:null!=e?Wo.toVector(e):void 0,transform(e,t,n){const r=e||n.shared.transform;return this.hasCustomTransform=!!r,r||ms},threshold:e=>Wo.toVector(e,0)};const vs=Qo(Qo({},ys),{},{axis(e,t,n){let{axis:r}=n;if(this.lockDirection="lock"===r,!this.lockDirection)return r},axisThreshold(){return arguments.length>0&&void 0!==arguments[0]?arguments[0]:0},bounds(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("function"===typeof e)return t=>vs.bounds(e(t));if("current"in e)return()=>e.current;if("function"===typeof HTMLElement&&e instanceof HTMLElement)return e;const{left:t=-1/0,right:n=1/0,top:r=-1/0,bottom:i=1/0}=e;return[[t,n],[r,i]]}});const bs="undefined"!==typeof window&&window.document&&window.document.createElement;function ws(){return bs&&"ontouchstart"in window}const xs={isBrowser:bs,gesture:function(){try{return"constructor"in GestureEvent}catch(ZI){return!1}}(),touch:ws(),touchscreen:ws()||bs&&window.navigator.maxTouchPoints>1,pointer:bs&&"onpointerdown"in window,pointerLock:bs&&"exitPointerLock"in window.document},Ss=.5,ks=50,_s=250,Ps={mouse:0,touch:0,pen:8};Qo(Qo({},vs),{},{device(e,t,n){let{pointer:{touch:r=!1,lock:i=!1,mouse:o=!1}={}}=n;return this.pointerLock=i&&xs.pointerLock,xs.touch&&r?"touch":this.pointerLock?"mouse":xs.pointer&&!o?"pointer":xs.touch?"touch":"mouse"},preventScrollAxis(e,t,n){let{preventScroll:r}=n;if(this.preventScrollDelay="number"===typeof r?r:r||void 0===r&&e?250:void 0,xs.touchscreen&&!1!==r)return e||(void 0!==r?"y":void 0)},pointerCapture(e,t,n){let{pointer:{capture:r=!0,buttons:i=1,keys:o=!0}={}}=n;return this.pointerButtons=i,this.keys=o,!this.pointerLock&&"pointer"===this.device&&r},threshold(e,t,n){let{filterTaps:r=!1,tapsThreshold:i=3,axis:o}=n;const s=Wo.toVector(e,r?i:o?1:0);return this.filterTaps=r,this.tapsThreshold=i,s},swipe(){let{velocity:e=Ss,distance:t=ks,duration:n=_s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{velocity:this.transform(Wo.toVector(e)),distance:this.transform(Wo.toVector(t)),duration:n}},delay(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;switch(e){case!0:return 180;case!1:return 0;default:return e}},axisThreshold:e=>e?Qo(Qo({},Ps),e):Ps,keyboardDisplacement(){return arguments.length>0&&void 0!==arguments[0]?arguments[0]:10}});function Cs(e){const[t,n]=e.overflow,[r,i]=e._delta,[o,s]=e._direction;(t<0&&r>0&&o<0||t>0&&r<0&&o>0)&&(e._movement[0]=e._movementBound[0]),(n<0&&i>0&&s<0||n>0&&i<0&&s>0)&&(e._movement[1]=e._movementBound[1])}const Es=Qo(Qo({},ys),{},{device(e,t,n){let{shared:r,pointer:{touch:i=!1}={}}=n;if(r.target&&!xs.touch&&xs.gesture)return"gesture";if(xs.touch&&i)return"touch";if(xs.touchscreen){if(xs.pointer)return"pointer";if(xs.touch)return"touch"}},bounds(e,t,n){let{scaleBounds:r={},angleBounds:i={}}=n;const o=e=>{const t=ps(us(r,e),{min:-1/0,max:1/0});return[t.min,t.max]},s=e=>{const t=ps(us(i,e),{min:-1/0,max:1/0});return[t.min,t.max]};return"function"!==typeof r&&"function"!==typeof i?[o(),s()]:e=>[o(e),s(e)]},threshold(e,t,n){this.lockDirection="lock"===n.axis;return Wo.toVector(e,this.lockDirection?[.1,3]:0)},modifierKey:e=>void 0===e?"ctrlKey":e,pinchOnWheel(){return!(arguments.length>0&&void 0!==arguments[0])||arguments[0]}});Qo(Qo({},vs),{},{mouseOnly:function(){return!(arguments.length>0&&void 0!==arguments[0])||arguments[0]}});const Is=vs;Qo(Qo({},vs),{},{mouseOnly:function(){return!(arguments.length>0&&void 0!==arguments[0])||arguments[0]}});const Ms=new Map,Ts=new Map;function As(e){Ms.set(e.key,e.engine),Ts.set(e.key,e.resolver)}const js={key:"pinch",engine:class extends fs{constructor(){super(...arguments),Go(this,"ingKey","pinching"),Go(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){const{type:e,movement:t,lastOffset:n}=this.state;this.state.offset="wheel"===e?Wo.add(t,n):[(1+t[0])*n[0],t[1]+n[1]]}computeMovement(){const{offset:e,lastOffset:t}=this.state;this.state.movement=[e[0]/t[0],e[1]-t[1]]}axisIntent(){const e=this.state,[t,n]=e._movement;if(!e.axis){const r=30*Math.abs(t)-Math.abs(n);r<0?e.axis="angle":r>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&("scale"===this.state.axis?e[1]=0:"angle"===this.state.axis&&(e[0]=0))}cancel(){const e=this.state;e.canceled||setTimeout((()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()}),0)}touchStart(e){this.ctrl.setEventIds(e);const t=this.state,n=this.ctrl.touchIds;if(t._active&&t._touchIds.every((e=>n.has(e))))return;if(n.size<2)return;this.start(e),t._touchIds=Array.from(n).slice(0,2);const r=ls(e,t._touchIds);r&&this.pinchStart(e,r)}pointerStart(e){if(null!=e.buttons&&e.buttons%2!==1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);const t=this.state,n=t._pointerEvents,r=this.ctrl.pointerIds;if(t._active&&Array.from(n.keys()).every((e=>r.has(e))))return;if(n.size<2&&n.set(e.pointerId,e),t._pointerEvents.size<2)return;this.start(e);const i=ss(...Array.from(n.values()));i&&this.pinchStart(e,i)}pinchStart(e,t){this.state.origin=t.origin,this.computeValues([t.distance,t.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;const t=ls(e,this.state._touchIds);t&&this.pinchMove(e,t)}pointerMove(e){const t=this.state._pointerEvents;if(t.has(e.pointerId)&&t.set(e.pointerId,e),!this.state._active)return;const n=ss(...Array.from(t.values()));n&&this.pinchMove(e,n)}pinchMove(e,t){const n=this.state,r=n._values[1],i=t.angle-r;let o=0;Math.abs(i)>270&&(o+=Math.sign(i)),this.computeValues([t.distance,t.angle-360*o]),n.origin=t.origin,n.turns=o,n._movement=[n._values[0]/n._initial[0]-1,n._values[1]-n._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some((e=>!this.ctrl.touchIds.has(e)))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){const t=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch(n){}t._pointerEvents.has(e.pointerId)&&t._pointerEvents.delete(e.pointerId),t._active&&t._pointerEvents.size<2&&(t._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();const t=this.state;t._active||(this.start(e),this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;const t=this.state;this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY];const n=t._movement;t._movement=[e.scale-1,e.rotation],t._delta=Wo.sub(t._movement,n),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){const t=this.config.modifierKey;t&&!(Array.isArray(t)?t.find((t=>e[t])):e[t])||(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||e.cancelable&&e.preventDefault();const t=this.state;t._delta=[-cs(e)[1]/100*t.offset[0],0],Wo.addTo(t._movement,t._delta),Cs(t),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){const t=this.config.device;t&&(e(t,"start",this[t+"Start"].bind(this)),e(t,"change",this[t+"Move"].bind(this)),e(t,"end",this[t+"End"].bind(this)),e(t,"cancel",this[t+"End"].bind(this)),e("lostPointerCapture","",this[t+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}},resolver:Es},Os={key:"wheel",engine:class extends gs{constructor(){super(...arguments),Go(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){const t=this.state;t._delta=cs(e),Wo.addTo(t._movement,t._delta),Cs(t),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}},resolver:Is};function Ls(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}const zs={target(e){if(e)return()=>"current"in e?e.current:e},enabled(){return!(arguments.length>0&&void 0!==arguments[0])||arguments[0]},window(){return arguments.length>0&&void 0!==arguments[0]?arguments[0]:xs.isBrowser?window:void 0},eventOptions(){let{passive:e=!0,capture:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{passive:e,capture:t}},transform:e=>e},Rs=["target","eventOptions","window","enabled","transform"];function Ds(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;const n={};for(const[r,i]of Object.entries(t))switch(typeof i){case"function":n[r]=i.call(n,e[r],r,e);break;case"object":n[r]=Ds(e[r],i);break;case"boolean":i&&(n[r]=e[r])}return n}class Ns{constructor(e,t){Go(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,n,r,i){const o=this._listeners,s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=Zo[e];return e+(n&&n[t]||t)}(t,n),a=Qo(Qo({},this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{}),i);e.addEventListener(s,r,a);const l=()=>{e.removeEventListener(s,r,a),o.delete(l)};return o.add(l),l}clean(){this._listeners.forEach((e=>e())),this._listeners.clear()}}class Fs{constructor(){Go(this,"_timeouts",new Map)}add(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:140;this.remove(e);for(var r=arguments.length,i=new Array(r>3?r-3:0),o=3;o<r;o++)i[o-3]=arguments[o];this._timeouts.set(e,window.setTimeout(t,n,...i))}remove(e){const t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach((e=>{window.clearTimeout(e)})),this._timeouts.clear()}}class Bs{constructor(e){Go(this,"gestures",new Set),Go(this,"_targetEventStore",new Ns(this)),Go(this,"gestureEventStores",{}),Go(this,"gestureTimeoutStores",{}),Go(this,"handlers",{}),Go(this,"config",{}),Go(this,"pointerIds",new Set),Go(this,"touchIds",new Set),Go(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),function(e,t){t.drag&&Us(e,"drag");t.wheel&&Us(e,"wheel");t.scroll&&Us(e,"scroll");t.move&&Us(e,"move");t.pinch&&Us(e,"pinch");t.hover&&Us(e,"hover")}(this,e)}setEventIds(e){return is(e)?(this.touchIds=new Set(as(e)),this.touchIds):"pointerId"in e?("pointerup"===e.type||"pointercancel"===e.type?this.pointerIds.delete(e.pointerId):"pointerdown"===e.type&&this.pointerIds.add(e.pointerId),this.pointerIds):void 0}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=e,{target:i,eventOptions:o,window:s,enabled:a,transform:l}=r,c=Ls(r,Rs);if(n.shared=Ds({target:i,eventOptions:o,window:s,enabled:a,transform:l},zs),t){const e=Ts.get(t);n[t]=Ds(Qo({shared:n.shared},c),e)}else for(const u in c){const e=Ts.get(u);e&&(n[u]=Ds(Qo({shared:n.shared},c[u]),e))}return n}(e,t,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=this.config.shared,i={};let o;if(!r.target||(o=r.target(),o)){if(r.enabled){for(const n of this.gestures){const e=this.config[n],r=Hs(i,e.eventOptions,!!o);if(e.enabled){new(Ms.get(n))(this,t,n).bind(r)}}const e=Hs(i,r.eventOptions,!!o);for(const n in this.nativeHandlers)e(n,"",(e=>this.nativeHandlers[n](Qo(Qo({},this.state.shared),{},{event:e,args:t}))),void 0,!0)}for(const e in i)i[e]=hs(...i[e]);if(!o)return i;for(const e in i){const{device:t,capture:n,passive:r}=rs(e);this._targetEventStore.add(o,t,"",i[e],{capture:n,passive:r})}}}}function Us(e,t){e.gestures.add(t),e.gestureEventStores[t]=new Ns(e,t),e.gestureTimeoutStores[t]=new Fs}const Hs=(e,t,n)=>function(r,i,o){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];var l,c;const u=null!==(l=s.capture)&&void 0!==l?l:t.capture,d=null!==(c=s.passive)&&void 0!==c?c:t.passive;let h=a?r:ts(r,i,u);n&&d&&(h+="Passive"),e[h]=e[h]||[],e[h].push(o)},Vs=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function Ks(e,t,n,r,i,o){if(!e.has(n))return;if(!Ms.has(r))return void 0;const s=n+"Start",a=n+"End";i[r]=e=>{let r;return e.first&&s in t&&t[s](e),n in t&&(r=t[n](e)),e.last&&a in t&&t[a](e),r},o[r]=o[r]||{}}function Ws(e,t){const[n,r,i]=function(e){const t={},n={},r=new Set;for(let i in e)Vs.test(i)?(r.add(RegExp.lastMatch),n[i]=e[i]):t[i]=e[i];return[n,t,r]}(e),o={};return Ks(i,n,"onDrag","drag",o,t),Ks(i,n,"onWheel","wheel",o,t),Ks(i,n,"onScroll","scroll",o,t),Ks(i,n,"onPinch","pinch",o,t),Ks(i,n,"onMove","move",o,t),Ks(i,n,"onHover","hover",o,t),{handlers:o,config:t,nativeHandlers:r}}function $s(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;const o=t.useMemo((()=>new Bs(e)),[]);if(o.applyHandlers(e,i),o.applyConfig(n,r),t.useEffect(o.effect.bind(o)),t.useEffect((()=>o.clean.bind(o)),[]),void 0===n.target)return o.bind.bind(o)}function Ys(e){return e.forEach(As),function(e,t){const{handlers:n,nativeHandlers:r,config:i}=Ws(e,t||{});return $s(n,i,void 0,r)}}const qs=10,Gs=/Mac|iPod|iPhone|iPad/.test("undefined"===typeof window?"node":window.navigator.platform);function Xs(e){let{deltaY:t,deltaX:n}=e,r=0;if(e.ctrlKey||e.altKey||e.metaKey){const n=Math.sign(e.deltaY);let i=t;Math.abs(e.deltaY)>qs&&(i=qs*n),r=i/100}else e.shiftKey&&!Gs&&(n=t,t=0);return{x:-n,y:-t,z:-r}}const Qs=Ys([Os,js]);let Zs;const Js=e=>void 0===Zs?(Zs=e,!1):e-Zs>120&&e-Zs<160?(Zs=e,!0):(Zs=e,!1);function ea(e){const n=di(),r=t.useMemo((()=>{let t="not sure";let r=1,i=1,o=1,s=0;const a=new Ei,l=new Ei;return{onWheel:e=>{let{event:r}=e;if(!n.instanceState.isFocused)return;if(t="not sure",Js(Date.now()))return;if(n.editingShapeId){const e=n.getShape(n.editingShapeId);if(e){if(n.getShapeUtil(e).canScroll(e)){const e=n.getShapePageBounds(n.editingShapeId);if(null!==e&&void 0!==e&&e.containsPoint(n.inputs.currentPagePoint))return}}}oi(r);const i=Xs(r);if(0===i.x&&0===i.y)return;const o=n.getContainer().getBoundingClientRect(),s={type:"wheel",name:"wheel",delta:i,point:new Ei(r.clientX,r.clientY).sub({x:o.left,y:o.top}),shiftKey:r.shiftKey,altKey:r.altKey,ctrlKey:r.metaKey||r.ctrlKey};n.dispatch(s)},onPinchStart:o=>{const s=e.current;t="not sure";const{event:c,origin:u,da:d}=o;c instanceof WheelEvent||(c.target===s||null!==s&&void 0!==s&&s.contains(c.target))&&(l.x=u[0],l.y=u[1],a.x=u[0],a.y=u[1],r=d[0],i=n.zoomLevel,n.dispatch({type:"pinch",name:"pinch_start",point:{x:u[0],y:u[1],z:n.zoomLevel},delta:{x:0,y:0},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey}))},onPinchEnd:r=>{const i=e.current,{event:o,origin:s,offset:a}=r;if(o instanceof WheelEvent)return;if(!(o.target===i||null!==i&&void 0!==i&&i.contains(o.target)))return;const l=a[0];t="not sure",requestAnimationFrame((()=>{n.dispatch({type:"pinch",name:"pinch_end",point:{x:s[0],y:s[1],z:l},delta:{x:s[0],y:s[1]},shiftKey:o.shiftKey,altKey:o.altKey,ctrlKey:o.metaKey||o.ctrlKey})}))},onPinch:c=>{const u=e.current,{event:d,origin:h,offset:p,da:f}=c;if(d instanceof WheelEvent)return;if(!(d.target===u||null!==u&&void 0!==u&&u.contains(d.target)))return;const g="gesturechange"===c.type||"gestureend"===c.type;s=f[0];const m=h[0]-l.x,y=h[1]-l.y;switch(l.x=h[0],l.y=h[1],(e=>{if(e&&(t="zooming"),"zooming"===t)return;const n=Math.abs(s-r),i=Ei.Dist(a,l);switch(t){case"not sure":n>24?t="zooming":i>16&&(t="panning");break;case"panning":n>64&&(t="zooming")}})(g),t){case"zooming":o=p[0],n.dispatch({type:"pinch",name:"pinch",point:{x:h[0],y:h[1],z:o},delta:{x:m,y:y},shiftKey:d.shiftKey,altKey:d.altKey,ctrlKey:d.metaKey||d.ctrlKey});break;case"panning":n.dispatch({type:"pinch",name:"pinch",point:{x:h[0],y:h[1],z:i},delta:{x:m,y:y},shiftKey:d.shiftKey,altKey:d.altKey,ctrlKey:d.metaKey||d.ctrlKey})}}}}),[n,e]);Qs(r,{target:e,eventOptions:{passive:!1},pinch:{from:()=>[n.zoomLevel,0],scaleBounds:()=>({from:n.zoomLevel,max:8,min:.05})}})}function ta(e,t,n){const r=e.getShape(t);return{shape:r,handle:e.getShapeHandles(r).find((e=>e.id===n))}}var na,ra=n(3881);class ia{constructor(e,t,n,r,i,o){s(this,"a",1),s(this,"b",0),s(this,"c",0),s(this,"d",1),s(this,"e",0),s(this,"f",0),this.a=e,this.b=t,this.c=n,this.d=r,this.e=i,this.f=o}equals(e){return this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d&&this.e===e.e&&this.f===e.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(e){const t=e,{a:n,b:r,c:i,d:o,e:s,f:a}=this;return this.a=n*t.a+i*t.b,this.c=n*t.c+i*t.d,this.e=n*t.e+i*t.f+s,this.b=r*t.a+o*t.b,this.d=r*t.c+o*t.d,this.f=r*t.e+o*t.f+a,this}rotate(e,t,n){return 0===e?this:void 0===t?this.multiply(ia.Rotate(e)):this.translate(t,n).multiply(ia.Rotate(e)).translate(-t,-n)}translate(e,t){return this.multiply(ia.Translate(e,t))}scale(e,t){return this.multiply(ia.Scale(e,t))}invert(){const{a:e,b:t,c:n,d:r,e:i,f:o}=this,s=e*r-t*n;return this.a=r/s,this.b=t/-s,this.c=n/-s,this.d=e/s,this.e=(r*i-n*o)/-s,this.f=(t*i-e*o)/s,this}applyToPoint(e){return ia.applyToPoint(this,e)}applyToPoints(e){return ia.applyToPoints(this,e)}rotation(){return ia.Rotation(this)}point(){return ia.Point(this)}decomposed(){return ia.Decompose(this)}toCssString(){return ia.toCssString(this)}setTo(e){return Object.assign(this,e),this}decompose(){return ia.Decompose(this)}clone(){return new ia(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new ia(1,0,0,1,0,0)}static Translate(e,t){return new ia(1,0,0,1,e,t)}static Rotate(e,t,n){if(0===e)return ia.Identity();const r=Math.cos(e),i=Math.sin(e),o=new ia(r,i,-i,r,0,0);return void 0===t?o:ia.Compose(ia.Translate(t,n),o,ia.Translate(-t,-n))}static Multiply(e,t){return{a:e.a*t.a+e.c*t.b,c:e.a*t.c+e.c*t.d,e:e.a*t.e+e.c*t.f+e.e,b:e.b*t.a+e.d*t.b,d:e.b*t.c+e.d*t.d,f:e.b*t.e+e.d*t.f+e.f}}static Inverse(e){const t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:e.b/-t,c:e.c/-t,d:e.a/t,e:(e.d*e.e-e.c*e.f)/-t,f:(e.b*e.e-e.a*e.f)/t}}static Absolute(e){const t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:e.b/-t,c:e.c/-t,d:e.a/t,e:(e.d*e.e-e.c*e.f)/t,f:(e.b*e.e-e.a*e.f)/-t}}static Compose(){const e=ia.Identity();for(let t=0,n=arguments.length;t<n;t++)e.multiply(t<0||arguments.length<=t?void 0:arguments[t]);return e}static Point(e){return new Ei(e.e,e.f)}static Rotation(e){let t;if(0!==e.a||0!==e.c){const n=Math.hypot(e.a,e.c);t=Math.acos(e.a/n)*(e.c>0?-1:1)}else if(0!==e.b||0!==e.d){const n=Math.hypot(e.b,e.d);t=Li+Math.acos(e.b/n)*(e.d>0?-1:1)}else t=0;return Yi(t)}static Decompose(e){let t,n,r;if(0!==e.a||0!==e.c){const i=Math.hypot(e.a,e.c);t=i,n=(e.a*e.d-e.b*e.c)/i,r=Math.acos(e.a/i)*(e.c>0?-1:1)}else if(0!==e.b||0!==e.d){const i=Math.hypot(e.b,e.d);t=(e.a*e.d-e.b*e.c)/i,n=i,r=Li+Math.acos(e.b/i)*(e.d>0?-1:1)}else t=0,n=0,r=0;return{x:e.e,y:e.f,scaleX:t,scaleY:n,rotation:Yi(r)}}static Smooth(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e10;return e.a=Math.round(e.a*t)/t,e.b=Math.round(e.b*t)/t,e.c=Math.round(e.c*t)/t,e.d=Math.round(e.d*t)/t,e.e=Math.round(e.e*t)/t,e.f=Math.round(e.f*t)/t,e}static toCssString(e){return"matrix(".concat(no(e.a),", ").concat(no(e.b),", ").concat(no(e.c),", ").concat(no(e.d),", ").concat(no(e.e),", ").concat(no(e.f),")")}static applyToPoint(e,t){return new Ei(e.a*t.x+e.c*t.y+e.e,e.b*t.x+e.d*t.y+e.f,t.z)}static applyToXY(e,t,n){return[e.a*t+e.c*n+e.e,e.b*t+e.d*n+e.f]}static applyToPoints(e,t){return t.map((t=>new Ei(e.a*t.x+e.c*t.y+e.e,e.b*t.x+e.d*t.y+e.f,t.z)))}static applyToBounds(e,t){return new Ti(e.e+t.minX,e.f+t.minY,t.width,t.height)}static From(e){return new ia(e.a,e.b,e.c,e.d,e.e,e.f)}static Cast(e){return e instanceof ia?e:ia.From(e)}}na=ia,s(ia,"Scale",((e,t,n,r)=>{const i=new na(e,0,0,0,t,0);return void 0===n?i:na.Compose(na.Translate(n,r),i,na.Translate(-n,-r))}));const oa=W((function(e){let{showStroke:n=!0,showVertices:r=!0,showClosestPointOnOutline:i=!0}=e;const o=di();!function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const[n,r]=(0,t.useState)(0),i=di();(0,t.useEffect)((()=>{if(!e)return;const t=()=>r((e=>e+1));return i.on("tick",t),()=>{i.off("tick",t)}}),[i,e])}(i);const{zoomLevel:s,renderingShapes:a,inputs:{currentPagePoint:l}}=o;return(0,Zr.jsx)("svg",{style:{position:"absolute",pointerEvents:"none",zIndex:999999999,top:0,left:0,overflow:"visible"},children:a.map((e=>{const t=o.getShape(e.id);if("group"===t.type)return null;const a=o.getShapeGeometry(t),c=o.getShapePageTransform(t),u=o.getPointInShapeSpace(t,l),d=a.nearestPoint(u),h=a.distanceToPoint(u,!0),p=Math.abs(h)*s,f=h<0,{vertices:g}=a;return(0,Zr.jsxs)("g",{transform:c.toCssString(),strokeLinecap:"round",strokeLinejoin:"round",children:[n&&(0,Zr.jsx)("path",{stroke:"red",strokeWidth:"2",fill:"none",opacity:"1",d:a.toSimpleSvgPath()}),r&&g.map(((e,t)=>(0,Zr.jsx)("circle",{cx:e.x,cy:e.y,r:"2",fill:"hsl(".concat(he(t,[0,g.length-1],[120,200]),", 100%, 50%)"),stroke:"black",strokeWidth:"1"},"v".concat(t)))),i&&p<150&&(0,Zr.jsx)("line",{x1:d.x,y1:d.y,x2:u.x,y2:u.y,opacity:1-p/150,stroke:f?"goldenrod":"dodgerblue",strokeWidth:"2"})]},e.id+"_outline")}))})}));var sa=n(9409);function aa(e){return sa(e)}function la(e){const n=di(),r=(0,t.useMemo)((()=>n.store.query.records("instance_presence",(()=>({userId:{eq:e}})))),[n,e]),i=q("latestPresence:".concat(e),(()=>r.value.slice().sort(((e,t)=>t.lastActivityTimestamp-e.lastActivityTimestamp))[0]),[]);return null!==i&&void 0!==i?i:null}const ca=W((function(){const e=function(){const e=di(),n=(0,t.useMemo)((()=>e.store.query.records("instance_presence",(()=>({userId:{neq:e.user.id}})))),[e]),r=$("userIds",(()=>aa(n.value.map((e=>e.userId))).sort()),{isEqual:(e,t)=>{var n;return e.join(",")===(null===(n=t.join)||void 0===n?void 0:n.call(t,","))}},[n]);return q(r)}();return(0,Zr.jsx)(Zr.Fragment,{children:e.map((e=>(0,Zr.jsx)(ua,{collaboratorId:e},e)))})})),ua=W((function(e){let{collaboratorId:n}=e;const r=di(),i=la(n),o=function(e){var n;const r=(0,t.useRef)(null!==(n=null===e||void 0===e?void 0:e.lastActivityTimestamp)&&void 0!==n?n:-1),[i,o]=(0,t.useState)((()=>ha(Date.now()-r.current)));(0,t.useEffect)((()=>{const e=setInterval((()=>{o(ha(Date.now()-r.current))}),1200);return()=>clearInterval(e)}),[]),e&&(r.current=e.lastActivityTimestamp);return i}(i);if(!i||i.currentPageId!==r.currentPageId)return null;switch(o){case"inactive":{const{followingUserId:e,highlightedUserIds:t}=r.instanceState;if(e!==i.userId&&!t.includes(i.userId))return null;break}case"idle":{const{highlightedUserIds:e}=r.instanceState;if(i.followingUserId===r.user.id&&!i.chatMessage&&!e.includes(i.userId))return null;break}}return(0,Zr.jsx)(da,{latestPresence:i})})),da=W((function(e){let{latestPresence:t}=e;const n=di(),{CollaboratorBrush:r,CollaboratorScribble:i,CollaboratorCursor:o,CollaboratorHint:s,CollaboratorShapeIndicator:a}=Vo(),{viewportPageBounds:l,zoomLevel:c}=n,{userId:u,chatMessage:d,brush:h,scribbles:p,selectedShapeIds:f,userName:g,cursor:m,color:y}=t,v=!(m.x<l.minX-12/c||m.y<l.minY-16/c||m.x>l.maxX-12/c||m.y>l.maxY-16/c);return(0,Zr.jsxs)(Zr.Fragment,{children:[h&&r?(0,Zr.jsx)(r,{className:"tl-collaborator__brush",brush:h,color:y,opacity:.1},u+"_brush"):null,v&&o?(0,Zr.jsx)(o,{className:"tl-collaborator__cursor",point:m,color:y,zoom:c,name:"New User"!==g?g:null,chatMessage:d},u+"_cursor"):s?(0,Zr.jsx)(s,{className:"tl-collaborator__cursor-hint",point:m,color:y,zoom:c,viewport:l},u+"_cursor_hint"):null,i&&p.length?(0,Zr.jsx)(Zr.Fragment,{children:p.map((e=>(0,Zr.jsx)(i,{className:"tl-collaborator__scribble",scribble:e,color:y,zoom:c,opacity:"laser"===e.color?.5:.1},u+"_scribble_"+e.id)))}):null,a&&f.map((e=>(0,Zr.jsx)(a,{className:"tl-collaborator__shape-indicator",id:e,color:y,opacity:.5},u+"_"+e)))]})}));function ha(e){return e>ko?"inactive":e>_o?"idle":"active"}function pa(e,t){return 0===t?e:pa(t,e%t)}function fa(e){const t=e.toString().split(".")[1];if(!t)return 1;const n=Math.pow(10,t.length);return n/pa(parseInt(t,10),n)}const ga=W((function(e){let{id:n,shape:r,util:i,index:o,backgroundIndex:s,opacity:a,isCulled:l}=e;const c=di(),{ShapeErrorFallback:u}=Vo(),d=t.useRef(null),h=t.useRef(null),p=t.useCallback(((e,t)=>{var n,r;null===(n=d.current)||void 0===n||n.style.setProperty(e,t),null===(r=h.current)||void 0===r||r.style.setProperty(e,t)}),[]);Y("set shape container transform position",(()=>{if(!c.getShape(n))return;const e=c.getShapePageTransform(n),t=ia.toCssString(e);p("transform",t)}),[c,p]),Y("set shape container clip path",(()=>{if(!c.getShape(n))return null;const e=c.getShapeClipPath(n);p("clip-path",null!==e&&void 0!==e?e:"none")}),[c,p]),Y("set shape height and width",(()=>{const e=c.getShape(n);if(!e)return null;const t=c.getShapeGeometry(e).bounds,r=fa(Math.floor(100*c.instanceState.devicePixelRatio)/100),i=t.w%r,o=0===i?t.w:t.w+(r-i),s=t.h%r,a=0===s?t.h:t.h+(r-s);p("width",Math.max(o,r)+"px"),p("height",Math.max(a,r)+"px")}),[c]),t.useLayoutEffect((()=>{var e,t;p("opacity",a+""),null===(e=d.current)||void 0===e||e.style.setProperty("z-index",o+""),null===(t=h.current)||void 0===t||t.style.setProperty("z-index",s+"")}),[a,o,s,p]);const f=t.useCallback((e=>{c.annotateError(e,{origin:"react.shape",willCrashApp:!1})}),[c]);return r?(0,Zr.jsxs)(Zr.Fragment,{children:[i.backgroundComponent&&(0,Zr.jsx)("div",{ref:h,className:"tl-shape tl-shape-background","data-shape-type":r.type,draggable:!1,children:!l&&(0,Zr.jsx)(bi,{fallback:u,onError:f,children:(0,Zr.jsx)(ya,{shape:r,util:i})})}),(0,Zr.jsx)("div",{ref:d,className:"tl-shape","data-shape-type":r.type,draggable:!1,children:l?(0,Zr.jsx)(va,{shape:r}):(0,Zr.jsx)(bi,{fallback:u,onError:f,children:(0,Zr.jsx)(ma,{shape:r,util:i})})})]}):null})),ma=t.memo((function(e){let{shape:t,util:n}=e;return U("InnerShape:"+t.type,(()=>n.component(t)))}),((e,t)=>e.shape.props===t.shape.props&&e.shape.meta===t.shape.meta)),ya=t.memo((function(e){let{shape:t,util:n}=e;return U("InnerShape:"+t.type,(()=>{var e;return null===(e=n.backgroundComponent)||void 0===e?void 0:e.call(n,t)}))}),((e,t)=>e.shape.props===t.shape.props&&e.shape.meta===t.shape.meta)),va=t.memo((function(e){let{shape:t}=e;const n=di().getShapeGeometry(t).bounds;return(0,Zr.jsx)("div",{className:"tl-shape__culled",style:{transform:"translate(".concat(no(n.minX),"px, ").concat(no(n.minY),"px)"),width:Math.max(1,no(n.width)),height:Math.max(1,no(n.height))}})}),(()=>!0));function ba(e){let{className:n}=e;const r=di(),{Background:i,SvgDefs:o}=Vo(),s=t.useRef(null),a=t.useRef(null),l=t.useRef(null);!function(){const e=di();(0,t.useLayoutEffect)((()=>{const t=ra((()=>{e.updateViewportScreenBounds()}),200,{trailing:!0});e.updateViewportScreenBounds();const n=setInterval(t,1e3);return window.addEventListener("resize",t),window.addEventListener("scroll",t),()=>{clearInterval(n),window.removeEventListener("resize",t),window.removeEventListener("scroll",t)}}),[e])}(),function(){const e=di(),n=fi(),r=q("isFocused",(()=>e.instanceState.isFocused),[e]);(0,t.useEffect)((()=>{if(void 0===typeof matchMedia)return;let t=null;const n=()=>{null!=t&&t();const r="(resolution: ".concat(window.devicePixelRatio,"dppx)"),i=matchMedia(r),o=e=>{"change"===e.type&&n()};i.addEventListener?i.addEventListener("change",n):i.addListener&&i.addListener(o),t=()=>{i.removeEventListener?i.removeEventListener("change",n):i.removeListener&&i.removeListener(o)},e.updateInstanceState({devicePixelRatio:window.devicePixelRatio})};return n(),()=>{var e;null===(e=t)||void 0===e||e()}}),[e]),(0,t.useEffect)((()=>{if(!r)return;const t=t=>{if(!t.altKey||!e.isIn("zoom")&&e.root.path.value.endsWith(".idle")||mi()||oi(t),t.isKilled)return;switch(t.isKilled=!0,t.key){case"=":case"-":case"0":if(t.metaKey||t.ctrlKey)return void oi(t);break;case"Tab":default:if(mi()||e.isMenuOpen)return;break;case",":if(!mi()&&(oi(t),!e.inputs.keys.has("Comma"))){const{x:n,y:r,z:i}=e.inputs.currentScreenPoint;e.inputs.keys.add("Comma");const o={type:"pointer",name:"pointer_down",point:{x:n,y:r,z:i},shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey,pointerId:0,button:0,isPen:e.instanceState.isPenMode,target:"canvas"};return void e.dispatch(o)}break;case"Escape":if((e.editingShape||e.selectedShapeIds.length>0)&&t.preventDefault(),e.openMenus.length>0)return;return void(e.inputs.keys.has("Escape")||(e.inputs.keys.add("Escape"),e.cancel(),n.focus()))}const r={type:"keyboard",name:t.repeat?"key_repeat":"key_down",key:t.key,code:t.code,shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey};e.dispatch(r)},i=t=>{if(t.isKilled)return;if(t.isKilled=!0,mi()||e.isMenuOpen)return;var n;if(","===t.key&&(null!==(n=document.activeElement)&&void 0!==n&&n.ELEMENT_NODE&&oi(t),e.inputs.keys.has(t.code))){const{x:n,y:r,z:i}=e.inputs.currentScreenPoint;e.inputs.keys.delete(t.code);const o={type:"pointer",name:"pointer_up",point:{x:n,y:r,z:i},shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey,pointerId:0,button:0,isPen:e.instanceState.isPenMode,target:"canvas"};return void e.dispatch(o)}const r={type:"keyboard",name:"key_up",key:t.key,code:t.code,shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey};e.dispatch(r)};function o(t){if(n.contains(t.target)){const n=t.touches[0].pageX,o=t.touches[0].radiusX||0;var r,i;if(n-o<10||n+o>e.viewportScreenBounds.width-10)"BUTTON"===(null===(r=t.target)||void 0===r?void 0:r.tagName)&&(null===(i=t.target)||void 0===i||i.click()),oi(t)}}const s=e=>{n.contains(e.target)&&(e.ctrlKey||e.metaKey)&&oi(e)};return n.addEventListener("touchstart",o,{passive:!1}),n.addEventListener("wheel",s,{passive:!1}),document.addEventListener("gesturestart",oi),document.addEventListener("gesturechange",oi),document.addEventListener("gestureend",oi),n.addEventListener("keydown",t),n.addEventListener("keyup",i),()=>{n.removeEventListener("touchstart",o),n.removeEventListener("wheel",s),document.removeEventListener("gesturestart",oi),document.removeEventListener("gesturechange",oi),document.removeEventListener("gestureend",oi),n.removeEventListener("keydown",t),n.removeEventListener("keyup",i)}}),[e,n,r])}(),function(){const e=di();(0,t.useEffect)((()=>{if(!e.environment.isFirefox||e.environment.isAndroid||e.environment.isIos){if(window.matchMedia){const t=window.matchMedia("(pointer: coarse)"),n=()=>{e.updateInstanceState({isCoarsePointer:!!t.matches})};if(n(),t)return t.addEventListener("change",n),()=>t.removeEventListener("change",n)}}else e.updateInstanceState({isCoarsePointer:!1})}),[e])}(),ea(s),function(e){const n=di();(0,t.useEffect)((()=>{const t=e.current;if(!t)return;const r=e=>{if(e instanceof PointerEvent&&"pen"===e.pointerType){var t;e.isKilled=!0;const{target:r}=e;if(Ko.includes(null===(t=r.tagName)||void 0===t?void 0:t.toLocaleLowerCase())||n.isIn("select.editing_shape"))return;oi(e)}};return t.addEventListener("touchstart",r),t.addEventListener("touchend",r),()=>{t.removeEventListener("touchstart",r),t.addEventListener("touchend",r)}}),[n,e])}(s),Y("position layers",(()=>{const e=a.current;if(!e)return;const t=l.current;if(!t)return;const{x:n,y:i,z:o}=r.camera,s=o>=1?he(o,[1,8],[.125,.5],!0):he(o,[.1,1],[-2,.125],!0),c="scale(".concat(no(o),") translate(").concat(no(n+s),"px,").concat(no(i+s),"px)");e.style.setProperty("transform",c),t.style.setProperty("transform",c)}),[r]);const c=function(){const e=di();return(0,t.useMemo)((function(){let t,n;return{onPointerDown:function(t){t.isKilled||(2!==t.button?0!==t.button&&1!==t.button&&5!==t.button||(si(t.currentTarget,t),e.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...ci(t)}),e.openMenus.length>0&&(e.updateInstanceState({openMenus:[]}),document.body.click(),e.getContainer().focus())):e.dispatch({type:"pointer",target:"canvas",name:"right_click",...ci(t)}))},onPointerMove:function(r){r.isKilled||r.clientX===t&&r.clientY===n||(t=r.clientX,n=r.clientY,e.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...ci(r)}))},onPointerUp:function(r){r.isKilled||0!==r.button&&1!==r.button&&2!==r.button&&5!==r.button||(t=r.clientX,n=r.clientY,ai(r.currentTarget,r),e.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...ci(r)}))},onPointerEnter:function(t){if(t.isKilled)return;if(e.instanceState.isPenMode&&"pen"!==t.pointerType)return;const n="mouse"===t.pointerType||"pen"===t.pointerType;e.updateInstanceState({isHoveringCanvas:!!n||null})},onPointerLeave:function(t){if(t.isKilled)return;if(e.instanceState.isPenMode&&"pen"!==t.pointerType)return;const n="mouse"===t.pointerType||"pen"===t.pointerType;e.updateInstanceState({isHoveringCanvas:!n&&null})},onDragOver:function(e){oi(e)},onDrop:async function(t){var n;if(oi(t),null===(n=t.dataTransfer)||void 0===n||null===(n=n.files)||void 0===n||!n.length)return;const r=Array.from(t.dataTransfer.files);await e.putExternalContent({type:"files",files:r,point:e.screenToPage({x:t.clientX,y:t.clientY}),ignoreParent:!1})},onTouchStart:function(e){e.isKilled=!0,document.body.click(),oi(e)},onTouchEnd:function(e){e.isKilled=!0,"A"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&oi(e)},onClick:function(e){li(e)}}}),[e])}(),u=q("shapeSvgDefs",(()=>{const e=new Map;for(const t of ye(r.shapeUtils)){if(!t)return;const n=t.getCanvasSvgDefs();for(const{key:t,component:r}of n)e.has(t)||e.set(t,(0,Zr.jsx)(r,{},t))}return[...e.values()]}),[r]),d=q("debug_shapes",(()=>ti.hideShapes.value),[ti]),h=q("debug_svg",(()=>ti.debugSvg.value),[ti]),p=q("debug_geometry",(()=>ti.debugGeometry.value),[ti]);return(0,Zr.jsxs)("div",{ref:s,draggable:!1,className:Jr("tl-canvas",n),"data-testid":"canvas",...c,children:[i&&(0,Zr.jsx)(i,{}),(0,Zr.jsx)(wa,{}),(0,Zr.jsx)(Na,{}),(0,Zr.jsx)("svg",{className:"tl-svg-context",children:(0,Zr.jsxs)("defs",{children:[u,Oa&&(0,Zr.jsx)(Oa,{}),(0,Zr.jsx)(La,{}),(0,Zr.jsx)(za,{}),(0,Zr.jsx)(Ra,{}),o&&(0,Zr.jsx)(o,{})]})}),(0,Zr.jsxs)("div",{ref:a,className:"tl-html-layer tl-shapes",draggable:!1,children:[(0,Zr.jsx)(Ua,{}),(0,Zr.jsx)(Ba,{}),d?null:h?(0,Zr.jsx)(Ia,{}):(0,Zr.jsx)(Ma,{})]}),(0,Zr.jsxs)("div",{className:"tl-fixed-layer tl-overlays",children:[(0,Zr.jsxs)("div",{ref:l,className:"tl-html-layer",children:[p?(0,Zr.jsx)(oa,{}):null,(0,Zr.jsx)(Ca,{}),(0,Zr.jsx)(Sa,{}),(0,Zr.jsx)(xa,{}),(0,Zr.jsx)(ka,{}),(0,Zr.jsx)(Ta,{}),(0,Zr.jsx)(Aa,{}),(0,Zr.jsx)(ja,{}),(0,Zr.jsx)(_a,{}),(0,Zr.jsx)(Fa,{}),(0,Zr.jsx)(ca,{})]}),(0,Zr.jsx)(Ha,{})]})]})}function wa(){const e=di(),t=q("gridSize",(()=>e.documentSettings.gridSize),[e]),{x:n,y:r,z:i}=q("camera",(()=>e.camera),[e]),o=q("isGridMode",(()=>e.instanceState.isGridMode),[e]),{Grid:s}=Vo();return s&&o?(0,Zr.jsx)(s,{x:n,y:r,z:i,size:t}):null}function xa(){const e=di(),t=q("scribbles",(()=>e.instanceState.scribbles),[e]),n=q("zoomLevel",(()=>e.zoomLevel),[e]),{Scribble:r}=Vo();return r&&t.length?(0,Zr.jsx)(Zr.Fragment,{children:t.map((e=>(0,Zr.jsx)(r,{className:"tl-user-scribble",scribble:e,zoom:n},e.id)))}):null}function Sa(){const e=di(),t=q("brush",(()=>e.instanceState.brush),[e]),{Brush:n}=Vo();return n&&t?(0,Zr.jsx)(n,{className:"tl-user-brush",brush:t}):null}function ka(){const e=di(),t=q("zoomBrush",(()=>e.instanceState.zoomBrush),[e]),{ZoomBrush:n}=Vo();return n&&t?(0,Zr.jsx)(n,{className:"tl-user-brush",brush:t}):null}function _a(){const e=di(),t=q("snapLines",(()=>e.snaps.lines),[e]),n=q("zoomLevel",(()=>e.zoomLevel),[e]),{SnapLine:r}=Vo();return r&&t.length>0?(0,Zr.jsx)(Zr.Fragment,{children:t.map((e=>(0,Zr.jsx)(r,{className:"tl-user-snapline",line:e,zoom:n},e.id)))}):null}const Pa=48;function Ca(){const e=di(),{Handles:t}=Vo(),n=q("zoomLevel",(()=>e.zoomLevel),[e]),r=q("coarse pointer",(()=>e.instanceState.isCoarsePointer),[e]),i=q("onlySelectedShape",(()=>e.onlySelectedShape),[e]),o=q("isChangingStyle",(()=>e.instanceState.isChangingStyle),[e]),s=q("isChangingStyle",(()=>e.instanceState.isReadonly),[e]),a=q("handles",(()=>e.onlySelectedShape?e.getShapeHandles(e.onlySelectedShape):void 0),[e]),l=q("transform",(()=>e.onlySelectedShape?e.getShapePageTransform(e.onlySelectedShape):void 0),[e]);if(!t||!i||o||s)return null;if(!a)return null;if(!l)return null;const c=[];for(let u=0,d=a[u];u<a.length;u++,d=a[u]){if("vertex"!==d.type){const e=a[u-1],t=a[u+1];if(e&&t&&Math.hypot(e.y-t.y,e.x-t.x)<Pa/n)continue}c.push(d)}return c.sort((e=>"vertex"===e.type?1:-1)),(0,Zr.jsx)(t,{children:(0,Zr.jsx)("g",{transform:ia.toCssString(l),children:c.map((e=>(0,Zr.jsx)(Ea,{shapeId:i.id,handle:e,zoom:n,isCoarse:r},e.id)))})})}function Ea(e){let{shapeId:n,handle:r,zoom:i,isCoarse:o}=e;const s=function(e,n){const r=di();return t.useMemo((()=>{let t,i;return{onPointerDown:t=>{if(t.isKilled)return;si(ii(t.currentTarget),t);const{shape:i,handle:o}=ta(r,e,n);o&&r.dispatch({type:"pointer",target:"handle",handle:o,shape:i,name:"pointer_down",...ci(t)})},onPointerMove:o=>{if(o.isKilled)return;if(o.clientX===t&&o.clientY===i)return;t=o.clientX,i=o.clientY;const{shape:s,handle:a}=ta(r,e,n);a&&r.dispatch({type:"pointer",target:"handle",handle:a,shape:s,name:"pointer_move",...ci(o)})},onPointerUp:t=>{if(t.isKilled)return;ai(ii(t.currentTarget),t);const{shape:i,handle:o}=ta(r,e,n);o&&r.dispatch({type:"pointer",target:"handle",handle:o,shape:i,name:"pointer_up",...ci(t)})}}}),[r,e,n])}(n,r.id),{Handle:a}=Vo();return a?(0,Zr.jsx)("g",{"aria-label":"handle",transform:"translate(".concat(r.x,", ").concat(r.y,")"),...s,children:(0,Zr.jsx)(a,{shapeId:n,handle:r,zoom:i,isCoarse:o})}):null}function Ia(){const e=di(),n=q("rendering shapes",(()=>e.renderingShapes),[e]);return(0,Zr.jsx)(Zr.Fragment,{children:n.map((e=>(0,Zr.jsxs)(t.Fragment,{children:[(0,Zr.jsx)(ga,{...e}),(0,Zr.jsx)(Da,{id:e.id})]},e.id+"_fragment")))})}function Ma(){const e=di(),t=q("rendering shapes",(()=>e.renderingShapes),[e]);return(0,Zr.jsx)(Zr.Fragment,{children:t.map((e=>(0,Zr.jsx)(ga,{...e},e.id+"_shape")))})}function Ta(){const e=di(),t=q("selectedShapeIds",(()=>e.currentPageState.selectedShapeIds),[e]);return q("should display selected ids",(()=>e.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle")&&!e.instanceState.isChangingStyle),[e])?(0,Zr.jsx)(Zr.Fragment,{children:t.map((e=>(0,Zr.jsx)(ki,{className:"tl-user-indicator__selected",id:e},e+"_indicator")))}):null}const Aa=function(){const e=di(),{HoveredShapeIndicator:t}=Vo(),n=q("coarse pointer",(()=>e.instanceState.isCoarsePointer),[e]),r=q("hovering canvas",(()=>e.instanceState.isHoveringCanvas),[e]),i=q("hovered id",(()=>e.currentPageState.hoveredShapeId),[e]);return!n&&r&&i&&t?(0,Zr.jsx)(t,{shapeId:i}):null},ja=W((function(){const e=X(di().hintingShapeIds);return e.length?(0,Zr.jsx)(Zr.Fragment,{children:e.map((e=>(0,Zr.jsx)(ki,{className:"tl-user-indicator__hint",id:e},e+"_hinting")))}):null}));function Oa(){return(0,Zr.jsxs)("g",{id:"cursor",children:[(0,Zr.jsxs)("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[(0,Zr.jsx)("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),(0,Zr.jsx)("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),(0,Zr.jsxs)("g",{fill:"white",transform:"translate(-12,-12)",children:[(0,Zr.jsx)("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),(0,Zr.jsx)("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),(0,Zr.jsxs)("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[(0,Zr.jsx)("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),(0,Zr.jsx)("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function La(){return(0,Zr.jsx)("path",{id:"cursor_hint",fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function za(){return(0,Zr.jsx)("marker",{id:"arrowhead-dot",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:(0,Zr.jsx)("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function Ra(){return(0,Zr.jsxs)("marker",{id:"arrowhead-cross",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[(0,Zr.jsx)("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),(0,Zr.jsx)("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}const Da=W((function(e){let{id:n}=e;const r=di(),i=r.getShape(n),[o,s]=t.useState(""),a=(null===i||void 0===i?void 0:i.parentId)===r.currentPageId;return t.useEffect((()=>{if(!a)return;let e=null;const t=B("shape to svg",(async()=>{const t=Math.random();e=t;const i=r.getShapePageBounds(n),o=await r.getSvg([n],{padding:0});o&&i&&e===t&&(o.style.setProperty("overflow","visible"),o.setAttribute("preserveAspectRatio","xMidYMin slice"),o.style.setProperty("transform","translate(".concat(i.x,"px, ").concat(i.y+i.h+12,"px)")),o.style.setProperty("border","1px solid black"),s(null===o||void 0===o?void 0:o.outerHTML))}));return()=>{e=null,t()}}),[r,n,a]),a?(0,Zr.jsx)("div",{style:{paddingTop:12,position:"absolute"},children:(0,Zr.jsx)("div",{style:{display:"flex"},dangerouslySetInnerHTML:{__html:o}})}):null}));function Na(){const e=q("debugging ui log",(()=>ti.logMessages.value),[ti]);return e.length?(0,Zr.jsx)("div",{className:"debug__ui-logger",children:e.map(((e,t)=>{const n="string"===typeof e?e:JSON.stringify(e);return(0,Zr.jsx)("div",{className:"debug__ui-logger__line",children:n},t)}))}):null}function Fa(){const e=di(),t=q("selection rotation",(()=>e.selectionRotation),[e]),n=q("selection bounds",(()=>e.selectionRotatedPageBounds),[e]),{SelectionForeground:r}=Vo();return n&&r?(0,Zr.jsx)(r,{bounds:n,rotation:t}):null}function Ba(){const e=di(),t=q("selection rotation",(()=>e.selectionRotation),[e]),n=q("selection bounds",(()=>e.selectionRotatedPageBounds),[e]),{SelectionBackground:r}=Vo();return n&&r?(0,Zr.jsx)(r,{bounds:n,rotation:t}):null}function Ua(){const{OnTheCanvas:e}=Vo();return e?(0,Zr.jsx)(e,{}):null}function Ha(){const{InFrontOfTheCanvas:e}=Vo();return e?(0,Zr.jsx)(e,{}):null}function Va(){return je()}const Ka="TLDRAW_USER_DATA_v3",Wa=gt({id:it,name:it.nullable().optional(),locale:it.nullable().optional(),color:it.nullable().optional(),isDarkMode:dt.nullable().optional(),animationSpeed:ot.nullable().optional(),isSnapMode:dt.nullable().optional()}),$a=3,Ya=Ve({currentVersion:$a,migrators:{[1]:{up:e=>({...e,animationSpeed:1}),down:e=>{let{animationSpeed:t,...n}=e;return n}},[2]:{up:e=>({...e,isSnapMode:!1}),down:e=>{let{isSnapMode:t,...n}=e;return n}},[$a]:{up:e=>e,down:e=>{var t,n,r,i,o,s;return{id:e.id,name:null!==(t=e.name)&&void 0!==t?t:Ga.name,locale:null!==(n=e.locale)&&void 0!==n?n:Ga.locale,color:null!==(r=e.color)&&void 0!==r?r:Ga.color,isDarkMode:null!==(i=e.isDarkMode)&&void 0!==i?i:Ga.isDarkMode,animationSpeed:null!==(o=e.animationSpeed)&&void 0!==o?o:Ga.animationSpeed,isSnapMode:null!==(s=e.isSnapMode)&&void 0!==s?s:Ga.isSnapMode}}}}}),qa=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"];const Ga=Object.freeze({name:"New User",locale:function(){var e;return function(e){for(const t of e){const e=Qr(t);if(e)return e}return"en"}("undefined"!==typeof window&&null!==(e=window.navigator.languages)&&void 0!==e?e:["en"])}(),color:qa[Math.floor(Math.random()*qa.length)],isDarkMode:!1,animationSpeed:function(){var e,t,n;return"undefined"!==typeof window&&(null!==(e=null===(t=(n=window).matchMedia)||void 0===t||null===(t=t.call(n,"(prefers-reduced-motion: reduce)"))||void 0===t?void 0:t.matches)&&void 0!==e&&e)}()?0:1,isSnapMode:!1});function Xa(){return{id:Va()}}function Qa(e){var t;if(null===e||"object"!==typeof e)return Xa();if(!("version"in e)||!("user"in e)||"number"!==typeof e.version)return Xa();const n=$e({value:e.user,fromVersion:e.version,toVersion:null!==(t=Ya.currentVersion)&&void 0!==t?t:0,migrations:Ya});if("error"===n.type)return Xa();try{Wa.validate(n.value)}catch(ZI){return Xa()}return n.value}const Za=A("globalUserData",function(){var e,t;return Qa("undefined"===typeof window?null:null!==(e=JSON.parse((null===(t=window)||void 0===t||null===(t=t.localStorage)||void 0===t?void 0:t.getItem(Ka))||"null"))&&void 0!==e?e:null)}());function Ja(e){Wa.validate(e),Za.set(e),"undefined"!==typeof window&&window.localStorage&&window.localStorage.setItem(Ka,JSON.stringify({version:Ya.currentVersion,user:Za.value})),null===tl||void 0===tl||tl.postMessage({type:rl,origin:nl,data:{user:Za.value,version:Ya.currentVersion}})}const el="undefined"!==typeof process&&!1,tl="undefined"===typeof BroadcastChannel||el?null:new BroadcastChannel("tldraw-user-sync");null===tl||void 0===tl||tl.addEventListener("message",(e=>{const t=e.data;(null===t||void 0===t?void 0:t.type)===rl&&(null===t||void 0===t?void 0:t.origin)!==nl&&Za.set(Qa(t.data))}));const nl=Va(),rl="tldraw-user-preferences-change";function il(){var e,t,n;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{derivePresenceState:null!==(e=r.derivePresenceState)&&void 0!==e?e:()=>N("presence",(()=>null)),userPreferences:null!==(t=r.userPreferences)&&void 0!==t?t:N("userPreferences",(()=>Za.value)),setUserPreferences:null!==(n=r.setUserPreferences)&&void 0!==n?n:Ja}}var ol=n(7143);function sl(e){let{children:t,className:n="",...r}=e;return(0,Zr.jsx)("svg",{...r,className:"tl-svg-container ".concat(n),children:t})}class al{constructor(e){var t,n;s(this,"isFilled",!1),s(this,"isClosed",!0),s(this,"isLabel",!1),s(this,"isSnappable",!0),s(this,"_vertices",void 0),s(this,"_bounds",void 0),s(this,"_snapPoints",void 0),s(this,"_area",void 0),this.isFilled=e.isFilled,this.isClosed=e.isClosed,this.isSnappable=null!==(t=e.isSnappable)&&void 0!==t&&t,this.isLabel=null!==(n=e.isLabel)&&void 0!==n&&n}hitTestPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.distanceToPoint(e,n)<=t}distanceToPoint(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=e.dist(this.nearestPoint(e));return this.isClosed&&(this.isFilled||t)&&to(e,this.vertices)?-n:n}distanceToLineSegment(e,t){const n=this.nearestPointOnLineSegment(e,t),r=Ei.DistanceToLineSegment(e,t,n);return this.isClosed&&this.isFilled&&to(n,this.vertices)?-r:r}hitTestLineSegment(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.distanceToLineSegment(e,t)<=n}nearestPointOnLineSegment(e,t){let n,r=1/0;for(let i=0;i<this.vertices.length;i++){const o=this.vertices[i],s=Ei.DistanceToLineSegment(e,t,o);s<r&&(r=s,n=o)}if(!n)throw Error("nearest point not found");return n}isPointInBounds(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{bounds:n}=this;return!(e.x<n.minX-t||e.y<n.minY-t||e.x>n.maxX+t||e.y>n.maxY+t)}get vertices(){return this._vertices||(this._vertices=this.getVertices()),this._vertices}getBounds(){return Ti.FromPoints(this.vertices)}get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}get snapPoints(){return this._snapPoints||(this._snapPoints=this.bounds.snapPoints),this._snapPoints}get center(){return this.bounds.center}get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;const{vertices:e}=this;let t=0;for(let n=0,r=e.length;n<r;n++){const i=e[n],o=e[(n+1)%r];t+=i.x*o.y-o.x*i.y}return t/2}toSimpleSvgPath(){let e="";const{vertices:t}=this,n=t.length;if(0===n)return e;e+="M".concat(t[0].x,",").concat(t[0].y);for(let r=1;r<n;r++)e+="L".concat(t[r].x,",").concat(t[r].y);return this.isClosed&&(e+="Z"),e}}class ll extends al{constructor(e){super({...e,isClosed:!0,isFilled:!1}),s(this,"children",void 0);const{children:t}=e;if(0===t.length)throw Error("Group2d must have at least one child");this.children=t}getVertices(){return this.children.filter((e=>!e.isLabel)).flatMap((e=>e.vertices))}nearestPoint(e){let t,n=1/0;const{children:r}=this;if(0===r.length)throw Error("no children");for(const i of r){const r=i.nearestPoint(e),o=r.dist(e);o<n&&(n=o,t=r)}if(!t)throw Error("nearest point not found");return t}distanceToPoint(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Math.min(...this.children.map(((n,r)=>n.distanceToPoint(e,t||r>0))))}hitTestPoint(e,t,n){return!!this.children.filter((e=>!e.isLabel)).find((r=>r.hitTestPoint(e,t,n)))}hitTestLineSegment(e,t,n){return!!this.children.filter((e=>!e.isLabel)).find((r=>r.hitTestLineSegment(e,t,n)))}getArea(){return this.children[0].area}toSimpleSvgPath(){let e="";for(const n of this.children)e+=n.toSimpleSvgPath();const t=Ti.FromPoints(this.vertices).corners;for(let n=0,r=t.length;n<r;n++){const i=t[n],o=t[(n-1+r)%r],s=i.dist(o),a=t[(n+1)%r],l=i.dist(a),c=i.clone().lrp(o,4/s),u=i,d=i.clone().lrp(a,4/l);e+="M".concat(c.x,",").concat(c.y," L").concat(u.x,",").concat(u.y," L").concat(d.x,",").concat(d.y," ")}return e}}function cl(e,t,n,r){const i=e.x-n.x,o=e.y-n.y,s=r.x-n.x,a=r.y-n.y,l=t.x-e.x,c=t.y-e.y,u=s*o-a*i,d=l*o-c*i,h=a*l-s*c;if(0===u||0===d)return null;if(0===h)return null;if(0!==h){const t=u/h,n=d/h;if(0<=t&&t<=1&&0<=n&&n<=1)return Ei.AddXY(e,t*l,t*c)}return null}function ul(e,t,n,r){const i=(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y),o=2*((t.x-e.x)*(e.x-n.x)+(t.y-e.y)*(e.y-n.y)),s=o*o-4*i*(n.x*n.x+n.y*n.y+e.x*e.x+e.y*e.y-2*(n.x*e.x+n.y*e.y)-r*r);if(s<0)return null;if(0===s)return null;const a=Math.sqrt(s),l=(-o+a)/(2*i),c=(-o-a)/(2*i);if((l<0||l>1)&&(c<0||c>1))return null;const u=[];return 0<=l&&l<=1&&u.push(Ei.Lrp(e,t,l)),0<=c&&c<=1&&u.push(Ei.Lrp(e,t,c)),0===u.length?null:u}function dl(e,t,n){const r=[];let i;for(let o=0,s=n.length-1;o<s;o++)i=cl(e,t,n[o],n[o+1]),i&&r.push(i);return 0===r.length?null:r}function hl(e,t,n){const r=[];let i;for(let o=1,s=n.length;o<s+1;o++)i=cl(e,t,n[o-1],n[o%n.length]),i&&r.push(i);return 0===r.length?null:r}function pl(e,t,n){const r=[];let i,o,s;for(let a=0,l=n.length;a<l;a++)i=n[a],o=n[(a+1)%n.length],s=ul(i,o,e,t),s&&r.push(...s);return 0===r.length?null:r}function fl(e,t,n){const r=[];let i,o,s;for(let a=1,l=n.length;a<l;a++)i=n[a-1],o=n[a],s=ul(i,o,e,t),s&&r.push(...s);return 0===r.length?null:r}function gl(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function ml(e,t,n,r){return gl(e,n,r)!==gl(t,n,r)&&gl(e,t,n)!==gl(e,t,r)}function yl(e,t){const n=[];let r,i,o,s;for(let a=0,l=e.length;a<l;a++)r=e[a],to(r,t)&&n.push(r);for(let a=0,l=t.length;a<l;a++)r=t[a],to(r,e)&&n.push(r);for(let a=0,l=e.length;a<l;a++){r=e[a],i=e[(a+1)%e.length];for(let e=0,a=t.length;e<a;e++){o=t[e],s=t[(e+1)%t.length];const a=cl(r,i,o,s);null!==a&&n.push(a)}}return 0===n.length?null:function(e){const t=Ei.Average(e);return e.sort(((e,n)=>Ei.Angle(t,e)-Ei.Angle(t,n)))}(n)}class vl extends al{constructor(e){super({...e,isClosed:!1,isFilled:!1}),s(this,"start",void 0),s(this,"end",void 0),s(this,"d",void 0),s(this,"u",void 0),s(this,"ul",void 0),s(this,"_length",void 0);const{start:t,end:n}=e;this.start=t,this.end=n,this.d=t.clone().sub(n),this.u=this.d.clone().uni(),this.ul=this.u.len()}get length(){return this._length?this._length:this.d.len()}midPoint(){return this.start.lrp(this.end,.5)}getVertices(){return[this.start,this.end]}nearestPoint(e){const{start:t,end:n,u:r,ul:i}=this;if(0===i)return t;const o=Ei.Sub(e,t).dpr(r)/i,s=t.x+r.x*o;if(s<Math.min(t.x,n.x))return t.x<n.x?t:n;if(s>Math.max(t.x,n.x))return t.x>n.x?t:n;const a=t.y+r.y*o;return a<Math.min(t.y,n.y)?t.y<n.y?t:n:a>Math.max(t.y,n.y)?t.y>n.y?t:n:new Ei(s,a)}hitTestLineSegment(e,t,n){return ml(e,t,this.start,this.end)}}class bl extends al{constructor(e){super({isClosed:!1,isFilled:!1,...e}),s(this,"points",void 0),s(this,"_segments",void 0),s(this,"_length",void 0);const{points:t}=e;this.points=t}get segments(){if(!this._segments){this._segments=[];const{vertices:e}=this;for(let t=0,n=e.length-1;t<n;t++){const n=e[t],r=e[t+1];this._segments.push(new vl({start:n,end:r}))}this.isClosed&&this._segments.push(new vl({start:e[e.length-1],end:e[0]}))}return this._segments}get length(){return this._length||(this._length=this.segments.reduce(((e,t)=>e+t.length),0)),this._length}getVertices(){return this.points}nearestPoint(e){const{segments:t}=this;let n,r,i=this.points[0],o=1/0;for(let s=0;s<t.length;s++)n=t[s].nearestPoint(e),r=n.dist(e),r<o&&(i=n,o=r);return i}hitTestLineSegment(e,t,n){return this.segments.some((r=>r.hitTestLineSegment(e,t,n)))}}class wl extends bl{constructor(e){super({...e}),this.isClosed=!0}}class xl extends wl{constructor(e){const{x:t=0,y:n=0,width:r,height:i}=e;super({...e,points:[new Ei(t,n),new Ei(t+r,n),new Ei(t+r,n+i),new Ei(t,n+i)]}),s(this,"x",void 0),s(this,"y",void 0),s(this,"w",void 0),s(this,"h",void 0),this.x=t,this.y=n,this.w=r,this.h=i}getBounds(){return new Ti(this.x,this.y,this.w,this.h)}}class Sl{constructor(e){s(this,"canSnap",(()=>!0)),s(this,"canScroll",(()=>!1)),s(this,"canUnmount",(()=>!0)),s(this,"canBind",((e,t)=>!0)),s(this,"canEdit",(()=>!1)),s(this,"canResize",(()=>!0)),s(this,"canEditInReadOnly",(()=>!1)),s(this,"canCrop",(()=>!1)),s(this,"hideResizeHandles",(()=>!1)),s(this,"hideRotateHandle",(()=>!1)),s(this,"hideSelectionBoundsBg",(()=>!1)),s(this,"hideSelectionBoundsFg",(()=>!1)),s(this,"isAspectRatioLocked",(()=>!1)),s(this,"onBeforeCreate",void 0),s(this,"onBeforeUpdate",void 0),s(this,"onDragShapesOver",void 0),s(this,"onDragShapesOut",void 0),s(this,"onDropShapesOver",void 0),s(this,"onResizeStart",void 0),s(this,"onResize",void 0),s(this,"onResizeEnd",void 0),s(this,"onTranslateStart",void 0),s(this,"onTranslate",void 0),s(this,"onTranslateEnd",void 0),s(this,"onRotateStart",void 0),s(this,"onRotate",void 0),s(this,"onRotateEnd",void 0),s(this,"onHandleChange",void 0),s(this,"onBindingChange",void 0),s(this,"onChildrenChange",void 0),s(this,"onDoubleClickHandle",void 0),s(this,"onDoubleClickEdge",void 0),s(this,"onDoubleClick",void 0),s(this,"onClick",void 0),s(this,"onEditEnd",void 0),this.editor=e}providesBackgroundForChildren(e){return!1}getOutlineSegments(e){return[this.editor.getShapeGeometry(e).vertices]}canReceiveNewChildrenOfType(e,t){return!1}canDropShapes(e,t){return!1}expandSelectionOutlinePx(e){return 0}getCanvasSvgDefs(){return[]}}function kl(e){let{bounds:t,className:n}=e;const r=di(),i=q("zoom level",(()=>r.zoomLevel),[r]);return(0,Zr.jsx)("g",{className:n,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:t.sides.map(((e,t)=>{const{strokeDasharray:n,strokeDashoffset:r}=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{closed:r=!1,snap:i=1,start:o="outset",end:s="outset",lengthRatio:a=2,style:l="dashed"}=n;let c=0,u=0,d=1,h=0,p=0;switch(l){case"dashed":d=1,c=Math.min(t*a,e/4);break;case"dotted":d=100,c=t/d;break;default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||("outset"===o?(e+=c/2,p+=c/2):"skip"===o&&(e-=c,p-=c),"outset"===s?e+=c/2:"skip"===s&&(e-=c)),u=Math.floor(e/c/(2*d)),u-=u%i,u<3&&"dashed"===l?e/t<5?(c=e,u=1,h=0):(c=.333*e,h=.333*e):(u=Math.max(u,3),c=e/u/(2*d),r?(p=c/2,h=(e-u*c)/u):h=(e-u*c)/Math.max(1,u-1)),{strokeDasharray:[c,h].join(" "),strokeDashoffset:p.toString()}}(e[0].dist(e[1]),1/i,{style:"dashed",lengthRatio:4});return(0,Zr.jsx)("line",{x1:e[0].x,y1:e[0].y,x2:e[1].x,y2:e[1].y,strokeDasharray:n,strokeDashoffset:r},t)}))})}s(Sl,"props",void 0),s(Sl,"migrations",void 0),s(Sl,"type",void 0);class _l extends Sl{constructor(){super(...arguments),s(this,"hideSelectionBoundsFg",(()=>!0)),s(this,"canBind",(()=>!1)),s(this,"onChildrenChange",(e=>{const t=this.editor.getSortedChildIdsForParent(e.id);return 0===t.length?(this.editor.currentPageState.focusedGroupId===e.id&&this.editor.popFocusedGroupId(),void this.editor.deleteShapes([e.id])):1===t.length?(this.editor.currentPageState.focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.reparentShapes(t,e.parentId),void this.editor.deleteShapes([e.id])):void 0}))}getDefaultProps(){return{}}getGeometry(e){const t=this.editor.getSortedChildIdsForParent(e.id);return 0===t.length?new xl({width:1,height:1,isFilled:!1}):new ll({children:t.map((e=>{const t=this.editor.getShape(e),n=this.editor.getShapeGeometry(e),r=this.editor.getShapeLocalTransform(t).applyToPoints(n.vertices);return n.isClosed?new wl({points:r,isFilled:!0}):new bl({points:r})}))})}component(e){const t=this.editor.erasingShapeIds.includes(e.id),{hintingShapeIds:n}=this.editor.currentPageState,r=n.length>0&&n.some((t=>t!==e.id&&this.editor.isShapeOfType(this.editor.getShape(t),"group"))),i=this.editor.currentPageState.focusedGroupId!==e.id;if(!t&&(i||r))return null;const o=this.editor.getShapeGeometry(e).bounds;return(0,Zr.jsx)(sl,{id:e.id,children:(0,Zr.jsx)(kl,{className:"tl-group",bounds:o})})}indicator(e){const t=this.editor.getShapeGeometry(e).bounds;return(0,Zr.jsx)(kl,{className:"",bounds:t})}}s(_l,"type","group"),s(_l,"props",{}),s(_l,"migrations",Ir);const Pl=[_l],Cl=new Set(Pl.map((e=>e.type)));function El(e){const t=[...Pl],n=new Set;for(const r of e){if(Cl.has(r.type))throw new Error('Shape type "'.concat(r.type,'" is a core shapes type and cannot be overridden'));if(n.has(r.type))throw new Error('Shape type "'.concat(r.type,'" is defined more than once'));t.push(r),n.add(r.type)}return t}let Il;function Ml(e,t){if(!t)return!1;switch(e.type){case"mixed":return"mixed"===t.type;case"shared":return"shared"===t.type&&e.value===t.value;default:throw ee(e)}}Il=Symbol.iterator;class Tl{constructor(e){s(this,"map",void 0),this.map=new Map(e)}get(e){return this.map.get(e)}getAsKnownValue(e){const t=this.get(e);if(t&&"mixed"!==t.type)return t.value}get size(){return this.map.size}equals(e){if(this.size!==e.size)return!1;const t=new Set;for(const[n,r]of this){if(!Ml(r,e.get(n)))return!1;t.add(n)}for(const[n,r]of e)if(!t.has(n)&&!Ml(r,this.get(n)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Il](){return this.map[Symbol.iterator]()}}class Al extends Tl{set(e,t){this.map.set(e,t)}applyValue(e,t){const n=this.get(e);if(n)switch(n.type){case"mixed":return;case"shared":return void(n.value!==t&&this.set(e,{type:"mixed"}));default:ee(n,"type")}else this.set(e,{type:"shared",value:t})}}class jl{constructor(){s(this,"items",new WeakMap)}get(e,t){return this.items.has(e)||this.items.set(e,t(e)),this.items.get(e)}access(e){return this.items.get(e)}set(e,t){this.items.set(e,t)}has(e){return this.items.has(e)}invalidate(e){this.items.delete(e)}bust(){this.items=new WeakMap}}const Ol="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",Ll="a0",zl="A00000000000000000000000000";function Rl(e){if(e>="a"&&e<="z")return e.charCodeAt(0)-"a".charCodeAt(0)+2;if(e>="A"&&e<="Z")return"Z".charCodeAt(0)-e.charCodeAt(0)+2;throw new Error("Invalid index key head: "+e)}function Dl(e){if(e.length!==Rl(e.charAt(0)))throw new Error("invalid integer part of index key: "+e)}function Nl(e){if(void 0===e)throw Error("n is undefined")}function Fl(e){Dl(e);const[t,...n]=e.split("");let r=!0;for(let i=n.length-1;r&&i>=0;i--){const e=Ol.indexOf(n[i])+1;e===Ol.length?n[i]="0":(n[i]=Ol.charAt(e),r=!1)}if(r){if("Z"===t)return"a0";if("z"===t)return;const e=String.fromCharCode(t.charCodeAt(0)+1);return e>"a"?n.push("0"):n.pop(),e+n.join("")}return t+n.join("")}function Bl(e,t){if(void 0!==t&&e>=t)throw new Error(e+" >= "+t);if("0"===e.slice(-1)||t&&"0"===t.slice(-1))throw new Error("trailing zero");if(t){let n=0;for(;(e.charAt(n)||"0")===t.charAt(n);)n++;if(n>0)return t.slice(0,n)+Bl(e.slice(n),t.slice(n))}const n=e?Ol.indexOf(e.charAt(0)):0,r=void 0!==t?Ol.indexOf(t.charAt(0)):Ol.length;if(r-n>1){const e=Math.round(.5*(n+r));return Ol.charAt(e)}return t&&t.length>1?t.slice(0,1):Ol.charAt(n)+Bl(e.slice(1),void 0)}function Ul(e){const t=Rl(e.charAt(0));if(t>e.length)throw new Error("invalid index: "+e);return e.slice(0,t)}function Hl(e){if(e===zl)throw new Error("invalid index: "+e);const t=Ul(e);if("0"===e.slice(t.length).slice(-1))throw new Error("invalid index: "+e)}function Vl(e,t){if(void 0!==e&&Hl(e),void 0!==t&&Hl(t),void 0!==e&&void 0!==t&&e>=t)throw new Error(e+" >= "+t);if(void 0===e&&void 0===t)return Ll;if(void 0===e){if(void 0===t)throw Error("b is undefined");const e=Ul(t),n=t.slice(e.length);if(e===zl)return e+Bl("",n);if(e<t)return e;const r=function(e){Dl(e);const[t,...n]=e.split("");let r=!0;for(let i=n.length-1;r&&i>=0;i--){const e=Ol.indexOf(n[i])-1;-1===e?n[i]=Ol.slice(-1):(n[i]=Ol.charAt(e),r=!1)}if(r){if("a"===t)return"Z"+Ol.slice(-1);if("A"===t)return;const e=String.fromCharCode(t.charCodeAt(0)-1);return e<"Z"?n.push(Ol.slice(-1)):n.pop(),e+n.join("")}return t+n.join("")}(e);return Nl(r),r}if(void 0===t){const t=Ul(e),n=e.slice(t.length),r=Fl(t);return void 0===r?t+Bl(n,void 0):r}const n=Ul(e),r=e.slice(n.length),i=Ul(t),o=t.slice(i.length);if(n===i)return n+Bl(r,o);const s=Fl(n);return Nl(s),s<t?s:n+Bl(r,void 0)}function Kl(e,t,n){if(0===n)return[];if(1===n)return[Vl(e,t)];if(void 0===t){let r=Vl(e,t);const i=[r];for(let e=0;e<n-1;e++)r=Vl(r,t),i.push(r);return i}if(void 0===e){let r=Vl(e,t);const i=[r];for(let t=0;t<n-1;t++)r=Vl(e,r),i.push(r);return i.reverse(),i}const r=Math.floor(n/2),i=Vl(e,t);return[...Kl(e,i,r),i,...Kl(i,t,n-r-1)]}function Wl(e,t,n){return Kl(e,t,n)}function $l(e,t){return Kl(e,void 0,t)}function Yl(e,t){return Kl(e,t,1)[0]}function ql(e){return Kl(e,void 0,1)[0]}function Gl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"a1";return[t,...Kl(t,void 0,e)]}function Xl(e,t){return e.index<t.index?-1:e.index>t.index?1:0}function Ql(e,t,n){if(0===n.length)return[];const r=new Map;for(const o of Q(n.map((t=>e.getShape(t))))){const{parentId:t}=o;r.has(t)||r.set(t,{children:Q(e.getSortedChildIdsForParent(t).map((t=>e.getShape(t)))),moving:new Set}),r.get(t).moving.add(o)}const i=[];switch(t){case"toBack":r.forEach((e=>{let{moving:t,children:n}=e;return function(e,t,n){const r=t.length;if(e.size===r)return;let i,o;for(let s=0;s<r;s++){const n=t[s];if(!e.has(n)){o=n.index;break}i=n.index,e.delete(n)}if(0===e.size)return;{const t=Wl(i,o,e.size);n.push(...Array.from(e.values()).sort(Xl).map(((e,n)=>({...e,index:t[n]}))))}}(t,n,i)}));break;case"toFront":r.forEach((e=>{let{moving:t,children:n}=e;return function(e,t,n){const r=t.length;if(e.size===r)return;let i,o;for(let s=r-1;s>-1;s--){const n=t[s];if(!e.has(n)){i=n.index;break}o=n.index,e.delete(n)}if(0===e.size)return;{const t=Wl(i,o,e.size);n.push(...Array.from(e.values()).sort(Xl).map(((e,n)=>({...e,index:t[n]}))))}}(t,n,i)}));break;case"forward":r.forEach((e=>{let{moving:t,children:n}=e;return function(e,t,n){const r=t.length;if(e.size===r)return;let i={name:"skipping"};for(let s=0;s<r;s++){const r=e.has(t[s]);switch(i.name){case"skipping":if(!r)continue;i={name:"selecting",selectIndex:s};break;case"selecting":{var o;if(r)continue;const{selectIndex:e}=i;Wl(t[s].index,null===(o=t[s+1])||void 0===o?void 0:o.index,s-e).forEach(((r,i)=>n.push({...t[e+i],index:r}))),i={name:"skipping"};break}}}}(t,n,i)}));break;case"backward":r.forEach((e=>{let{moving:t,children:n}=e;return function(e,t,n){const r=t.length;if(e.size===r)return;let i={name:"skipping"};for(let s=r-1;s>-1;s--){const r=e.has(t[s]);switch(i.name){case"skipping":if(!r)continue;i={name:"selecting",selectIndex:s};break;case"selecting":var o;if(r)continue;Wl(null===(o=t[s-1])||void 0===o?void 0:o.index,t[s].index,i.selectIndex-s).forEach(((e,r)=>{n.push({...t[s+r+1],index:e})})),i={name:"skipping"}}}}(t,n,i)}))}return i}function Zl(e){let{editor:t}=e;const{selectionRotation:n,selectionRotatedPageBounds:r,inputs:{originPagePoint:i},selectedShapes:o}=t;if(!r)return null;const s=r.center.clone().rotWith(r.point,n);return{selectionPageCenter:s,initialCursorAngle:s.angle(i),initialSelectionRotation:n,shapeSnapshots:o.map((e=>({shape:Ae(e),initialPagePoint:t.getShapePageTransform(e.id).point()})))}}function Jl(e){let{delta:t,editor:n,snapshot:r,stage:i}=e;const{selectionPageCenter:o,shapeSnapshots:s}=r;n.updateShapes(s.map((e=>{let{shape:r,initialPagePoint:i}=e;const s=Rn(r.parentId)?n.getShapePageTransform(r.parentId):ia.Identity(),a=Ei.RotWith(i,o,t),l=ia.applyToPoint(ia.Inverse(s),a),c=Hi(r.rotation+t);return{id:r.id,type:r.type,x:l.x,y:l.y,rotation:c}})));const a=[];s.forEach((e=>{var t;let{shape:r}=e;const o=n.getShape(r.id);if(!o)return;const s=n.getShapeUtil(r);if("start"===i||"one-off"===i){var l;const e=null===(l=s.onRotateStart)||void 0===l?void 0:l.call(s,r);e&&a.push(e)}const c=null===(t=s.onRotate)||void 0===t?void 0:t.call(s,r,o);if(c&&a.push(c),"end"===i||"one-off"===i){var u;const e=null===(u=s.onRotateEnd)||void 0===u?void 0:u.call(s,r,o);e&&a.push(e)}})),a.length>0&&n.updateShapes(a)}const ec=(e,t,n)=>{for(;!Kt(n.parentId);){const t=e.get(n.parentId);if(!t)return!1;n=t}return n.parentId===t};class tc{constructor(e){var t=this;s(this,"_clickId",""),s(this,"_clickTimeout",void 0),s(this,"_clickScreenPoint",void 0),s(this,"_previousScreenPoint",void 0),s(this,"_getClickTimeout",(function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Va();t._clickId=n,clearTimeout(t._clickTimeout),t._clickTimeout=setTimeout((()=>{if(t._clickState===e&&t._clickId===n){switch(t._clickState){case"pendingTriple":t.editor.dispatch({...t.lastPointerInfo,type:"click",name:"double_click",phase:"settle"});break;case"pendingQuadruple":t.editor.dispatch({...t.lastPointerInfo,type:"click",name:"triple_click",phase:"settle"});break;case"pendingOverflow":t.editor.dispatch({...t.lastPointerInfo,type:"click",name:"quadruple_click",phase:"settle"})}t._clickState="idle"}}),"idle"===e||"pendingDouble"===e?450:200)})),s(this,"_clickState","idle"),s(this,"lastPointerInfo",{}),s(this,"transformPointerDownEvent",(e=>{if(!this._clickState)return e;switch(this._clickScreenPoint=Ei.From(e.point),this._previousScreenPoint&&this._previousScreenPoint.dist(this._clickScreenPoint)>40&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=e,this._clickState){case"idle":return this._clickState="pendingDouble",this._clickTimeout=this._getClickTimeout(this._clickState),e;case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"double_click",phase:"down"};case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"triple_click",phase:"down"};case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"quadruple_click",phase:"down"};case"pendingOverflow":return this._clickState="overflow",this._clickTimeout=this._getClickTimeout(this._clickState),e;default:return this._clickTimeout=this._getClickTimeout(this._clickState),e}})),s(this,"transformPointerUpEvent",(e=>{if(!this._clickState)return e;switch(this._clickScreenPoint=Ei.From(e.point),this._clickState){case"pendingTriple":return{...this.lastPointerInfo,type:"click",name:"double_click",phase:"up"};case"pendingQuadruple":return{...this.lastPointerInfo,type:"click",name:"triple_click",phase:"up"};case"pendingOverflow":return{...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"up"};default:return e}})),s(this,"cancelDoubleClickTimeout",(()=>{this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"})),s(this,"handleMove",(()=>{"idle"!==this._clickState&&this._clickScreenPoint&&this._clickScreenPoint.dist(this.editor.inputs.currentScreenPoint)>(this.editor.instanceState.isCoarsePointer?6:4)&&this.cancelDoubleClickTimeout()})),this.editor=e}get clickState(){return this._clickState}}class nc{constructor(e){s(this,"isSafari",void 0),s(this,"isIos",void 0),s(this,"isChromeForIos",void 0),s(this,"isFirefox",void 0),s(this,"isAndroid",void 0),this.editor=e,"undefined"!==typeof window&&"navigator"in window?(this.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this.isIos=!!navigator.userAgent.match(/iPad/i)||!!navigator.userAgent.match(/iPhone/i),this.isChromeForIos=/crios.*safari/i.test(navigator.userAgent),this.isFirefox=/firefox/i.test(navigator.userAgent),this.isAndroid=/android/i.test(navigator.userAgent)):(this.isSafari=!1,this.isIos=!1,this.isChromeForIos=!1,this.isFirefox=!1,this.isAndroid=!1)}}let rc,ic;function oc(e){if(e){let t=sc;for(;e.length;)t=t.push(e.pop());return t}return sc}rc=Symbol.iterator;const sc=new class{constructor(){s(this,"length",0),s(this,"head",null),s(this,"tail",this)}push(e){return new ac(e,this)}toArray(){return p}[rc](){return{next:()=>({value:void 0,done:!0})}}};ic=Symbol.iterator;class ac{constructor(e,t){s(this,"length",void 0),this.head=e,this.tail=t,this.length=t.length+1}push(e){return new ac(e,this)}toArray(){return Array.from(this)}[ic](){let e=this;return{next(){if(e.length){const t=e.head;return e=e.tail,{value:t,done:!1}}return{value:void 0,done:!0}}}}}class lc{constructor(e,t){var n=this;s(this,"_undos",A("HistoryManager.undos",oc())),s(this,"_redos",A("HistoryManager.redos",oc())),s(this,"_batchDepth",0),s(this,"onBatchComplete",(()=>{})),s(this,"_commands",{}),s(this,"createCommand",((e,t,r)=>{if(this._commands[e])throw new Error("Duplicate command: ".concat(e));this._commands[e]=r;const i=function(){for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];if(!n._batchDepth)return n.batch((()=>i(...s))),n.ctx;const l=t(...s);if(!l)return n.ctx;const{data:c,ephemeral:u,squashing:d,preservesRedoStack:h}=l;if(n.ignoringUpdates(((e,t)=>(r.do(c),{undos:e,redos:t}))),!u){const t=n._undos.value.head;d&&t&&"command"===t.type&&t.name===e&&t.preservesRedoStack===h?n._undos.update((e=>e.tail.push({...t,id:Va(),data:r.squash(t.data,c)}))):n._undos.update((t=>t.push({type:"command",name:e,data:c,id:Va(),preservesRedoStack:h}))),l.preservesRedoStack||n._redos.set(oc()),n.ctx.emit("change-history",{reason:"push"})}return n.ctx};return i})),s(this,"batch",(e=>{try{this._batchDepth++,1===this._batchDepth?M((()=>{var t,n;const r=null===(t=this._undos.value.head)||void 0===t?void 0:t.id;e(),r!==(null===(n=this._undos.value.head)||void 0===n?void 0:n.id)&&this.onBatchComplete()})):e()}catch(t){throw this.annotateError(t),t}finally{this._batchDepth--}return this})),s(this,"ignoringUpdates",(e=>{let t=this._undos.value,n=this._redos.value;this._undos.set(oc()),this._redos.set(oc());try{({undos:t,redos:n}=M((()=>e(t,n))))}finally{this._undos.set(t),this._redos.set(n)}})),s(this,"_undo",(e=>{let{pushToRedoStack:t,toMark:n}=e;return this.ignoringUpdates(((e,r)=>{if(0===e.length)return{undos:e,redos:r};for(;"STOP"===(null===(i=e.head)||void 0===i?void 0:i.type);){var i;const o=e.head;if(e=e.tail,t&&(r=r.push(o)),o.id===n)return this.ctx.emit("change-history",t?{reason:"undo"}:{reason:"bail",markId:n}),{undos:e,redos:r}}if(0===e.length)return this.ctx.emit("change-history",t?{reason:"undo"}:{reason:"bail",markId:n}),{undos:e,redos:r};for(;e.head;){const i=e.head;if(e=e.tail,t&&(r=r.push(i)),"STOP"===i.type){if(i.onUndo&&(!n||i.id===n))return this.ctx.emit("change-history",t?{reason:"undo"}:{reason:"bail",markId:n}),{undos:e,redos:r}}else{this._commands[i.name].undo(i.data)}}return this.ctx.emit("change-history",t?{reason:"undo"}:{reason:"bail",markId:n}),{undos:e,redos:r}})),this})),s(this,"undo",(()=>(this._undo({pushToRedoStack:!0}),this))),s(this,"redo",(()=>(this.ignoringUpdates(((e,t)=>{if(0===t.length)return{undos:e,redos:t};for(;"STOP"===(null===(n=t.head)||void 0===n?void 0:n.type);){var n;e=e.push(t.head),t=t.tail}if(0===t.length)return this.ctx.emit("change-history",{reason:"redo"}),{undos:e,redos:t};for(;t.head;){const n=t.head;if(e=e.push(t.head),t=t.tail,"STOP"===n.type){if(n.onRedo)break}else{const e=this._commands[n.name];e.redo?e.redo(n.data):e.do(n.data)}}return this.ctx.emit("change-history",{reason:"redo"}),{undos:e,redos:t}})),this))),s(this,"bail",(()=>(this._undo({pushToRedoStack:!1}),this))),s(this,"bailToMark",(e=>(this._undo({pushToRedoStack:!1,toMark:e}),this))),s(this,"mark",(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Va(),t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=n._undos.value.head;return i&&"STOP"===i.type&&i.id===e&&i.onUndo===t&&i.onRedo===r?i.id:(n._undos.update((n=>n.push({type:"STOP",id:e,onUndo:t,onRedo:r}))),n.ctx.emit("mark-history",{id:e}),e)})),this.ctx=e,this.annotateError=t}get numUndos(){return this._undos.value.length}get numRedos(){return this._redos.value.length}clear(){this._undos.set(oc()),this._redos.set(oc())}}class cc{constructor(e){var t=this;s(this,"scribbleItems",new Map),s(this,"state","paused"),s(this,"addScribble",(function(e){var n;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Va();const i={id:r,scribble:{id:r,size:20,color:"accent",opacity:.8,delay:0,points:[],shrink:.1,taper:!0,...e,state:"starting"},timeoutMs:0,delayRemaining:null!==(n=e.delay)&&void 0!==n?n:0,prev:null,next:null};return t.scribbleItems.set(r,i),"paused"===t.state&&t.resume(),i})),s(this,"stop",(e=>{const t=this.scribbleItems.get(e);if(!t)throw Error("Scribble with id ".concat(e," not found"));return t.delayRemaining=Math.min(t.delayRemaining,200),t.scribble.state="stopping",t})),s(this,"addPoint",((e,t,n)=>{const r=this.scribbleItems.get(e);if(!r)throw Error("Scribble with id ".concat(e," not found"));const{prev:i}=r,o={x:t,y:n,z:.5};return(!i||Ei.Dist(i,o)>=1)&&(r.next=o),r})),s(this,"tick",(e=>{this.editor.batch((()=>{this.scribbleItems.forEach((t=>{if("starting"===t.scribble.state){const{next:e,prev:n}=t;return e&&e!==n&&(t.prev=e,t.scribble.points.push(e)),void(t.scribble.points.length>8&&(t.scribble.state="active"))}t.delayRemaining>0&&(t.delayRemaining=Math.max(0,t.delayRemaining-e)),t.timeoutMs+=e,t.timeoutMs>=16&&(t.timeoutMs=0);const{delayRemaining:n,timeoutMs:r,prev:i,next:o,scribble:s}=t;switch(s.state){case"active":o&&o!==i?(t.prev=o,s.points.push(o),0===n&&s.points.length>8&&s.points.shift()):0===r&&(s.points.length>1?s.points.shift():t.delayRemaining=s.delay);break;case"stopping":if(0===t.delayRemaining&&0===r){if(1===s.points.length)return void this.scribbleItems.delete(t.id);s.shrink&&(s.size=Math.max(1,s.size*(1-s.shrink))),s.points.shift()}}})),this.editor.updateInstanceState({scribbles:Array.from(this.scribbleItems.values()).map((e=>{let{scribble:t}=e;return{...t,points:[...t.points]}})).slice(-5)}),0===this.scribbleItems.size&&this.pause()}))})),this.editor=e}resume(){this.state="running",this.editor.addListener("tick",this.tick)}pause(){this.editor.removeListener("tick",this.tick),this.state="paused"}reset(){this.editor.updateInstanceState({scribbles:[]}),this.scribbleItems.clear(),this.pause()}}class uc{constructor(e){s(this,"_beforeCreateHandlers",{}),s(this,"_afterCreateHandlers",{}),s(this,"_beforeChangeHandlers",{}),s(this,"_afterChangeHandlers",{}),s(this,"_beforeDeleteHandlers",{}),s(this,"_afterDeleteHandlers",{}),s(this,"_batchCompleteHandlers",[]),this.editor=e,e.store.onBeforeCreate=(e,t)=>{const n=this._beforeCreateHandlers[e.typeName];if(n){let r=e;for(const e of n)r=e(r,t);return r}return e},e.store.onAfterCreate=(e,t)=>{const n=this._afterCreateHandlers[e.typeName];if(n)for(const r of n)r(e,t)},e.store.onBeforeChange=(e,t,n)=>{const r=this._beforeChangeHandlers[t.typeName];if(r){let i=t;for(const t of r)i=t(e,i,n);return i}return t};let t=0;e.store.onAfterChange=(e,n,r)=>{if(t++,t>1e3)console.error("[CleanupManager.onAfterChange] Maximum update depth exceeded, bailing out.");else{const t=this._afterChangeHandlers[n.typeName];if(t)for(const i of t)i(e,n,r)}t--},e.store.onBeforeDelete=(e,t)=>{const n=this._beforeDeleteHandlers[e.typeName];if(n)for(const r of n)if(!1===r(e,t))return!1},e.store.onAfterDelete=(e,t)=>{const n=this._afterDeleteHandlers[e.typeName];if(n)for(const r of n)r(e,t)},e.history.onBatchComplete=()=>{this._batchCompleteHandlers.forEach((e=>e()))}}registerBeforeCreateHandler(e,t){return this._beforeCreateHandlers[e]||(this._beforeCreateHandlers[e]=[]),this._beforeCreateHandlers[e].push(t),()=>dc(this._beforeCreateHandlers[e],t)}registerAfterCreateHandler(e,t){return this._afterCreateHandlers[e]||(this._afterCreateHandlers[e]=[]),this._afterCreateHandlers[e].push(t),()=>dc(this._afterCreateHandlers[e],t)}registerBeforeChangeHandler(e,t){return this._beforeChangeHandlers[e]||(this._beforeChangeHandlers[e]=[]),this._beforeChangeHandlers[e].push(t),()=>dc(this._beforeChangeHandlers[e],t)}registerAfterChangeHandler(e,t){return this._afterChangeHandlers[e]||(this._afterChangeHandlers[e]=[]),this._afterChangeHandlers[e].push(t),()=>dc(this._afterChangeHandlers[e],t)}registerBeforeDeleteHandler(e,t){return this._beforeDeleteHandlers[e]||(this._beforeDeleteHandlers[e]=[]),this._beforeDeleteHandlers[e].push(t),()=>dc(this._beforeDeleteHandlers[e],t)}registerAfterDeleteHandler(e,t){return this._afterDeleteHandlers[e]||(this._afterDeleteHandlers[e]=[]),this._afterDeleteHandlers[e].push(t),()=>dc(this._afterDeleteHandlers[e],t)}registerBatchCompleteHandler(e){return this._batchCompleteHandlers.push(e),()=>dc(this._batchCompleteHandlers,e)}}function dc(e,t){const n=e.indexOf(t);n>=0&&e.splice(n,1)}var hc=Object.defineProperty,pc=Object.getOwnPropertyDescriptor,fc=(e,t,n,r)=>{for(var i,o=r>1?void 0:r?pc(t,n):t,s=e.length-1;s>=0;s--)(i=e[s])&&(o=(r?i(t,n,o):i(o))||o);return r&&o&&hc(t,n,o),o};const gc=e=>Math.round(e*10**8)/10**8;function mc(e,t,n,r,i){const o=e.filter((e=>("forward"===r?e.startNode.id===t:e.endNode.id===t)&&gc(e.length)===gc(n)&&Ji(e.breadthIntersection[0],e.breadthIntersection[1],i[0],i[1])));if(0===o.length)return[];const s=new Set;return o.forEach((t=>{const a="forward"===r?t.endNode.id:t.startNode.id;if(!s.has(a)){s.add(a);const l=mc(e,a,n,r,Ji(t.breadthIntersection[0],t.breadthIntersection[1],i[0],i[1]));o.push(...l)}})),o}class yc{constructor(e){s(this,"_snapLines",A("snapLines",void 0)),this.editor=e}get lines(){var e;return null!==(e=this._snapLines.value)&&void 0!==e?e:p}clear(){this.lines.length&&this._snapLines.set(void 0)}setLines(e){this._snapLines.set(e)}get snapPointsCache(){const{editor:e}=this;return e.store.createComputedCache("snapPoints",(t=>{const n=e.getShapePageTransform(t.id);if(!n)return;return this.editor.getShapeGeometry(t).snapPoints.map(((e,r)=>{const{x:i,y:o}=ia.applyToPoint(n,e);return{x:i,y:o,id:"".concat(t.id,":").concat(r)}}))}))}get snapThreshold(){return 8/this.editor.zoomLevel}get snappableShapes(){var e;const{editor:t}=this,{selectedShapeIds:n,renderingBounds:r}=t,i=[],o=e=>{const s=t.getSortedChildIdsForParent(e);for(const a of s){if(n.includes(a))continue;const e=t.getShape(a);if(!e)continue;if(!t.getShapeUtil(e).canSnap(e))continue;const s=t.getShapePageBounds(a);s&&r.includes(s)&&(t.isShapeOfType(e,"group")?o(a):i.push({id:a,pageBounds:s,isClosed:t.getShapeGeometry(e).isClosed}))}};return o(null!==(e=this.currentCommonAncestor)&&void 0!==e?e:t.currentPageId),i}get currentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.selectedShapes)}get snappablePoints(){const{snappableShapes:e,snapPointsCache:t}=this,n=[];return e.forEach((e=>{const r=t.get(e.id);r&&n.push(...r)})),n}get visibleGaps(){const e=[],t=[];let n,r;const i=this.snappableShapes.sort(((e,t)=>e.pageBounds.minX-t.pageBounds.minX));for(let s=0;s<i.length;s++){n=i[s];for(let t=s+1;t<i.length;t++)r=i[t],n.pageBounds.maxX<r.pageBounds.minX&&Zi(n.pageBounds.minY,n.pageBounds.maxY,r.pageBounds.minY,r.pageBounds.maxY)&&e.push({startNode:n,endNode:r,startEdge:[new Ei(n.pageBounds.maxX,n.pageBounds.minY),new Ei(n.pageBounds.maxX,n.pageBounds.maxY)],endEdge:[new Ei(r.pageBounds.minX,r.pageBounds.minY),new Ei(r.pageBounds.minX,r.pageBounds.maxY)],length:r.pageBounds.minX-n.pageBounds.maxX,breadthIntersection:Ji(n.pageBounds.minY,n.pageBounds.maxY,r.pageBounds.minY,r.pageBounds.maxY)})}const o=i.sort(((e,t)=>e.pageBounds.minY-t.pageBounds.minY));for(let s=0;s<o.length;s++){n=o[s];for(let e=s+1;e<o.length;e++)r=o[e],n.pageBounds.maxY<r.pageBounds.minY&&Zi(n.pageBounds.minX,n.pageBounds.maxX,r.pageBounds.minX,r.pageBounds.maxX)&&t.push({startNode:n,endNode:r,startEdge:[new Ei(n.pageBounds.minX,n.pageBounds.maxY),new Ei(n.pageBounds.maxX,n.pageBounds.maxY)],endEdge:[new Ei(r.pageBounds.minX,r.pageBounds.minY),new Ei(r.pageBounds.maxX,r.pageBounds.minY)],length:r.pageBounds.minY-n.pageBounds.maxY,breadthIntersection:Ji(n.pageBounds.minX,n.pageBounds.maxX,r.pageBounds.minX,r.pageBounds.maxX)})}return{horizontal:e,vertical:t}}snapTranslate(e){var t,n,r,i;let{lockedAxis:o,initialSelectionPageBounds:s,initialSelectionSnapPoints:a,dragDelta:l}=e;const{snappablePoints:c,snapThreshold:u}=this,d=s.clone().translate(l),h=a.map(((e,t)=>{let{x:n,y:r}=e;return{id:"selection:"+t,x:n+l.x,y:r+l.y}})),p=c,f=[],g=[],m=new Ei(u,u);this.collectPointSnaps({minOffset:m,nearestSnapsX:f,nearestSnapsY:g,otherNodeSnapPoints:p,selectionSnapPoints:h}),this.collectGapSnaps({selectionPageBounds:d,nearestSnapsX:f,nearestSnapsY:g,minOffset:m});const y=new Ei("x"===o?0:null!==(t=null===(n=f[0])||void 0===n?void 0:n.nudge)&&void 0!==t?t:0,"y"===o?0:null!==(r=null===(i=g[0])||void 0===i?void 0:i.nudge)&&void 0!==r?r:0);m.x=0,m.y=0,f.length=0,g.length=0,h.forEach((e=>{e.x+=y.x,e.y+=y.y})),d.translate(y),this.collectPointSnaps({minOffset:m,nearestSnapsX:f,nearestSnapsY:g,otherNodeSnapPoints:p,selectionSnapPoints:h}),this.collectGapSnaps({selectionPageBounds:d,nearestSnapsX:f,nearestSnapsY:g,minOffset:m});const v=this.getPointSnapLines({nearestSnapsX:f,nearestSnapsY:g}),b=this.getGapSnapLines({selectionPageBounds:d,nearestSnapsX:f,nearestSnapsY:g});return this._snapLines.set([...b,...v]),{nudge:y}}get outlinesInPageSpace(){return this.snappableShapes.map((e=>{let{id:t,isClosed:n}=e;const r=ge(this.editor.getShapeGeometry(t).vertices);n&&r.push(r[0]);const i=this.editor.getShapePageTransform(t);if(!i)throw Error("No page transform");return ia.applyToPoints(i,r)}))}getSnappingHandleDelta(e){let{handlePoint:t,additionalSegments:n}=e;const{outlinesInPageSpace:r,snapThreshold:i}=this;let o,s,a,l,c=i,u=null;const d=[...r,...n];for(const h of d)for(let e=0;e<h.length-1;e++)o=h[e],s=h[e+1],a=Ei.NearestPointOnLineSegment(o,s,t),l=Ei.Dist(t,a),isNaN(l)||l<c&&(c=l,u=a);return u?(this._snapLines.set([{id:Va(),type:"points",points:[u]}]),Ei.Sub(u,t)):null}snapResize(e){var t,n,r,i;let{initialSelectionPageBounds:o,dragDelta:s,handle:a,isAspectRatioLocked:l,isResizingFromCenter:c}=e;const{snapThreshold:u}=this,{box:d,scaleX:h,scaleY:p}=Ti.Resize(o,a,c?2*s.x:s.x,c?2*s.y:s.y,l);let f=a;h<0&&(f=function(e){switch(e){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return e}}(f)),p<0&&(f=function(e){switch(e){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return e}}(f)),c&&(d.center=o.center);const g="top"===f||"bottom"===f,m="left"===f||"right"===f,y=vc(f,d),v=this.snappablePoints,b=[],w=[],x=new Ei(u,u);this.collectPointSnaps({minOffset:x,nearestSnapsX:b,nearestSnapsY:w,otherNodeSnapPoints:v,selectionSnapPoints:y});const S=new Ei(g?0:null!==(t=null===(n=b[0])||void 0===n?void 0:n.nudge)&&void 0!==t?t:0,m?0:null!==(r=null===(i=w[0])||void 0===i?void 0:i.nudge)&&void 0!==r?r:0);if(l&&("top_left"===(k=f)||"top_right"===k||"bottom_right"===k||"bottom_left"===k)&&0!==S.len()){const e=b.length&&w.length?Math.abs(S.x)<Math.abs(S.y)?"x":"y":b.length?"x":"y",t=o.aspectRatio;"x"===e?(w.length=0,S.y=S.x/t,"bottom_left"!==f&&"top_right"!==f||(S.y=-S.y)):(b.length=0,S.x=S.y*t,"bottom_left"!==f&&"top_right"!==f||(S.x=-S.x))}var k;const _=Ei.Add(s,S),{box:P}=Ti.Resize(o,a,c?2*_.x:_.x,c?2*_.y:_.y,l);c&&(P.center=o.center);const C=vc("any",P);b.length=0,w.length=0,x.x=0,x.y=0,this.collectPointSnaps({minOffset:x,nearestSnapsX:b,nearestSnapsY:w,otherNodeSnapPoints:v,selectionSnapPoints:C});const E=this.getPointSnapLines({nearestSnapsX:b,nearestSnapsY:w});return this._snapLines.set([...E]),{nudge:S}}collectPointSnaps(e){let{selectionSnapPoints:t,otherNodeSnapPoints:n,minOffset:r,nearestSnapsX:i,nearestSnapsY:o}=e;for(const s of t)for(const e of n){const t=Ei.Sub(s,e),n=Math.abs(t.x),a=Math.abs(t.y);gc(n)<=gc(r.x)&&(gc(n)<gc(r.x)&&(i.length=0),i.push({type:"points",points:{thisPoint:s,otherPoint:e},nudge:e.x-s.x}),r.x=n),gc(a)<=gc(r.y)&&(gc(a)<gc(r.y)&&(o.length=0),o.push({type:"points",points:{thisPoint:s,otherPoint:e},nudge:e.y-s.y}),r.y=a)}}collectGapSnaps(e){let{selectionPageBounds:t,minOffset:n,nearestSnapsX:r,nearestSnapsY:i}=e;const{horizontal:o,vertical:s}=this.visibleGaps;for(const a of o){if(!Zi(a.breadthIntersection[0],a.breadthIntersection[1],t.minY,t.maxY))continue;const e=a.startEdge[0].x+a.length/2-t.center.x;if(a.length>t.width&&gc(Math.abs(e))<=gc(n.x)){gc(Math.abs(e))<gc(n.x)&&(r.length=0),n.x=Math.abs(e);const t={type:"gap_center",gap:a,nudge:e},i=r.find((e=>{let{type:t}=e;return"gap_center"===t})),o=i&&Ji(a.breadthIntersection[0],a.breadthIntersection[1],i.gap.breadthIntersection[0],i.gap.breadthIntersection[1]);i&&i.gap.length>a.length&&o?r[r.indexOf(i)]=t:i&&o||r.push(t)}const i=a.startNode.pageBounds.minX-a.length-t.maxX;gc(Math.abs(i))<=gc(n.x)&&(gc(Math.abs(i))<gc(n.x)&&(r.length=0),n.x=Math.abs(i),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"left",nudge:i}));const o=a.endNode.pageBounds.maxX+a.length-t.minX;gc(Math.abs(o))<=gc(n.x)&&(gc(Math.abs(o))<gc(n.x)&&(r.length=0),n.x=Math.abs(o),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"right",nudge:o}))}for(const a of s){if(!Zi(a.breadthIntersection[0],a.breadthIntersection[1],t.minX,t.maxX))continue;const e=a.startEdge[0].y+a.length/2-t.center.y;if(a.length>t.height&&gc(Math.abs(e))<=gc(n.y)){gc(Math.abs(e))<gc(n.y)&&(i.length=0),n.y=Math.abs(e);const t={type:"gap_center",gap:a,nudge:e},r=i.find((e=>{let{type:t}=e;return"gap_center"===t})),o=r&&Zi(r.gap.breadthIntersection[0],r.gap.breadthIntersection[1],a.breadthIntersection[0],a.breadthIntersection[1]);r&&r.gap.length>a.length&&o?i[i.indexOf(r)]=t:r&&o||i.push(t);continue}const r=a.startNode.pageBounds.minY-a.length-t.maxY;gc(Math.abs(r))<=gc(n.y)&&(gc(Math.abs(r))<gc(n.y)&&(i.length=0),n.y=Math.abs(r),i.push({type:"gap_duplicate",gap:a,protrusionDirection:"top",nudge:r}));const o=a.endNode.pageBounds.maxY+a.length-t.minY;gc(Math.abs(o))<=gc(n.y)&&(gc(Math.abs(o))<gc(n.y)&&(i.length=0),n.y=Math.abs(o),i.push({type:"gap_duplicate",gap:a,protrusionDirection:"bottom",nudge:o}))}}getPointSnapLines(e){let{nearestSnapsX:t,nearestSnapsY:n}=e;const r={},i={};if(t.length>0)for(const o of t)if("points"===o.type){const e=gc(o.points.otherPoint.x);r[e]||(r[e]=[]),r[e].push(o.points)}if(n.length>0)for(const o of n)if("points"===o.type){const e=gc(o.points.otherPoint.y);i[e]||(i[e]=[]),i[e].push(o.points)}return Object.values(r).concat(Object.values(i)).map((e=>({id:Va(),type:"points",points:X(e.map((e=>Ei.From(e.otherPoint))).concat(e.map((e=>Ei.From(e.thisPoint)))),((e,t)=>e.equals(t)))})))}getGapSnapLines(e){let{selectionPageBounds:t,nearestSnapsX:n,nearestSnapsY:r}=e;const{vertical:i,horizontal:o}=this.visibleGaps,s={top:t.sides[0],right:t.sides[1],bottom:[t.corners[3],t.corners[2]],left:[t.corners[0],t.corners[3]]},a=[];if(n.length>0)for(const l of n){if("points"===l.type)continue;const{gap:{breadthIntersection:e,startEdge:n,startNode:r,endNode:i,length:c,endEdge:u}}=l;switch(l.type){case"gap_center":{const l=(c-t.width)/2,d=Ji(e[0],e[1],t.minY,t.maxY);a.push({type:"gaps",direction:"horizontal",id:Va(),gaps:[...mc(o,r.id,l,"backward",d),{startEdge:n,endEdge:s.left},{startEdge:s.right,endEdge:u},...mc(o,i.id,l,"forward",d)]});break}case"gap_duplicate":{const d=Ji(e[0],e[1],t.minY,t.maxY);a.push({type:"gaps",direction:"horizontal",id:Va(),gaps:"left"===l.protrusionDirection?[{startEdge:s.right,endEdge:n.map((e=>e.clone().addXY(-r.pageBounds.width,0)))},{startEdge:n,endEdge:u},...mc(o,i.id,c,"forward",d)]:[...mc(o,r.id,c,"backward",d),{startEdge:n,endEdge:u},{startEdge:u.map((e=>e.clone().addXY(l.gap.endNode.pageBounds.width,0))),endEdge:s.left}]});break}}}if(r.length>0)for(const l of r){if("points"===l.type)continue;const{gap:{breadthIntersection:e,startEdge:n,startNode:r,endNode:o,length:c,endEdge:u}}=l;switch(l.type){case"gap_center":{const o=(c-t.height)/2,d=Ji(e[0],e[1],t.minX,t.maxX);a.push({type:"gaps",direction:"vertical",id:Va(),gaps:[...mc(i,r.id,o,"backward",d),{startEdge:n,endEdge:s.top},{startEdge:s.bottom,endEdge:u},...mc(i,l.gap.endNode.id,o,"forward",d)]});break}case"gap_duplicate":{const d=Ji(e[0],e[1],t.minX,t.maxX);a.push({type:"gaps",direction:"vertical",id:Va(),gaps:"top"===l.protrusionDirection?[{startEdge:s.bottom,endEdge:n.map((e=>e.clone().addXY(0,-r.pageBounds.height)))},{startEdge:n,endEdge:u},...mc(i,o.id,c,"forward",d)]:[...mc(i,r.id,c,"backward",d),{startEdge:n,endEdge:u},{startEdge:u.map((e=>e.clone().addXY(0,o.pageBounds.height))),endEdge:s.top}]})}}}return function(e){e.sort(((e,t)=>t.gaps.length-e.gaps.length));for(let t=e.length-1;t>0;t--){const n=e[t];for(let r=t-1;r>=0;r--){const i=e[r];if(i.direction===n.direction&&n.gaps.every((e=>i.gaps.some((t=>gc(e.startEdge[0].x)===gc(t.startEdge[0].x)&&gc(e.startEdge[0].y)===gc(t.startEdge[0].y)&&gc(e.startEdge[1].x)===gc(t.startEdge[1].x)&&gc(e.startEdge[1].y)===gc(t.startEdge[1].y)))&&i.gaps.some((t=>gc(e.endEdge[0].x)===gc(t.endEdge[0].x)&&gc(e.endEdge[0].y)===gc(t.endEdge[0].y)&&gc(e.endEdge[1].x)===gc(t.endEdge[1].x)&&gc(e.endEdge[1].y)===gc(t.endEdge[1].y)))))){e.splice(t,1);break}}}}(a),a}}function vc(e,t){const{minX:n,maxX:r,minY:i,maxY:o}=t,s=[];switch(e){case"top":case"left":case"top_left":case"any":s.push({id:"top_left",handle:"top_left",x:n,y:i})}switch(e){case"top":case"right":case"top_right":case"any":s.push({id:"top_right",handle:"top_right",x:r,y:i})}switch(e){case"bottom":case"right":case"bottom_right":case"any":s.push({id:"bottom_right",handle:"bottom_right",x:r,y:o})}switch(e){case"bottom":case"left":case"bottom_left":case"any":s.push({id:"bottom_left",handle:"bottom_left",x:n,y:o})}return s}fc([N],yc.prototype,"snapPointsCache",1),fc([N],yc.prototype,"snapThreshold",1),fc([N],yc.prototype,"snappableShapes",1),fc([N],yc.prototype,"currentCommonAncestor",1),fc([N],yc.prototype,"snappablePoints",1),fc([N],yc.prototype,"visibleGaps",1),fc([N],yc.prototype,"outlinesInPageSpace",1);const bc=/\r?\n|\r/g;function wc(e){return e.replace(bc,"\n").split("\n").map((e=>e||" ")).join("\n")}const xc={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},Sc=/\s/;class kc{constructor(e){s(this,"measureText",((e,t)=>{var n;const r=this.getTextElement();r.setAttribute("dir","ltr"),r.style.setProperty("font-family",t.fontFamily),r.style.setProperty("font-style",t.fontStyle),r.style.setProperty("font-weight",t.fontWeight),r.style.setProperty("font-size",t.fontSize+"px"),r.style.setProperty("line-height",t.lineHeight*t.fontSize+"px"),r.style.setProperty("max-width",null===t.maxWidth?null:t.maxWidth+"px"),r.style.setProperty("min-width",null!==(n=t.minWidth)&&void 0!==n?n:null),r.style.setProperty("padding",t.padding),r.textContent=wc(e);const i=r.getBoundingClientRect();return{x:0,y:0,w:i.width,h:i.height}})),this.editor=e}getTextElement(){const e=document.querySelector(".tl-text-measure");null===e||void 0===e||e.remove();const t=document.createElement("div");return this.editor.getContainer().appendChild(t),t.id="__textMeasure_".concat(Va()),t.classList.add("tl-text"),t.classList.add("tl-text-measure"),t.tabIndex=-1,t}measureElementTextNodeSpans(e){let{shouldTruncateToFirstLine:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=[],r=e.getBoundingClientRect(),i=-r.left,o=-r.top,s=new Range,a=e.childNodes[0];let l=0,c=null,u=null,d=0,h=!1;for(const f of e.childNodes)if(f.nodeType===Node.TEXT_NODE)for(const e of null!==(p=f.textContent)&&void 0!==p?p:""){var p;s.setStart(a,l),s.setEnd(a,l+e.length);const r=s.getClientRects(),f=r[r.length-1],g=f.top+o,m=f.left+i,y=f.right+i,v=Sc.test(e);if(v===u&&g===d&&c)c.box.w=y-c.box.x,c.text+=e;else{if(c){if(t&&g!==d){h=!0;break}n.push(c)}c={box:{x:m,y:g,w:f.width,h:f.height},text:e}}u=v,d=g,l+=e.length}return c&&n.push(c),{spans:n,didTruncate:h}}measureTextSpans(e,t){if(""===e)return[];const n="truncate-ellipsis"===t.overflow||"truncate-clip"===t.overflow,r=this.getTextElement(),i=Math.ceil(t.width-2*t.padding);r.style.setProperty("width","".concat(i,"px")),r.style.setProperty("height","min-content"),r.style.setProperty("dir","ltr"),r.style.setProperty("font-size","".concat(t.fontSize,"px")),r.style.setProperty("font-family",t.fontFamily),r.style.setProperty("font-weight",t.fontWeight),r.style.setProperty("line-height","".concat(t.lineHeight*t.fontSize,"px")),r.style.setProperty("text-align",xc[t.textAlign]),n&&(r.style.setProperty("overflow-wrap","anywhere"),r.style.setProperty("word-break","break-all")),e=wc(e),r.textContent=e;const{spans:o,didTruncate:s}=this.measureElementTextNodeSpans(r,{shouldTruncateToFirstLine:n});if("truncate-ellipsis"===t.overflow&&s){r.textContent="\u2026";const n=Math.ceil(this.measureElementTextNodeSpans(r).spans[0].box.w);r.style.setProperty("width","".concat(i-n,"px")),r.textContent=e;const o=this.measureElementTextNodeSpans(r,{shouldTruncateToFirstLine:!0}).spans,s=o[o.length-1];return o.push({text:"\u2026",box:{x:Math.min(s.box.x+s.box.w,t.width-t.padding-n),y:s.box.y,w:n,h:s.box.h}}),o}return r.remove(),o}}class _c{constructor(e){s(this,"raf",void 0),s(this,"isPaused",!0),s(this,"last",0),s(this,"t",0),s(this,"start",(()=>{this.isPaused=!1,cancelAnimationFrame(this.raf),this.raf=requestAnimationFrame(this.tick),this.last=Date.now()})),s(this,"tick",(()=>{if(this.isPaused)return;const e=Date.now(),t=e-this.last;this.last=e,this.t+=t,this.editor.emit("frame",t),this.t<16||(this.t-=16,this.updatePointerVelocity(t),this.editor.emit("tick",t)),this.raf=requestAnimationFrame(this.tick)})),s(this,"dispose",(()=>{this.isPaused=!0,cancelAnimationFrame(this.raf)})),s(this,"prevPoint",new Ei),s(this,"updatePointerVelocity",(e=>{const{prevPoint:t,editor:{inputs:{currentScreenPoint:n,pointerVelocity:r}}}=this;if(0===e)return;const i=Ei.Sub(n,t);this.prevPoint=n.clone();const o=i.len(),s=o?i.div(o):new Ei(0,0),a=r.clone().lrp(s.mul(o/e),.5);Math.abs(a.x)<.01&&(a.x=0),Math.abs(a.y)<.01&&(a.y=0),r.equals(a)||(this.editor.inputs.pointerVelocity=a)})),this.editor=e,this.editor.disposables.add(this.dispose),this.start()}}var Pc=Object.defineProperty,Cc=Object.getOwnPropertyDescriptor,Ec=(e,t,n,r)=>{for(var i,o=r>1?void 0:r?Cc(t,n):t,s=e.length-1;s>=0;s--)(i=e[s])&&(o=(r?i(t,n,o):i(o))||o);return r&&o&&Pc(t,n,o),o};class Ic{constructor(e,t){s(this,"updateUserPreferences",(e=>{this.user.setUserPreferences({...this.user.userPreferences.value,...e})})),this.user=e,this.inferDarkMode=t}get userPreferences(){return{id:this.id,name:this.name,locale:this.locale,color:this.color,isDarkMode:this.isDarkMode,animationSpeed:this.animationSpeed,isSnapMode:this.isSnapMode}}get isDarkMode(){var e;return null!==(e=this.user.userPreferences.value.isDarkMode)&&void 0!==e?e:!!this.inferDarkMode&&function(){var e,t,n;return"undefined"!==typeof window&&null!==(e=null===(t=(n=window).matchMedia)||void 0===t||null===(t=t.call(n,"(prefers-color-scheme: dark)"))||void 0===t?void 0:t.matches)&&void 0!==e&&e}()}get animationSpeed(){var e;return null!==(e=this.user.userPreferences.value.animationSpeed)&&void 0!==e?e:Ga.animationSpeed}get id(){return this.user.userPreferences.value.id}get name(){var e;return null!==(e=this.user.userPreferences.value.name)&&void 0!==e?e:Ga.name}get locale(){var e;return null!==(e=this.user.userPreferences.value.locale)&&void 0!==e?e:Ga.locale}get color(){var e;return null!==(e=this.user.userPreferences.value.color)&&void 0!==e?e:Ga.color}get isSnapMode(){var e;return null!==(e=this.user.userPreferences.value.isSnapMode)&&void 0!==e?e:Ga.isSnapMode}}function Mc(e){return Math.abs(e.props.bend)<8}function Tc(e,t){if("point"===t.type)return;const n=e.getShape(t.boundShapeId),r=e.getShapePageTransform(n),i=e.getShapeGeometry(n),o=i instanceof ll?i.children[0].vertices:i.vertices;return{shape:n,transform:r,isClosed:i.isClosed,isExact:t.isExact,didIntersect:!1,outline:o}}function Ac(e,t,n){if("point"===n.type)return Ei.From(n);const r=e.getShape(n.boundShapeId);if(r){const{point:i,size:o}=e.getShapeGeometry(r).bounds,s=Ei.Add(i,Ei.MulV(n.normalizedAnchor,o)),a=ia.applyToPoint(e.getShapePageTransform(r),s);return ia.applyToPoint(ia.Inverse(t),a)}return new Ei(0,0)}function jc(e,t){const n=e.getShapePageTransform(t);return{start:Ac(e,n,t.props.start),end:Ac(e,n,t.props.end)}}Ec([N],Ic.prototype,"userPreferences",1),Ec([N],Ic.prototype,"isDarkMode",1),Ec([N],Ic.prototype,"animationSpeed",1),Ec([N],Ic.prototype,"id",1),Ec([N],Ic.prototype,"name",1),Ec([N],Ic.prototype,"locale",1),Ec([N],Ic.prototype,"color",1),Ec([N],Ic.prototype,"isSnapMode",1);const Oc=32,Lc=10,zc={s:2,m:3.5,l:5,xl:10};function Rc(e,t){const{start:n,end:r,arrowheadStart:i,arrowheadEnd:o}=t.props,s=jc(e,t),a=s.start.clone(),l=s.end.clone(),c=Ei.Med(a,l);if(Ei.Equals(a,l))return{isStraight:!0,start:{handle:a,point:a,arrowhead:t.props.arrowheadStart},end:{handle:l,point:l,arrowhead:t.props.arrowheadEnd},middle:c,isValid:!1,length:0};const u=Ei.Sub(l,a).uni(),d=Tc(e,n),h=Tc(e,r),p=e.getShapePageTransform(t);Dc(l,s.start,p,h),Dc(a,s.end,p,d);let f=0,g=0;const m=d&&h&&d.shape===h.shape;!d||!h||m||d.isExact||h.isExact||(h.didIntersect&&!d.didIntersect?d.isClosed&&a.setTo(l.clone().add(u.clone().mul(Oc))):h.didIntersect||h.isClosed&&l.setTo(a.clone().sub(u.clone().mul(Oc))));const y=Ei.Sub(l,a).uni(),v=!Ei.Equals(y,u);m||(d&&"none"!==i&&!d.isExact&&(f=Lc+zc[t.props.size]/2+("size"in d.shape.props?zc[d.shape.props.size]/2:0)),h&&"none"!==o&&!h.isExact&&(g=Lc+zc[t.props.size]/2+("size"in h.shape.props?zc[h.shape.props.size]/2:0)));const b=a.clone().add(y.clone().mul(f*(v?-1:1))),w=l.clone().sub(y.clone().mul(g*(v?-1:1))),x=Ei.Dist(b,w);x<Oc&&(0!==f&&0!==g?(f*=-1.5,g*=-1.5):0!==f?f*=-2:0!==g?g*=-2:x<10&&(d?f=-(10-x):h&&(g=-(10-x)))),a.add(y.clone().mul(f*(v?-1:1))),l.sub(y.clone().mul(g*(v?-1:1))),v?(d&&h&&l.setTo(Ei.Add(a,y.clone().mul(-Oc))),c.setTo(Ei.Med(s.start,s.end))):c.setTo(Ei.Med(a,l));const S=Ei.Dist(a,l);return{isStraight:!0,start:{handle:s.start,point:a,arrowhead:t.props.arrowheadStart},end:{handle:s.end,point:l,arrowhead:t.props.arrowheadEnd},middle:c,isValid:S>0,length:S}}function Dc(e,t,n,r){if(void 0===r)return;if(r.isExact)return;const i=ia.applyToPoint(n,t),o=ia.applyToPoint(n,e),s=ia.applyToPoint(ia.Inverse(r.transform),i),a=ia.applyToPoint(ia.Inverse(r.transform),o),l=r.isClosed,c=(l?hl:dl)(s,a,r.outline);let u;var d;null!==c&&(u=null!==(d=c.sort(((e,t)=>Ei.Dist(e,s)-Ei.Dist(t,s)))[0])&&void 0!==d?d:l?void 0:a);if(void 0===u)return;const h=ia.applyToPoint(r.transform,u),p=ia.applyToPoint(ia.Inverse(n),h);e.setTo(p),r.didIntersect=!0}function Nc(e){return Bc(e.start.handle,e.end.handle)}function Fc(e){return Bc(e.start.point,e.end.point)}function Bc(e,t){return"M".concat(e.x,",").concat(e.y,"L").concat(t.x,",").concat(t.y)}function Uc(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const{arrowheadEnd:r,arrowheadStart:i}=t.props,o=t.props.bend+n;if(Math.abs(o)>Math.abs(10*t.props.bend))return Rc(e,t);const s=jc(e,t),a=Ei.Med(s.start,s.end),l=Ei.Sub(s.end,s.start).uni(),c=Ei.Add(a,l.per().mul(-o)),u=Tc(e,t.props.start),d=Tc(e,t.props.end),h=s.start.clone(),p=s.end.clone(),f=c.clone();if(Ei.Equals(h,p))return{isStraight:!0,start:{handle:h,point:h,arrowhead:t.props.arrowheadStart},end:{handle:p,point:p,arrowhead:t.props.arrowheadEnd},middle:f,isValid:!1,length:0};const g=t.props.bend<0,m=g?Vi:Ki,y=Kc(h,p,f),v=Ei.Angle(y.center,h),b=Ei.Angle(y.center,p),w=m(v,b);if(0===y.length||0===y.size||!io(y.length)||!io(y.size))return Rc(e,t);const x=h.clone(),S=p.clone(),k=f.clone(),_=e.getShapePageTransform(t);let P=0,C=0;if(u&&!u.isExact){const n=ia.applyToPoint(_,x),r=ia.applyToPoint(_,y.center),o=ia.applyToPoint(_,S),s=ia.Inverse(u.transform),a=ia.applyToPoint(s,n),l=ia.applyToPoint(s,r),c=ia.applyToPoint(s,o),{isClosed:d}=u;let h,p=(d?pl:fl)(l,y.radius,u.outline);if(p){var E;const e=l.angle(a),t=l.angle(c),n=m(e,t);p=p.filter((t=>m(e,l.angle(t))<=n));const r=.25*n;p.sort(d?(t,n)=>Math.abs(m(e,l.angle(t))-r)<Math.abs(m(e,l.angle(n))-r)?-1:1:(t,n)=>m(e,l.angle(t))<m(e,l.angle(n))?-1:1),h=null!==(E=p[0])&&void 0!==E?E:d?void 0:a}else h=d?void 0:a;h&&(x.setTo(e.getPointInShapeSpace(t,ia.applyToPoint(u.transform,h))),u.didIntersect=!0,"none"!==i&&(P=Lc+zc[t.props.size]/2+("size"in u.shape.props?zc[u.shape.props.size]/2:0)))}if(d&&!d.isExact){const n=ia.applyToPoint(_,x),i=ia.applyToPoint(_,S),o=ia.applyToPoint(_,y.center),s=ia.Inverse(d.transform),a=ia.applyToPoint(s,n),l=ia.applyToPoint(s,o),c=ia.applyToPoint(s,i),u=d.isClosed;let h,p=(u?pl:fl)(l,y.radius,d.outline);if(p){const e=l.angle(a),t=l.angle(c),n=m(e,t),r=.75*n;p=p.filter((t=>m(e,l.angle(t))<=n)),p.sort(u?(t,n)=>Math.abs(m(e,l.angle(t))-r)<Math.abs(m(e,l.angle(n))-r)?-1:1:(t,n)=>m(e,l.angle(t))<m(e,l.angle(n))?-1:1),h=p[0]?p[0]:u?void 0:c}else h=u?void 0:c;h&&(S.setTo(e.getPointInShapeSpace(t,ia.applyToPoint(d.transform,h))),d.didIntersect=!0,"none"!==r&&(C=Lc+zc[t.props.size]/2+("size"in d.shape.props?zc[d.shape.props.size]/2:0)))}let I=Ei.Angle(y.center,x),M=Ei.Angle(y.center,S),T=m(I,M),A=T*y.radius;const j=x.clone(),O=S.clone();if(0!==P){const e=P/A*(g?1:-1),t=Ei.FromAngle(I+T*e);j.setTo(y.center).add(t.mul(y.radius))}if(0!==C){const e=C/A*(g?-1:1),t=Ei.FromAngle(M+T*e);O.setTo(y.center).add(t.mul(y.radius))}const L=Ei.Dist(j,O);if(L<Oc&&(0!==P&&0!==C?(P*=-1.5,C*=-1.5):0!==P?P*=-2:0!==C?C*=-2:L<10&&(u?P=-(10-L):d&&(C=-(10-L)))),0!==P){const e=P/A*(g?1:-1),t=Ei.FromAngle(I+T*e);x.setTo(y.center).add(t.mul(y.radius))}if(0!==C){const e=C/A*(g?-1:1),t=Ei.FromAngle(M+T*e);S.setTo(y.center).add(t.mul(y.radius))}if(u&&d&&!u.isExact&&!d.isExact)if(I=Ei.Angle(y.center,x),M=Ei.Angle(y.center,S),T=m(I,M),A=T*y.radius,u.shape===d.shape)A<100&&(x.setTo(h),S.setTo(p),k.setTo(f));else if(u&&!u.didIntersect&&x.setTo(h),d&&!d.didIntersect||m(v,I)>m(v,M)){const e=Math.min(.9,Oc/A)*(g?1:-1),t=Ei.FromAngle(I+T*e);S.setTo(y.center).add(t.mul(y.radius))}!function(e,t,n,r,i,o,s){const a=Ei.Angle(e,n),l=Ei.Angle(e,r);let c=Vi(a,l);s||(c=zi-c);const u=.5*(s?1:-1),d=Ei.FromAngle(a+c*u);if(i.setTo(e).add(d.mul(t)),c>o){i.rotWith(e,Oi);const t=r.clone();r.setTo(n),n.setTo(t)}}(y.center,y.radius,x,S,k,w,g),x.equals(S)&&(x.setTo(k.clone().addXY(1,1)),S.setTo(k.clone().subXY(1,1))),h.setTo(x),p.setTo(S),f.setTo(k);const z=Kc(h,p,f);return{isStraight:!1,start:{point:h,handle:s.start,arrowhead:t.props.arrowheadStart},end:{point:p,handle:s.end,arrowhead:t.props.arrowheadEnd},middle:f,handleArc:y,bodyArc:z,isValid:0!==z.length&&isFinite(z.center.x)&&isFinite(z.center.y)}}function Hc(e){const{start:t,end:n,handleArc:{radius:r,largeArcFlag:i,sweepFlag:o}}=e;return"M".concat(t.handle.x,",").concat(t.handle.y," A").concat(r," ").concat(r," 0 ").concat(i," ").concat(o," ").concat(n.handle.x,",").concat(n.handle.y)}function Vc(e){const{start:t,end:n,bodyArc:{radius:r,largeArcFlag:i,sweepFlag:o}}=e;return"M".concat(t.point.x,",").concat(t.point.y," A").concat(r," ").concat(r," 0 ").concat(i," ").concat(o," ").concat(n.point.x,",").concat(n.point.y)}function Kc(e,t,n){const r=-2*(e.x*(t.y-n.y)-e.y*(t.x-n.x)+t.x*n.y-n.x*t.y),i={x:((e.x*e.x+e.y*e.y)*(n.y-t.y)+(t.x*t.x+t.y*t.y)*(e.y-n.y)+(n.x*n.x+n.y*n.y)*(t.y-e.y))/r,y:((e.x*e.x+e.y*e.y)*(t.x-n.x)+(t.x*t.x+t.y*t.y)*(n.x-e.x)+(n.x*n.x+n.y*n.y)*(e.x-t.x))/r},o=Ei.Dist(i,e),s=+Ei.Clockwise(e,n,t),a=Math.hypot(e.y-t.y,e.x-t.x),l=Math.hypot(t.y-n.y,t.x-n.x),c=Math.hypot(n.y-e.y,n.x-e.x),u=2*Math.acos((l*l+c*c-a*a)/(2*l*c)),d=(zi-u)*(s?1:-1);return{center:i,radius:o,size:d,length:d*o,largeArcFlag:+(Oi>u),sweepFlag:s}}const Wc={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick"};var $c=Object.defineProperty,Yc=Object.getOwnPropertyDescriptor;class qc{constructor(e,t){s(this,"path",void 0),s(this,"id",void 0),s(this,"current",void 0),s(this,"type",void 0),s(this,"shapeType",void 0),s(this,"initial",void 0),s(this,"children",void 0),s(this,"parent",void 0),s(this,"isActive",!1),s(this,"transition",((e,t)=>{const n=e.split(".");let r=this;for(let o=0;o<n.length;o++){var i;const e=n[o],s=r.current.value,a=null===(i=r.children)||void 0===i?void 0:i[e];if(!a)throw Error("".concat(r.id," - no child state exists with the id ").concat(e,"."));if((null===s||void 0===s?void 0:s.id)!==a.id&&(null===s||void 0===s||s.exit(t,e),r.current.set(a),a.enter(t,(null===s||void 0===s?void 0:s.id)||"initial"),!a.isActive))break;r=a}return this})),s(this,"handleEvent",(e=>{var t;const n=Wc[e.name],r=this.current.value;null===(t=this[n])||void 0===t||t.call(this,e),this.current.value===r&&this.isActive&&(null===r||void 0===r||r.handleEvent(e))})),s(this,"enter",((e,t)=>{var n;if(this.isActive=!0,null===(n=this.onEnter)||void 0===n||n.call(this,e,t),this.children&&this.initial&&this.isActive){const n=this.children[this.initial];this.current.set(n),n.enter(e,t)}})),s(this,"exit",((e,t)=>{var n,r;(this.isActive=!1,null===(n=this.onExit)||void 0===n||n.call(this,e,t),this.isActive)||(null===(r=this.current.value)||void 0===r||r.exit(e,t))})),s(this,"_currentToolIdMask",A("curent tool id mask",void 0)),s(this,"onWheel",void 0),s(this,"onPointerDown",void 0),s(this,"onPointerMove",void 0),s(this,"onPointerUp",void 0),s(this,"onDoubleClick",void 0),s(this,"onTripleClick",void 0),s(this,"onQuadrupleClick",void 0),s(this,"onRightClick",void 0),s(this,"onMiddleClick",void 0),s(this,"onKeyDown",void 0),s(this,"onKeyUp",void 0),s(this,"onKeyRepeat",void 0),s(this,"onCancel",void 0),s(this,"onComplete",void 0),s(this,"onInterrupt",void 0),s(this,"onEnter",void 0),s(this,"onExit",void 0),this.editor=e;const{id:n,children:r,initial:i}=this.constructor;this.id=n,this.current=A("toolState"+this.id,void 0),this.path=N("toolPath"+this.id,(()=>{const e=this.current.value;return this.id+(e?".".concat(e.path.value):"")})),this.parent=null!==t&&void 0!==t?t:{},this.parent?r&&i?(this.type="branch",this.initial=i,this.children=Object.fromEntries(r().map((e=>[e.id,new e(this.editor,this)]))),this.current.set(this.children[this.initial])):this.type="leaf":(this.type="root",r&&i&&(this.initial=i,this.children=Object.fromEntries(r().map((e=>[e.id,new e(this.editor,this)]))),this.current.set(this.children[this.initial])))}get currentToolIdMask(){return this._currentToolIdMask.value}set currentToolIdMask(e){this._currentToolIdMask.set(e)}}s(qc,"id",void 0),s(qc,"initial",void 0),s(qc,"children",void 0),((e,t,n,r)=>{for(var i,o=r>1?void 0:r?Yc(t,n):t,s=e.length-1;s>=0;s--)(i=e[s])&&(o=(r?i(t,n,o):i(o))||o);r&&o&&$c(t,n,o)})([N],qc.prototype,"currentToolIdMask",1);class Gc extends qc{constructor(){super(...arguments),s(this,"onKeyDown",(e=>{if("KeyZ"===e.code)if(!e.shiftKey&&!e.ctrlKey){var t;const n=this.current.value;n&&"idle"===(null===(t=n.current.value)||void 0===t?void 0:t.id)&&this.children.zoom&&this.editor.setCurrentTool("zoom",{...e,onInteractionEnd:n.id})}}))}}s(Gc,"id","root"),s(Gc,"initial",""),s(Gc,"children",(()=>[]));var Xc=Object.defineProperty,Qc=Object.getOwnPropertyDescriptor,Zc=(e,t,n,r)=>{for(var i,o=r>1?void 0:r?Qc(t,n):t,s=e.length-1;s>=0;s--)(i=e[s])&&(o=(r?i(t,n,o):i(o))||o);return r&&o&&Xc(t,n,o),o};class Jc extends ol.EventEmitter{constructor(e){let{store:t,user:n,shapeUtils:r,tools:i,getContainer:o,initialState:a,inferDarkMode:l}=e;super(),s(this,"store",void 0),s(this,"root",void 0),s(this,"disposables",new Set),s(this,"_tickManager",new _c(this)),s(this,"snaps",void 0),s(this,"user",void 0),s(this,"textMeasure",void 0),s(this,"environment",void 0),s(this,"scribbles",void 0),s(this,"getContainer",void 0),s(this,"sideEffects",void 0),s(this,"shapeUtils",void 0),s(this,"styleProps",void 0),s(this,"history",new lc(this,(e=>{this.annotateError(e,{origin:"history.batch",willCrashApp:!0}),this.crash(e)}))),s(this,"_crashingError",null),s(this,"_updateInstanceState",this.history.createCommand("updateInstanceState",((e,t)=>{const n=this.store.get(this.instanceState.id);return{data:{prev:n,next:{...n,...e}},ephemeral:!1,squashing:!1,...t}}),{do:e=>{let{next:t}=e;this.store.put([t])},undo:e=>{let{prev:t}=e;this.store.put([t])},squash(e,t){let{prev:n}=e,{next:r}=t;return{prev:n,next:r}}})),s(this,"_isChangingStyleTimeout",-1),s(this,"setCursor",(e=>(this.updateInstanceState({cursor:{...this.instanceState.cursor,...e}},{ephemeral:!0}),this))),s(this,"_setInstancePageState",this.history.createCommand("setInstancePageState",((e,t)=>{var n;return{data:{prev:this.store.get(null!==(n=e.id)&&void 0!==n?n:this.currentPageState.id),partial:e},...t}}),{do:e=>{let{prev:t,partial:n}=e;this.store.update(t.id,(e=>({...e,...n})))},undo:e=>{let{prev:t}=e;this.store.update(t.id,(()=>t))}})),s(this,"_setSelectedShapes",this.history.createCommand("setSelectedShapes",((e,t)=>{const{selectedShapeIds:n}=this.currentPageState,r=new Set(n);return e.length===r.size&&e.every((e=>r.has(e)))?null:{data:{selectedShapeIds:e,prevSelectedShapeIds:n},preservesRedoStack:!0,...t}}),{do:e=>{let{selectedShapeIds:t}=e;this.store.put([{...this.currentPageState,selectedShapeIds:t}])},undo:e=>{let{prevSelectedShapeIds:t}=e;this.store.put([{...this.currentPageState,selectedShapeIds:t}])},squash(e,t){let{prevSelectedShapeIds:n}=e,{selectedShapeIds:r}=t;return{selectedShapeIds:r,prevSelectedShapeIds:n}}})),s(this,"_setFocusedGroupId",this.history.createCommand("setFocusedGroupId",(e=>{const t=this.currentPageState.focusedGroupId;if(t!==e)return{data:{prev:t,next:e},preservesRedoStack:!0,squashing:!0}}),{do:e=>{let{next:t}=e;this.store.update(this.currentPageState.id,(e=>({...e,focusedGroupId:t})))},undo:e=>{let{prev:t}=e;this.store.update(this.currentPageState.id,(e=>({...e,focusedGroupId:t})))},squash(e,t){let{prev:n}=e,{next:r}=t;return{prev:n,next:r}}})),s(this,"_viewportAnimation",null),s(this,"_willSetInitialBounds",!0),s(this,"_cameraState",A("camera state","idle")),s(this,"_cameraStateTimeoutRemaining",0),s(this,"_lastUpdateRenderingBoundsTimestamp",Date.now()),s(this,"_decayCameraStateTimeout",(e=>{this._cameraStateTimeoutRemaining-=e,this._cameraStateTimeoutRemaining<=0&&(this.off("tick",this._decayCameraStateTimeout),this._cameraState.set("idle"),this.updateRenderingBounds())})),s(this,"_tickCameraState",(()=>{this._cameraStateTimeoutRemaining=64;const e=Date.now();"idle"===this._cameraState.__unsafe__getWithoutCapture()?(this._lastUpdateRenderingBoundsTimestamp=e,this._cameraState.set("moving"),this.on("tick",this._decayCameraStateTimeout)):e-this._lastUpdateRenderingBoundsTimestamp>620&&this.updateRenderingBounds()})),s(this,"_renderingBounds",A("rendering viewport",new Ti)),s(this,"_renderingBoundsExpanded",A("rendering viewport expanded",new Ti)),s(this,"renderingBoundsMargin",100),s(this,"_currentPageShapeIds",void 0),s(this,"_setCurrentPageId",this.history.createCommand("setCurrentPage",((e,t)=>{if(this.store.has(e))return this.stopFollowingUser(),{data:{toId:e,fromId:this.currentPageId},squashing:!0,preservesRedoStack:!0,...t};console.error("Tried to set the current page id to a page that doesn't exist.")}),{do:e=>{let{toId:t}=e;if(this.store.has(t)){if(!this.pageStates.find((e=>e.pageId===t))){const e=Tt.create({id:Tt.createId(t)});this.store.put([e,Jt.create({id:Jt.createId(t),pageId:t})])}this.store.put([{...this.instanceState,currentPageId:t}]),this.updateRenderingBounds()}},undo:e=>{let{fromId:t}=e;this.store.has(t)&&(this.store.put([{...this.instanceState,currentPageId:t}]),this.updateRenderingBounds())},squash:(e,t)=>{let{fromId:n}=e,{toId:r}=t;return{toId:r,fromId:n}}})),s(this,"_updatePage",this.history.createCommand("updatePage",((e,t)=>{if(this.instanceState.isReadonly)return null;const n=this.getPage(e.id);return n?{data:{prev:n,partial:e},...t}:null}),{do:e=>{let{partial:t}=e;this.store.update(t.id,(e=>({...e,...t})))},undo:e=>{let{prev:t,partial:n}=e;this.store.update(n.id,(()=>t))},squash:(e,t)=>({prev:{...e.prev,...t.prev},partial:t.partial})})),s(this,"_createPage",this.history.createCommand("createPage",(e=>{var t;if(this.instanceState.isReadonly)return null;if(this.pages.length>=40)return null;const{pages:n}=this,r=function(e,t){let n=e;const r=new Set(t);for(;r.has(n);){var i;n=null!==(i=/^.*(\d+)$/.exec(n))&&void 0!==i&&i[1]?n.replace(/(\d+)(?=\D?)$/,(e=>(+e+1).toString())):"".concat(n," 1")}return n}(null!==(t=e.name)&&void 0!==t?t:"Page",n.map((e=>e.name)));let i=e.index;i&&!n.some((e=>e.index===i))||(i=ql(n[n.length-1].index));const o=Vt.create({meta:{},...e,name:r,index:i}),s=Tt.create({id:Tt.createId(o.id)});return{data:{newPage:o,newTabPageState:Jt.create({id:Jt.createId(o.id),pageId:o.id}),newCamera:s}}}),{do:e=>{let{newPage:t,newTabPageState:n,newCamera:r}=e;this.store.put([t,r,n])},undo:e=>{let{newPage:t,newTabPageState:n,newCamera:r}=e;1!==this.pages.length&&this.store.remove([n.id,t.id,r.id])}})),s(this,"_deletePage",this.history.createCommand("delete_page",(e=>{if(this.instanceState.isReadonly)return null;const{pages:t}=this;if(1===t.length)return null;const n=this.getPage(e),r=this.pageStates.filter((t=>t.pageId===e));if(!n)return null;if(e===this.currentPageId){var i;const n=t.findIndex((t=>t.id===e)),r=null!==(i=t[n-1])&&void 0!==i?i:t[n+1];this.setCurrentPage(r.id)}return{data:{id:e,deletedPage:n,deletedPageStates:r}}}),{do:e=>{let{deletedPage:t,deletedPageStates:n}=e;const{pages:r}=this;if(1!==r.length){if(t.id===this.currentPageId){var i;const e=r.findIndex((e=>e.id===t.id)),n=null!==(i=r[e-1])&&void 0!==i?i:r[e+1];this.setCurrentPage(n.id)}this.store.remove(n.map((e=>e.id))),this.store.remove([t.id]),this.updateRenderingBounds()}},undo:e=>{let{deletedPage:t,deletedPageStates:n}=e;this.store.put([t]),this.store.put(n),this.updateRenderingBounds()}})),s(this,"_createAssets",this.history.createCommand("createAssets",(e=>this.instanceState.isReadonly||e.length<=0?null:{data:{assets:e}}),{do:e=>{let{assets:t}=e;this.store.put(t)},undo:e=>{let{assets:t}=e;this.store.remove(t.map((e=>e.id)))}})),s(this,"_updateAssets",this.history.createCommand("updateAssets",(e=>{if(this.instanceState.isReadonly)return;if(e.length<=0)return;return{data:{snapshots:{},assets:e}}}),{do:e=>{let{assets:t,snapshots:n}=e;this.store.put(t.map((e=>{const t=this.store.get(e.id);return n[e.id]=t,{...t,...e}})))},undo:e=>{let{snapshots:t}=e;this.store.put(Object.values(t))}})),s(this,"_deleteAssets",this.history.createCommand("deleteAssets",(e=>{if(this.instanceState.isReadonly)return;if(e.length<=0)return;const t=Q(e.map((e=>this.store.get(e))));return{data:{ids:e,prev:t}}}),{do:e=>{let{ids:t}=e;this.store.remove(t)},undo:e=>{let{prev:t}=e;this.store.put(t)}})),s(this,"_parentIdsToChildIds",void 0),s(this,"_childIdsCache",new jl),s(this,"_createShapes",this.history.createCommand("createShapes",(e=>{if(this.instanceState.isReadonly)return null;if(e.length<=0)return null;const{currentPageShapeIds:t}=this;if(!(e.length+t.size>po))return 0===e.length?null:{data:{currentPageId:this.currentPageId,partials:e.map((e=>e.id?e:{...e,id:Dn()}))}};eu(this)}),{do:e=>{let{partials:t}=e;const{focusedGroupId:n}=this,{currentPageShapesSorted:r}=this;t=t.map((e=>{if(!e.parentId||!this.store.has(e.parentId)&&!t.some((t=>t.id===e.parentId))){let t=this.focusedGroupId;for(let n=r.length-1;n>=0;n--){var i,o;const s=r[n];if(this.getShapeUtil(s).canReceiveNewChildrenOfType(s,e.type)&&this.isPointInShape(s,{x:null!==(i=e.x)&&void 0!==i?i:0,y:null!==(o=e.y)&&void 0!==o?o:0},{margin:0,hitInside:!0})){t=s.id;break}}const c=e.parentId;if(t===e.id&&(t=n),t!==c&&((e={...e}).parentId=t,Rn(t))){var s,a,l;const n=this.getPointInShapeSpace(this.getShape(t),{x:null!==(s=e.x)&&void 0!==s?s:0,y:null!==(a=e.y)&&void 0!==a?a:0});e.x=n.x,e.y=n.y,e.rotation=-this.getShapePageTransform(t).rotation()+(null!==(l=e.rotation)&&void 0!==l?l:0)}}return e}));const i=new Map,o=[];for(const d of t){var s,a,l,c;const e=this.getShapeUtil(d);let t=d.index;if(!t){var u;const e=null!==(u=d.parentId)&&void 0!==u?u:n;i.has(e)||i.set(e,this.getHighestIndexForParent(e)),t=i.get(e),i.set(e,ql(t))}const r=e.getDefaultProps();for(const[n,i]of this.styleProps[d.type])r[i]=this.getStyleForNextShape(n);let h=this.store.schema.types.shape.create({...d,index:t,opacity:null!==(s=d.opacity)&&void 0!==s?s:this.instanceState.opacityForNextShape,parentId:null!==(a=d.parentId)&&void 0!==a?a:n,props:"props"in d?{...r,...d.props}:r});if(void 0===h.index)throw Error("no index!");const p=null===(l=(c=this.getShapeUtil(h)).onBeforeCreate)||void 0===l?void 0:l.call(c,h);p&&(h=p),o.push(h)}o.forEach((e=>{e.meta={...this.getInitialMetaForShape(e),...e.meta}})),this.store.put(o)},undo:e=>{let{partials:t}=e;this.store.remove(t.map((e=>e.id)))}})),s(this,"animatingShapes",new Map),s(this,"_updateShapes",this.history.createCommand("updateShapes",((e,t)=>{if(this.instanceState.isReadonly)return null;const n=Q(e),r=Object.fromEntries(Q(n.map((e=>{let{id:t}=e;return this.getShape(t)}))).map((e=>[e.id,e])));if(n.length<=0)return null;const i=Q(n.map((e=>{var t;const n=r[e.id];if(!n)return null;let i=null;for(const[r,o]of Object.entries(e))if(void 0!==o)switch(r){case"id":case"type":continue;default:if(o!==n[r])if(i||(i={...n}),"props"===r){const e={...n.props};for(const[t,n]of Object.entries(o))void 0!==n&&(e[t]=n);i.props=e}else if("meta"===r){const e={...n.meta};for(const[t,n]of Object.entries(o))void 0!==n&&(e[t]=n);i.meta=e}else i[r]=o}return null!==(t=i)&&void 0!==t?t:n}))),o=Object.fromEntries(i.map((e=>[e.id,e])));return{data:{snapshots:r,updates:o},...t}}),{do:e=>{let{updates:t}=e;const n=Object.values(t);for(let o=0;o<n.length;o++){var r,i;const e=n[o],t=this.store.get(e.id);if(!t)continue;const s=null===(r=(i=this.getShapeUtil(e)).onBeforeUpdate)||void 0===r?void 0:r.call(i,t,e);s&&(n[o]=s)}this.store.put(n)},undo:e=>{let{snapshots:t}=e;this.store.put(Object.values(t))},squash:(e,t)=>({snapshots:{...t.snapshots,...e.snapshots},updates:{...e.updates,...t.updates}})})),s(this,"_deleteShapes",this.history.createCommand("delete_shapes",(e=>{if(this.instanceState.isReadonly)return null;if(0===e.length)return null;const t=[...this.currentPageState.selectedShapeIds],n=new Set(e);for(const a of e)this.visitDescendants(a,(e=>{n.add(e)}));const r=[...n],i=this._arrowBindingsIndex.value,o=Q(r.flatMap((e=>{const t=this.getShape(e),n=i[e];return n&&n.length>0?n.map((e=>{let{arrowId:t}=e;return this.getShape(t)})).concat(t):t}))),s=t.filter((e=>!n.has(e)));return{data:{deletedIds:r,snapshots:o,prevSelectedShapeIds:t,postSelectedShapeIds:s}}}),{do:e=>{let{deletedIds:t,postSelectedShapeIds:n}=e;this.store.remove(t),this.store.update(this.currentPageState.id,(e=>({...e,selectedShapeIds:n})))},undo:e=>{let{snapshots:t,prevSelectedShapeIds:n}=e;this.store.put(t),this.store.update(this.currentPageState.id,(e=>({...e,selectedShapeIds:n})))}})),s(this,"_selectionSharedStyles",N("_selectionSharedStyles",(()=>{const{selectedShapes:e}=this,t=new Al;for(const n of e)this._extractSharedStyles(n,t);return t}))),s(this,"externalAssetContentHandlers",{file:null,url:null}),s(this,"externalContentHandlers",{text:null,files:null,embed:null,"svg-text":null,url:null}),s(this,"inputs",{originPagePoint:new Ei,originScreenPoint:new Ei,previousPagePoint:new Ei,previousScreenPoint:new Ei,currentPagePoint:new Ei,currentScreenPoint:new Ei,keys:new Set,buttons:new Set,isPen:!1,shiftKey:!1,ctrlKey:!1,altKey:!1,isDragging:!1,isPointing:!1,isPinching:!1,isEditing:!1,isPanning:!1,pointerVelocity:new Ei}),s(this,"_clickManager",new tc(this)),s(this,"_prevCursor","default"),s(this,"_shiftKeyTimeout",-1),s(this,"_setShiftKeyTimeout",(()=>{this.inputs.shiftKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Shift",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ShiftLeft"})})),s(this,"_altKeyTimeout",-1),s(this,"_setAltKeyTimeout",(()=>{this.inputs.altKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Alt",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"AltLeft"})})),s(this,"_ctrlKeyTimeout",-1),s(this,"_setCtrlKeyTimeout",(()=>{this.inputs.ctrlKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Ctrl",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ControlLeft"})})),s(this,"_restoreToolId","select"),s(this,"_pinchStart",1),s(this,"_didPinch",!1),s(this,"_selectedShapeIdsAtPointerDown",[]),s(this,"capturedPointerId",null),s(this,"dispatch",(e=>{if(this.crashingError)return this;const{inputs:t}=this,{type:n}=e;return this.batch((()=>{if("misc"===e.type)return"cancel"!==e.name&&"complete"!==e.name||(this.inputs.isDragging=!1,this.inputs.isPanning&&(this.inputs.isPanning=!1,this.updateInstanceState({cursor:{type:this._prevCursor,rotation:0}}))),void this.root.handleEvent(e);e.shiftKey?(clearInterval(this._shiftKeyTimeout),this._shiftKeyTimeout=-1,t.shiftKey=!0):!e.shiftKey&&t.shiftKey&&-1===this._shiftKeyTimeout&&(this._shiftKeyTimeout=setTimeout(this._setShiftKeyTimeout,150)),e.altKey?(clearInterval(this._altKeyTimeout),this._altKeyTimeout=-1,t.altKey=!0):!e.altKey&&t.altKey&&-1===this._altKeyTimeout&&(this._altKeyTimeout=setTimeout(this._setAltKeyTimeout,150)),e.ctrlKey?(clearInterval(this._ctrlKeyTimeout),this._ctrlKeyTimeout=-1,t.ctrlKey=!0):!e.ctrlKey&&t.ctrlKey&&-1===this._ctrlKeyTimeout&&(this._ctrlKeyTimeout=setTimeout(this._setCtrlKeyTimeout,150));const{originPagePoint:r,originScreenPoint:i,currentPagePoint:o,currentScreenPoint:s}=t;switch(t.isPointing||(t.isDragging=!1),n){case"pinch":if(!this.instanceState.canMoveCamera)return;switch(this._updateInputsFromEvent(e),e.name){case"pinch_start":if(t.isPinching)return;return void(t.isEditing||(this._pinchStart=this.camera.z,this._selectedShapeIdsAtPointerDown.length||(this._selectedShapeIdsAtPointerDown=this.selectedShapeIds),this._didPinch=!0,t.isPinching=!0,this.interrupt()));case"pinch":{if(!t.isPinching)return;const{point:{x:n,y:r,z:i=1},delta:{x:o,y:s}}=e,{camera:{x:a,y:l,z:c}}=this,u=Math.min(yo,Math.max(mo,i));return void this.setCamera({x:a+o/c-n/c+n/u,y:l+s/c-r/c+r/u,z:u})}case"pinch_end":{if(!t.isPinching)return this;t.isPinching=!1;const{_selectedShapeIdsAtPointerDown:e}=this;return this.setSelectedShapes(this._selectedShapeIdsAtPointerDown,{squashing:!0}),this._selectedShapeIdsAtPointerDown=[],void(this._didPinch&&(this._didPinch=!1,requestAnimationFrame((()=>{this._didPinch||this.setSelectedShapes(e,{squashing:!0})}))))}}case"wheel":if(!this.instanceState.canMoveCamera)return;if(this._updateInputsFromEvent(e),this.isMenuOpen);else{if(t.ctrlKey){var a;const{x:t,y:n}=this.inputs.currentScreenPoint,{x:r,y:i,z:o}=this.camera,s=Math.min(yo,Math.max(mo,o+(null!==(a=e.delta.z)&&void 0!==a?a:0)*o));return void this.setCamera({x:r+(t/s-t)-(t/o-t),y:i+(n/s-n)-(n/o-n),z:s})}this.pan(e.delta),!t.isDragging&&t.isPointing&&r.dist(o)>(this.instanceState.isCoarsePointer?6:4)/this.zoomLevel&&(t.isDragging=!0)}break;case"pointer":{if(t.isPinching)return;this._updateInputsFromEvent(e);const{isPen:n}=e;switch(e.name){case"pointer_down":if(this._selectedShapeIdsAtPointerDown=this.selectedShapeIds,0===e.button&&(this.capturedPointerId=e.pointerId),t.buttons.add(e.button),t.isPointing=!0,t.isDragging=!1,this.instanceState.isPenMode){if(!n)return}else n&&this.updateInstanceState({isPenMode:!0});if(5===e.button?(this._restoreToolId=this.currentToolId,this.complete(),this.setCurrentTool("eraser")):1===e.button&&(this.inputs.isPanning||(this._prevCursor=this.instanceState.cursor.type),this.inputs.isPanning=!0),this.inputs.isPanning)return this.stopCameraAnimation(),this.updateInstanceState({cursor:{type:"grabbing",rotation:0}}),this;i.setTo(s),r.setTo(o);break;case"pointer_move":if(!n&&this.instanceState.isPenMode)return;if(this.inputs.isPanning&&this.inputs.isPointing){const{currentScreenPoint:e,previousScreenPoint:t}=this.inputs;return void this.pan(Ei.Sub(e,t))}!t.isDragging&&t.isPointing&&r.dist(o)>(this.instanceState.isCoarsePointer?6:4)/this.zoomLevel&&(t.isDragging=!0);break;case"pointer_up":if(t.buttons.delete(e.button),t.isPointing=!1,t.isDragging=!1,this.isMenuOpen)return;if(!n&&this.instanceState.isPenMode)return;this.capturedPointerId===e.pointerId&&(this.capturedPointerId=null,e.button=0),t.isPanning?1===e.button?this.inputs.keys.has(" ")?(this.slideCamera({speed:Math.min(2,this.inputs.pointerVelocity.len()),direction:this.inputs.pointerVelocity,friction:xo}),this.updateInstanceState({cursor:{type:"grab",rotation:0}})):(t.isPanning=!1,this.slideCamera({speed:Math.min(2,this.inputs.pointerVelocity.len()),direction:this.inputs.pointerVelocity,friction:xo}),this.updateInstanceState({cursor:{type:this._prevCursor,rotation:0}})):0===e.button&&(this.slideCamera({speed:Math.min(2,this.inputs.pointerVelocity.len()),direction:this.inputs.pointerVelocity,friction:xo}),this.updateInstanceState({cursor:{type:"grab",rotation:0}})):5===e.button&&(this.complete(),this.setCurrentTool(this._restoreToolId))}break}case"keyboard":switch("ShiftRight"===e.key&&(e.key="ShiftLeft"),"AltRight"===e.key&&(e.key="AltLeft"),"ControlRight"===e.code&&(e.code="ControlLeft"),e.name){case"key_down":t.keys.add(e.code),e.ctrlKey||"Space"!==e.code||(this.inputs.isPanning||(this._prevCursor=this.instanceState.cursor.type),this.inputs.isPanning=!0,this.updateInstanceState({cursor:{type:this.inputs.isPointing?"grabbing":"grab",rotation:0}}));break;case"key_up":t.keys.delete(e.code),"Space"!==e.code||this.inputs.buttons.has(1)||(this.inputs.isPanning=!1,this.updateInstanceState({cursor:{type:this._prevCursor,rotation:0}}))}}if("pointer"===e.type&&(1===e.button?e.name="middle_click":2===e.button&&(e.name="right_click"),e.isPen===this.instanceState.isPenMode))switch(e.name){case"pointer_down":{const t=this._clickManager.transformPointerDownEvent(e);if(e.name!==t.name)return this.root.handleEvent(e),this.emit("event",e),this.root.handleEvent(t),void this.emit("event",t);break}case"pointer_up":{const t=this._clickManager.transformPointerUpEvent(e);if(e.name!==t.name)return this.root.handleEvent(e),this.emit("event",e),this.root.handleEvent(t),void this.emit("event",t);break}case"pointer_move":this._clickManager.handleMove()}this.root.handleEvent(e),this.emit("event",e)})),this})),this.store=t,this.snaps=new yc(this),this.user=new Ic(null!==n&&void 0!==n?n:il(),null!==l&&void 0!==l&&l),this.getContainer=null!==o&&void 0!==o?o:()=>document.body,this.textMeasure=new kc(this);class c extends Gc{}s(c,"initial",null!==a&&void 0!==a?a:""),this.root=new c(this),this.root.children={};const u=El(r),d=new Set(Object.keys(t.schema.types.shape.migrations.subTypeMigrations));for(const s of u){if(!d.has(s.type))throw Error('Editor and store have different shapes: "'.concat(s.type,'" was passed into the editor but not the schema'));d.delete(s.type)}if(d.size>0)throw Error('Editor and store have different shapes: "'.concat([...d][0],'" is present in the store schema but not provided to the editor'));const h={},p={},f=new Map;for(const s of u){var g;const e=new s(this);h[s.type]=e;const t=Nn(null!==(g=s.props)&&void 0!==g?g:{});p[s.type]=t;for(const n of t.keys())if(f.has(n.id)){if(f.get(n.id)!==n)throw Error('Multiple style props with id "'.concat(n.id,'" in use. Style prop IDs must be unique.'))}else f.set(n.id,n)}this.shapeUtils=h,this.styleProps=p;for(const s of[...i]){if(pe(this.root.children,s.id))throw Error("Can't override tool with id \"".concat(s.id,'"'));this.root.children[s.id]=new s(this,this.root)}this.environment=new nc(this),this.scribbles=new cc(this);const m=new Set,y=e=>{const t=this.getShape(e);if(!t)return;const{start:n,end:r}=t.props,i="binding"===n.type?this.getShape(n.boundShapeId):void 0,o="binding"===r.type?this.getShape(r.boundShapeId):void 0,s=this.getAncestorPageId(t);if(!s)return;let a;if(i&&o){var l;a=null!==(l=this.findCommonAncestor([i,o]))&&void 0!==l?l:s}else{if(!i&&!o)return;a=s}a&&a!==t.parentId&&this.reparentShapes([e],a);const c=this.getShape(e);if(!c)throw Error("no reparented arrow");const u=this.getShapeNearestSibling(c,i),d=this.getShapeNearestSibling(c,o);let h,p;if(u&&d)h=u.index>d.index?u:d;else if(u&&!d)h=u;else{if(!d||u)return;h=d}const f=this.getSortedChildIdsForParent(h.parentId).map((e=>this.getShape(e))).filter((e=>e.index>h.index));if(f.length){const e=f.find((e=>"arrow"!==e.type));if(c.index>h.index&&(!e||c.index<e.index))return;p=Yl(h.index,f[0].index)}else p=ql(h.index);p!==c.index&&this.updateShapes([{id:e,type:"arrow",index:p}])},v=(e,t)=>{const{x:n,y:r}=jc(this,e)[t];this.store.put([{...e,props:{...e.props,[t]:{type:"point",x:n,y:r}}}])},b=e=>{for(const t of["start","end"]){const n=e.props[t];if("binding"!==n.type)continue;const r=this.getShape(n.boundShapeId),i=this.getAncestorPageId(e)===this.getAncestorPageId(r);r&&i||v(e,t)}y(e.id)},w=(e,t)=>{let n=null;const r=e.selectedShapeIds.filter((e=>!t.has(e)));r.length!==e.selectedShapeIds.length&&(n||(n={...e}),n.selectedShapeIds=r);const i=e.erasingShapeIds.filter((e=>!t.has(e)));i.length!==e.erasingShapeIds.length&&(n||(n={...e}),n.erasingShapeIds=i),e.hoveredShapeId&&t.has(e.hoveredShapeId)&&(n||(n={...e}),n.hoveredShapeId=null),e.editingShapeId&&t.has(e.editingShapeId)&&(n||(n={...e}),n.editingShapeId=null);const o=e.hintingShapeIds.filter((e=>!t.has(e)));return o.length!==e.hintingShapeIds.length&&(n||(n={...e}),n.hintingShapeIds=o),e.focusedGroupId&&t.has(e.focusedGroupId)&&(n||(n={...e}),n.focusedGroupId=null),n};if(this.sideEffects=new uc(this),this.sideEffects.registerBatchCompleteHandler((()=>{for(const t of m){var e;m.delete(t);const n=this.getShape(t);if(!n)continue;const r=this.getShapeUtil(n),i=null===(e=r.onChildrenChange)||void 0===e?void 0:e.call(r,n);null!==i&&void 0!==i&&i.length&&this.updateShapes(i,{squashing:!0})}this.emit("update")})),this.sideEffects.registerBeforeDeleteHandler("shape",(e=>{e.parentId&&Rn(e.parentId)&&m.add(e.parentId);const t=this._arrowBindingsIndex.value[e.id];if(null!==t&&void 0!==t&&t.length)for(const{arrowId:i,handleId:o}of t){const e=this.getShape(i);e&&v(e,o)}const n=new Set([e.id]),r=Q(this.pageStates.map((e=>w(e,n))));r.length&&this.store.put(r)})),this.sideEffects.registerBeforeDeleteHandler("page",(e=>{var t;if(this.instanceState.currentPageId!==e.id)return;const n=null===(t=this.pages.find((t=>t.id!==e.id)))||void 0===t?void 0:t.id;if(!n)return;this.store.put([{...this.instanceState,currentPageId:n}]);const r=Tt.createId(e.id),i=Jt.createId(e.id);this.store.remove([r,i])})),this.sideEffects.registerAfterChangeHandler("shape",((e,t)=>{if(this.isShapeOfType(t,"arrow")&&b(t),e.parentId!==t.parentId){const e=e=>{const t=this._arrowBindingsIndex.value[e];if(null!==t&&void 0!==t&&t.length)for(const n of t)y(n.arrowId)};e(t.id),this.visitDescendants(t.id,e)}if(e.parentId!==t.parentId&&Kt(t.parentId)){const n=new Set([e.id]);this.visitDescendants(e.id,(e=>{n.add(e)}));for(const e of this.pageStates){if(e.pageId===t.parentId)continue;const r=w(e,n);r&&this.store.put([r])}}e.parentId&&Rn(e.parentId)&&m.add(e.parentId),t.parentId!==e.parentId&&Rn(t.parentId)&&m.add(t.parentId)})),this.sideEffects.registerAfterChangeHandler("instance_page_state",((e,t)=>{if((null===e||void 0===e?void 0:e.selectedShapeIds)!==(null===t||void 0===t?void 0:t.selectedShapeIds)){const e=t.selectedShapeIds.filter((e=>{var n;let r=null===(n=this.getShape(e))||void 0===n?void 0:n.parentId;for(;Rn(r);){var i;if(t.selectedShapeIds.includes(r))return!1;r=null===(i=this.getShape(r))||void 0===i?void 0:i.parentId}return!0}));let r=null;if(e.length>0){const t=this.findCommonAncestor(Q(e.map((e=>this.getShape(e)))),(e=>this.isShapeOfType(e,"group")));t&&(r=t)}else null!==t&&void 0!==t&&t.focusedGroupId&&(r=t.focusedGroupId);var n;if(e.length!==t.selectedShapeIds.length||r!==t.focusedGroupId)this.store.put([{...t,selectedShapeIds:e,focusedGroupId:null!==(n=r)&&void 0!==n?n:null}])}})),this.sideEffects.registerAfterCreateHandler("shape",(e=>{this.isShapeOfType(e,"arrow")&&b(e)})),this.sideEffects.registerAfterCreateHandler("page",(e=>{const t=Tt.createId(e.id),n=Jt.createId(e.id);this.store.has(t)||this.store.put([Tt.create({id:t})]),this.store.has(n)||this.store.put([Jt.create({id:n,pageId:e.id})])})),this._currentPageShapeIds=((e,t)=>{const n=e.query.ids("shape");let r=null;function i(){const i=t();return r=i,new Set([...n.value].filter((t=>ec(e,i,e.get(t)))))}return N("_shapeIdsInCurrentPage",((n,o)=>{if(O(n))return i();const s=t();if(s!==r)return i();const a=e.history.getDiffSince(o);if(a===x)return i();const l=new G(n);for(const t of a){for(const n of Object.values(t.added))zn(n)&&ec(e,s,n)&&l.add(n.id);for(const[n,r]of Object.values(t.updated))zn(r)&&(ec(e,s,r)?l.add(r.id):l.remove(r.id));for(const e of Object.keys(t.removed))Rn(e)&&l.remove(e)}const c=l.get();return c?z(c.value,c.diff):n}))})(this.store,(()=>this.currentPageId)),this._parentIdsToChildIds=(e=>{const t=e.query.ids("shape");function n(){const n={},r=t.value,i=Array(r.size);return r.forEach((t=>i.push(e.get(t)))),i.sort(Xl),i.forEach((e=>{n[e.parentId]||(n[e.parentId]=[]),n[e.parentId].push(e.id)})),n}return N("parentsToChildrenWithIndexes",((t,r)=>{var i;if(O(t))return n();const o=e.history.getDiffSince(r);if(o===x)return n();if(0===o.length)return t;let s=null;const a=e=>{s||(s={...t}),s[e]?s[e]===t[e]&&(s[e]=[...s[e]]):s[e]=[]},l=new Set;let c;for(let e=0,n=o.length;e<n;e++){c=o[e];for(const e of Object.values(c.added))zn(e)&&(a(e.parentId),s[e.parentId].push(e.id),l.add(s[e.parentId]));for(const[e,t]of Object.values(c.updated))if(zn(t)&&zn(e))if(e.parentId!==t.parentId)a(e.parentId),a(t.parentId),s[e.parentId].splice(s[e.parentId].indexOf(t.id),1),s[t.parentId].push(t.id),l.add(s[t.parentId]);else if(e.index!==t.index){a(t.parentId);const e=s[t.parentId].indexOf(t.id);s[t.parentId][e]=t.id,l.add(s[t.parentId])}for(const e of Object.values(c.removed))zn(e)&&(a(e.parentId),s[e.parentId].splice(s[e.parentId].indexOf(e.id),1))}for(const n of l){const t=Q(n.map((t=>e.get(t))));t.sort(Xl),n.splice(0,n.length,...t.map((e=>e.id)))}return null!==(i=s)&&void 0!==i?i:t}))})(this.store),this.disposables.add(this.store.listen((e=>{this.emit("change",e)}))),this.store.ensureStoreIsUsable(),this._setInstancePageState({editingShapeId:null,hoveredShapeId:null,erasingShapeIds:[]},{ephemeral:!0}),a&&void 0===this.root.children[a])throw Error('No state found for initialState "'.concat(a,'".'));this.root.enter(void 0,"initial"),this.instanceState.followingUserId&&this.stopFollowingUser(),this.updateRenderingBounds(),requestAnimationFrame((()=>{this._tickManager.start()}))}dispose(){this.disposables.forEach((e=>e())),this.disposables.clear()}getShapeUtil(e){const t="string"===typeof e?e:e.type,n=fe(this.shapeUtils,t);return te(n,'No shape util found for type "'.concat(t,'"')),n}undo(){return this.history.undo(),this}get canUndo(){return this.history.numUndos>0}redo(){return this.history.redo(),this}get canRedo(){return this.history.numRedos>0}mark(e,t,n){return this.history.mark(e,t,n),this}bail(){return this.history.bail(),this}bailToMark(e){return this.history.bailToMark(e),this}batch(e){return this.history.batch(e),this}get _arrowBindingsIndex(){return(e=>{const{store:t}=e,n=t.query.filterHistory("shape"),r=t.query.records("shape",(()=>({type:{eq:"arrow"}})));function i(){const e=r.value,t={};for(const n of e){const{start:e,end:r}=n.props;if("binding"===e.type){const r=t[e.boundShapeId];r?r.push({arrowId:n.id,handleId:"start"}):t[e.boundShapeId]=[{arrowId:n.id,handleId:"start"}]}if("binding"===r.type){const e=t[r.boundShapeId];e?e.push({arrowId:n.id,handleId:"end"}):t[r.boundShapeId]=[{arrowId:n.id,handleId:"end"}]}}return t}return N("arrowBindingsIndex",((t,r)=>{var o;if(O(t))return i();const s=t,a=n.getDiffSince(r);if(a===x)return i();let l;function c(e){l||(l={...s}),l[e]?l[e]===s[e]&&(l[e]=[...l[e]]):l[e]=[]}function u(e,t,n){c(e),l[e]=l[e].filter((e=>e.arrowId!==t||e.handleId!==n)),0===l[e].length&&delete l[e]}function d(e,t,n){c(e),l[e].push({arrowId:t,handleId:n})}for(const n of a){for(const t of Object.values(n.added))if(e.isShapeOfType(t,"arrow")){const{start:e,end:n}=t.props;"binding"===e.type&&d(e.boundShapeId,t.id,"start"),"binding"===n.type&&d(n.boundShapeId,t.id,"end")}for(const[t,r]of Object.values(n.updated))if(e.isShapeOfType(t,"arrow")&&e.isShapeOfType(r,"arrow"))for(const e of["start","end"]){const n=t.props[e],i=r.props[e];"binding"===n.type&&"point"===i.type?u(n.boundShapeId,t.id,e):"point"===n.type&&"binding"===i.type?d(i.boundShapeId,r.id,e):"binding"===n.type&&"binding"===i.type&&n.boundShapeId!==i.boundShapeId&&(u(n.boundShapeId,t.id,e),d(i.boundShapeId,r.id,e))}for(const t of Object.values(n.removed))if(e.isShapeOfType(t,"arrow")){const{start:e,end:n}=t.props;"binding"===e.type&&u(e.boundShapeId,t.id,"start"),"binding"===n.type&&u(n.boundShapeId,t.id,"end")}}return null!==(o=l)&&void 0!==o?o:s}))})(this)}getArrowsBoundTo(e){return this._arrowBindingsIndex.value[e]||p}get arrowInfoCache(){return this.store.createComputedCache("arrow infoCache",(e=>Mc(e)?Rc(this,e):Uc(this,e)))}getArrowInfo(e){const t="string"===typeof e?e:e.id;return this.arrowInfoCache.get(t)}annotateError(e,t){let{origin:n,willCrashApp:r,tags:i,extras:o}=t;const s=this.createErrorAnnotations(n,r);return oe(e,{tags:{...s.tags,...i},extras:{...s.extras,...o}}),r&&this.store.markAsPossiblyCorrupted(),this}createErrorAnnotations(e,t){try{return{tags:{origin:e,willCrashApp:t},extras:{activeStateNode:this.root.path.value,selectedShapes:this.selectedShapes,editingShape:this.editingShapeId?this.getShape(this.editingShapeId):void 0,inputs:this.inputs}}}catch{return{tags:{origin:e,willCrashApp:t},extras:{}}}}get crashingError(){return this._crashingError}crash(e){return this._crashingError=e,this.store.markAsPossiblyCorrupted(),this.emit("crash",{error:e}),this}isIn(e){const t=e.split(".").reverse();let n=this.root;for(;t.length>0;){const e=t.pop();if(!e)return!0;const r=n.current.value;if((null===r||void 0===r?void 0:r.id)!==e)return!1;if(0===t.length)return!0;n=r}return!1}isInAny(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.some((e=>this.isIn(e)))}setCurrentTool(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.root.transition(e,t),this}get currentTool(){return this.root.current.value}get currentToolId(){var e;const{currentTool:t}=this;return t?null!==(e=t.currentToolIdMask)&&void 0!==e?e:t.id:""}getStateDescendant(e){const t=e.split(".").reverse();let n=this.root;for(;t.length>0;){var r;const e=t.pop();if(!e)return n;const i=null===(r=n.children)||void 0===r?void 0:r[e];if(!i)return;n=i}return n}get documentSettings(){return this.store.get(fn)}updateDocumentSettings(e){return this.store.put([{...this.documentSettings,...e}]),this}get instanceState(){return this.store.get(Yt)}updateInstanceState(e,t){return this._updateInstanceState(e,{ephemeral:!0,squashing:!0,...t}),void 0!==e.isChangingStyle&&(clearTimeout(this._isChangingStyleTimeout),!0===e.isChangingStyle&&(this._isChangingStyleTimeout=setTimeout((()=>{this.updateInstanceState({isChangingStyle:!1})}),2e3))),this}get openMenus(){return this.instanceState.openMenus}addOpenMenu(e){const t=new Set(this.openMenus);return t.has(e)||(t.add(e),this.updateInstanceState({openMenus:[...t]})),this}deleteOpenMenu(e){const t=new Set(this.openMenus);return t.has(e)&&(t.delete(e),this.updateInstanceState({openMenus:[...t]})),this}get isMenuOpen(){return this.openMenus.length>0}get pageStates(){return this._pageStates.value}get _pageStates(){return this.store.query.records("instance_page_state")}get currentPageState(){return this.store.get(this._currentPageStateId)}get _currentPageStateId(){return Jt.createId(this.currentPageId)}updateCurrentPageState(e,t){return this._setInstancePageState(e,t),this}get selectedShapeIds(){return this.currentPageState.selectedShapeIds}get selectedShapes(){const{selectedShapeIds:e}=this.currentPageState;return Q(e.map((e=>this.store.get(e))))}setSelectedShapes(e,t){const n=e.map((e=>"string"===typeof e?e:e.id));return this._setSelectedShapes(n,t),this}isAncestorSelected(e){var t;const n="string"===typeof e?e:null!==(t=null===e||void 0===e?void 0:e.id)&&void 0!==t?t:null,r=this.getShape(n);if(!r)return!1;const{selectedShapeIds:i}=this;return!!this.findShapeAncestor(r,(e=>i.includes(e.id)))}select(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r="string"===typeof t[0]?t:t.map((e=>e.id));return this.setSelectedShapes(r),this}deselect(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r="string"===typeof t[0]?t:t.map((e=>e.id)),{selectedShapeIds:i}=this;return i.length>0&&r.length>0&&this.setSelectedShapes(i.filter((e=>!r.includes(e)))),this}selectAll(){const e=this.getSortedChildIdsForParent(this.currentPageId);return e.length<=0||this.setSelectedShapes(this._getUnlockedShapeIds(e)),this}selectNone(){return this.selectedShapeIds.length>0&&this.setSelectedShapes([]),this}get onlySelectedShape(){const{selectedShapes:e}=this;return 1===e.length?e[0]:null}get selectionPageBounds(){const{currentPageState:{selectedShapeIds:e}}=this;return 0===e.length?null:Ti.Common(Q(e.map((e=>this.getShapePageBounds(e)))))}get selectionRotation(){const{selectedShapeIds:e}=this;if(0===e.length)return 0;if(1===e.length)return this.getShapePageTransform(this.selectedShapeIds[0]).rotation();const t=e.map((e=>this.getShapePageTransform(e).rotation()));return t.every((e=>Math.abs(e-t[0])<Math.PI/180))?this.getShapePageTransform(e[0]).rotation():0}get selectionRotatedPageBounds(){const{selectedShapeIds:e}=this;if(0===e.length)return;const{selectionRotation:t}=this;if(0===t)return this.selectionPageBounds;if(1===e.length){const t=this.getShapeGeometry(e[0]).bounds.clone(),n=this.getShapePageTransform(e[0]);return t.point=n.applyToPoint(t.point),t}const n=Ti.FromPoints(this.selectedShapeIds.flatMap((e=>{const t=this.getShapePageTransform(e);return t?t.applyToPoints(this.getShapeGeometry(e).vertices):[]})).map((e=>Ei.Rot(e,-t))));return n.point=n.point.rot(t),n}get focusedGroupId(){var e;return null!==(e=this.currentPageState.focusedGroupId)&&void 0!==e?e:this.currentPageId}get focusedGroup(){const{focusedGroupId:e}=this;return e?this.getShape(e):void 0}setFocusedGroup(e){var t;const n="string"===typeof e?e:null!==(t=null===e||void 0===e?void 0:e.id)&&void 0!==t?t:null;if(null!==n){const e=this.getShape(n);if(!e)throw Error("Editor.setFocusedGroup: Shape with id ".concat(n," does not exist"));if(!this.isShapeOfType(e,"group"))throw Error("Editor.setFocusedGroup: Cannot set focused group to shape of type ".concat(e.type))}return n===this.focusedGroupId||this._setFocusedGroupId(n),this}popFocusedGroupId(){const{focusedGroup:e}=this;if(e){var t;const n=this.findShapeAncestor(e,(e=>this.isShapeOfType(e,"group")));this.setFocusedGroup(null!==(t=null===n||void 0===n?void 0:n.id)&&void 0!==t?t:null),this.select(e.id)}else this.setFocusedGroup(null),this.selectNone();return this}get editingShapeId(){return this.currentPageState.editingShapeId}get editingShape(){const{editingShapeId:e}=this;return e?this.getShape(e):void 0}setEditingShape(e){var t;const n="string"===typeof e?e:null!==(t=null===e||void 0===e?void 0:e.id)&&void 0!==t?t:null;if(n!==this.editingShapeId){if(n){const e=this.getShape(n);if(e&&this.getShapeUtil(e).canEdit(e))return this._setInstancePageState({editingShapeId:n}),this}this._setInstancePageState({editingShapeId:null})}return this}get hoveredShapeId(){return this.currentPageState.hoveredShapeId}get hoveredShape(){const{hoveredShapeId:e}=this;return e?this.getShape(e):void 0}setHoveredShape(e){var t;const n="string"===typeof e?e:null!==(t=null===e||void 0===e?void 0:e.id)&&void 0!==t?t:null;return n===this.hoveredShapeId||this.updateCurrentPageState({hoveredShapeId:n},{ephemeral:!0}),this}get hintingShapeIds(){return this.currentPageState.hintingShapeIds}get hintingShapes(){const{hintingShapeIds:e}=this;return Q(e.map((e=>this.getShape(e))))}setHintingShapes(e){const t="string"===typeof e[0]?e:e.map((e=>e.id));return this.updateCurrentPageState({hintingShapeIds:X(t)},{ephemeral:!0}),this}get erasingShapeIds(){return this.currentPageState.erasingShapeIds}get erasingShapes(){const{erasingShapeIds:e}=this;return Q(e.map((e=>this.getShape(e))))}setErasingShapes(e){const t="string"===typeof e[0]?e:e.map((e=>e.id));t.sort();const{erasingShapeIds:n}=this;if(t.length===n.length){for(let r=0;r<t.length;r++)if(t[r]!==n[r]){this._setInstancePageState({erasingShapeIds:t},{ephemeral:!0});break}}else this._setInstancePageState({erasingShapeIds:t},{ephemeral:!0});return this}get croppingShapeId(){return this.currentPageState.croppingShapeId}setCroppingShape(e){var t;const n="string"===typeof e?e:null!==(t=null===e||void 0===e?void 0:e.id)&&void 0!==t?t:null;if(n!==this.croppingShapeId)if(n){const e=this.getShape(n),t=this.getShapeUtil(e);e&&t.canCrop(e)&&this.updateCurrentPageState({croppingShapeId:n})}else this.updateCurrentPageState({croppingShapeId:null});return this}get cameraId(){return Tt.createId(this.currentPageId)}get camera(){return this.store.get(this.cameraId)}get zoomLevel(){return this.camera.z}_setCamera(e){const t=this.camera;return t.x===e.x&&t.y===e.y&&t.z===e.z||this.batch((()=>{var n;this.store.put([{...t,...e}]);const{currentScreenPoint:r}=this.inputs;this.dispatch({type:"pointer",target:"canvas",name:"pointer_move",point:r,pointerId:Po,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,shiftKey:this.inputs.shiftKey,button:0,isPen:null!==(n=this.instanceState.isPenMode)&&void 0!==n&&n}),this._tickCameraState()})),this}setCamera(e,t){const n=Number.isFinite(e.x)?e.x:0,r=Number.isFinite(e.y)?e.y:0,i=Number.isFinite(e.z)?e.z:this.zoomLevel;if(this.stopCameraAnimation(),this.instanceState.followingUserId&&this.stopFollowingUser(),t){const{width:e,height:o}=this.viewportScreenBounds;return this._animateToViewport(new Ti(-n,-r,e/i,o/i),t)}return this._setCamera({x:n,y:r,z:i}),this}centerOnPoint(e,t){if(!this.instanceState.canMoveCamera)return this;const{viewportPageBounds:{width:n,height:r},camera:i}=this;return this.setCamera({x:-(e.x-n/2),y:-(e.y-r/2),z:i.z},t),this}zoomToContent(){var e;const t=null!==(e=this.selectionPageBounds)&&void 0!==e?e:this.currentPageBounds;return t&&this.zoomToBounds(t,Math.min(1,this.zoomLevel),{duration:220}),this}zoomToFit(e){if(!this.instanceState.canMoveCamera)return this;const t=[...this.currentPageShapeIds];if(t.length<=0)return this;const n=Ti.Common(Q(t.map((e=>this.getShapePageBounds(e)))));return this.zoomToBounds(n,void 0,e),this}resetZoom(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.viewportScreenCenter,t=arguments.length>1?arguments[1]:void 0;if(!this.instanceState.canMoveCamera)return this;const{x:n,y:r,z:i}=this.camera,{x:o,y:s}=e;return this.setCamera({x:n+(o/1-o)-(o/i-o),y:r+(s/1-s)-(s/i-s),z:1},t),this}zoomIn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.viewportScreenCenter,t=arguments.length>1?arguments[1]:void 0;if(!this.instanceState.canMoveCamera)return this;const{x:n,y:r,z:i}=this.camera;let o=yo;for(let l=1;l<go.length;l++){const e=go[l];if(!(e-i<=(e-go[l-1])/2)){o=e;break}}const{x:s,y:a}=e;return this.setCamera({x:n+(s/o-s)-(s/i-s),y:r+(a/o-a)-(a/i-a),z:o},t),this}zoomOut(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.viewportScreenCenter,t=arguments.length>1?arguments[1]:void 0;if(!this.instanceState.canMoveCamera)return this;const{x:n,y:r,z:i}=this.camera;let o=mo;for(let l=go.length-1;l>0;l--){const e=go[l-1],t=go[l];if(!(t-i>=(t-e)/2)){o=e;break}}const{x:s,y:a}=e;return this.setCamera({x:n+(s/o-s)-(s/i-s),y:r+(a/o-a)-(a/i-a),z:o},t),this}zoomToSelection(e){if(!this.instanceState.canMoveCamera)return this;const{selectionPageBounds:t}=this;return t?(this.zoomToBounds(t,Math.max(1,this.zoomLevel),e),this):this}panZoomIntoView(e,t){if(!this.instanceState.canMoveCamera)return this;if(e.length<=0)return this;const n=Ti.Common(Q(e.map((e=>this.getShapePageBounds(e))))),{viewportPageBounds:r}=this;if(r.h<n.h||r.w<n.w)return this.zoomToBounds(n,this.camera.z,t),this;{const e=this.viewportPageBounds.clone().expandBy(-32/this.zoomLevel);let r=0,i=0;e.maxY<n.maxY?i=e.maxY-n.maxY:e.minY>n.minY&&(i=e.minY-n.minY),e.maxX<n.maxX?r=e.maxX-n.maxX:e.minX>n.minX&&(r=e.minX-n.minX);const{camera:o}=this;this.setCamera({x:o.x+r,y:o.y+i,z:o.z},t)}return this}zoomToBounds(e,t,n){if(!this.instanceState.canMoveCamera)return this;const{viewportScreenBounds:r}=this,i=Math.min(256,.28*r.width);let o=Ni(Math.min((r.width-i)/e.width,(r.height-i)/e.height),mo,yo);return void 0!==t&&(o=Math.min(t,o)),this.setCamera({x:-e.minX+(r.width-e.width*o)/2/o,y:-e.minY+(r.height-e.height*o)/2/o,z:o},n),this}pan(e,t){if(!this.instanceState.canMoveCamera)return this;const{x:n,y:r,z:i}=this.camera;return this.setCamera({x:n+e.x/i,y:r+e.y/i,z:i},t),this}stopCameraAnimation(){return this.emit("stop-camera-animation"),this}_animateViewport(e){if(!this._viewportAnimation)return;const t=()=>{this.removeListener("tick",this._animateViewport),this.removeListener("stop-camera-animation",t),this._viewportAnimation=null};this.once("stop-camera-animation",t),this._viewportAnimation.elapsed+=e;const{elapsed:n,easing:r,duration:i,start:o,end:s}=this._viewportAnimation;if(n>i)return this._setCamera({x:-s.x,y:-s.y,z:this.viewportScreenBounds.width/s.width}),void t();const a=r(1-(i-n)/i),l=o.minX+(s.minX-o.minX)*a,c=o.minY+(s.minY-o.minY)*a,u=o.maxX+(s.maxX-o.maxX)*a;this._setCamera({x:-l,y:-c,z:this.viewportScreenBounds.width/(u-l)})}_animateToViewport(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{duration:n=0,easing:r=Ci.easeInOutCubic}=t,{user:{animationSpeed:i},viewportPageBounds:o}=this;return this.stopCameraAnimation(),this.instanceState.followingUserId&&this.stopFollowingUser(),0===n||0===i?this._setCamera({x:-e.x,y:-e.y,z:this.viewportScreenBounds.width/e.width}):(this._viewportAnimation={elapsed:0,duration:n/i,easing:r,start:o.clone(),end:e.clone()},this.addListener("tick",this._animateViewport),this)}slideCamera(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.instanceState.canMoveCamera)return this;this.stopCameraAnimation();const{animationSpeed:t}=this.user;if(0===t)return this;const{speed:n,friction:r,direction:i,speedThreshold:o=.01}=e;let s=Math.min(n,1);const a=()=>{this.removeListener("tick",l),this.removeListener("stop-camera-animation",a)};this.once("stop-camera-animation",a);const l=e=>{const{x:t,y:n,z:l}=this.camera,c=Ei.Mul(i,s*e/l);s*=1-r,s<o?a():this._setCamera({x:t+c.x,y:n+c.y,z:l})};return this.addListener("tick",l),this}animateToUser(e){const t=[...this.store.query.records("instance_presence",(()=>({userId:{eq:e}}))).value].sort(((e,t)=>e.lastActivityTimestamp-t.lastActivityTimestamp)).pop();return t?(this.batch((()=>{null!==this.instanceState.followingUserId&&this.stopFollowingUser();const n=t.currentPageId===this.currentPageId;n||this.setCurrentPage(t.currentPageId);const r=n?{duration:500}:void 0;this.centerOnPoint(t.cursor,r);const{highlightedUserIds:i}=this.instanceState;this.updateInstanceState({highlightedUserIds:[...i,e]}),setTimeout((()=>{const t=[...this.instanceState.highlightedUserIds],n=t.indexOf(e);n<0||(t.splice(n,1),this.updateInstanceState({highlightedUserIds:t}))}),_o)})),this):this}animateToShape(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wo;if(!this.instanceState.canMoveCamera)return this;const n=this.viewportScreenBounds.clone().expandBy(-32),r=n.width/n.height,i=this.getShapePageBounds(e);if(!i)return this;const o=i.width/i.height,s=i.clone(),a=i.width/n.width;return s.width+=(n.minX+n.maxX)*a,s.height+=(n.minY+n.maxY)*a,s.x-=n.minX*a,s.y-=n.minY*a,o>r?(s.height=i.width/r,s.y-=(s.height-i.height)/2):(s.width=i.height*r,s.x-=(s.width-i.width)/2),this._animateToViewport(s,t)}updateViewportScreenBounds(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this.getContainer();if(!t)return this;const n=t.getBoundingClientRect(),r=new Ti(n.left||n.x,n.top||n.y,Math.max(n.width,1),Math.max(n.height,1)),i=r.equals(this.viewportScreenBounds),{_willSetInitialBounds:o}=this;if(i)this._willSetInitialBounds=!1;else if(o)this._willSetInitialBounds=!1,this.updateInstanceState({screenBounds:r.toJson()},{squashing:!0,ephemeral:!0});else if(e&&!this.instanceState.followingUserId){const e=this.viewportPageCenter;this.updateInstanceState({screenBounds:r.toJson()},{squashing:!0,ephemeral:!0}),this.centerOnPoint(e)}else this.updateInstanceState({screenBounds:r.toJson()},{squashing:!0,ephemeral:!0});return this._tickCameraState(),this.updateRenderingBounds(),this}get viewportScreenBounds(){const{x:e,y:t,w:n,h:r}=this.instanceState.screenBounds;return new Ti(e,t,n,r)}get viewportScreenCenter(){return this.viewportScreenBounds.center}get viewportPageBounds(){const{w:e,h:t}=this.viewportScreenBounds,{x:n,y:r,z:i}=this.camera;return new Ti(-n,-r,e/i,t/i)}get viewportPageCenter(){return this.viewportPageBounds.center}screenToPage(e){var t;const{screenBounds:n}=this.store.unsafeGetWithoutCapture(Yt),{x:r,y:i,z:o=1}=this.camera;return{x:(e.x-n.x)/o-r,y:(e.y-n.y)/o-i,z:null!==(t=e.z)&&void 0!==t?t:.5}}pageToScreen(e){var t;const{screenBounds:n}=this.store.unsafeGetWithoutCapture(Yt),{x:r,y:i,z:o=1}=this.camera;return{x:(e.x+r)*o+n.x,y:(e.y+i)*o+n.y,z:null!==(t=e.z)&&void 0!==t?t:.5}}startFollowingUser(e){const t=this.store.query.records("instance_presence",(()=>({userId:{eq:e}}))),n=this.user.id;if(n||console.warn("You should set the userId for the current instance before following a user"),t.value.some((e=>e.followingUserId===n)))return this;M((()=>{this.stopFollowingUser(),this.updateInstanceState({followingUserId:e},{ephemeral:!0})}));const r=()=>{this.removeListener("frame",o),this.removeListener("stop-following",r)};let i=!1;const o=()=>{const r=[...t.value].sort(((e,t)=>e.lastActivityTimestamp-t.lastActivityTimestamp)).pop();if(!r)return void this.stopFollowingUser();const o=r.currentPageId===this.currentPageId,s=o?.5:1;if(!o)return this.stopFollowingUser(),this.setCurrentPage(r.currentPageId),void this.startFollowingUser(e);const{center:a,width:l,height:c}=this.viewportPageBounds,u=Ti.From(r.screenBounds),d=u.width/r.camera.z,h=u.height/r.camera.z,p=new Ei(d/2-r.camera.x,h/2-r.camera.y),f=l+(d-l)*s,g=c+(h-c)*s,m=r.followingUserId===n?c/g:Math.min(l/f,c/g),y=Ni(this.camera.z*m,mo,yo),v=this.viewportScreenBounds.w/y,b=this.viewportScreenBounds.h/y,w=p.sub(a),x=Ei.Add(a,Ei.Mul(w,s)),S=Ei.Sub(x,a).len(),k=Math.abs(y-this.camera.z);S<.1&&k<.005?i=!0:i&&S<.2&&k<.05||(i=!1,this.stopCameraAnimation(),this._setCamera({x:-(x.x-v/2),y:-(x.y-b/2),z:y}))};return this.once("stop-following",r),this.addListener("frame",o),this}stopFollowingUser(){return this.updateInstanceState({followingUserId:null},{ephemeral:!0}),this.emit("stop-following"),this}get cameraState(){return this._cameraState.value}getUnorderedRenderingShapes(e){const t=[];let n=4e3,r=po;const i=this.editingShapeId,o=this.selectedShapeIds,s=this.erasingShapeIds,a=this.renderingBoundsExpanded,l=Number.isFinite(this.renderingBoundsMargin),c=(u,d,h)=>{const p=this.getShape(u);if(!p)return;d*=p.opacity;let f=!1,g=!1;const m=this.getShapeUtil(p),y=this.getShapeMaskedPageBounds(u);e&&(g=!h&&s.includes(u),g&&(d*=.32),f=l&&m.canUnmount(p)&&i!==u&&(void 0===y||!a.includes(y)&&!o.includes(u))),t.push({id:u,shape:p,util:m,index:n,backgroundIndex:r,opacity:d,isCulled:f,maskedPageBounds:y}),n+=1,r+=1;const v=this.getSortedChildIdsForParent(u);if(!v.length)return;let b=null;m.providesBackgroundForChildren(p)&&(b=r,r=n,n+=po);for(const e of v)c(e,d,h||g);null!==b&&(r=b)};for(const u of this.getSortedChildIdsForParent(this.currentPageId))c(u,1,!1);return t}get renderingShapes(){return this.getUnorderedRenderingShapes(!0).sort(Ee)}get renderingBounds(){return this._renderingBounds.value}get renderingBoundsExpanded(){return this._renderingBoundsExpanded.value}updateRenderingBounds(){const{viewportPageBounds:e}=this;return e.equals(this._renderingBounds.__unsafe__getWithoutCapture())||(this._renderingBounds.set(e.clone()),Number.isFinite(this.renderingBoundsMargin)?this._renderingBoundsExpanded.set(e.clone().expandBy(this.renderingBoundsMargin/this.zoomLevel)):this._renderingBoundsExpanded.set(e)),this}get _pages(){return this.store.query.records("page")}get pages(){return this._pages.value.sort(Xl)}get currentPage(){return this.getPage(this.currentPageId)}get currentPageId(){return this.instanceState.currentPageId}getPage(e){return this.store.get("string"===typeof e?e:e.id)}get currentPageShapeIds(){return this._currentPageShapeIds.value}getPageShapeIds(e){const t="string"===typeof e?e:e.id,n=this.store.query.exec("shape",{parentId:{eq:t}});return this.getShapeAndDescendantIds(n.map((e=>e.id)))}setCurrentPage(e,t){const n="string"===typeof e?e:e.id;return this._setCurrentPageId(n,t),this}updatePage(e,t){return this._updatePage(e,t),this}createPage(e){return this._createPage(e),this}deletePage(e){const t="string"===typeof e?e:e.id;return this._deletePage(t),this}duplicatePage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Vt.createId();if(this.pages.length>=40)return this;const n="string"===typeof e?e:e.id,r=this.getPage(n);if(!r)return this;const i={...this.camera},o=this.getContentFromCurrentPage(this.getSortedChildIdsForParent(r.id));return this.batch((()=>{var e;const{pages:n}=this,s=Yl(r.index,null===(e=n[n.indexOf(r)+1])||void 0===e?void 0:e.index);if(this.createPage({name:r.name+" Copy",id:t,index:s}),this.setCurrentPage(t),this.setCamera(i),o)return this.putContentOntoCurrentPage(o)})),this}renamePage(e,t,n){const r="string"===typeof e?e:e.id;return this.instanceState.isReadonly||this.updatePage({id:r,name:t},n),this}get _assets(){return this.store.query.records("asset")}get assets(){return this._assets.value}createAssets(e){return this._createAssets(e),this}updateAssets(e){return this._updateAssets(e),this}deleteAssets(e){const t="string"===typeof e[0]?e:e.map((e=>e.id));return this._deleteAssets(t),this}getAsset(e){return this.store.get("string"===typeof e?e:e.id)}get _shapeGeometryCache(){return this.store.createComputedCache("bounds",(e=>this.getShapeUtil(e).getGeometry(e)),((e,t)=>e.props===t.props))}getShapeGeometry(e){return this._shapeGeometryCache.get("string"===typeof e?e:e.id)}get _shapeOutlineSegmentsCache(){return this.store.createComputedCache("outline-segments",(e=>this.getShapeUtil(e).getOutlineSegments(e)))}getShapeOutlineSegments(e){var t;return null!==(t=this._shapeOutlineSegmentsCache.get("string"===typeof e?e:e.id))&&void 0!==t?t:p}get _shapeHandlesCache(){return this.store.createComputedCache("handles",(e=>{var t,n;return null===(t=(n=this.getShapeUtil(e)).getHandles)||void 0===t?void 0:t.call(n,e)}))}getShapeHandles(e){return this._shapeHandlesCache.get("string"===typeof e?e:e.id)}getShapeLocalTransform(e){const t="string"===typeof e?e:e.id,n=this.getShape(t);if(!n)throw Error("Editor.getTransform: shape not found");return ia.Identity().translate(n.x,n.y).rotate(n.rotation)}get _shapePageTransformCache(){return this.store.createComputedCache("pageTransformCache",(e=>{var t;if(Kt(e.parentId))return this.getShapeLocalTransform(e);const n=null!==(t=this._shapePageTransformCache.get(e.parentId))&&void 0!==t?t:ia.Identity();return ia.Compose(n,this.getShapeLocalTransform(e))}))}getShapeParentTransform(e){var t;const n="string"===typeof e?e:e.id,r=this.getShape(n);return!r||Kt(r.parentId)?ia.Identity():null!==(t=this._shapePageTransformCache.get(r.parentId))&&void 0!==t?t:ia.Identity()}getShapePageTransform(e){var t;const n="string"===typeof e?e:this.getShape(e).id;return null!==(t=this._shapePageTransformCache.get(n))&&void 0!==t?t:ia.Identity()}get _shapePageBoundsCache(){return this.store.createComputedCache("pageBoundsCache",(e=>{const t=this._shapePageTransformCache.get(e.id);if(!t)return new Ti;return Ti.FromPoints(ia.applyToPoints(t,this.getShapeGeometry(e).vertices))}))}getShapePageBounds(e){return this._shapePageBoundsCache.get("string"===typeof e?e:e.id)}get _shapeClipPathCache(){return this.store.createComputedCache("clipPathCache",(e=>{const t=this._shapeMaskCache.get(e.id);if(!t)return;const n=this._shapePageTransformCache.get(e.id);if(!n)return;if(0===t.length)return"polygon(0px 0px, 0px 0px, 0px 0px)";const r=ia.applyToPoints(ia.Inverse(n),t);return"polygon(".concat(r.map((e=>"".concat(e.x,"px ").concat(e.y,"px"))).join(","),")")}))}getShapeClipPath(e){return this._shapeClipPathCache.get("string"===typeof e?e:e.id)}get _shapeMaskCache(){return this.store.createComputedCache("pageMaskCache",(e=>{if(Kt(e.parentId))return;const t=this.getShapeAncestors(e.id).filter((e=>this.isShapeOfType(e,"frame")));if(0===t.length)return;const n=t.map((e=>this._shapePageTransformCache.get(e.id).applyToPoints(this.getShapeGeometry(e).vertices))).reduce(((e,t)=>{if(!t||!e)return;const n=yl(e,t);return n?n.map(Ei.Cast):[]}));return n}))}getShapeMask(e){return this._shapeMaskCache.get("string"===typeof e?e:e.id)}getShapeMaskedPageBounds(e){"string"!==typeof e&&(e=e.id);const t=this._shapePageBoundsCache.get(e);if(!t)return;const n=this._shapeMaskCache.get(e);if(n){const e=yl(n,t.corners);if(!e)return;return Ti.FromPoints(e)}return t}getShapeAncestors(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const n="string"===typeof e?e:e.id,r=this.getShape(n);if(!r)return t;const i=r.parentId;if(Kt(i))return t.reverse(),t;const o=this.store.get(i);return o?(t.push(o),this.getShapeAncestors(o,t)):t}findShapeAncestor(e,t){const n="string"===typeof e?e:e.id,r=this.getShape(n);if(!r)return;const i=r.parentId;if(Kt(i))return;const o=this.getShape(i);return o?t(o)?o:this.findShapeAncestor(o,t):void 0}hasAncestor(e,t){const n="string"===typeof e?e:null===e||void 0===e?void 0:e.id,r=n&&this.getShape(n);return!!r&&(r.parentId===t||this.hasAncestor(this.getShapeParent(r),t))}findCommonAncestor(e,t){if(0===e.length)return;const n=Q(("string"===typeof e[0]?e:e.map((e=>e.id))).map((e=>this.getShape(e))));if(1===n.length){var r;const e=n[0].parentId;if(Kt(e))return;return t?null===(r=this.findShapeAncestor(n[0],t))||void 0===r?void 0:r.id:e}const[i,...o]=n;let s=this.getShapeParent(i);for(;s;)if(!t||t(s)){if(o.every((e=>this.hasAncestor(e,s.id))))return s.id;s=this.getShapeParent(s)}else s=this.getShapeParent(s)}isShapeOrAncestorLocked(e){const t="string"===typeof e?this.getShape(e):e;return void 0!==t&&(!!t.isLocked||this.isShapeOrAncestorLocked(this.getShapeParent(t)))}get currentPageBounds(){let e;return this.currentPageShapeIds.forEach((t=>{const n=this.getShapeMaskedPageBounds(t);n&&(e=e?e.expand(n):n.clone())})),e}getSelectedShapeAtPoint(e){const{selectedShapeIds:t}=this;return this.currentPageShapesSorted.filter((e=>"group"!==e.type&&t.includes(e.id))).reverse().find((t=>this.isPointInShape(t,e,{hitInside:!0,margin:0})))}getShapeAtPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{viewportPageBounds:n,zoomLevel:r}=this,{filter:i,margin:o=0,hitLabels:s=!1,hitInside:a=!1,hitFrameInside:l=!1}=t;let c=1/0,u=null,d=1/0,h=null;const p=(t.renderingOnly?this.currentPageRenderingShapesSorted:this.currentPageShapesSorted).filter((t=>{if(this.isShapeOfType(t,"group"))return!1;const n=this.getShapeMask(t);return!(n&&!to(e,n))&&(!i||i(t))}));for(let f=p.length-1;f>=0;f--){const t=p[f],i=this.getShapeGeometry(t),g=i instanceof ll,m=this.getPointInShapeSpace(t,e);if((this.isShapeOfType(t,"arrow")||this.isShapeOfType(t,"geo")&&"none"===t.props.fill)&&t.props.text.trim())for(const e of i.children)if(e.isLabel&&e.isPointInBounds(m))return t;if(this.isShapeOfType(t,"frame")){const e=i.distanceToPoint(m,a);if(Math.abs(e)<=o)return h||t;if(i.hitTestPoint(m,0,!0))return h||u||(l?t:void 0);continue}let y;if(g){let e=1/0;for(const t of i.children){if(t.isLabel&&!s)continue;const n=t.distanceToPoint(m,a);n<e&&(e=n)}y=e}else y=0===o&&(i.bounds.w<1||i.bounds.h<1)||i.bounds.containsPoint(m,o)?i.distanceToPoint(m,a):1/0;if(i.isClosed){if(y<=o){if(i.isFilled||g&&i.children[0].isFilled)return h||t;if(this.getShapePageBounds(t).contains(n))continue;if(Math.abs(y)<o)Math.abs(y)<d&&(d=Math.abs(y),h=t);else if(!h){const{area:e}=i;e<c&&(c=e,u=t)}}}else if(y<8/r)return t}return h||u||void 0}getShapesAtPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.currentPageShapes.filter((n=>this.isPointInShape(n,e,t)))}isPointInShape(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{hitInside:r=!1,margin:i=0}=n,o="string"===typeof e?e:e.id,s=this.getShapeMask(o);return!(s&&!to(t,s))&&this.getShapeGeometry(o).hitTestPoint(this.getPointInShapeSpace(e,t),i,r)}getPointInShapeSpace(e,t){const n="string"===typeof e?e:e.id;return this._shapePageTransformCache.get(n).clone().invert().applyToPoint(t)}getPointInParentSpace(e,t){const n="string"===typeof e?e:e.id,r=this.getShape(n);if(!r)return new Ei(0,0);if(Kt(r.parentId))return Ei.From(t);const i=this.getShapePageTransform(r.parentId);return i?i.clone().invert().applyToPoint(t):Ei.From(t)}get currentPageShapes(){return Array.from(this.currentPageShapeIds,(e=>this.store.get(e)))}get currentPageShapesSorted(){const e=new Set(this.currentPageShapes.sort(Xl)),t=[];function n(r){t.push(r),e.delete(r),e.forEach((e=>{e.parentId===r.id&&n(e)}))}return e.forEach((e=>{zn(this.getShape(e.parentId))||n(e)})),t}get currentPageRenderingShapesSorted(){return this.renderingShapes.filter((e=>{let{isCulled:t}=e;return!t})).sort(((e,t)=>e.index-t.index)).map((e=>{let{shape:t}=e;return t}))}isShapeOfType(e,t){return("string"===typeof e?this.getShape(e):e).type===t}getShape(e){const t="string"===typeof e?e:e.id;if(Rn(t))return this.store.get(t)}getShapeParent(e){const t="string"===typeof e?e:null===e||void 0===e?void 0:e.id;if(!t)return;const n=this.getShape(t);return void 0!==n&&Rn(n.parentId)?this.store.get(n.parentId):void 0}getShapeNearestSibling(e,t){if(!t)return;if(t.parentId===e.parentId)return t;return this.findShapeAncestor(t,(t=>t.parentId===e.parentId))}isShapeInPage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.currentPageId;const n="string"===typeof e?e:e.id,r=this.getShape(n);if(!r)return!1;let i=!1;if(r.parentId===t)i=!0;else{let e=this.getShape(r.parentId);e:for(;e;){if(e.parentId===t){i=!0;break e}e=this.getShape(e.parentId)}}return i}getAncestorPageId(e){const t="string"===typeof e?e:null===e||void 0===e?void 0:e.id,n=t&&this.getShape(t);if(n)return Kt(n.parentId)?n.parentId:this.getAncestorPageId(this.getShape(n.parentId))}reparentShapes(e,t,n){const r="string"===typeof e[0]?e:e.map((e=>e.id)),i=[],o=Kt(t)?ia.Identity():this.getShapePageTransform(t),s=o.rotation();let a=[];const l=Q(this.getSortedChildIdsForParent(t).map((e=>this.getShape(e))));if(n){const e=l.find((e=>e.index===n));if(e){const t=l[l.indexOf(e)+1];a=t?Wl(n,t.index,r.length):$l(n,r.length)}else{const e=l.sort(Xl).find((e=>e.index>n));a=e?Wl(n,e.index,r.length):$l(n,r.length)}}else{const e=l.length&&l[l.length-1];a=e?$l(e.index,r.length):Gl(r.length)}const c=o.clone().invert(),u=Q(r.map((e=>this.getShape(e)))),d=u.filter((e=>e.isLocked));d.length&&this.updateShapes(d.map((e=>{let{id:t,type:n}=e;return{id:t,type:n,isLocked:!1}})));for(let h=0;h<u.length;h++){const e=u[h],n=this.getShapePageTransform(e);if(!n)continue;const r=n.point();if(!r)continue;const o=c.applyToPoint(r),l=n.rotation()-s;i.push({id:e.id,type:e.type,parentId:t,x:o.x,y:o.y,rotation:l,index:a[h],isLocked:e.isLocked})}return this.updateShapes(i),this}getHighestIndexForParent(e){const t="string"===typeof e?e:e.id,n=this._parentIdsToChildIds.value[t];if(!n||0===n.length)return"a1";return ql(this.getShape(n[n.length-1]).index)}getSortedChildIdsForParent(e){const t="string"===typeof e?e:e.id,n=this._parentIdsToChildIds.value[t];return n?this._childIdsCache.get(n,(()=>n)):p}visitDescendants(e,t){const n="string"===typeof e?e:e.id,r=this.getSortedChildIdsForParent(n);for(const i of r)!1!==t(i)&&this.visitDescendants(i,t);return this}getShapeAndDescendantIds(e){const t=new Set,n=[...e];for(;n.length>0;){const e=n.pop();if(!e)break;if(!t.has(e)){t.add(e);for(const t of this.getSortedChildIdsForParent(e))n.push(t)}}return t}getDroppingOverShape(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const{currentPageShapesSorted:n}=this;for(let r=n.length-1;r>=0;r--){const i=n[r];if(!this.getShapeUtil(i).canDropShapes(i,t)||t.find((e=>e.id===i.id||this.hasAncestor(i,e.id))))continue;const o=this.getShapeMaskedPageBounds(i.id);if(o&&o.containsPoint(e)&&this.getShapeGeometry(i).hitTestPoint(this.getPointInShapeSpace(i,e),0,!0))return i}}getOutermostSelectableShape(e,t){const n="string"===typeof e?e:e.id,r=this.getShape(n);let i=r,o=r;const{focusedGroup:s}=this;for(;o;){var a;if(!this.isShapeOfType(o,"group")||(null===s||void 0===s?void 0:s.id)===o.id||this.hasAncestor(s,o.id)||null!==(a=null===t||void 0===t?void 0:t(o))&&void 0!==a&&!a){if((null===s||void 0===s?void 0:s.id)===o.id)break}else i=o;o=this.getShapeParent(o)}return i}rotateShapesBy(e,t){if(("string"===typeof e[0]?e:e.map((e=>e.id))).length<=0)return this;const n=Zl({editor:this});return n?(Jl({delta:t,snapshot:n,editor:this,stage:"one-off"}),this):this}nudgeShapes(e,t,n){const r="string"===typeof e[0]?e:e.map((e=>e.id));if(r.length<=0)return this;const i=[];for(const a of r){var o,s;const e=this.getShape(a);if(!e)throw Error("Could not find a shape with the id ".concat(a,"."));const n=Ei.Cast(t),r=this.getShapeParentTransform(e);r&&n.rot(-r.rotation());const l=null===(o=(s=this.getShapeUtil(e)).onTranslateStart)||void 0===o?void 0:o.call(s,e);i.push(l?{...l,x:e.x+n.x,y:e.y+n.y}:{id:a,x:e.x+n.x,y:e.y+n.y,type:e.type})}return this.updateShapes(i,{squashing:!0,...n}),this}duplicateShapes(e,t){const n="string"===typeof e[0]?e:e.map((e=>e.id));if(n.length<=0)return this;const r=new Set(n),i=[],o=[...n];for(;o.length>0;){const e=o.pop();if(!e)break;i.push(e),this.getSortedChildIdsForParent(e).forEach((e=>o.push(e)))}i.reverse();const s=new Map(i.map((e=>[e,Dn()]))),a=Q(i.map((e=>{var n;const i=this.getShape(e);if(!i)return null;const o=s.get(e);let a=0,l=0;if(t&&r.has(e)){const e=this.getShapeParentTransform(i),n=new Ei(t.x,t.y).rot(-e.rotation());a=n.x,l=n.y}const c=null!==(n=i.parentId)&&void 0!==n?n:this.currentPageId,u=this.getSortedChildIdsForParent(c),d=u.indexOf(i.id),h=u[d+1],p=h?this.getShape(h):null,f=p?Yl(i.index,p.index):ql(i.index);let g=ge(i);if(this.isShapeOfType(i,"arrow")&&this.isShapeOfType(g,"arrow")){const e=this.getArrowInfo(i);let t,n;if("binding"===i.props.start.type&&(t=s.get(i.props.start.boundShapeId),!t))if(null!==e&&void 0!==e&&e.isValid){const{x:t,y:n}=e.start.point;g.props.start={type:"point",x:t,y:n}}else{const{start:e}=jc(this,i);g.props.start={type:"point",x:e.x,y:e.y}}if("binding"===i.props.end.type&&(n=s.get(i.props.end.boundShapeId),!n))if(null!==e&&void 0!==e&&e.isValid){const{x:t,y:n}=e.end.point;g.props.end={type:"point",x:t,y:n}}else{const{end:e}=jc(this,i);g.props.start={type:"point",x:e.x,y:e.y}}const r=Mc(g)?Rc(this,g):Uc(this,g);if(null!==e&&void 0!==e&&e.isValid&&null!==r&&void 0!==r&&r.isValid&&!Mc(i)){const t=Ei.Med(e.start.handle,e.end.handle),n=Ei.Dist(e.middle,t),i=Ei.Dist(r.middle,t);g.props.bend<0?g.props.bend+=i-n:g.props.bend-=i-n}"binding"===g.props.start.type&&t&&(g.props.start.boundShapeId=t),"binding"===g.props.end.type&&n&&(g.props.end.boundShapeId=n)}return g={...g,id:o,x:i.x+a,y:i.y+l,index:f},g})));return a.forEach((e=>{Rn(e.parentId)&&s.has(e.parentId)&&(e.parentId=s.get(e.parentId))})),this.history.batch((()=>{const e=a.length+this.currentPageShapeIds.size>po;e&&eu(this);const n=e?a.slice(0,po-this.currentPageShapeIds.size):a,r=n.map((e=>e.id));if(this.createShapes(n),this.setSelectedShapes(r),void 0!==t){const{viewportPageBounds:e,selectionPageBounds:t}=this;t&&!e.contains(t)&&this.centerOnPoint(t.center,{duration:fo})}})),this}moveShapesToPage(e,t){const n="string"===typeof e[0]?e:e.map((e=>e.id));if(0===n.length)return this;if(this.instanceState.isReadonly)return this;const{currentPageId:r}=this;if(t===r)return this;if(!this.store.has(t))return this;const i=this.getContentFromCurrentPage(n);if(!i)return this;if(this.getPageShapeIds(t).size+i.shapes.length>po)return eu(this,t),this;const o=this.camera.z;return this.history.batch((()=>{this.deleteShapes(n),this.setCurrentPage(t),this.setFocusedGroup(null),this.selectNone(),this.putContentOntoCurrentPage(i,{select:!0,preserveIds:!0,preservePosition:!0}),this.setCamera({...this.camera,z:o}),this.centerOnPoint(this.selectionRotatedPageBounds.center)})),this}toggleLock(e){const t="string"===typeof e[0]?e:e.map((e=>e.id));if(this.instanceState.isReadonly||0===t.length)return this;let n=!0,r=!0;const i=[];for(const o of t){const e=this.getShape(o);e&&(i.push(e),e.isLocked?r=!1:n=!1)}return this.batch((()=>{r?(this.updateShapes(i.map((e=>({id:e.id,type:e.type,isLocked:!0})))),this.setSelectedShapes([])):n?this.updateShapes(i.map((e=>({id:e.id,type:e.type,isLocked:!1})))):this.updateShapes(i.map((e=>({id:e.id,type:e.type,isLocked:!0}))))})),this}sendToBack(e){const t=Ql(this,"toBack","string"===typeof e[0]?e:e.map((e=>e.id)));return t&&this.updateShapes(t),this}sendBackward(e){const t=Ql(this,"backward","string"===typeof e[0]?e:e.map((e=>e.id)));return t&&this.updateShapes(t),this}bringForward(e){const t=Ql(this,"forward","string"===typeof e[0]?e:e.map((e=>e.id)));return t&&this.updateShapes(t),this}bringToFront(e){const t=Ql(this,"toFront","string"===typeof e[0]?e:e.map((e=>e.id)));return t&&this.updateShapes(t),this}flipShapes(e,t){const n="string"===typeof e[0]?e:e.map((e=>e.id));if(this.instanceState.isReadonly)return this;let r=Q(n.map((e=>this.getShape(e))));if(!r.length)return this;r=Q(r.map((e=>this.isShapeOfType(e,"group")?this.getSortedChildIdsForParent(e.id).map((e=>this.getShape(e))):e)).flat());const i=Ti.Common(Q(r.map((e=>this.getShapePageBounds(e))))).center;return this.batch((()=>{for(const e of r){const n=this.getShapeGeometry(e).bounds,r=this.getShapePageTransform(e.id);r&&this.resizeShape(e.id,{x:"horizontal"===t?-1:1,y:"vertical"===t?-1:1},{initialBounds:n,initialPageTransform:r,initialShape:e,mode:"scale_shape",scaleOrigin:i,scaleAxisRotation:0})}})),this}stackShapes(e,t,n){const r="string"===typeof e[0]?e:e.map((e=>e.id));if(this.instanceState.isReadonly)return this;const i=Q(r.map((e=>this.getShape(e))).filter((e=>!!e&&(!this.isShapeOfType(e,"arrow")||"binding"!==e.props.start.type&&"binding"!==e.props.end.type)))),o=i.length;if(0===n&&o<3||o<2)return this;const s=Object.fromEntries(i.map((e=>[e.id,this.getShapePageBounds(e)])));let a,l,c,u,d;if("horizontal"===t?(a="x",l="minX",c="maxX",u="width"):(a="y",l="minY",c="maxY",u="height"),0===n){const e=[];i.sort(((e,t)=>s[e.id][l]-s[t.id][l]));for(let n=0;n<o-1;n++){const t=i[n],r=i[n+1],o=s[t.id],a=s[r.id][l]-o[c],u=e.find((e=>e.gap===a));u?u.count++:e.push({gap:a,count:1})}let t=0;e.forEach((e=>{e.count>t&&(t=e.count,d=e.gap)})),1===t&&(d=Math.max(0,e.reduce(((e,t)=>e+t.gap*t.count),0)/(o-1)))}else d=n;const h=[];let p=s[i[0].id][c];return i.forEach(((e,t)=>{var n,r;if(0===t)return;const i={x:0,y:0};i[a]=p+d-s[e.id][a];const o=this.getShapeParent(e),l=o?Ei.Rot(i,-this.getShapePageTransform(o).decompose().rotation):i,c=null===(n=(r=this.getShapeUtil(e)).onTranslateStart)||void 0===n?void 0:n.call(r,e);h.push(c?{...c,[a]:e[a]+l[a]}:{id:e.id,type:e.type,[a]:e[a]+l[a]}),p+=s[e.id][u]+d})),this.updateShapes(h),this}packShapes(e,t){const n="string"===typeof e[0]?e:e.map((e=>e.id));if(this.instanceState.isReadonly)return this;if(n.length<2)return this;const r=Q(n.map((e=>this.getShape(e))).filter((e=>!!e&&(!this.isShapeOfType(e,"arrow")||"binding"!==e.props.start.type&&"binding"!==e.props.end.type)))),i={},o={};let s,a,l=0;for(let k=0;k<r.length;k++)s=r[k],a=this.getShapePageBounds(s),i[s.id]=a,o[s.id]=a.clone(),l+=a.width*a.height;const c=Ti.Common(Q(Object.values(i))),u=c.width;r.sort(((e,t)=>i[t.id].height-i[e.id].height));const d=Math.max(Math.ceil(Math.sqrt(l/.95)),u),h=[new Ti(c.x,c.y,d,1/0)];let p,f,g=0,m=0;for(let k=0;k<r.length;k++){s=r[k],a=o[s.id];for(let e=h.length-1;e>=0;e--)if(p=h[e],!(a.width>p.width||a.height>p.height)){a.x=p.x,a.y=p.y,m=Math.max(m,a.maxY),g=Math.max(g,a.maxX),a.width===p.width&&a.height===p.height?(f=h.pop(),e<h.length&&(h[e]=f)):a.height===p.height?(p.x+=a.width+t,p.width-=a.width+t):a.width===p.width?(p.y+=a.height+t,p.height-=a.height+t):(h.push(new Ti(p.x+(a.width+t),p.y,p.width-(a.width+t),a.height)),p.y+=a.height+t,p.height-=a.height+t);break}}const y=Ti.Common(Object.values(o)),v=Ei.Sub(c.center,y.center);let b;const w=[];for(let k=0;k<r.length;k++){var x,S;s=r[k],a=i[s.id],b=o[s.id];const e=Ei.Sub(b.point,a.point).add(v),t=this.getShapeParentTransform(s);t&&e.rot(-t.rotation());const n={id:s.id,type:s.type,x:s.x+e.x,y:s.y+e.y},l=null===(x=(S=this.getShapeUtil(s)).onTranslateStart)||void 0===x?void 0:x.call(S,{...s,...n});l?w.push({...n,...l}):w.push(n)}return w.length&&this.updateShapes(w),this}alignShapes(e,t){const n="string"===typeof e[0]?e:e.map((e=>e.id));if(this.instanceState.isReadonly)return this;if(n.length<2)return this;const r=Q(n.map((e=>this.getShape(e)))),i=Object.fromEntries(r.map((e=>[e.id,this.getShapePageBounds(e)]))),o=Ti.Common(Q(Object.values(i))),s=[];return r.forEach((e=>{var n,r;const a=i[e.id];if(!a)return;const l={x:0,y:0};switch(t){case"top":l.y=o.minY-a.minY;break;case"center-vertical":l.y=o.midY-a.minY-a.height/2;break;case"bottom":l.y=o.maxY-a.minY-a.height;break;case"left":l.x=o.minX-a.minX;break;case"center-horizontal":l.x=o.midX-a.minX-a.width/2;break;case"right":l.x=o.maxX-a.minX-a.width}const c=this.getShapeParent(e),u=c?Ei.Rot(l,-this.getShapePageTransform(c).decompose().rotation):l,d=null===(n=(r=this.getShapeUtil(e)).onTranslateStart)||void 0===n?void 0:n.call(r,e);s.push(d?{...d,x:e.x+u.x,y:e.y+u.y}:{id:e.id,type:e.type,x:e.x+u.x,y:e.y+u.y})})),this.updateShapes(s),this}distributeShapes(e,t){const n="string"===typeof e[0]?e:e.map((e=>e.id));if(this.instanceState.isReadonly)return this;if(n.length<3)return this;const r=n.length,i=Q(n.map((e=>this.getShape(e)))),o=Object.fromEntries(i.map((e=>[e.id,this.getShapePageBounds(e)])));let s,a,l,c,u;"horizontal"===t?(s="x",a="minX",l="maxX",c="midX",u="width"):(s="y",a="minY",l="maxY",c="midY",u="height");const d=[],h=i.sort(((e,t)=>o[e.id][a]-o[t.id][a]))[0],p=i.sort(((e,t)=>o[t.id][l]-o[e.id][l]))[0],f=o[h.id][c],g=(o[p.id][c]-f)/(r-1),m=f+g;return i.filter((e=>e!==h&&e!==p)).sort(((e,t)=>o[e.id][c]-o[t.id][c])).forEach(((e,t)=>{var n,r;const i={x:0,y:0};i[s]=m+g*t-o[e.id][u]/2-o[e.id][s];const a=this.getShapeParent(e),l=a?Ei.Rot(i,-this.getShapePageTransform(a).rotation()):i,c=null===(n=(r=this.getShapeUtil(e)).onTranslateStart)||void 0===n?void 0:n.call(r,e);d.push(c?{...c,[s]:e[s]+l[s]}:{id:e.id,type:e.type,[s]:e[s]+l[s]})})),this.updateShapes(d),this}stretchShapes(e,t){const n="string"===typeof e[0]?e:e.map((e=>e.id));if(this.instanceState.isReadonly)return this;if(n.length<2)return this;const r=Q(n.map((e=>this.getShape(e)))),i=Object.fromEntries(n.map((e=>[e,this.getShapeGeometry(e).bounds]))),o=Object.fromEntries(n.map((e=>[e,this.getShapePageBounds(e)]))),s=Ti.Common(Q(Object.values(o)));switch(t){case"vertical":this.batch((()=>{for(const e of r){if(this.getShapePageTransform(e).rotation()%zi)continue;const t=i[e.id],n=o[e.id],r=new Ei(0,s.minY-n.minY),a=this.getShapeParentTransform(e);a&&r.rot(-a.rotation());const{x:l,y:c}=Ei.Add(r,e);this.updateShapes([{id:e.id,type:e.type,x:l,y:c}],{squashing:!0});const u=new Ei(1,s.height/n.height);this.resizeShape(e.id,u,{initialBounds:t,scaleOrigin:new Ei(n.center.x,s.minY),scaleAxisRotation:0})}}));break;case"horizontal":this.batch((()=>{for(const e of r){const t=i[e.id],n=o[e.id];if(this.getShapePageTransform(e).rotation()%zi)continue;const r=new Ei(s.minX-n.minX,0),a=this.getShapeParentTransform(e);a&&r.rot(-a.rotation());const{x:l,y:c}=Ei.Add(r,e);this.updateShapes([{id:e.id,type:e.type,x:l,y:c}],{squashing:!0});const u=new Ei(s.width/n.width,1);this.resizeShape(e.id,u,{initialBounds:t,scaleOrigin:new Ei(s.minX,n.center.y),scaleAxisRotation:0})}}))}return this}resizeShape(e,t){var n,r,i,o,s;let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const l="string"===typeof e?e:e.id;if(this.instanceState.isReadonly)return this;Number.isFinite(t.x)||(t=new Ei(1,t.y)),Number.isFinite(t.y)||(t=new Ei(t.x,1));const c=null!==(n=a.initialShape)&&void 0!==n?n:this.getShape(l);if(!c)return this;const u=null!==(r=a.scaleOrigin)&&void 0!==r?r:null===(i=this.getShapePageBounds(l))||void 0===i?void 0:i.center;if(!u)return this;const d=a.initialPageTransform?ia.Cast(a.initialPageTransform):this.getShapePageTransform(l);if(!d)return this;const h=d.rotation();if(null==h)return this;const p=null!==(o=a.scaleAxisRotation)&&void 0!==o?o:h,f=null!==(s=a.initialBounds)&&void 0!==s?s:this.getShapeGeometry(l).bounds;if(!f)return this;if(!Gi(h,p))return this._resizeUnalignedShape(l,t,{...a,initialBounds:f,scaleOrigin:u,scaleAxisRotation:p,initialPageTransform:d,initialShape:c});const g=this.getShapeUtil(c);if(g.isAspectRatioLocked(c)&&(t=Math.abs(t.x)>Math.abs(t.y)?new Ei(t.x,Math.sign(t.y)*Math.abs(t.x)):new Ei(Math.sign(t.x)*Math.abs(t.y),t.y)),g.onResize&&g.canResize(c)){var m,y;const e=this._scalePagePoint(ia.applyToPoint(d,new Ei(0,0)),u,t,p),n=this.getPointInParentSpace(c.id,e),r=new Ei(t.x,t.y),i=Bi((h-p)%Math.PI,0);r.x=i?t.x:t.y,r.y=i?t.y:t.x;const o=ia.applyToPoint(d,new Ei),{x:s,y:v}=this.getPointInParentSpace(c.id,o);this.updateShapes([{id:l,type:c.type,x:n.x,y:n.y,...g.onResize({...c,x:s,y:v},{newPoint:n,handle:null!==(m=a.dragHandle)&&void 0!==m?m:"bottom_right",mode:null!==(y=a.mode)&&void 0!==y?y:"scale_shape",scaleX:r.x,scaleY:r.y,initialBounds:f,initialShape:c})}],{squashing:!0})}else{const e=ia.applyToPoint(d,f.center),n=this._scalePagePoint(e,u,t,p),r=this.getPointInParentSpace(c.id,e),i=this.getPointInParentSpace(c.id,n),o=Ei.Sub(i,r);this.updateShapes([{id:l,type:c.type,x:c.x+o.x,y:c.y+o.y}],{squashing:!0})}return this}_scalePagePoint(e,t,n,r){const i=Ei.RotWith(e,t,-r).sub(t),o=Ei.MulV(i,n);return Ei.Add(o,t).rotWith(t,r)}_resizeUnalignedShape(e,t,n){const{type:r}=n.initialShape,i=new Ei(t.x,t.y);if(Math.abs(t.x)>Math.abs(t.y)?i.x=Math.sign(t.x)*Math.abs(t.y):i.y=Math.sign(t.y)*Math.abs(t.x),this.resizeShape(e,i,{initialShape:n.initialShape,initialBounds:n.initialBounds}),Math.sign(t.x)*Math.sign(t.y)<0){let{rotation:t}=ia.Decompose(n.initialPageTransform);t-=2*t,this.updateShapes([{id:e,type:r,rotation:t}],{squashing:!0})}const o=ia.applyToPoint(n.initialPageTransform,n.initialBounds.center),s=this._scalePagePoint(o,n.scaleOrigin,t,n.scaleAxisRotation),a=this.getShapePageBounds(e),l=this.getShapePageTransform(e),c=a.center,u=l.point();if(!c||!u)return this;const d=Ei.Sub(s,c),h=Ei.Add(u,d),{x:p,y:f}=this.getPointInParentSpace(e,h);return this.updateShapes([{id:e,type:r,x:p,y:f}],{squashing:!0}),this}getInitialMetaForShape(e){return{}}createShape(e){return this._createShapes([e]),this}createShapes(e){if(!Array.isArray(e))throw Error("Editor.createShapes: must provide an array of shapes or shape partials");return this._createShapes(e),this}animateShape(e,t){return this.animateShapes([e],t)}animateShapes(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{duration:n=500,easing:r=Ci.linear}=t,i=Va();let o,s=n;const a=[];let l;e.forEach((e=>{if(!e)return;const t={partial:e,values:[]},n=this.getShape(e.id);if(n){for(const r of["x","y","rotation"])void 0!==e[r]&&n[r]!==e[r]&&t.values.push({prop:r,from:n[r],to:e[r]});a.push(t),this.animatingShapes.set(n.id,i)}}));const c=t=>{if(s-=t,s<0){const{animatingShapes:t}=this,n=e.filter((e=>e&&t.get(e.id)===i));return n.length&&this.updateShapes(n,{squashing:!1}),void this.removeListener("tick",c)}o=r(1-s/n);const{animatingShapes:u}=this;try{const e=[];for(let t=0;t<a.length;t++)l=a[t],u.get(l.partial.id)===i&&e.push({id:l.partial.id,type:l.partial.type,...l.values.reduce(((e,t)=>{let{prop:n,from:r,to:i}=t;return e[n]=r+(i-r)*o,e}),{})});this._updateShapes(e,{squashing:!0})}catch(ZI){}};return this.addListener("tick",c),this}groupShapes(e){var t,n;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Dn();if(!Array.isArray(e))throw Error("Editor.groupShapes: must provide an array of shapes or shape ids");if(this.instanceState.isReadonly)return this;const i="string"===typeof e[0]?e:e.map((e=>e.id));if(i.length<=1)return this;const o=Q(this._getUnlockedShapeIds(i).map((e=>this.getShape(e)))),s=o.sort(Xl).map((e=>e.id)),a=Ti.Common(Q(o.map((e=>this.getShapePageBounds(e))))),{x:l,y:c}=a.point,u=null!==(t=this.findCommonAncestor(o))&&void 0!==t?t:this.currentPageId;if("select"!==this.currentToolId)return this;this.isIn("select.idle")||this.cancel();const d=o.filter((e=>e.parentId===u)).sort(Xl),h=null===(n=d[d.length-1])||void 0===n?void 0:n.index;return this.batch((()=>{this.createShapes([{id:r,type:"group",parentId:u,index:h,x:l,y:c,opacity:1,props:{}}]),this.reparentShapes(s,r),this.select(r)})),this}ungroupShapes(e){const t="string"===typeof e[0]?e:e.map((e=>e.id));if(this.instanceState.isReadonly)return this;if(0===t.length)return this;if("select"!==this.currentToolId)return this;this.isIn("select.idle")||this.cancel();const n=new Set,r=Q(t.map((e=>this.getShape(e)))),i=[];return r.forEach((e=>{this.isShapeOfType(e,"group")?i.push(e):n.add(e.id)})),0===i.length||this.batch((()=>{let e;for(let t=0,r=i.length;t<r;t++){e=i[t];const r=this.getSortedChildIdsForParent(e.id);for(let e=0,t=r.length;e<t;e++)n.add(r[e]);this.reparentShapes(r,e.parentId,e.index)}this.deleteShapes(i.map((e=>e.id))),this.select(...n)})),this}updateShape(e,t){return this.updateShapes([e],t),this}updateShapes(e,t){let n=Q(e);return this.animatingShapes.size>0&&n.forEach((e=>this.animatingShapes.delete(e.id))),n=n.filter((e=>{const t=this.getShape(e.id);return!!t&&!(this.isShapeOrAncestorLocked(t)&&!Object.hasOwn(e,"isLocked"))})),this._updateShapes(n,t),this}_getUnlockedShapeIds(e){return e.filter((e=>{var t;return!(null!==(t=this.getShape(e))&&void 0!==t&&t.isLocked)}))}deleteShapes(e){if(!Array.isArray(e))throw Error("Editor.deleteShapes: must provide an array of shapes or shapeIds");return this._deleteShapes(this._getUnlockedShapeIds("string"===typeof e[0]?e:e.map((e=>e.id)))),this}deleteShape(e){return this.deleteShapes(["string"===typeof e?e:e.id]),this}_extractSharedStyles(e,t){if(this.isShapeOfType(e,"group")){const n=this._parentIdsToChildIds.value[e.id];if(!n)return;for(let e=0,r=n.length;e<r;e++)this._extractSharedStyles(this.getShape(n[e]),t)}else for(const[n,r]of this.styleProps[e.type])t.applyValue(n,fe(e.props,r))}getStyleForNextShape(e){const t=this.instanceState.stylesForNextShape[e.id];return void 0===t?e.defaultValue:t}getShapeStyleIfExists(e,t){const n=this.styleProps[e.type].get(t);if(void 0!==n)return fe(e.props,n)}get sharedStyles(){if(this.isIn("select")&&this.selectedShapeIds.length>0)return this._selectionSharedStyles.value;const e=this.root.current.value,t=new Al;if(e.shapeType)for(const n of this.styleProps[e.shapeType].keys())t.applyValue(n,this.getStyleForNextShape(n));return t}get sharedOpacity(){if(this.isIn("select")&&this.selectedShapeIds.length>0){const e=[],t=n=>{const r=this.getShape(n);if(r)if(this.isShapeOfType(r,"group"))for(const e of this.getSortedChildIdsForParent(r.id))t(e);else e.push(r)};for(const r of this.selectedShapeIds)t(r);let n=null;for(const r of e)if(null===n)n=r.opacity;else if(n!==r.opacity)return{type:"mixed"};if(null!==n)return{type:"shared",value:n}}return{type:"shared",value:this.instanceState.opacityForNextShape}}setOpacityForNextShapes(e,t){return this.updateInstanceState({opacityForNextShape:e},t),this}setOpacityForSelectedShapes(e,t){const{selectedShapes:n}=this;if(n.length>0){const r=[],i=e=>{if(this.isShapeOfType(e,"group")){const t=this.getSortedChildIdsForParent(e);for(const e of t)i(this.getShape(e))}else r.push(e)};for(const e of n)i(e);this.updateShapes(r.map((t=>({id:t.id,type:t.type,opacity:e}))),t)}return this}setStyleForNextShapes(e,t,n){const{instanceState:{stylesForNextShape:r}}=this;return this.updateInstanceState({stylesForNextShape:{...r,[e.id]:t}},n),this}setStyleForSelectedShapes(e,t,n){const{selectedShapes:r}=this;if(r.length>0){const i=[],o=n=>{if(this.isShapeOfType(n,"group")){const e=this.getSortedChildIdsForParent(n.id);for(const t of e)o(this.getShape(t))}else{const r=this.getShapeUtil(n),o=this.styleProps[n.type].get(e);if(o){const e={id:n.id,type:n.type,props:{[o]:t}};i.push({util:r,originalShape:n,updatePartial:e})}}};for(const e of r)o(e);this.updateShapes(i.map((e=>{let{updatePartial:t}=e;return t})),n)}return this}registerExternalAssetHandler(e,t){return this.externalAssetContentHandlers[e]=t,this}async getAssetForExternalContent(e){var t,n;return await(null===(t=(n=this.externalAssetContentHandlers)[e.type])||void 0===t?void 0:t.call(n,e))}registerExternalContentHandler(e,t){return this.externalContentHandlers[e]=t,this}async putExternalContent(e){var t,n;return null===(t=(n=this.externalContentHandlers)[e.type])||void 0===t?void 0:t.call(n,e)}getContentFromCurrentPage(e){const t="string"===typeof e[0]?e:e.map((e=>e.id));if(!t)return;if(0===t.length)return;const n={};let r=X(t.map((e=>this.getShape(e))).sort(Xl).flatMap((e=>{const t=[e];return this.visitDescendants(e.id,(e=>{t.push(this.getShape(e))})),t})));r=r.map((e=>{if(n[e.id]=this.getShapePageTransform(e.id),e=Ae(e),this.isShapeOfType(e,"arrow")){const t="binding"===e.props.start.type?e.props.start.boundShapeId:void 0,n="binding"===e.props.end.type?e.props.end.boundShapeId:void 0,i=this.getArrowInfo(e);if("binding"===e.props.start.type&&!r.some((e=>e.id===t)))if(null!==i&&void 0!==i&&i.isValid){const{x:t,y:n}=i.start.point;e.props.start={type:"point",x:t,y:n}}else{const{start:t}=jc(this,e);e.props.start={type:"point",x:t.x,y:t.y}}if("binding"===e.props.end.type&&!r.some((e=>e.id===n)))if(null!==i&&void 0!==i&&i.isValid){const{x:t,y:n}=i.end.point;e.props.end={type:"point",x:t,y:n}}else{const{end:t}=jc(this,e);e.props.end={type:"point",x:t.x,y:t.y}}const o=Mc(e)?Rc(this,e):Uc(this,e);if(null!==i&&void 0!==i&&i.isValid&&null!==o&&void 0!==o&&o.isValid&&!Mc(e)){const t=Ei.Med(i.start.handle,i.end.handle),n=Ei.Dist(i.middle,t),r=Ei.Dist(o.middle,t);e.props.bend<0?e.props.bend+=r-n:e.props.bend-=r-n}return e}return e}));const i=[];r.forEach((e=>{if(void 0===r.find((t=>t.id===e.parentId))){const t=this.getShapePageTransform(e.id),n=t.point(),r=t.rotation();e.x=n.x,e.y=n.y,e.rotation=r,e.parentId=this.currentPageId,i.push(e.id)}}));const o=new Set;return r.forEach((e=>{"assetId"in e.props&&null!==e.props.assetId&&o.add(e.props.assetId)})),{shapes:r,rootShapeIds:i,schema:this.store.schema.serialize(),assets:Q(Array.from(o).map((e=>this.getAsset(e))))}}putContentOntoCurrentPage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.instanceState.isReadonly)return this;if(!e.schema)throw Error("Could not put content:\ncontent is missing a schema.");const{select:n=!1,preserveIds:r=!1,preservePosition:i=!1}=t;let{point:o}=t;const{currentPageId:s}=this,{assets:a,shapes:l,rootShapeIds:c}=e,u=new Map(l.map((e=>[e.id,Dn()])));let d=this.currentPageId,h=1/0,p=[];for(const b of this.selectedShapes){if(0===h)break;const e=this.isShapeOfType(b,"frame"),t=this.getShapeAncestors(b);e&&t.push(b);const n=e?t.length+1:t.length;if(n<h)h=n,p=t,d=e?b.id:b.parentId;else if(n===h){if(p.length!==t.length)throw Error("Ancestors: ".concat(p.length," !== ").concat(t.length));if(0===p.length){d=s;break}d=s;for(let e=0;e<p.length&&t[e]===p[e];e++)d=t[e].id}}let f=!1;if(!Kt(d)){const e=this.getShape(d);if(e)if(this.viewportPageBounds.includes(this.getShapePageBounds(e))){if(1===c.length){const t=l.find((e=>e.id===c[0]));this.isShapeOfType(e,"frame")&&this.isShapeOfType(t,"frame")&&t.props.w===(null===e||void 0===e?void 0:e.props.w)&&t.props.h===(null===e||void 0===e?void 0:e.props.h)&&(f=!0)}}else d=s;else d=s}f||(f=u.has(d)),f&&(d=this.getShape(d).parentId);let g=this.getHighestIndexForParent(d);const m=[],y=l.map((e=>{let t;if(r)t=ge(e),u.set(e.id,e.id);else{const n=u.get(e.id);t=ge({...e,id:n})}if(c.includes(e.id)&&(t.parentId=s,m.push(t)),u.has(t.parentId)?t.parentId=u.get(e.parentId):(c.push(t.id),t.index=g,g=ql(g)),this.isShapeOfType(t,"arrow")){if("binding"===t.props.start.type){const e=u.get(t.props.start.boundShapeId);t.props.start=e?{...t.props.start,boundShapeId:e}:{type:"point",x:0,y:0}}if("binding"===t.props.end.type){const e=u.get(t.props.end.boundShapeId);t.props.end=e?{...t.props.end,boundShapeId:e}:{type:"point",x:0,y:0}}}return t}));if(y.length+this.currentPageShapeIds.size>po)return eu(this),this;let v=[];if(a){for(let n=0;n<a.length;n++){const t=a[n],r=this.store.schema.migratePersistedRecord(t,e.schema);if("success"!==r.type)throw Error("Could not put content:\ncould not migrate content for asset:\n".concat(t.id,"\n").concat(t.type,"\nreason:").concat(r.reason));a[n]=r.value}const t=[];v=a.filter((e=>!this.store.has(e.id))).map((e=>{var n;"image"!==e.type&&"video"!==e.type||(e.props.src&&null!==(n=e.props.src)&&void 0!==n&&n.startsWith("data:image")?(t.push(Ae(e)),e.props.src=null):t.push(Ae(e)));return e})),Promise.allSettled(t.map((async e=>{var t;const n=await(r=e.props.src,i=e.props.name,o=null!==(t=e.props.mimeType)&&void 0!==t?t:"image/png",fetch(r).then((function(e){return e.arrayBuffer()})).then((function(e){return new File([e],i,{type:o})})));var r,i,o;const s=await this.getAssetForExternalContent({type:"file",file:n});return s?[e,s]:null}))).then((e=>{this.updateAssets(Q(e.map((e=>"fulfilled"===e.status&&e.value?{...e.value[1],id:e.value[0].id}:void 0))))}))}for(let b=0;b<y.length;b++){const t=y[b],n=this.store.schema.migratePersistedRecord(t,e.schema);if("success"!==n.type)throw Error("Could not put content:\ncould not migrate content for shape:\n".concat(t.id,", ").concat(t.type,"\nreason:").concat(n.reason));y[b]=n.value}return this.batch((()=>{v.length>0&&this.createAssets(v),this.createShapes(y),n&&this.select(...m.map((e=>e.id))),d!==s&&this.reparentShapes(m.map((e=>e.id)),d);const e=y.map((e=>this.getShape(e.id))),t=Ti.Common(e.map((e=>this.getShapePageBounds(e))));if(void 0===o)if(Kt(d)){const{viewportPageBounds:e}=this;o=i||e.includes(Ti.From(t))?t.center:e.center}else{const e=this.getShape(d);o=ia.applyToPoint(this.getShapePageTransform(e),this.getShapeGeometry(e).bounds.center)}if(1===m.length){const e=m[0];if(this.isShapeOfType(e,"frame"))for(;this.getShapesAtPoint(o).some((t=>this.isShapeOfType(t,"frame")&&t.props.w===e.props.w&&t.props.h===e.props.h));)o.x+=t.w+16}const r=Ti.Common(Q(m.map((e=>{let{id:t}=e;return this.getShapePageBounds(t)})))).center,a=Ei.Sub(o,r);this.updateShapes(m.map((e=>{let{id:t}=e;const n=this.getShape(t),r=this.getShapeParentTransform(t).decompose().rotation,i=Ei.Rot(a,-r);return{id:n.id,type:n.type,x:n.x+i.x,y:n.y+i.y}})))})),this}async getSvg(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n="string"===typeof e[0]?e:e.map((e=>e.id));if(0===n.length)return;if(!window.document)throw Error("No document");const{scale:r=1,background:i=!1,padding:o=vo,preserveAspectRatio:s=!1}=t,a=Wn({isDarkMode:this.user.isDarkMode}),l=this.getShapeAndDescendantIds(n),c=this.getUnorderedRenderingShapes(!1).filter((e=>{let{id:t}=e;return l.has(t)}));let u=null;for(const{maskedPageBounds:x}of c)x&&(u?u.union(x):u=x.clone());if(!u)return;const d=1===n.length&&this.isShapeOfType(this.getShape(n[0]),"frame")?n[0]:null;d||u.expandBy(o);const h=u.width*r,p=u.height*r,f=window.document.createElementNS("http://www.w3.org/2000/svg","svg");s&&f.setAttribute("preserveAspectRatio",s),f.setAttribute("direction","ltr"),f.setAttribute("width",h+""),f.setAttribute("height",p+""),f.setAttribute("viewBox","".concat(u.minX," ").concat(u.minY," ").concat(u.width," ").concat(u.height)),f.setAttribute("stroke-linecap","round"),f.setAttribute("stroke-linejoin","round"),i?d?f.style.setProperty("background",a.solid):f.style.setProperty("background-color",a.background):f.style.setProperty("background-color","transparent");try{var g,m;null===(g=(m=document.body).focus)||void 0===g||g.call(m)}catch(ZI){}const y=window.document.createElementNS("http://www.w3.org/2000/svg","defs");f.append(y);const v=new Map,b={addExportDef:e=>{if(v.has(e.key))return;const t=(async()=>{const t=await e.getElement();if(!t)return;const n=document.createComment("def: ".concat(e.key));y.appendChild(n);for(const e of Array.isArray(t)?t:[t])y.appendChild(e)})();v.set(e.key,t)}},w=(await Promise.all(c.map((async e=>{var t,n,r,i,o,s;let{id:l,opacity:c,index:u,backgroundIndex:h}=e;if(l===d)return[];const p=this.getShape(l);if(this.isShapeOfType(p,"group"))return[];const f=this.getShapeUtil(p);let g=await(null===(t=f.toSvg)||void 0===t?void 0:t.call(f,p,b)),m=await(null===(n=f.toBackgroundSvg)||void 0===n?void 0:n.call(f,p,b));if(g){const e=document.createElementNS("http://www.w3.org/2000/svg","g");e.appendChild(g),g=e}if(m){const e=document.createElementNS("http://www.w3.org/2000/svg","g");e.appendChild(m),m=e}if(!g&&!m){const e=this.getShapePageBounds(p),t=window.document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("width",e.width+""),t.setAttribute("height",e.height+""),t.setAttribute("fill",a.solid),t.setAttribute("stroke",a.grey.pattern),t.setAttribute("stroke-width","1"),g=t}let v=this.getShapePageTransform(p).toCssString();"scale"in p.props&&1!==p.props.scale&&(v="".concat(v," scale(").concat(p.props.scale,", ").concat(p.props.scale,")")),null===(r=g)||void 0===r||r.setAttribute("transform",v),null===(i=m)||void 0===i||i.setAttribute("transform",v),null===(o=g)||void 0===o||o.setAttribute("opacity",c+""),null===(s=m)||void 0===s||s.setAttribute("opacity",c+"");const w=this.getShapeMask(p.id);if(w){const e=document.createElementNS("http://www.w3.org/2000/svg","clipPath");y.appendChild(e);const t=Va();e.id=t;const n=document.createElementNS("http://www.w3.org/2000/svg","path");if(n.setAttribute("d","M".concat(w.map((e=>{let{x:t,y:n}=e;return"".concat(t,",").concat(n)})).join("L"),"Z")),e.appendChild(n),g){const e=document.createElementNS("http://www.w3.org/2000/svg","g");e.setAttribute("clip-path","url(#".concat(t,")")),e.appendChild(g),g=e}if(m){const e=document.createElementNS("http://www.w3.org/2000/svg","g");e.setAttribute("clip-path","url(#".concat(t,")")),e.appendChild(m),m=e}}const x=[];return g&&x.push({zIndex:u,element:g}),m&&x.push({zIndex:h,element:m}),x})))).flat();await Promise.all(v.values());for(const{element:x}of w.sort(((e,t)=>e.zIndex-t.zIndex)))f.appendChild(x);return f}_updateInputsFromEvent(e){var t,n;const{previousScreenPoint:r,previousPagePoint:i,currentScreenPoint:o,currentPagePoint:s}=this.inputs,{screenBounds:a}=this.store.unsafeGetWithoutCapture(Yt),{x:l,y:c,z:u}=e.point,{x:d,y:h,z:p}=this.camera;r.setTo(o),i.setTo(s),o.set(l,c),s.set((l-a.x)/p-d,(c-a.y)/p-h,null!==u&&void 0!==u?u:.5),this.inputs.isPen="pointer"===e.type&&e.isPen,"pointer_down"===e.name&&this.inputs.pointerVelocity.set(0,0),this.store.put([{id:on,typeName:"pointer",x:s.x,y:s.y,lastActivityTimestamp:"pointer"===e.type&&e.pointerId===Po&&null!==(t=null===(n=this.store.get(on))||void 0===n?void 0:n.lastActivityTimestamp)&&void 0!==t?t:Date.now(),meta:{}}])}cancel(){return this.dispatch({type:"misc",name:"cancel"}),this}interrupt(){return this.dispatch({type:"misc",name:"interrupt"}),this}complete(){return this.dispatch({type:"misc",name:"complete"}),this}cancelDoubleClick(){this._clickManager.cancelDoubleClickTimeout()}}function eu(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.currentPageId;const n=e.getPage(t).name;e.emit("max-shapes",{name:n,pageId:t,count:po})}function tu(){const e=di();return q("isDarkMode",(()=>e.user.isDarkMode),[e])}Zc([N],Jc.prototype,"canUndo",1),Zc([N],Jc.prototype,"canRedo",1),Zc([N],Jc.prototype,"_arrowBindingsIndex",1),Zc([N],Jc.prototype,"arrowInfoCache",1),Zc([N],Jc.prototype,"currentTool",1),Zc([N],Jc.prototype,"currentToolId",1),Zc([N],Jc.prototype,"documentSettings",1),Zc([N],Jc.prototype,"instanceState",1),Zc([N],Jc.prototype,"openMenus",1),Zc([N],Jc.prototype,"isMenuOpen",1),Zc([N],Jc.prototype,"pageStates",1),Zc([N],Jc.prototype,"_pageStates",1),Zc([N],Jc.prototype,"currentPageState",1),Zc([N],Jc.prototype,"_currentPageStateId",1),Zc([N],Jc.prototype,"selectedShapeIds",1),Zc([N],Jc.prototype,"selectedShapes",1),Zc([N],Jc.prototype,"onlySelectedShape",1),Zc([N],Jc.prototype,"selectionPageBounds",1),Zc([N],Jc.prototype,"selectionRotation",1),Zc([N],Jc.prototype,"selectionRotatedPageBounds",1),Zc([N],Jc.prototype,"focusedGroupId",1),Zc([N],Jc.prototype,"focusedGroup",1),Zc([N],Jc.prototype,"editingShapeId",1),Zc([N],Jc.prototype,"editingShape",1),Zc([N],Jc.prototype,"hoveredShapeId",1),Zc([N],Jc.prototype,"hoveredShape",1),Zc([N],Jc.prototype,"hintingShapeIds",1),Zc([N],Jc.prototype,"hintingShapes",1),Zc([N],Jc.prototype,"erasingShapeIds",1),Zc([N],Jc.prototype,"erasingShapes",1),Zc([N],Jc.prototype,"cameraId",1),Zc([N],Jc.prototype,"camera",1),Zc([N],Jc.prototype,"zoomLevel",1),Zc([N],Jc.prototype,"viewportScreenBounds",1),Zc([N],Jc.prototype,"viewportScreenCenter",1),Zc([N],Jc.prototype,"viewportPageBounds",1),Zc([N],Jc.prototype,"viewportPageCenter",1),Zc([N],Jc.prototype,"cameraState",1),Zc([N],Jc.prototype,"renderingShapes",1),Zc([N],Jc.prototype,"renderingBounds",1),Zc([N],Jc.prototype,"renderingBoundsExpanded",1),Zc([N],Jc.prototype,"_pages",1),Zc([N],Jc.prototype,"pages",1),Zc([N],Jc.prototype,"_assets",1),Zc([N],Jc.prototype,"_shapeGeometryCache",1),Zc([N],Jc.prototype,"_shapeOutlineSegmentsCache",1),Zc([N],Jc.prototype,"_shapeHandlesCache",1),Zc([N],Jc.prototype,"_shapePageTransformCache",1),Zc([N],Jc.prototype,"_shapePageBoundsCache",1),Zc([N],Jc.prototype,"_shapeClipPathCache",1),Zc([N],Jc.prototype,"_shapeMaskCache",1),Zc([N],Jc.prototype,"currentPageBounds",1),Zc([N],Jc.prototype,"currentPageShapes",1),Zc([N],Jc.prototype,"currentPageShapesSorted",1),Zc([N],Jc.prototype,"currentPageRenderingShapesSorted",1),Zc([N({isEqual:(e,t)=>e.equals(t)})],Jc.prototype,"sharedStyles",1),Zc([N],Jc.prototype,"sharedOpacity",1);const nu="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",ru="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",iu='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>';function ou(e,t,n,r,i){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:16,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:16;const a=Oi/180*(-n-t),l=Math.sin(a),c=Math.cos(a),u=1*c-1*l,d=1*l+1*c;return"url(\"data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ".concat(i,";'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='").concat(u,"' dy='").concat(d,"' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(").concat(t+n," 16 16)").concat(r?" scale(-1,-1) translate(0, -32)":"","' filter='url(%23shadow)'>")+e.replaceAll('"',"'")+'</g></svg>") '.concat(o," ").concat(s,", pointer")}const su={none:()=>"none",default:(e,t,n)=>ou('<path d="m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z" fill="white"/><path d="m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z" fill="white"/><path d="m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z" fill="black"/><path d="m13 10.814v11.188l2.969-2.866.428-.139h4.768z" fill="black"/>',e,0,t,n,12,8),pointer:(e,t,n)=>ou('<path d="m13.3315 21.3799c-.284-.359-.629-1.093-1.243-1.984-.348-.504-1.211-1.453-1.468-1.935-.223-.426-.199-.617-.146-.97.094-.628.738-1.117 1.425-1.051.519.049.959.392 1.355.716.239.195.533.574.71.788.163.196.203.277.377.509.23.307.302.459.214.121-.071-.496-.187-1.343-.355-2.092-.128-.568-.159-.657-.281-1.093-.129-.464-.195-.789-.316-1.281-.084-.348-.235-1.059-.276-1.459-.057-.547-.087-1.439.264-1.849.275-.321.906-.418 1.297-.22.512.259.803 1.003.936 1.3.239.534.387 1.151.516 1.961.164 1.031.466 2.462.476 2.763.024-.369-.068-1.146-.004-1.5.058-.321.328-.694.666-.795.286-.085.621-.116.916-.055.313.064.643.288.766.499.362.624.369 1.899.384 1.831.086-.376.071-1.229.284-1.584.14-.234.497-.445.687-.479.294-.052.655-.068.964-.008.249.049.586.345.677.487.218.344.342 1.317.379 1.658.015.141.074-.392.293-.736.406-.639 1.843-.763 1.898.639.025.654.02.624.02 1.064 0 .517-.012.828-.04 1.202-.031.4-.117 1.304-.242 1.742-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.191 1.813-.118.562-.079.566-.102.965-.023.398.121.922.121.922s-.802.104-1.234.035c-.391-.063-.875-.841-1-1.079-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.031-3.139.02 0 0 .185-1.011-.227-1.358-.305-.259-.83-.784-1.144-1.06z" fill="white"/><g stroke="black" stroke-linecap="round" stroke-width=".75"><path d="m13.3315 21.3799c-.284-.359-.629-1.093-1.243-1.984-.348-.504-1.211-1.453-1.468-1.935-.223-.426-.199-.617-.146-.97.094-.628.738-1.117 1.425-1.051.519.049.959.392 1.355.716.239.195.533.574.71.788.163.196.203.277.377.509.23.307.302.459.214.121-.071-.496-.187-1.343-.355-2.092-.128-.568-.159-.657-.281-1.093-.129-.464-.195-.789-.316-1.281-.084-.348-.235-1.059-.276-1.459-.057-.547-.087-1.439.264-1.849.275-.321.906-.418 1.297-.22.512.259.803 1.003.936 1.3.239.534.387 1.151.516 1.961.164 1.031.466 2.462.476 2.763.024-.369-.068-1.146-.004-1.5.058-.321.328-.694.666-.795.286-.085.621-.116.916-.055.313.064.643.288.766.499.362.624.369 1.899.384 1.831.086-.376.071-1.229.284-1.584.14-.234.497-.445.687-.479.294-.052.655-.068.964-.008.249.049.586.345.677.487.218.344.342 1.317.379 1.658.015.141.074-.392.293-.736.406-.639 1.843-.763 1.898.639.025.654.02.624.02 1.064 0 .517-.012.828-.04 1.202-.031.4-.117 1.304-.242 1.742-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.191 1.813-.118.562-.079.566-.102.965-.023.398.121.922.121.922s-.802.104-1.234.035c-.391-.063-.875-.841-1-1.079-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.031-3.139.02 0 0 .185-1.011-.227-1.358-.305-.259-.83-.784-1.144-1.06z" stroke-linejoin="round"/><path d="m21.5664 21.7344v-3.459"/><path d="m19.5508 21.7461-.016-3.473"/><path d="m17.5547 18.3047.021 3.426"/></g>',e,0,t,n,14,10),cross:(e,t,n)=>ou('<path d="m25 16h-6.01v-6h-2.98v6h-6.01v3h6.01v6h2.98v-6h6.01z" fill="white"/><path d="m23.9902 17.0103h-6v-6.01h-.98v6.01h-6v.98h6v6.01h.98v-6.01h6z" fill="%23231f1f"/>',e,0,t,n),move:(e,t,n)=>ou('<path d="m19 14h1v1h-1zm1 6h-1v-1h1zm-5-5h-1v-1h1zm0 5h-1v-1h1zm2-10.987-7.985 7.988 5.222 5.221 2.763 2.763 7.984-7.985z" fill="white"/><g fill="black"><path d="m23.5664 16.9971-2.557-2.809v1.829h-4.009-4.001v-1.829l-2.571 2.809 2.572 2.808-.001-1.808h4.001 4.009l-.001 1.808z"/><path d="m17.9873 17h.013v-4.001l1.807.001-2.807-2.571-2.809 2.57h1.809v4.001h.008v4.002l-1.828-.001 2.807 2.577 2.805-2.576h-1.805z"/></g>',e,0,t,n),grab:(e,t,n)=>ou('<path d="m13.5557 17.5742c-.098-.375-.196-.847-.406-1.552-.167-.557-.342-.859-.47-1.233-.155-.455-.303-.721-.496-1.181-.139-.329-.364-1.048-.457-1.44-.119-.509.033-.924.244-1.206.253-.339.962-.49 1.357-.351.371.13.744.512.916.788.288.46.357.632.717 1.542.393.992.564 1.918.611 2.231l.085.452c-.001-.04-.043-1.122-.044-1.162-.035-1.029-.06-1.823-.038-2.939.002-.126.064-.587.084-.715.078-.5.305-.8.673-.979.412-.201.926-.215 1.401-.017.423.173.626.55.687 1.022.014.109.094.987.093 1.107-.013 1.025.006 1.641.015 2.174.004.231.003 1.625.017 1.469.061-.656.094-3.189.344-3.942.144-.433.405-.746.794-.929.431-.203 1.113-.07 1.404.243.285.305.446.692.482 1.153.032.405-.019.897-.02 1.245 0 .867-.021 1.324-.037 2.121-.001.038-.015.298.023.182.094-.28.188-.542.266-.745.049-.125.241-.614.359-.859.114-.234.211-.369.415-.688.2-.313.415-.448.668-.561.54-.235 1.109.112 1.301.591.086.215.009.713-.028 1.105-.061.647-.254 1.306-.352 1.648-.128.447-.274 1.235-.34 1.601-.072.394-.234 1.382-.359 1.82-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.192 1.812-.117.563-.078.567-.101.965-.024.399.121.923.121.923s-.802.104-1.234.034c-.391-.062-.875-.841-1-1.078-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.03-3.139.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.284-.36-.629-1.093-1.243-1.985-.348-.504-1.027-1.085-1.284-1.579-.223-.425-.331-.954-.19-1.325.225-.594.675-.897 1.362-.832.519.05.848.206 1.238.537.225.19.573.534.75.748.163.195.203.276.377.509.23.307.302.459.214.121" fill="white"/><g stroke="black" stroke-linecap="round" stroke-width=".75"><path d="m13.5557 17.5742c-.098-.375-.196-.847-.406-1.552-.167-.557-.342-.859-.47-1.233-.155-.455-.303-.721-.496-1.181-.139-.329-.364-1.048-.457-1.44-.119-.509.033-.924.244-1.206.253-.339.962-.49 1.357-.351.371.13.744.512.916.788.288.46.357.632.717 1.542.393.992.564 1.918.611 2.231l.085.452c-.001-.04-.043-1.122-.044-1.162-.035-1.029-.06-1.823-.038-2.939.002-.126.064-.587.084-.715.078-.5.305-.8.673-.979.412-.201.926-.215 1.401-.017.423.173.626.55.687 1.022.014.109.094.987.093 1.107-.013 1.025.006 1.641.015 2.174.004.231.003 1.625.017 1.469.061-.656.094-3.189.344-3.942.144-.433.405-.746.794-.929.431-.203 1.113-.07 1.404.243.285.305.446.692.482 1.153.032.405-.019.897-.02 1.245 0 .867-.021 1.324-.037 2.121-.001.038-.015.298.023.182.094-.28.188-.542.266-.745.049-.125.241-.614.359-.859.114-.234.211-.369.415-.688.2-.313.415-.448.668-.561.54-.235 1.109.112 1.301.591.086.215.009.713-.028 1.105-.061.647-.254 1.306-.352 1.648-.128.447-.274 1.235-.34 1.601-.072.394-.234 1.382-.359 1.82-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.192 1.812-.117.563-.078.567-.101.965-.024.399.121.923.121.923s-.802.104-1.234.034c-.391-.062-.875-.841-1-1.078-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.03-3.139.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.284-.36-.629-1.093-1.243-1.985-.348-.504-1.027-1.085-1.284-1.579-.223-.425-.331-.954-.19-1.325.225-.594.675-.897 1.362-.832.519.05.848.206 1.238.537.225.19.573.534.75.748.163.195.203.276.377.509.23.307.302.459.214.121" stroke-linejoin="round"/><path d="m20.5664 21.7344v-3.459"/><path d="m18.5508 21.7461-.016-3.473"/><path d="m16.5547 18.3047.021 3.426"/></g>',e,0,t,n),grabbing:(e,t,n)=>ou("<path d='m13.5732 12.0361c.48-.178 1.427-.069 1.677.473.213.462.396 1.241.406 1.075.024-.369-.024-1.167.137-1.584.117-.304.347-.59.686-.691.285-.086.62-.116.916-.055.313.064.642.287.765.499.362.623.368 1.899.385 1.831.064-.272.07-1.229.283-1.584.141-.235.497-.445.687-.479.294-.052.656-.068.964-.008.249.049.586.344.677.487.219.344.342 1.316.379 1.658.016.141.074-.393.293-.736.406-.639 1.844-.763 1.898.639.026.654.02.624.02 1.064 0 .516-.012.828-.04 1.202-.03.399-.116 1.304-.241 1.742-.086.301-.371.978-.653 1.384 0 0-1.074 1.25-1.191 1.812-.117.563-.078.567-.102.965-.023.399.121.923.121.923s-.801.104-1.234.034c-.391-.062-.875-.84-1-1.078-.172-.328-.539-.265-.682-.023-.224.383-.709 1.07-1.05 1.113-.669.084-2.055.03-3.14.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.283-.36-1.002-.929-1.243-1.985-.213-.936-.192-1.395.037-1.77.232-.381.67-.589.854-.625.208-.042.692-.039.875.062.223.123.313.159.488.391.23.307.312.456.213.121-.076-.262-.322-.595-.434-.97-.109-.361-.401-.943-.38-1.526.008-.221.103-.771.832-1.042' fill='white'/><g stroke='black' stroke-width='.75'><path d='m13.5732 12.0361c.48-.178 1.427-.069 1.677.473.213.462.396 1.241.406 1.075.024-.369-.024-1.167.137-1.584.117-.304.347-.59.686-.691.285-.086.62-.116.916-.055.313.064.642.287.765.499.362.623.368 1.899.385 1.831.064-.272.07-1.229.283-1.584.141-.235.497-.445.687-.479.294-.052.656-.068.964-.008.249.049.586.344.677.487.219.344.342 1.316.379 1.658.016.141.074-.393.293-.736.406-.639 1.844-.763 1.898.639.026.654.02.624.02 1.064 0 .516-.012.828-.04 1.202-.03.399-.116 1.304-.241 1.742-.086.301-.371.978-.653 1.384 0 0-1.074 1.25-1.191 1.812-.117.563-.078.567-.102.965-.023.399.121.923.121.923s-.801.104-1.234.034c-.391-.062-.875-.84-1-1.078-.172-.328-.539-.265-.682-.023-.224.383-.709 1.07-1.05 1.113-.669.084-2.055.03-3.14.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.283-.36-1.002-.929-1.243-1.985-.213-.936-.192-1.395.037-1.77.232-.381.67-.589.854-.625.208-.042.692-.039.875.062.223.123.313.159.488.391.23.307.312.456.213.121-.076-.262-.322-.595-.434-.97-.109-.361-.401-.943-.38-1.526.008-.221.103-.771.832-1.042z' stroke-linejoin='round'/><path d='m20.5664 19.7344v-3.459' stroke-linecap='round'/><path d='m18.5508 19.7461-.016-3.473' stroke-linecap='round'/><path d='m16.5547 16.3047.021 3.426' stroke-linecap='round'/></g>",e,0,t,n),text:(e,t,n)=>ou('<path fill="white" d="M7.94 0a5.25 5.25 0 0 0-3.47 1.17A5.27 5.27 0 0 0 1 0H0v3h1c1.41 0 1.85.7 2 1v3.94H2v3h1v3c-.13.3-.57 1-2 1H0v3h1a5.27 5.27 0 0 0 3.47-1.17c.98.8 2.21 1.21 3.47 1.17h1v-3h-1c-1.41 0-1.85-.7-2-1v-3H7v-3H6V4c.13-.3.57-1 2-1h1V0H7.94z"/><path fill="black" d="M7.94 2V1a4 4 0 0 0-3.47 1.64A4 4 0 0 0 1 1v1c1.3-.17 2.56.6 3 1.84v5.1H3v1h1v4.16c-.45 1.24-1.7 2-3 1.84v1a4.05 4.05 0 0 0 3.47-1.63 4.05 4.05 0 0 0 3.47 1.63v-1A2.82 2.82 0 0 1 5 14.1V9.93h1v-1H5V3.85A2.81 2.81 0 0 1 7.94 2z"/>',e,0,t,n,4,10),"ew-resize":(e,t,n)=>ou(ru,e,0,t,n),"ns-resize":(e,t,n)=>ou(ru,e,90,t,n),"nesw-resize":(e,t,n)=>ou(nu,e,0,t,n),"nwse-resize":(e,t,n)=>ou(nu,e,90,t,n),"nwse-rotate":(e,t,n)=>ou(iu,e,0,t,n),"nesw-rotate":(e,t,n)=>ou(iu,e,90,t,n),"senw-rotate":(e,t,n)=>ou(iu,e,180,t,n),"swne-rotate":(e,t,n)=>ou(iu,e,270,t,n),"zoom-in":(e,t,n)=>ou('<path d="m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5" fill="white"/><path d="m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5z" stroke="black"/><g fill="black"><path d="m18 14h-2v-2h-2v2h-2v1.98h2v2.02h2v-2.02h2z"/><path d="m23.5859 25 1.414-1.414-5.449-5.449-1.414 1.414z"/></g>',e,0,t,n),"zoom-out":(e,t,n)=>ou('<path d="m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5" fill="white"/><path d="m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5z" stroke="black"/><g fill="black"><path d="m18 16h-5.98v-1.98h5.98z"/><path d="m23.5859 25 1.414-1.414-5.449-5.449-1.414 1.414z"/></g>',e,0,t,n)};function au(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"black";return su[e](180*t/Oi,!1,n)}const lu=["default","pointer","cross","move","grab","grabbing","text"];var cu,uu;const du="TLDRAW_TAB_ID_v2",hu=globalThis.window;const pu=null!==(cu=null!==(uu=null===hu||void 0===hu?void 0:hu[du])&&void 0!==uu?uu:null===hu||void 0===hu?void 0:hu.sessionStorage[du])&&void 0!==cu?cu:"TLDRAW_INSTANCE_STATE_V1_"+Va();hu&&(hu[du]=pu,hu&&(["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(hu.navigator.platform)||hu.navigator.userAgent.includes("Mac")&&"ontouchend"in document)?hu.sessionStorage[du]=pu:delete hu.sessionStorage[du]),null===hu||void 0===hu||hu.addEventListener("beforeunload",(()=>{hu.sessionStorage[du]=pu}));const fu=0,gu=gt({version:ot,currentPageId:Ft,isFocusMode:dt,exportBackground:dt,isDebugMode:dt,isToolLocked:dt,isGridMode:dt,pageStates:ft(gt({pageId:Ft,camera:gt({x:ot,y:ot,z:ot}),selectedShapeIds:ft(Gt),focusedGroupId:Gt.nullable()}))}),mu=Ve({currentVersion:fu});function yu(e,t){const n=function(e){if(!e||"object"!==typeof e)return console.warn("Invalid instance state"),null;if(!("version"in e)||"number"!==typeof e.version)return console.warn("No version in instance state"),null;const t=$e({value:e,fromVersion:e.version,toVersion:fu,migrations:mu});if("error"===t.type)return console.warn(t.reason),null;const n={...t.value,version:fu};try{gu.validate(n)}catch(ZI){return console.warn(ZI),null}return n}(t);if(!n)return;const r={added:{},updated:{},removed:{...be(e.allRecords().filter((e=>"instance_page_state"===e.typeName||"camera"===e.typeName)).map((e=>[e.id,e])))}};e.has(Yt)&&(r.removed[Yt]=e.get(Yt));const i={removed:{},updated:{},added:{[Yt]:e.schema.types.instance.create({id:Yt,currentPageId:n.currentPageId,isDebugMode:n.isDebugMode,isFocusMode:n.isFocusMode,isToolLocked:n.isToolLocked,isGridMode:n.isGridMode,exportBackground:n.exportBackground})}};for(const o of n.pageStates){const e=Tt.createId(o.pageId),t=Jt.createId(o.pageId);i.added[e]=Tt.create({id:Tt.createId(o.pageId),x:o.camera.x,y:o.camera.y,z:o.camera.z}),i.added[t]=Jt.create({id:Jt.createId(o.pageId),pageId:o.pageId,selectedShapeIds:o.selectedShapeIds,focusedGroupId:o.focusedGroupId})}M((()=>{e.applyDiff(Ue([r,i])),e.ensureStoreIsUsable()}))}const vu=(e,t)=>t.some((t=>e instanceof t));let bu,wu;const xu=new WeakMap,Su=new WeakMap,ku=new WeakMap,_u=new WeakMap,Pu=new WeakMap;let Cu={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return Su.get(e);if("objectStoreNames"===t)return e.objectStoreNames||ku.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Mu(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Eu(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(wu||(wu=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(Tu(this),n),Mu(xu.get(this))}:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Mu(e.apply(Tu(this),n))}:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];const o=e.call(Tu(this),t,...r);return ku.set(o,t.sort?t.sort():[t]),Mu(o)}}function Iu(e){return"function"===typeof e?Eu(e):(e instanceof IDBTransaction&&function(e){if(Su.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",o),e.removeEventListener("abort",o)},i=()=>{t(),r()},o=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",o),e.addEventListener("abort",o)}));Su.set(e,t)}(e),vu(e,bu||(bu=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,Cu):e)}function Mu(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",o)},i=()=>{t(Mu(e.result)),r()},o=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",o)}));return t.then((t=>{t instanceof IDBCursor&&xu.set(t,e)})).catch((()=>{})),Pu.set(t,e),t}(e);if(_u.has(e))return _u.get(e);const t=Iu(e);return t!==e&&(_u.set(e,t),Pu.set(t,e)),t}const Tu=e=>Pu.get(e);const Au=["get","getKey","getAll","getAllKeys","count"],ju=["put","add","delete","clear"],Ou=new Map;function Lu(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!==typeof t)return;if(Ou.get(t))return Ou.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=ju.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!Au.includes(n))return;const o=async function(e){const t=this.transaction(e,i?"readwrite":"readonly");let o=t.store;for(var s=arguments.length,a=new Array(s>1?s-1:0),l=1;l<s;l++)a[l-1]=arguments[l];return r&&(o=o.index(a.shift())),(await Promise.all([o[n](...a),i&&t.done]))[0]};return Ou.set(t,o),o}Cu=(e=>({...e,get:(t,n,r)=>Lu(t,n)||e.get(t,n,r),has:(t,n)=>!!Lu(t,n)||e.has(t,n)}))(Cu);const zu="TLDRAW_DOCUMENT_v2",Ru="TLDRAW_DB_NAME_INDEX_v2",Du={Records:"records",Schema:"schema",SessionState:"session_state"};async function Nu(e,t){!function(e){var t;const n=new Set(Bu());n.add(e),null===(t=window)||void 0===t||t.localStorage.setItem(Ru,JSON.stringify([...n]))}(e);const n=await function(e,t){let{blocked:n,upgrade:r,blocking:i,terminated:o}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=indexedDB.open(e,t),a=Mu(s);return r&&s.addEventListener("upgradeneeded",(e=>{r(Mu(s.result),e.oldVersion,e.newVersion,Mu(s.transaction),e)})),n&&s.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{o&&e.addEventListener("close",(()=>o())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}(e,3,{upgrade(e){e.objectStoreNames.contains(Du.Records)||e.createObjectStore(Du.Records),e.objectStoreNames.contains(Du.Schema)||e.createObjectStore(Du.Schema),e.objectStoreNames.contains(Du.SessionState)||e.createObjectStore(Du.SessionState)}});try{return await t(n)}finally{n.close()}}async function Fu(e){let{persistenceKey:t,sessionId:n,didCancel:r}=e;const i=zu+t;if(Bu().includes(i))return await async function(e){let{persistenceKey:t,didCancel:n}=e;await Nu(zu+t,(async e=>{const t=e.transaction([Du.SessionState],"readwrite"),r=t.objectStore(Du.SessionState),i=(await r.getAll()).sort(((e,t)=>e.updatedAt-t.updatedAt));if(i.length<10)return void await t.done;const o=i.slice(0,i.length-10);for(const{id:n}of o)await r.delete(n);if(null!==n&&void 0!==n&&n())return t.abort();await t.done}))}({persistenceKey:t,didCancel:r}),await Nu(i,(async e=>{var t;if(null!==r&&void 0!==r&&r())return;const i=e.transaction([Du.Records,Du.Schema,Du.SessionState],"readonly"),o=i.objectStore(Du.Records),s=i.objectStore(Du.Schema),a=i.objectStore(Du.SessionState);let l=n?null===(t=await a.get(n))||void 0===t?void 0:t.snapshot:null;if(!l){var c;l=null===(c=(await a.getAll()).sort(((e,t)=>e.updatedAt-t.updatedAt)).pop())||void 0===c?void 0:c.snapshot}const u={records:await o.getAll(),schema:await s.get(Du.Schema),sessionStateSnapshot:l};if(null===r||void 0===r||!r())return await i.done,u;i.abort()}))}function Bu(){var e,t;const n=null!==(e=JSON.parse((null===(t=window)||void 0===t?void 0:t.localStorage.getItem(Ru))||"[]"))&&void 0!==e?e:[];return Array.isArray(n)?n:[]}const Uu=Symbol("UPDATE_INSTANCE_STATE");const Hu="undefined"===typeof BroadcastChannel?class{constructor(e){s(this,"onmessage",void 0)}postMessage(e){}close(){}}:BroadcastChannel;class Vu{constructor(e,t){let{persistenceKey:n,sessionId:r=pu,onLoad:i,onLoadError:o}=t,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Hu("tldraw-tab-sync-".concat(n));s(this,"disposables",new Set),s(this,"diffQueue",[]),s(this,"didDispose",!1),s(this,"shouldDoFullDBWrite",!0),s(this,"isReloading",!1),s(this,"persistenceKey",void 0),s(this,"sessionId",void 0),s(this,"serializedSchema",void 0),s(this,"isDebugging",!1),s(this,"documentTypes",void 0),s(this,"$sessionStateSnapshot",void 0),s(this,"initTime",Date.now()),s(this,"isPersisting",!1),s(this,"didLastWriteError",!1),s(this,"scheduledPersistTimeout",null),this.store=e,this.channel=a,"undefined"!==typeof window&&(window.tlsync=this),this.persistenceKey=n,this.sessionId=r,this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=function(e){const t=e.query.ids("page");return N("sessionStateSnapshot",(()=>{const n=e.get(Yt);if(!n)return null;const r=[...t.value];return{version:fu,currentPageId:n.currentPageId,exportBackground:n.exportBackground,isFocusMode:n.isFocusMode,isDebugMode:n.isDebugMode,isToolLocked:n.isToolLocked,isGridMode:n.isGridMode,pageStates:r.map((t=>{var n,r,i,o,s;const a=e.get(Jt.createId(t)),l=e.get(Tt.createId(t));return{pageId:t,camera:{x:null!==(n=null===l||void 0===l?void 0:l.x)&&void 0!==n?n:0,y:null!==(r=null===l||void 0===l?void 0:l.y)&&void 0!==r?r:0,z:null!==(i=null===l||void 0===l?void 0:l.z)&&void 0!==i?i:1},selectedShapeIds:null!==(o=null===a||void 0===a?void 0:a.selectedShapeIds)&&void 0!==o?o:[],focusedGroupId:null!==(s=null===a||void 0===a?void 0:a.focusedGroupId)&&void 0!==s?s:null}}))}}))}(this.store),this.disposables.add(e.listen((e=>{let{changes:t}=e;this.diffQueue.push(t),this.channel.postMessage({type:"diff",storeId:this.store.id,changes:t,schema:this.serializedSchema}),this.schedulePersist()}),{source:"user",scope:"document"})),this.disposables.add(e.listen((()=>{this.diffQueue.push(Uu),this.schedulePersist()}),{scope:"session"})),this.connect(i,o),this.documentTypes=new Set(Object.values(this.store.schema.types).filter((e=>"document"===e.scope)).map((e=>e.typeName)))}debug(){this.isDebugging&&console.debug(...arguments)}async connect(e,t){let n;this.debug("connecting");try{n=await Fu({persistenceKey:this.persistenceKey,sessionId:this.sessionId,didCancel:()=>this.didDispose})}catch(o){return t(o),window.alert("Oops! We could not access your browser's storage\u2014and the app won't work correctly without that. We now need to reload the page and try again.\n\nKeep seeing this message?\n\u2022 If you're using tldraw in a private or \"incognito\" window, try loading tldraw in a regular window or in a different browser."),void("undefined"!==typeof window&&window.location.reload())}if(this.debug("loaded data from store",n,"didDispose",this.didDispose),!this.didDispose)try{if(n){var r,i;const e=Object.fromEntries(n.records.map((e=>[e.id,e]))),o=null!==(r=n.sessionStateSnapshot)&&void 0!==r?r:function(e){const t=[];for(const o of Object.values(e)){var n;null!==(n=o.typeName)&&void 0!==n&&n.match(/^(instance.*|pointer|camera)$/)&&t.push(o)}const r=t.filter((e=>"instance"===e.typeName&&e.id!==Yt))[0];if(!r)return null;const i={version:fu,currentPageId:r.currentPageId,exportBackground:!!r.exportBackground,isFocusMode:!!r.isFocusMode,isDebugMode:!!r.isDebugMode,isToolLocked:!!r.isToolLocked,isGridMode:!1,pageStates:t.filter((e=>"instance_page_state"===e.typeName&&e.instanceId===r.id)).map((t=>{var n;const r=null!==(n=e[t.cameraId])&&void 0!==n?n:{x:0,y:0,z:1};return{pageId:t.pageId,camera:{x:r.x,y:r.y,z:r.z},selectedShapeIds:t.selectedShapeIds,focusedGroupId:t.focusedGroupId}}))};try{return gu.validate(i),i}catch(ZI){return null}}(e),s=this.store.schema.migrateStoreSnapshot({store:e,schema:null!==(i=n.schema)&&void 0!==i?i:this.store.schema.serializeEarliestVersion()});if("error"===s.type)return console.error("failed to migrate store",s),void t(new Error("Failed to migrate store: ".concat(s.reason)));this.store.mergeRemoteChanges((()=>{this.store.put(Object.values(s.value).filter((e=>this.documentTypes.has(e.typeName))),"initialize")})),o&&yu(this.store,o)}this.channel.onmessage=e=>{var n;let{data:r}=e;this.debug("got message",r);const i=r,o=((e,t)=>{if(e.schemaVersion>t.schemaVersion)return 1;if(e.schemaVersion<t.schemaVersion)return-1;if(e.storeVersion>t.storeVersion)return 1;if(e.storeVersion<t.storeVersion)return-1;for(const n of Object.keys(e.recordVersions)){const r=e.recordVersions[n],i=t.recordVersions[n];if(r.version>i.version)return 1;if(r.version<i.version)return-1;if("subTypeVersions"in r&&!("subTypeVersions"in i))return 1;if(!("subTypeVersions"in r)&&"subTypeVersions"in i)return-1;if("subTypeVersions"in r&&"subTypeVersions"in i)for(const e of Object.keys(r.subTypeVersions)){const t=r.subTypeVersions[e],n=i.subTypeVersions[e];if(t>n)return 1;if(t<n)return-1}}return 0})(this.serializedSchema,null!==(n=i.schema)&&void 0!==n?n:this.store.schema.serializeEarliestVersion());if(-1===o){var s,a;return Date.now()-this.initTime<5e3?void t(new Error("Schema mismatch, please close other tabs and reload the page")):(this.debug("reloading"),this.isReloading=!0,void(null===(s=window)||void 0===s||null===(s=s.location)||void 0===s||null===(a=s.reload)||void 0===a||a.call(s)))}if(1===o)return this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,void this.persistIfNeeded();"diff"===i.type&&(this.debug("applying diff"),M((()=>{this.store.mergeRemoteChanges((()=>{this.store.applyDiff(i.changes),this.store.ensureStoreIsUsable()}))})))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add((()=>{this.channel.close()})),e(this)}catch(ZI){if(this.debug("error loading data from store",ZI),this.didDispose)return;return void t(ZI)}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach((e=>e()))}schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),this.scheduledPersistTimeout||(this.scheduledPersistTimeout=setTimeout((()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()}),this.didLastWriteError?1e4:350))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),this.isPersisting||this.isReloading||this.store.isPossiblyCorrupted()||(this.shouldDoFullDBWrite||this.diffQueue.length>0)&&this.doPersist()}async doPersist(){te(!this.isPersisting,"persist already in progress"),this.isPersisting=!0,this.debug("doPersist start");const e=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await async function(e){let{persistenceKey:t,schema:n,snapshot:r,sessionId:i,sessionStateSnapshot:o,didCancel:s}=e;const a=zu+t;await Nu(a,(async e=>{const t=e.transaction([Du.Records,Du.Schema,Du.SessionState],"readwrite"),a=t.objectStore(Du.Records),l=t.objectStore(Du.Schema),c=t.objectStore(Du.SessionState);await a.clear();for(const[n,i]of Object.entries(r))await a.put(i,n);if(l.put(n.serialize(),Du.Schema),o&&i?c.put({snapshot:o,updatedAt:Date.now(),id:i},i):(o||i)&&console.error("sessionStateSnapshot and instanceId must be provided together"),null!==s&&void 0!==s&&s())return t.abort();await t.done}))}({persistenceKey:this.persistenceKey,schema:this.store.schema,snapshot:this.store.serialize(),didCancel:()=>this.didDispose,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.value});else{const t=Ue(e.filter((e=>e!==Uu)));await async function(e){let{persistenceKey:t,schema:n,changes:r,sessionId:i,sessionStateSnapshot:o,didCancel:s}=e;const a=zu+t;await Nu(a,(async e=>{const t=e.transaction([Du.Records,Du.Schema,Du.SessionState],"readwrite"),a=t.objectStore(Du.Records),l=t.objectStore(Du.Schema),c=t.objectStore(Du.SessionState);for(const[n,i]of Object.entries(r.added))await a.put(i,n);for(const[n,i]of Object.values(r.updated))await a.put(i,i.id);for(const n of Object.keys(r.removed))await a.delete(n);if(l.put(n.serialize(),Du.Schema),o&&i?c.put({snapshot:o,updatedAt:Date.now(),id:i},i):(o||i)&&console.error("sessionStateSnapshot and instanceId must be provided together"),null!==s&&void 0!==s&&s())return t.abort();await t.done}))}({persistenceKey:this.persistenceKey,changes:t,schema:this.store.schema,didCancel:()=>this.didDispose,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.value})}this.didLastWriteError=!1}catch(ZI){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",ZI),window.alert("Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.\n\nKeep seeing this message?\n\u2022 If you're using tldraw in a private or \"incognito\" window, try loading tldraw in a regular window or in a different browser.\n\u2022 If your hard disk is full, try clearing up some space and then reload the page."),"undefined"!==typeof window&&window.location.reload()}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}}function Ku(e){let{initialData:t,defaultName:n="",...r}=e;const i="schema"in r&&r.schema?r.schema:Hn({shapes:(o=El("shapeUtils"in r&&r.shapeUtils?r.shapeUtils:[]),Object.fromEntries(o.map((e=>[e.type,{props:e.props,migrations:e.migrations}]))))});var o;return new Be({schema:i,initialData:t,props:{defaultName:n}})}function Wu(e){var n;let{persistenceKey:r,sessionId:i,...o}=e;const[s,a]=(0,t.useState)(null),l=function(e){const[n,r]=(0,t.useState)((()=>{const t=Ku(e);return e.snapshot&&t.loadSnapshot(e.snapshot),t})),i=(0,t.useRef)(e);if((0,t.useEffect)((()=>{i.current=e})),Object.keys(i.current).some((t=>i.current[t]!==e[t]))){const t=Ku(e);return e.snapshot&&t.loadSnapshot(e.snapshot),r(t),t}return n}(o);return(0,t.useEffect)((()=>{const e=Va();if(!r)return void a({id:e,storeWithStatus:{status:"not-synced",store:l}});a({id:e,storeWithStatus:{status:"loading"}});const t=t=>{a((n=>(null===n||void 0===n?void 0:n.id)===e?{id:e,storeWithStatus:t}:n))},n=new Vu(l,{sessionId:i,persistenceKey:r,onLoad(){t({store:l,status:"synced-local"})},onLoadError(e){t({status:"error",error:e})}});return()=>{a((t=>(null===t||void 0===t?void 0:t.id)===e?null:t)),n.close()}}),[r,l,i]),null!==(n=null===s||void 0===s?void 0:s.storeWithStatus)&&void 0!==n?n:{status:"loading"}}let $u=!1;if("undefined"!==typeof window){const e=window.navigator.userAgent,t=!!e.match(/iPad/i)||!!e.match(/iPhone/i),n=!!e.match(/WebKit/i);$u=t&&n&&!e.match(/CriOS/i)}const Yu=[],qu=[],Gu=(0,t.memo)((function(e){var n,r;let{store:i,components:o,className:s,user:a,...l}=e;const[c,u]=t.useState(null),d=(0,t.useMemo)((()=>null!==a&&void 0!==a?a:il()),[a]),h=void 0===(null===o||void 0===o?void 0:o.ErrorFallback)?ho:null===o||void 0===o?void 0:o.ErrorFallback,p={...l,shapeUtils:null!==(n=l.shapeUtils)&&void 0!==n?n:Yu,tools:null!==(r=l.tools)&&void 0!==r?r:qu};return(0,Zr.jsx)("div",{ref:u,draggable:!1,className:Jr("tl-container tl-theme__light",s),onPointerDown:li,tabIndex:-1,children:(0,Zr.jsx)(bi,{fallback:h,onError:e=>oe(e,{tags:{origin:"react.tldraw-before-app"}}),children:c&&(0,Zr.jsx)(pi,{container:c,children:(0,Zr.jsx)(Ho,{overrides:o,children:i?i instanceof Be?(0,Zr.jsx)(Zu,{...p,store:i,user:d}):(0,Zr.jsx)(Qu,{...p,store:i,user:d}):(0,Zr.jsx)(Xu,{...p,store:i,user:d})})})})})}));function Xu(e){const{defaultName:t,snapshot:n,initialData:r,shapeUtils:i,persistenceKey:o,sessionId:s,user:a}=e,l=Wu({shapeUtils:i,initialData:r,persistenceKey:o,sessionId:s,defaultName:t,snapshot:n});return(0,Zr.jsx)(Qu,{...e,store:l,user:a})}const Qu=(0,t.memo)((function(e){let{store:n,user:r,...i}=e;const o=fi();switch((0,t.useLayoutEffect)((()=>{r.userPreferences.value.isDarkMode&&(o.classList.remove("tl-theme__light"),o.classList.add("tl-theme__dark"))}),[o,r.userPreferences.value.isDarkMode]),n.status){case"error":throw n.error;case"loading":return(0,Zr.jsx)(td,{children:"Connecting..."})}return(0,Zr.jsx)(Zu,{...i,store:n.store,user:r})}));function Zu(e){let{onMount:n,children:r,store:i,tools:o,shapeUtils:s,user:a,initialState:l,autoFocus:c=!0,inferDarkMode:u}=e;const{ErrorFallback:d}=Vo(),h=fi(),[p,f]=(0,t.useState)(null);(0,t.useLayoutEffect)((()=>{const e=new Jc({store:i,shapeUtils:s,tools:o,getContainer:()=>h,user:a,initialState:l,inferDarkMode:u});return window.app=e,window.editor=e,f(e),()=>{e.dispose()}}),[h,s,o,i,a,l,u]);const g=(0,t.useSyncExternalStore)((0,t.useCallback)((e=>p?(p.on("crash",e),()=>p.off("crash",e)):()=>{}),[p]),(()=>{var e;return null!==(e=null===p||void 0===p?void 0:p.crashingError)&&void 0!==e?e:null}));return p?(0,Zr.jsx)(bi,{fallback:d,onError:e=>p.annotateError(e,{origin:"react.tldraw",willCrashApp:!0}),children:g?(0,Zr.jsx)(ed,{crashingError:g}):(0,Zr.jsx)(ui.Provider,{value:p,children:(0,Zr.jsx)(Ju,{autoFocus:c,onMount:n,children:r})})}):null}function Ju(e){let{children:n,onMount:r,autoFocus:i}=e;!function(){const e=di(),n=fi();t.useEffect((()=>{const t=e=>n.style.setProperty("--tl-zoom",e.toString()),r=re(t,100),i=new F("useZoomCss",(()=>{e.currentPageShapeIds.size<300?t(e.zoomLevel):r(e.zoomLevel)}));return i.attach(),i.execute(),()=>{i.detach()}}),[e,n])}(),function(){const e=di(),t=fi(),n=tu();Y("useCursor",(()=>{const{type:r,rotation:i}=e.instanceState.cursor;lu.includes(r)?t.style.setProperty("--tl-cursor","var(--tl-cursor-".concat(r,")")):t.style.setProperty("--tl-cursor",au(r,i,n?"white":"black"))}),[e,t,n])}(),function(){const e=di(),n=fi(),r=tu(),i=q(ti.forceSrgb);t.useEffect((()=>{r?(n.setAttribute("data-color-mode","dark"),n.classList.remove("tl-theme__light"),n.classList.add("tl-theme__dark")):(n.setAttribute("data-color-mode","light"),n.classList.remove("tl-theme__dark"),n.classList.add("tl-theme__light")),i?n.classList.add("tl-theme__force-sRGB"):n.classList.remove("tl-theme__force-sRGB")}),[e,n,i,r])}(),function(){const e=di();t.useEffect((()=>{if($u)return document.addEventListener("focusout",t),()=>document.removeEventListener("focusout",t);function t(t){(t.target instanceof HTMLInputElement&&"text"===t.target.type||t.target instanceof HTMLTextAreaElement)&&e.complete()}}),[e])}(),function(){const[e,n]=(0,t.useState)(0);(0,t.useEffect)((()=>n((e=>e+1))),[])}(),function(e){const n=di(),r=fi();(0,t.useLayoutEffect)((()=>{e?(n.instanceState.isFocused||n.updateInstanceState({isFocused:!0}),n.getContainer().focus()):n.instanceState.isFocused&&n.updateInstanceState({isFocused:!1})}),[n,r,e])}(i),function(e){const n=di(),r=function(e){const n=(0,t.useRef)();return(0,t.useLayoutEffect)((()=>{n.current=e})),(0,t.useDebugValue)(e),(0,t.useCallback)((function(){const e=n.current;return te(e,"fn does not exist"),e(...arguments)}),[])}((t=>{const n=null===e||void 0===e?void 0:e(t);return t.emit("mount"),window.tldrawReady=!0,n}));t.useLayoutEffect((()=>{if(n)return null===r||void 0===r?void 0:r(n)}),[n,r])}(r),function(){const e=di(),n=fi();t.useEffect((()=>B("useDPRMultiple",(()=>{const t=e.instanceState.devicePixelRatio;n.style.setProperty("--tl-dpr-multiple",fa(t).toString())}))),[e,n])}();return di().updateViewportScreenBounds(),null!==n&&void 0!==n?n:(0,Zr.jsx)(ba,{})}function ed(e){let{crashingError:t}=e;throw t}function td(e){let{children:t}=e;const{Spinner:n}=Vo();return(0,Zr.jsxs)("div",{className:"tl-loading",children:[n?(0,Zr.jsx)(n,{}):null,t]})}function nd(e){let{children:t}=e;return(0,Zr.jsx)("div",{className:"tl-loading",children:t})}function rd(e){let{children:t,className:n="",...r}=e;return(0,Zr.jsx)("div",{...r,className:"tl-html-container ".concat(n),children:t})}W((function(e){let{x:n=0,y:r=0,rotation:i=0,...o}=e;const s=di(),a=(0,t.useRef)(null);return(0,t.useLayoutEffect)((()=>{const{x:e,y:t,z:o}=s.camera,l=a.current;l&&void 0!==e&&(l.style.transform="translate(".concat(e,"px, ").concat(t,"px) scale(").concat(o,") rotate(").concat(i,"rad) translate(").concat(n,"px, ").concat(r,"px)"))}),[s.camera,n,r,i]),(0,Zr.jsx)("div",{ref:a,...o,className:Jr("tl-positioned",o.className)})}));class id extends Sl{constructor(){super(...arguments),s(this,"onResize",((e,t)=>function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{newPoint:r,handle:i,scaleX:o,scaleY:s}=t,{minWidth:a=1,maxWidth:l=1/0,minHeight:c=1,maxHeight:u=1/0}=n;let d=e.props.w*o,h=e.props.h*s;const p=new Ei(0,0);if(d>0){if(d<a){switch(i){case"top_left":case"left":case"bottom_left":p.x=d-a;break;case"top":case"bottom":p.x=(d-a)/2;break;default:p.x=0}d=a}}else if(p.x=d,d=-d,d<a){switch(i){case"top_left":case"left":case"bottom_left":p.x=-d;break;default:p.x=-a}d=a}if(h>0){if(h<c){switch(i){case"top_left":case"top":case"top_right":p.y=h-c;break;case"right":case"left":p.y=(h-c)/2;break;default:p.y=0}h=c}}else if(p.y=h,h=-h,h<c){switch(i){case"top_left":case"top":case"top_right":p.y=-h;break;default:p.y=-c}h=c}const{x:f,y:g}=p.rot(e.rotation).add(r);return{x:f,y:g,props:{w:Math.min(l,d),h:Math.min(u,h)}}}(e,t)))}getGeometry(e){return new xl({width:e.props.w,height:e.props.h,isFilled:!0})}}function od(e,t,n){const r="end"===t?e.end.point:e.start.point,i="end"===t?e.start.point:e.end.point,o=e.isStraight?Ei.Dist(i,r):Math.abs(e.bodyArc.length),s=Math.max(Math.min(o/5,3*n),n);let a;if(e.isStraight)a=Ei.Nudge(r,i,s);else{const n=function(e,t,n,r){let i=n.x-e.x,o=n.y-e.y;const s=Math.sqrt(i*i+o*o),a=(s*s-r*r+t*t)/(2*s),l=Math.sqrt(t*t-a*a);return i/=s,o/=s,[new Ei(e.x+i*a-o*l,e.y+o*a+i*l),new Ei(e.x+i*a+o*l,e.y+o*a-i*l)]}(r,s,e.handleArc.center,e.handleArc.radius);a="end"===t?e.handleArc.sweepFlag?n[0]:n[1]:e.handleArc.sweepFlag?n[1]:n[0]}return{point:r,int:a}}function sd(e,t,n){const r="end"===t?e.end.arrowhead:e.start.arrowhead;if("none"===r)return;const i=od(e,t,n);if(i){switch(r){case"bar":return function(e){let{int:t,point:n}=e;const r=Ei.Sub(t,n).div(2),i=Ei.Add(n,Ei.Rot(r,Li)),o=Ei.Sub(n,Ei.Rot(r,Li));return"M ".concat(i.x," ").concat(i.y," L ").concat(o.x," ").concat(o.y)}(i);case"square":return function(e){let{int:t,point:n}=e;const r=Ei.Lrp(n,t,.85),i=Ei.Sub(r,n).div(2),o=Ei.Add(n,Ei.Rot(i,Li)),s=Ei.Sub(n,Ei.Rot(i,Li)),a=Ei.Add(r,Ei.Rot(i,Li)),l=Ei.Sub(r,Ei.Rot(i,Li));return"M ".concat(o.x," ").concat(o.y," L ").concat(a.x," ").concat(a.y," L ").concat(l.x," ").concat(l.y," L ").concat(s.x," ").concat(s.y," Z")}(i);case"diamond":return function(e){let{point:t,int:n}=e;const r=Ei.Lrp(t,n,.75),i=Ei.RotWith(r,t,Oi/4),o=Ei.RotWith(r,t,-Oi/4),s=Ei.Lrp(i,o,.5);return s.add(Ei.Sub(s,t)),"M ".concat(s.x," ").concat(s.y," L ").concat(i.x," ").concat(i.y," ").concat(t.x," ").concat(t.y," L ").concat(o.x," ").concat(o.y," Z")}(i);case"dot":return function(e){let{point:t,int:n}=e;const r=Ei.Lrp(t,n,.45),i=Ei.Dist(r,t);return"M ".concat(r.x-i,",").concat(r.y,"\n  a ").concat(i,",").concat(i," 0 1,0 ").concat(2*i,",0\n  a ").concat(i,",").concat(i," 0 1,0 -").concat(2*i,",0 ")}(i);case"inverted":return function(e){let{point:t,int:n}=e;const r=Ei.Sub(n,t).div(2),i=Ei.Add(t,Ei.Rot(r,Li)),o=Ei.Sub(t,Ei.Rot(r,Li));return"M ".concat(i.x," ").concat(i.y," L ").concat(n.x," ").concat(n.y," L ").concat(o.x," ").concat(o.y," Z")}(i);case"arrow":return function(e){let{point:t,int:n}=e;const r=Ei.RotWith(n,t,Oi/6),i=Ei.RotWith(n,t,-Oi/6);return"M ".concat(r.x," ").concat(r.y," L ").concat(t.x," ").concat(t.y," L ").concat(i.x," ").concat(i.y)}(i);case"triangle":return function(e){let{point:t,int:n}=e;const r=Ei.RotWith(n,t,Oi/6),i=Ei.RotWith(n,t,-Oi/6);return"M ".concat(r.x," ").concat(r.y," L ").concat(t.x," ").concat(t.y," L ").concat(i.x," ").concat(i.y," Z")}(i)}return""}}class ad extends qc{constructor(){super(...arguments),s(this,"onPointerDown",(e=>{this.parent.transition("pointing",e)})),s(this,"onEnter",(()=>{this.editor.setCursor({type:"cross",rotation:0})})),s(this,"onCancel",(()=>{this.editor.setCurrentTool("select")}))}}s(ad,"id","idle");class ld extends qc{constructor(){super(...arguments),s(this,"markId",""),s(this,"wasFocusedOnEnter",!1),s(this,"onEnter",(()=>{const{isMenuOpen:e}=this.editor;this.wasFocusedOnEnter=!e})),s(this,"onPointerMove",(e=>{if(this.editor.inputs.isDragging){const{originPagePoint:t}=this.editor.inputs,n=this.parent.shapeType,r=Dn();this.markId="creating:".concat(r),this.editor.mark(this.markId),this.editor.createShapes([{id:r,type:n,x:t.x,y:t.y,props:{w:1,h:1}}]).select(r),this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:this.parent.id})}})),s(this,"onPointerUp",(()=>{this.complete()})),s(this,"onCancel",(()=>{this.cancel()})),s(this,"onComplete",(()=>{this.complete()})),s(this,"onInterrupt",(()=>{this.cancel()}))}complete(){const{originPagePoint:e}=this.editor.inputs;if(!this.wasFocusedOnEnter)return;this.editor.mark(this.markId);const t=this.parent.shapeType,n=Dn();this.editor.mark(this.markId),this.editor.createShapes([{id:n,type:t,x:e.x,y:e.y}]);const r=this.editor.getShape(n),{w:i,h:o}=this.editor.getShapeUtil(r).getDefaultProps(),s=new Ei(i/2,o/2),a=this.editor.getShapeParentTransform(r);a&&s.rot(-a.rotation()),this.editor.updateShapes([{id:n,type:t,x:r.x-s.x,y:r.y-s.y}]),this.editor.setSelectedShapes([n]),this.editor.instanceState.isToolLocked?this.parent.transition("idle",{}):this.editor.setCurrentTool("select.idle")}cancel(){this.parent.transition("idle",{})}}s(ld,"id","pointing");class cd extends qc{}function ud(e){const t=di();return q("isCropping",(()=>t.croppingShapeId===e),[t,e])}function dd(e){const t=di();return q("isEditing",(()=>t.editingShapeId===e),[t,e])}function hd(e){const n=di();return(0,t.useMemo)((function(){let t,r;return{onPointerDown:t=>{if(t.isKilled)return;if(2===t.button)return void n.dispatch({type:"pointer",target:"selection",handle:e,name:"right_click",...ci(t)});if(0!==t.button)return;const r=ii(t.currentTarget);si(r,t),r.addEventListener("pointerup",(function e(){r.removeEventListener("pointerup",e),ai(r,t)})),n.dispatch({name:"pointer_down",type:"pointer",target:"selection",handle:e,...ci(t)}),li(t)},onPointerMove:function(i){i.isKilled||0===i.button&&(i.clientX===t&&i.clientY===r||(t=i.clientX,r=i.clientY,n.dispatch({name:"pointer_move",type:"pointer",target:"selection",handle:e,...ci(i)})))},onPointerUp:t=>{t.isKilled||0===t.button&&n.dispatch({name:"pointer_up",type:"pointer",target:"selection",handle:e,...ci(t)})}}}),[n,e])}s(cd,"id","box"),s(cd,"initial","idle"),s(cd,"children",(()=>[ad,ld]));function pd(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return Math.max(8,Math.ceil(e/t))}class fd extends al{constructor(e){super({...e,isFilled:!1,isClosed:!1}),s(this,"_center",void 0),s(this,"radius",void 0),s(this,"start",void 0),s(this,"end",void 0),s(this,"measure",void 0),s(this,"length",void 0),s(this,"angleStart",void 0),s(this,"angleEnd",void 0);const{center:t,radius:n,sweepFlag:r,largeArcFlag:i,start:o,end:a}=e;if(o.equals(a))throw Error("Arc must have different start and end points.");this.angleStart=Ei.Angle(t,o),this.angleEnd=Ei.Angle(t,a),this.measure=function(e,t,n,r){const i=(t-e)%zi*2%zi-(t-e)%zi;return r?(zi-Math.abs(i))*(n?1:-1):i}(this.angleStart,this.angleEnd,r,i),this.length=this.measure*n,this.start=o,this.end=a,this._center=t,this.radius=n}nearestPoint(e){const{_center:t,measure:n,radius:r,angleEnd:i,angleStart:o,start:s,end:a}=this,l=gd(n,o,i,t.angle(e));if(l<=0)return s;if(l>=1)return a;const c=t.clone().add(e.clone().sub(t).uni().mul(r));let u,d=1/0;for(const h of[s,a,c])e.dist(h)<d&&(u=h,d=e.dist(h));if(!u)throw Error("nearest point not found");return u}hitTestLineSegment(e,t,n){const{_center:r,radius:i,measure:o,angleStart:s,angleEnd:a}=this,l=ul(e,t,r,i);return null!==l&&l.some((e=>{const t=gd(o,s,a,r.angle(e));return t>=0&&t<=1}))}getVertices(){const{_center:e,measure:t,length:n,radius:r,angleStart:i}=this,o=[];for(let s=0,a=pd(Math.abs(n));s<a+1;s++){const n=i+s/a*t;o.push(e.clone().add(new Ei(Math.cos(n),Math.sin(n)).mul(r)))}return o}}function gd(e,t,n,r){let i;if(Math.abs(e)>Oi){i=Wi(t,r);const o=Wi(r,n);return Math.abs(i)<Math.abs(o)?i/e:(e-o)/e}return i=Wi(t,r),i/e}class md extends al{constructor(e){super({isClosed:!0,...e}),s(this,"_center",void 0),s(this,"radius",void 0),s(this,"x",void 0),s(this,"y",void 0),this.config=e;const{x:t=0,y:n=0,radius:r}=e;this.x=t,this.y=n,this._center=new Ei(r+t,r+n),this.radius=r}getBounds(){return new Ti(this.x,this.y,2*this.radius,2*this.radius)}getVertices(){const{_center:e,radius:t}=this,n=[];for(let r=0,i=pd(zi*t);r<i;r++){const o=r/i*zi;n.push(e.clone().add(Ei.FromAngle(o).mul(t)))}return n}nearestPoint(e){const{_center:t,radius:n}=this;return t.equals(e)?Ei.AddXY(t,n,0):t.clone().add(e.clone().sub(t).uni().mul(n))}hitTestLineSegment(e,t,n){const{_center:r,radius:i}=this;return null!==ul(e,t,r,i)}}class yd extends bl{constructor(e){const{start:t,cp1:n,cp2:r,end:i}=e;super({...e,points:[t,i]}),s(this,"a",void 0),s(this,"b",void 0),s(this,"c",void 0),s(this,"d",void 0),this.a=t,this.b=n,this.c=r,this.d=i}getVertices(){const e=[],{a:t,b:n,c:r,d:i}=this;for(let o=0,s=10;o<=s;o++){const a=o/s;e.push(new Ei((1-a)*(1-a)*(1-a)*t.x+(1-a)*(1-a)*3*a*n.x+3*(1-a)*(a*a)*r.x+a*a*a*i.x,(1-a)*(1-a)*(1-a)*t.y+(1-a)*(1-a)*3*a*n.y+3*(1-a)*(a*a)*r.y+a*a*a*i.y))}return e}midPoint(){return function(e,t){const{a:n,b:r,c:i,d:o}=e;return new Ei((1-t)*(1-t)*(1-t)*n.x+(1-t)*(1-t)*3*t*r.x+3*(1-t)*(t*t)*i.x+t*t*t*o.x,(1-t)*(1-t)*(1-t)*n.y+(1-t)*(1-t)*3*t*r.y+3*(1-t)*(t*t)*i.y+t*t*t*o.y)}(this,.5)}nearestPoint(e){let t,n=1/0;for(const r of this.segments){const i=r.nearestPoint(e),o=i.dist(e);o<n&&(t=i,n=o)}if(!t)throw Error("nearest point not found");return t}}class vd extends al{constructor(e){super({...e,isClosed:!1,isFilled:!1}),s(this,"points",void 0),s(this,"_segments",void 0),s(this,"_length",void 0);const{points:t}=e;this.points=t}get segments(){if(!this._segments){this._segments=[];const{points:e}=this,t=e.length,n=t-2,r=1.25;for(let i=0;i<t-1;i++){const t=0===i?e[0]:e[i-1],o=e[i],s=e[i+1],a=i===n?s:e[i+2],l=o,c=0===i?t:new Ei(o.x+(s.x-t.x)/6*r,o.y+(s.y-t.y)/6*r),u=i===n?s:new Ei(s.x-(a.x-o.x)/6*r,s.y-(a.y-o.y)/6*r),d=s;this._segments.push(new yd({start:l,cp1:c,cp2:u,end:d}))}}return this._segments}get length(){return this._length||(this._length=this.segments.reduce(((e,t)=>e+t.length),0)),this._length}getVertices(){const e=this.segments.reduce(((e,t)=>e.concat(t.vertices)),[]);return e.push(this.points[this.points.length-1]),e}nearestPoint(e){let t,n=1/0;for(const r of this.segments){const i=r.nearestPoint(e),o=i.dist(e);o<n&&(t=i,n=o)}if(!t)throw Error("nearest point not found");return t}hitTestLineSegment(e,t,n){return this.segments.some((r=>r.hitTestLineSegment(e,t,n)))}}class bd extends al{constructor(e){super({...e,isClosed:!0}),s(this,"w",void 0),s(this,"h",void 0),s(this,"_edges",void 0),this.config=e;const{width:t,height:n}=e;this.w=t,this.h=n}get edges(){if(!this._edges){const{vertices:e}=this;this._edges=[];for(let t=0,n=e.length;t<n;t++){const r=e[t],i=e[(t+1)%n];this._edges.push(new vl({start:r,end:i}))}}return this._edges}getVertices(){const e=Math.max(1,this.w)/2,t=Math.max(1,this.h)/2,n=Math.pow(e-t,2)/Math.pow(e+t,2),r=pd(Oi*(e+t)*(1+3*n/(10+Math.sqrt(4-3*n)))),i=zi/r,o=Math.cos(i),s=Math.sin(i);let a=0,l=1,c=0,u=1;const d=Array(r);for(let h=0;h<r;h++)d[h]=new Ei(e+e*l,t+t*a),c=s*l+o*a,u=o*l-s*a,a=c,l=u;return d}nearestPoint(e){let t,n=1/0;for(const r of this.edges){const i=r.nearestPoint(e),o=i.dist(e);o<n&&(t=i,n=o)}if(!t)throw Error("nearest point not found");return t}hitTestLineSegment(e,t,n){return this.edges.some((r=>r.hitTestLineSegment(e,t,n)))}getBounds(){return new Ti(0,0,this.w,this.h)}}class wd extends bd{constructor(e){super({...e}),this.config=e}getVertices(){const e=Math.max(1,this.w),t=Math.max(1,this.h),n=e/2,r=t/2,i=Array(18);if(t>e)for(let o=0;o<9;o++){const e=Oi*o/8-Oi,r=Oi*o/8;i[o]=new Ei(n+n*Math.cos(e),n+n*Math.sin(e)),i[o+9]=new Ei(n+n*Math.cos(r),t-n+n*Math.sin(r))}else for(let o=0;o<9;o++){const n=Oi*o/8-Li,s=Li+Oi*-o/8;i[o]=new Ei(e-r+r*Math.cos(n),t-r+r*Math.sin(n)),i[o+9]=new Ei(r-r*Math.cos(s),t-r+r*Math.sin(s))}return i}}"undefined"!==typeof window&&(window.__tldraw__hardReset=async function(){let{shouldReload:e=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};sessionStorage.clear(),await Promise.all(Bu().map((e=>function(e){let{blocked:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",(e=>t(e.oldVersion,e))),Mu(n).then((()=>{}))}(e)))),localStorage.clear(),e&&window.location.reload()});const xd=e=>{let{children:t}=e;const n=di();return q("shouldDisplayHandles",(()=>n.isInAny("select.idle","select.pointing_handle")),[n])?(0,Zr.jsx)("svg",{className:"tl-user-handles tl-overlays__item",children:t}):null},Sd=e=>{let{shapeId:t}=e;const n=di();return q("show hovered",(()=>n.isIn("select.editing_shape")?n.hoveredShapeId!==n.editingShapeId:n.isInAny("select.idle")),[n])?(0,Zr.jsx)(ki,{className:"tl-user-indicator__hovered",id:t}):null},{PI:kd}=Math,_d=kd+1e-4;function Pd(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{size:n=16,smoothing:r=.5,start:i={},end:o={},last:s=!1}=t,{cap:a=!0}=i,{cap:l=!0}=o;if(0===e.length||n<=0)return[];const c=e[0],u=e[e.length-1],d=u.runningLength,h=!1===i.taper?0:!0===i.taper?Math.max(n,d):i.taper,p=!1===o.taper?0:!0===o.taper?Math.max(n,d):o.taper,f=Math.pow(n*r,2),g=[],m=[];let y,v=e[0].vector,b=e[0].point,w=b,x=b,S=w,k=!1;for(let M=0;M<e.length;M++){y=e[M];const{point:t,vector:n}=e[M],r=y.vector.dpr(v),i=(M<e.length-1?e[M+1]:e[M]).vector,o=M<e.length-1?i.dpr(y.vector):1,s=null!==o&&o<.2;if(r<0&&!k||s){if(o>-.62&&d-y.runningLength>y.radius){const e=v.clone().mul(y.radius);v.clone().cpr(i)<0?(x=Ei.Add(t,e),S=Ei.Sub(t,e)):(x=Ei.Sub(t,e),S=Ei.Add(t,e)),g.push(x),m.push(S)}else{const e=v.clone().mul(y.radius).per(),t=Ei.Sub(y.input,e);for(let n=1/13,r=0;r<1;r+=n)x=Ei.RotWith(t,y.input,_d*r),g.push(x),S=Ei.RotWith(t,y.input,_d+_d*-r),m.push(S)}b=x,w=S,s&&(k=!0);continue}if(k=!1,y===c||y===u){const e=Ei.Per(n).mul(y.radius);g.push(Ei.Sub(t,e)),m.push(Ei.Add(t,e));continue}const a=Ei.Lrp(i,n,o).per().mul(y.radius);x=Ei.Sub(t,a),(M<=1||Ei.Dist2(b,x)>f)&&(g.push(x),b=x),S=Ei.Add(t,a),(M<=1||Ei.Dist2(w,S)>f)&&(m.push(S),w=S),v=n}const _=c.point,P=e.length>1?e[e.length-1].point:Ei.AddXY(c.point,1,1);if(1===e.length&&(!h&&!p||s)){const e=Ei.Add(_,Ei.Sub(_,P).uni().per().mul(-c.radius)),t=[];for(let n=1/13,r=n;r<=1;r+=n)t.push(Ei.RotWith(e,_,2*_d*r));return t}const C=[];if(h||p&&1===e.length);else if(a)for(let M=1/8,T=M;T<=1;T+=M){const e=Ei.RotWith(m[0],_,_d*T);C.push(e)}else{const e=Ei.Sub(g[0],m[0]),t=Ei.Mul(e,.5),n=Ei.Mul(e,.51);C.push(Ei.Sub(_,t),Ei.Sub(_,n),Ei.Add(_,n),Ei.Add(_,t))}const E=[],I=u.vector.clone().per().neg();if(p||h&&1===e.length)E.push(P);else if(l){const e=Ei.Add(P,Ei.Mul(I,u.radius));for(let t=1/29,n=t;n<1;n+=t)E.push(Ei.RotWith(e,P,3*_d*n))}else E.push(Ei.Add(P,Ei.Mul(I,u.radius)),Ei.Add(P,Ei.Mul(I,.99*u.radius)),Ei.Sub(P,Ei.Mul(I,.99*u.radius)),Ei.Sub(P,Ei.Mul(I,u.radius)));return g.concat(E,m.reverse(),C)}const Cd=.025,Ed=.01;function Id(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{streamline:r=.5,size:i=16,simulatePressure:o=!1}=n;if(0===e.length)return[];const s=.15+.85*(1-r);let a=e.map(Ei.From),l=0;if(!o){let e=a[0];for(;e&&!(e.z>=Cd);)a.shift(),e=a[0]}if(!o){let e=a[a.length-1];for(;e&&!(e.z>=Ed);)a.pop(),e=a[a.length-1]}if(0===a.length)return[{point:Ei.From(e[0]),input:Ei.From(e[0]),pressure:o?.5:.15,vector:new Ei(1,1),distance:0,runningLength:0,radius:1}];let c=a[1];for(;c&&!(Ei.Dist(c,a[0])>i/3);)a[0].z=Math.max(a[0].z,c.z),a.splice(1,1),c=a[1];const u=a.pop();for(c=a[a.length-1];c&&!(Ei.Dist(c,u)>i/3);)a.pop(),c=a[a.length-1],l++;a.push(u);const d=n.last||!n.simulatePressure||a.length>1&&Ei.Dist(a[a.length-1],a[a.length-2])<i||l>0;if(2===a.length&&n.simulatePressure){const e=a[1];a=a.slice(0,-1);for(let t=1;t<5;t++){const n=Ei.Lrp(a[0],e,t/4);n.z=(a[0].z+(e.z-a[0].z))*t/4,a.push(n)}}const h=[{point:a[0],input:a[0],pressure:o?.5:a[0].z,vector:new Ei(1,1),distance:0,runningLength:0,radius:1}];let p,f,g=0,m=h[0];d&&r>0&&a.push(a[a.length-1].clone());for(let y=1,v=a.length;y<v;y++)p=!s||n.last&&y===v-1?a[y].clone():a[y].clone().lrp(m.point,1-s),m.point.equals(p)||(f=Ei.Dist(p,m.point),g+=f,y<4&&g<i||(m={input:a[y],point:p,pressure:o?.5:a[y].z,vector:Ei.Sub(m.point,p).uni(),distance:f,runningLength:g,radius:1},h.push(m)));if(null!==(t=h[1])&&void 0!==t&&t.vector&&(h[0].vector=h[1].vector.clone()),g<1){const e=Math.max(.5,...h.map((e=>e.pressure)));h.forEach((t=>t.pressure=e))}return h}const{min:Md}=Math,Td=.275;function Ad(e,t){const{size:n=16,thinning:r=.5,simulatePressure:i=!0,easing:o=(e=>e),start:s={},end:a={}}=t,{easing:l=Ci.easeOutQuad}=s,{easing:c=Ci.easeOutCubic}=a,u=e[e.length-1].runningLength;let d,h,p=e[0].pressure;if(!i&&u<n){const t=e.reduce(((e,t)=>Math.max(e,t.pressure)),.5);return e.forEach((e=>{e.pressure=t,e.radius=n*o(.5-r*(.5-e.pressure))})),e}{let t;for(let r=0,o=e.length;r<o&&(h=e[r],!(h.runningLength>5*n));r++){const e=Md(1,h.distance/n);if(i){const n=Md(1,1-e);t=Md(1,p+e*Td*(n-p))}else t=Md(1,p+.5*(h.pressure-p));p+=.5*(t-p)}for(let s=0;s<e.length;s++){if(h=e[s],r){let{pressure:e}=h;const t=Md(1,h.distance/n);if(i){const n=Md(1,1-t);e=Md(1,p+t*Td*(n-p))}else e=Md(1,p+t*Td*(e-p));h.radius=n*o(.5-r*(.5-e)),p=e}else h.radius=n/2;void 0===d&&(d=h.radius)}}const f=!1===s.taper?0:!0===s.taper?Math.max(n,u):s.taper,g=!1===a.taper?0:!0===a.taper?Math.max(n,u):a.taper;if(f||g)for(let m=0;m<e.length;m++){h=e[m];const{runningLength:t}=h,n=t<f?l(t/f):1,r=u-t<g?c((u-t)/g):1;h.radius=Math.max(.01,h.radius*Math.min(n,r))}return e}const jd=e=>{let{scribble:t,zoom:n,color:r,opacity:i,className:o}=e;if(!t.points.length)return null;const s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Pd(Ad(Id(e,t),t),t)}(t.points,{size:t.size/n,start:{taper:t.taper,easing:Ci.linear},last:"stopping"===t.state,simulatePressure:!1,streamline:.32});let a;if(s.length<4){const e=t.size/n/2,{x:r,y:i}=t.points[t.points.length-1];a="M ".concat(r-e,",").concat(i," a ").concat(e,",").concat(e," 0 1,0 ").concat(2*e,",0 a ").concat(e,",").concat(e," 0 1,0 ").concat(2*-e,",0")}else a=To(s);return(0,Zr.jsx)("svg",{className:o?Jr("tl-overlays__item",o):o,children:(0,Zr.jsx)("path",{className:"tl-scribble",d:a,fill:null!==r&&void 0!==r?r:"var(--color-".concat(t.color,")"),opacity:null!==i&&void 0!==i?i:t.opacity})})},Od=e=>{let{bounds:t,rotation:n}=e;const r=di();return q("should display",(()=>r.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","text.resizing")),[r])?(0,Zr.jsx)(jo,{bounds:t,rotation:n}):null};function Ld(){const e=di();return q("isReadonlyMode",(()=>e.instanceState.isReadonly),[e])}function zd(e){let{size:t,width:n,height:r,hideAlternateHandles:i}=e;const o=no(t/3),s=o/2;return(0,Zr.jsxs)("svg",{className:"tl-overlays__item",children:[(0,Zr.jsx)("polyline",{className:"tl-corner-crop-handle",points:"\n\t\t\t\t\t\t".concat(no(0-s),",").concat(no(t)," \n\t\t\t\t\t\t").concat(no(0-s),",").concat(no(0-s)," \n\t\t\t\t\t\t").concat(no(t),",").concat(no(0-s)),strokeWidth:o,"data-testid":"selection.crop.top_left","aria-label":"top_left handle"}),(0,Zr.jsx)("line",{className:Jr("tl-corner-crop-edge-handle",{"tl-hidden":i}),x1:no(n/2-t),y1:no(0-s),x2:no(n/2+t),y2:no(0-s),strokeWidth:o,"data-testid":"selection.crop.top","aria-label":"top handle"}),(0,Zr.jsx)("polyline",{className:Jr("tl-corner-crop-handle",{"tl-hidden":i}),points:"\n\t\t\t\t\t\t".concat(no(n-t),",").concat(no(0-s)," \n\t\t\t\t\t\t").concat(no(n+s),",").concat(no(0-s)," \n\t\t\t\t\t\t").concat(no(n+s),",").concat(no(t)),strokeWidth:o,"data-testid":"selection.crop.top_right","aria-label":"top_right handle"}),(0,Zr.jsx)("line",{className:Jr("tl-corner-crop-edge-handle",{"tl-hidden":i}),x1:no(n+s),y1:no(r/2-t),x2:no(n+s),y2:no(r/2+t),strokeWidth:o,"data-testid":"selection.crop.right","aria-label":"right handle"}),(0,Zr.jsx)("polyline",{className:"tl-corner-crop-handle",points:"\n\t\t\t\t\t\t".concat(no(n+s),",").concat(no(r-t)," \n\t\t\t\t\t\t").concat(no(n+s),",").concat(no(r+s),"\n\t\t\t\t\t\t").concat(no(n-t),",").concat(no(r+s)),strokeWidth:o,"data-testid":"selection.crop.bottom_right","aria-label":"bottom_right handle"}),(0,Zr.jsx)("line",{className:Jr("tl-corner-crop-edge-handle",{"tl-hidden":i}),x1:no(n/2-t),y1:no(r+s),x2:no(n/2+t),y2:no(r+s),strokeWidth:o,"data-testid":"selection.crop.bottom","aria-label":"bottom handle"}),(0,Zr.jsx)("polyline",{className:Jr("tl-corner-crop-handle",{"tl-hidden":i}),points:"\n\t\t\t\t\t\t".concat(no(0+t),",").concat(no(r+s)," \n\t\t\t\t\t\t").concat(no(0-s),",").concat(no(r+s),"\n\t\t\t\t\t\t").concat(no(0-s),",").concat(no(r-t)),strokeWidth:o,"data-testid":"selection.crop.bottom_left","aria-label":"bottom_left handle"}),(0,Zr.jsx)("line",{className:Jr("tl-corner-crop-edge-handle",{"tl-hidden":i}),x1:no(0-s),y1:no(r/2-t),x2:no(0-s),y2:no(r/2+t),strokeWidth:o,"data-testid":"selection.crop.left","aria-label":"left handle"})]})}const Rd=W((function(e){var n,r;let{bounds:i,rotation:o}=e;const s=di(),a=(0,t.useRef)(null),l=Ld(),c=hd("top"),u=hd("right"),d=hd("bottom"),h=hd("left"),p=hd("top_left"),f=hd("top_right"),g=hd("bottom_right"),m=hd("bottom_left"),y=!s.isMenuOpen&&"default"===s.instanceState.cursor.type,v=s.instanceState.isCoarsePointer,b=s.selectedShapes,w=s.onlySelectedShape,x=w&&s.isShapeOrAncestorLocked(w),S=w?s.getShapeUtil(w).expandSelectionOutlinePx(w):0;if(Pi(a,null===(n=i)||void 0===n?void 0:n.x,null===(r=i)||void 0===r?void 0:r.y,1,s.selectionRotation,{x:-S,y:-S}),!i)return null;i=i.clone().expandBy(S).zeroFix();const k=s.zoomLevel,_=s.instanceState.isChangingStyle,P=i.width,C=i.height,E=8/k,I=P<2*E,M=C<2*E,T=P<4*E,A=C<4*E,j=P<5*E,O=C<5*E,L=v?1.75:1,z=6/k*L,R=(T?z/2:z)*(.75*L),D=(A?z/2:z)*(.75*L),N=(!w||!s.getShapeUtil(w).hideSelectionBoundsFg(w))&&!_;let F=N&&s.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.pointing_resize_handle","select.pointing_crop_handle")||N&&s.isIn("select.resizing")&&w&&s.isShapeOfType(w,"text");w&&F&&s.environment.isFirefox&&s.isShapeOfType(w,"embed")&&(F=!1);const B=s.isInAny("select.pointing_crop_handle","select.crop.idle","select.crop.pointing_crop")&&!_&&!l,U=s.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!_&&!l,H=!v&&!(I||M)&&(U||B)&&(!w||!s.getShapeUtil(w).hideRotateHandle(w))&&!x,V=v&&(!T||!A)&&(U||B)&&(!w||!s.getShapeUtil(w).hideRotateHandle(w))&&!x,K=U&&(!w||s.getShapeUtil(w).canResize(w)&&!s.getShapeUtil(w).hideResizeHandles(w))&&!B&&!x,W=I||M,$=I&&M,Y=j||O,q=K||B,G=!H,X=!U||!V,Q=!U||!q,Z=!U||!q||W,J=!U||!q||W,ee=!U||!q||$&&!B;let te=v;te&&b.every((e=>s.getShapeUtil(e).isAspectRatioLocked(e)))&&(te=!1);let ne=!0;B?ne=Y:K&&(ne=W||$||te);const re=Math.min(24/k,C-3*D),ie=U&&v&&w&&s.isShapeOfType(w,"text")&&re*k>=4;return(0,Zr.jsx)("svg",{className:"tl-overlays__item tl-selection__fg tl-svg-context","data-testid":"selection-foreground",children:(0,Zr.jsxs)("g",{ref:a,children:[F&&(0,Zr.jsx)("rect",{className:Jr("tl-selection__fg__outline"),width:no(P),height:no(C)}),(0,Zr.jsx)(Dd,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:z,corner:"top_left_rotate",cursor:y?au("nwse-rotate",o):void 0,isHidden:G}),(0,Zr.jsx)(Dd,{"data-testid":"selection.rotate.top-right",cx:P+3*z,cy:0,targetSize:z,corner:"top_right_rotate",cursor:y?au("nesw-rotate",o):void 0,isHidden:G}),(0,Zr.jsx)(Dd,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:C+3*z,targetSize:z,corner:"bottom_left_rotate",cursor:y?au("swne-rotate",o):void 0,isHidden:G}),(0,Zr.jsx)(Dd,{"data-testid":"selection.rotate.bottom-right",cx:P+3*z,cy:C+3*z,targetSize:z,corner:"bottom_right_rotate",cursor:y?au("senw-rotate",o):void 0,isHidden:G}),(0,Zr.jsx)(Fd,{"data-testid":"selection.rotate.mobile",cx:T?1.5*-z:P/2,cy:T?C/2:1.5*-z,size:E,isHidden:X}),(0,Zr.jsx)("rect",{className:Jr("tl-transparent",{"tl-hidden":ne}),"data-testid":"selection.resize.top","aria-label":"top target",pointerEvents:"all",x:0,y:no(0-(A?2*D:D)),width:no(P),height:no(Math.max(1,2*D)),style:y?{cursor:au("ns-resize",o)}:void 0,...c}),(0,Zr.jsx)("rect",{className:Jr("tl-transparent",{"tl-hidden":ne}),"data-testid":"selection.resize.right","aria-label":"right target",pointerEvents:"all",x:no(P-(T?0:R)),y:0,height:no(C),width:no(Math.max(1,2*R)),style:y?{cursor:au("ew-resize",o)}:void 0,...u}),(0,Zr.jsx)("rect",{className:Jr("tl-transparent",{"tl-hidden":ne}),"data-testid":"selection.resize.bottom","aria-label":"bottom target",pointerEvents:"all",x:0,y:no(C-(A?0:D)),width:no(P),height:no(Math.max(1,2*D)),style:y?{cursor:au("ns-resize",o)}:void 0,...d}),(0,Zr.jsx)("rect",{className:Jr("tl-transparent",{"tl-hidden":ne}),"data-testid":"selection.resize.left","aria-label":"left target",pointerEvents:"all",x:no(0-(T?2*R:R)),y:0,height:no(C),width:no(Math.max(1,2*R)),style:y?{cursor:au("ew-resize",o)}:void 0,...h}),(0,Zr.jsx)("rect",{className:Jr("tl-transparent",{"tl-hidden":Q}),"data-testid":"selection.target.top-left","aria-label":"top-left target",pointerEvents:"all",x:no(0-(T?2*R:1.5*R)),y:no(0-(A?2*D:1.5*D)),width:no(3*R),height:no(3*D),style:y?{cursor:au("nwse-resize",o)}:void 0,...p}),(0,Zr.jsx)("rect",{className:Jr("tl-transparent",{"tl-hidden":Z}),"data-testid":"selection.target.top-right","aria-label":"top-right target",pointerEvents:"all",x:no(P-(T?0:1.5*R)),y:no(0-(A?2*D:1.5*D)),width:no(3*R),height:no(3*D),style:y?{cursor:au("nesw-resize",o)}:void 0,...f}),(0,Zr.jsx)("rect",{className:Jr("tl-transparent",{"tl-hidden":ee}),"data-testid":"selection.target.bottom-right","aria-label":"bottom-right target",pointerEvents:"all",x:no(P-(T?R:1.5*R)),y:no(C-(A?D:1.5*D)),width:no(3*R),height:no(3*D),style:y?{cursor:au("nwse-resize",o)}:void 0,...g}),(0,Zr.jsx)("rect",{className:Jr("tl-transparent",{"tl-hidden":J}),"data-testid":"selection.target.bottom-left","aria-label":"bottom-left target",pointerEvents:"all",x:no(0-(T?3*R:1.5*R)),y:no(C-(A?0:1.5*D)),width:no(3*R),height:no(3*D),style:y?{cursor:au("nesw-resize",o)}:void 0,...m}),K&&(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsx)("rect",{"data-testid":"selection.resize.top-left",className:Jr("tl-corner-handle",{"tl-hidden":Q}),"aria-label":"top_left handle",x:no(0-E/2),y:no(0-E/2),width:no(E),height:no(E)}),(0,Zr.jsx)("rect",{"data-testid":"selection.resize.top-right",className:Jr("tl-corner-handle",{"tl-hidden":Z}),"aria-label":"top_right handle",x:no(P-E/2),y:no(0-E/2),width:no(E),height:no(E)}),(0,Zr.jsx)("rect",{"data-testid":"selection.resize.bottom-right",className:Jr("tl-corner-handle",{"tl-hidden":ee}),"aria-label":"bottom_right handle",x:no(P-E/2),y:no(C-E/2),width:no(E),height:no(E)}),(0,Zr.jsx)("rect",{"data-testid":"selection.resize.bottom-left",className:Jr("tl-corner-handle",{"tl-hidden":J}),"aria-label":"bottom_left handle",x:no(0-E/2),y:no(C-E/2),width:no(E),height:no(E)})]}),ie&&(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsx)("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle","aria-label":"bottom_left handle",x:no(0-E/4),y:no(C/2-re/2),rx:E/4,width:no(E/2),height:no(re)}),(0,Zr.jsx)("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle","aria-label":"bottom_left handle",rx:E/4,x:no(P-E/4),y:no(C/2-re/2),width:no(E/2),height:no(re)})]}),B&&(0,Zr.jsx)(zd,{size:E,width:P,height:C,hideAlternateHandles:Y})]})})})),Dd=function(e){let{cx:t,cy:n,targetSize:r,corner:i,cursor:o,isHidden:s,"data-testid":a}=e;const l=hd(i);return(0,Zr.jsx)("rect",{className:Jr("tl-transparent","tl-rotate-corner",{"tl-hidden":s}),"data-testid":a,"aria-label":"".concat(i," target"),pointerEvents:"all",x:no(t-3*r),y:no(n-3*r),width:no(Math.max(1,3*r)),height:no(Math.max(1,3*r)),cursor:o,...l})},Nd=Math.sqrt(Math.PI),Fd=function(e){let{cx:t,cy:n,size:r,isHidden:i,"data-testid":o}=e;const s=hd("mobile_rotate"),a=di(),l=q("zoom level",(()=>a.zoomLevel),[a]),c=Math.max(1/l*14,20/Math.max(1,l));return(0,Zr.jsxs)("g",{children:[(0,Zr.jsx)("circle",{"data-testid":o,pointerEvents:"all",className:Jr("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":i}),cx:t,cy:n,r:c,...s}),(0,Zr.jsx)("circle",{className:Jr("tl-mobile-rotate__fg",{"tl-hidden":i}),cx:t,cy:n,r:r/Nd})]})},Bd={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px"},Ud={s:2,m:3.5,l:5,xl:10},Hd={s:18,m:24,l:36,xl:44},Vd={s:18,m:22,l:26,xl:32},Kd={s:18,m:20,l:24,xl:28},Wd={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"};function $d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Yd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$d(Object(n),!0).forEach((function(t){qd(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function qd(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Gd(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function Xd(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,s,a=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=o.call(n)).done)&&(a.push(r.value),a.length!==t);l=!0);}catch(u){c=!0,i=u}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw i}}return a}}(e,t)||Zd(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Qd(e){return function(e){if(Array.isArray(e))return Jd(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Zd(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Zd(e,t){if(e){if("string"===typeof e)return Jd(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Jd(e,t):void 0}}function Jd(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function eh(e){var t,n,r=e.sizes.shift(),i=Math.max(Math.ceil(r[0]),1),o=Math.max(Math.ceil(r[1]),1),s=[i-1,o-1,1,1],a=Date.now(),l="undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope;l?(t=new OffscreenCanvas(1,1),n=new OffscreenCanvas(i,o)):((t=document.createElement("canvas")).width=1,t.height=1,(n=document.createElement("canvas")).width=i,n.height=o);var c=t.getContext("2d"),u=n.getContext("2d");u&&(u.fillRect.apply(u,s),c.drawImage(n,i-1,o-1,1,1,0,0,1,1));var d=c&&0!==c.getImageData(0,0,1,1).data[3],h=Date.now()-a;return[t,n].forEach((function(e){e.height=0,e.width=0})),l?(postMessage({width:i,height:o,benchmark:h,isTestPass:d}),!d&&e.sizes.length&&eh(e)):d?e.onSuccess(i,o,h):(e.onError(i,o,h),e.sizes.length&&eh(e)),d}var th=[16384,14188,11402,11180,10836,8192,4096,1],nh=[8388607,65535,32767,16384,8192,4096,1],rh=[4194303,65535,32767,16384,8192,4096,1],ih=["onError","onSuccess"],oh={max:null,min:1,sizes:[],step:1024,usePromise:!1,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},sh={};function ah(e){var t=e.width===e.height,n=1===e.height,r=1===e.width,i=[];if(e.width&&e.height)for(var o=e.min||oh.min,s=e.step||oh.step,a=Math.max(e.width,e.height);a>=o;){var l=t||n?a:1,c=t||r?a:1;i.push([l,c]),a-=s}else e.sizes.forEach((function(e){var o=t||n?e:1,s=t||r?e:1;i.push([o,s])}));return i}function lh(e){var t=window&&"HTMLCanvasElement"in window,n=window&&"OffscreenCanvas"in window,r=Date.now(),i=e.onError,o=e.onSuccess,s=Gd(e,ih),a=null;if(!t)return!1;if(e.useWorker&&n){var l="\n            var canvasTest = ".concat(eh.toString(),";\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        "),c=new Blob([l],{type:"application/javascript"}),u=URL.createObjectURL(c);a=new Worker(u),URL.revokeObjectURL(u),a.onmessage=function(e){var t=e.data,n=t.width,i=t.height,o=t.benchmark;t.isTestPass?(sh[r].onSuccess(n,i,o),delete sh[r]):sh[r].onError(n,i,o)}}return e.usePromise?new Promise((function(t,n){var l=Yd(Yd({},e),{},{onError:function(t,r,o){var s;if(0===e.sizes.length)s=!0;else{var a=Xd(e.sizes.slice(-1),1),l=Xd(a[0],2),c=l[0],u=l[1];s=t===c&&r===u}i(t,r,o),s&&n({width:t,height:r,benchmark:o})},onSuccess:function(e,n,r){o(e,n,r),t({width:e,height:n,benchmark:r})}});if(a){var c=l.onError,u=l.onSuccess;sh[r]={onError:c,onSuccess:u},a.postMessage(s)}else eh(l)})):a?(sh[r]={onError:i,onSuccess:o},void a.postMessage(s)):eh(e)}var ch={maxArea:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=ah({width:e.max,height:e.max,min:e.min,step:e.step,sizes:Qd(th)});return lh(Yd(Yd(Yd({},oh),e),{},{sizes:t}))},maxHeight:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=ah({width:1,height:e.max,min:e.min,step:e.step,sizes:Qd(nh)});return lh(Yd(Yd(Yd({},oh),e),{},{sizes:t}))},maxWidth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=ah({width:e.max,height:1,min:e.min,step:e.step,sizes:Qd(rh)});return lh(Yd(Yd(Yd({},oh),e),{},{sizes:t}))},test:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Yd(Yd({},oh),e);return t.sizes=Qd(t.sizes),t.width&&t.height&&(t.sizes=[[t.width,t.height]]),lh(t)}};let uh=null;function dh(){return uh||(uh=async function(){const e=await ch.maxWidth({usePromise:!0}),t=await ch.maxHeight({usePromise:!0}),n=await ch.maxArea({usePromise:!0});return{maxWidth:e.width,maxHeight:t.height,maxArea:n.width*n.height}}()),uh}function hh(e,t){let n=0;for(;e[t+n];)n+=e[t+n]+1;return n+1}function ph(e){const t=new Uint8Array(e);let n,r,i=0,o=0;if(!function(e){return"GIF"===new TextDecoder("ascii").decode(e.slice(0,3))}(e))return!1;for(n=128&t[10],r=7&t[10],i+=6,i+=7,i+=n?3*Math.pow(2,r+1):0;o<2&&i<t.length;)switch(t[i]){case 44:o+=1,n=128&t[i+9],r=7&t[i+9],i+=10,i+=n?3*Math.pow(2,r+1):0,i+=hh(t,i+1)+1;break;case 33:i+=2,i+=hh(t,i);break;default:i=t.length}return o>1}async function fh(e){return await new Promise(((t,n)=>{const r=new FileReader;r.onerror=()=>n(r.error),r.onload=()=>{t(!!r.result&&ph(r.result))},r.readAsArrayBuffer(e)}))}const gh=e=>e.split("*").map((e=>function(e){if("string"!==typeof e)throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}(e))).join(".+"),mh=(e,t)=>!!e.find((e=>{const n=new RegExp(gh(e));return t.match(n)}));function yh(e){var t;return null!==(t=function(e){const t=new URL(e).host.replace("www.","");for(const n of gr)if(mh(n.hostnames,t)){const t=n.toEmbedUrl(e);if(t)return{definition:n,embedUrl:t,url:e}}}(e))&&void 0!==t?t:function(e){const t=new URL(e).host.replace("www.","");for(const n of gr)if(mh(n.hostnames,t)){const t=n.fromEmbedUrl(e);if(t)return{definition:n,url:t,embedUrl:e}}}(e)}function vh(e){try{return yh(e)}catch(ZI){console.error(ZI)}}const bh="  ";class wh{static insertTextFirefox(e,t){e.setRangeText(t,e.selectionStart||0,e.selectionEnd||0,"end"),e.dispatchEvent(new InputEvent("input",{data:t,inputType:"insertText",isComposing:!1}))}static insert(e,t){const n=e.ownerDocument,r=n.activeElement;r!==e&&e.focus(),n.execCommand("insertText",!1,t)||wh.insertTextFirefox(e,t),r===n.body?e.blur():r instanceof HTMLElement&&r!==e&&r.focus()}static set(e,t){e.select(),wh.insert(e,t)}static getSelection(e){const{selectionStart:t,selectionEnd:n}=e;return e.value.slice(t||void 0,n||void 0)}static wrapSelection(e,t,n){const{selectionStart:r,selectionEnd:i}=e,o=wh.getSelection(e);wh.insert(e,t+o+(null!==n&&void 0!==n?n:t)),e.selectionStart=(r||0)+t.length,e.selectionEnd=(i||0)+t.length}static replace(e,t,n){let r=0;e.value.replace(t,(function(){for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];const s=r+i[i.length-2],a=i[0].length;e.selectionStart=s,e.selectionEnd=s+a;const l="string"===typeof n?n:n(...i);return wh.insert(e,l),e.selectionStart=s,r+=l.length-a,l}))}static findLineEnd(e,t){const n=e.lastIndexOf("\n",t-1)+1;return"\t"!==e.charAt(n)?t:n+1}static indent(e){var t;const{selectionStart:n,selectionEnd:r,value:i}=e,o=i.slice(n,r),s=null===(t=/\n/g.exec(o))||void 0===t?void 0:t.length;if(s&&s>0){const t=i.lastIndexOf("\n",n-1)+1,o=e.value.slice(t,r-1),s=o.replace(/^|\n/g,"$&".concat(bh)),a=s.length-o.length;e.setSelectionRange(t,r-1),wh.insert(e,s),e.setSelectionRange(n+1,r+a)}else wh.insert(e,bh)}static unindent(e){const{selectionStart:t,selectionEnd:n,value:r}=e,i=r.lastIndexOf("\n",t-1)+1,o=wh.findLineEnd(r,n),s=e.value.slice(i,o),a=s.replace(/(^|\n)(\t| {1,2})/g,"$1"),l=s.length-a.length;e.setSelectionRange(i,o),wh.insert(e,a);const c=/\t| {1,2}/.exec(r.slice(i,t)),u=c?c[0].length:0,d=t-u;e.setSelectionRange(t-u,Math.max(d,n-l))}static indentCE(e){var t,n,r;const i=window.getSelection(),o=e.innerText,s=null!==(t=xh(e))&&void 0!==t?t:0,a=null!==(n=xh(e))&&void 0!==n?n:0,l=o.slice(s,a),c=null===(r=/\n/g.exec(l))||void 0===r?void 0:r.length;if(c&&c>0){const t=o.lastIndexOf("\n",s-1)+1,n=o.slice(t,a-1),r=n.replace(/^|\n/g,"$&".concat(bh)).length-n.length;i&&i.setBaseAndExtent(e,s+1,e,a+r)}else{const t=window.getSelection();e.innerText=o.slice(0,s)+bh+o.slice(s),null===t||void 0===t||t.setBaseAndExtent(e,s+1,e,s+2)}}static unindentCE(e){var t,n;const r=window.getSelection(),i=e.innerText,o=null!==(t=xh(e))&&void 0!==t?t:0,s=null!==(n=xh(e))&&void 0!==n?n:0,a=i.lastIndexOf("\n",o-1)+1,l=wh.findLineEnd(i,s),c=i.slice(a,l),u=c.replace(/(^|\n)(\t| {1,2})/g,"$1"),d=c.length-u.length;if(r){r.setBaseAndExtent(e,a,e,l);const t=/\t| {1,2}/.exec(i.slice(a,o)),n=t?t[0].length:0,c=o-n;r.setBaseAndExtent(e,o-n,e,Math.max(c,s-d))}}static normalizeText(e){return e.replace(wh.fixNewLines,"\n")}static normalizeTextForDom(e){return e.replace(wh.fixNewLines,"\n").split("\n").map((e=>e||" ")).join("\n")}}function xh(e){if("undefined"===typeof window.getSelection)return;const t=window.getSelection();if(!t)return;let n=0;if(0!==t.rangeCount){const r=t.getRangeAt(0),i=r.cloneRange();i.selectNodeContents(e),i.setEnd(r.endContainer,r.endOffset),n=i.toString().length}return n}s(wh,"fixNewLines",/\r?\n|\r/g);const Sh=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/;function kh(e){return function(e){return e.replace(/[ \t]+$/gm,"").replace(/\n+$/,"")}(function(e){const t=e.split("\n");for(;t[0]&&0===t[0].trim().length;)t.shift();let n=1/0;for(const r of t)if(r.trim().length>0){const e=r.length-r.trimStart().length;n=Math.min(n,e)}return t.map((e=>e.slice(n))).join("\n")}(function(e){return e.replace(/\t/g,bh)}(e)))}const _h=(e,t)=>e.length<=t?e:e.substring(0,t-3)+"...";function Ph(e,t){let{maxImageDimension:n,maxAssetSize:r,acceptedImageMimeTypes:i,acceptedVideoMimeTypes:o}=t;e.registerExternalAssetHandler("file",(async e=>{let{file:t}=e;return await new Promise(((e,s)=>{i.includes(t.type)||o.includes(t.type)||(console.warn("File type not allowed: ".concat(t.type)),s()),t.size>r&&(console.warn("File size too big: ".concat((t.size/1024).toFixed(),"kb > ").concat((r/1024).toFixed(),"kb")),s());const a=new FileReader;a.onerror=()=>s(a.error),a.onload=async()=>{let r=a.result;"video/quicktime"===t.type&&r.includes("video/quicktime")&&(r=r.replace("video/quicktime","video/mp4"));const o=i.includes(t.type);let s,l;if(o?(s=await ue.getImageSizeFromSrc(r),l="image/gif"===t.type&&await fh(t)):(l=!0,s=await ue.getVideoSizeFromSrc(r)),isFinite(n)){const e=function(e,t){const n=e.w/t.w,r=e.h/t.h;return n<=1&&r<=1?e:n>r?{w:e.w/n,h:e.h/n}:{w:e.w/r,h:e.h/r}}(s,{w:n,h:n});s===e||"image/jpeg"!==t.type&&"image/png"!==t.type||(r=await async function(e,t,n){return await new Promise((r=>{const i=new Image;i.onload=async()=>{const e=document.createElement("canvas"),o=e.getContext("2d");if(!o)return;const s=await dh();let a=2*t,l=2*n;const c=i.width/i.height;if(a>s.maxWidth&&(a=s.maxWidth,l=a/c),l>s.maxHeight&&(l=s.maxHeight,a=l*c),a*l>s.maxArea){const e=Math.sqrt(s.maxArea/(a*l));a*=e,l*=e}e.width=a,e.height=l,o.drawImage(i,0,0,e.width,e.height);const u=e.toDataURL();r(u)},i.crossOrigin="anonymous",i.src=e}))}(r,s.w,s.h)),s=e}const c=Tn.createId(se(r)),u=Tn.create({id:c,type:o?"image":"video",typeName:"asset",props:{name:t.name,src:r,w:s.w,h:s.h,mimeType:t.type,isAnimated:l}});e(u)},a.readAsDataURL(t)}))})),e.registerExternalAssetHandler("url",(async e=>{let t,{url:n}=e;try{var r,i,o,s,a,l;const e=await fetch(n,{method:"GET",mode:"no-cors"}),c=await e.text(),u=(new DOMParser).parseFromString(c,"text/html");t={image:null!==(r=null===(i=u.head.querySelector('meta[property="og:image"]'))||void 0===i?void 0:i.getAttribute("content"))&&void 0!==r?r:"",title:null!==(o=null===(s=u.head.querySelector('meta[property="og:title"]'))||void 0===s?void 0:s.getAttribute("content"))&&void 0!==o?o:_h(n,32),description:null!==(a=null===(l=u.head.querySelector('meta[property="og:description"]'))||void 0===l?void 0:l.getAttribute("content"))&&void 0!==a?a:""}}catch(c){console.error(c),t={image:"",title:_h(n,32),description:""}}return{id:Tn.createId(se(n)),typeName:"asset",type:"bookmark",props:{src:n,description:t.description,image:t.image,title:t.title},meta:{}}})),e.registerExternalContentHandler("svg-text",(async t=>{let{point:n,text:r}=t;const i=null!==n&&void 0!==n?n:e.inputs.shiftKey?e.inputs.currentPagePoint:e.viewportPageCenter,o=(new DOMParser).parseFromString(r,"image/svg+xml").querySelector("svg");if(!o)throw new Error("No <svg/> element present");let s=parseFloat(o.getAttribute("width")||"0"),a=parseFloat(o.getAttribute("height")||"0");if(!s||!a){document.body.appendChild(o);const e=o.getBoundingClientRect();document.body.removeChild(o),s=e.width,a=e.height}const l=await e.getAssetForExternalContent({type:"file",file:new File([r],"asset.svg",{type:"image/svg+xml"})});if(!l)throw Error("Could not create an asset");Ch(e,[l],i)})),e.registerExternalContentHandler("embed",(t=>{let{point:n,url:r,embed:i}=t;const o=null!==n&&void 0!==n?n:e.inputs.shiftKey?e.inputs.currentPagePoint:e.viewportPageCenter,{width:s,height:a}=i,l=Dn(),c={id:l,type:"embed",x:o.x-(s||450)/2,y:o.y-(a||450)/2,props:{w:s,h:a,url:r}};e.createShapes([c]).select(l)})),e.registerExternalContentHandler("files",(async t=>{let{point:n,files:s}=t;const a=null!==n&&void 0!==n?n:e.inputs.shiftKey?e.inputs.currentPagePoint:e.viewportPageCenter,l=new Ei(a.x,a.y),c=[];await Promise.all(s.map((async(t,n)=>{if(t.size>r)return console.warn("File size too big: ".concat((t.size/1024).toFixed(),"kb > ").concat((r/1024).toFixed(),"kb")),null;if(!t.type)throw new Error("No mime type");if(!i.concat(o).includes(t.type))return console.warn("".concat(t.name," not loaded - Extension not allowed.")),null;try{const r=await e.getAssetForExternalContent({type:"file",file:t});if(!r)throw Error("Could not create an asset");c[n]=r}catch(s){return console.error(s),null}}))),Ch(e,Q(c),l)})),e.registerExternalContentHandler("text",(async t=>{let{point:n,text:r}=t;const i=null!==n&&void 0!==n?n:e.inputs.shiftKey?e.inputs.currentPagePoint:e.viewportPageCenter,o=e.getShapeUtil("text").getDefaultProps(),s=kh(r);let a,l,c,u="middle";const d=s.split("\n").length>1,h=function(e){return Sh.test(e)}(s);d&&(u=d?h?"end":"start":"middle");const p=e.textMeasure.measureText(s,{...Bd,fontFamily:Wd[o.font],fontSize:Hd[o.size],maxWidth:null}),f=Math.min(d?.9*e.viewportPageBounds.width:920,Math.max(200,.9*e.viewportPageBounds.width));if(p.w>f){const t=e.textMeasure.measureText(s,{...Bd,fontFamily:Wd[o.font],fontSize:Hd[o.size],maxWidth:f});a=t.w,l=t.h,c=!1,u=h?"end":"start"}else a=p.w,l=p.h,c=!0;i.y-l/2<e.viewportPageBounds.minY+40&&(i.y=e.viewportPageBounds.minY+40+l/2),e.createShapes([{id:Dn(),type:"text",x:i.x-a/2,y:i.y-l/2,props:{text:s,align:u,autoSize:c,w:a}}])})),e.registerExternalContentHandler("url",(async t=>{let{point:n,url:r}=t;const i=vh(r);if(i)return e.putExternalContent({type:"embed",url:i.url,point:n,embed:i.definition});const o=null!==n&&void 0!==n?n:e.inputs.shiftKey?e.inputs.currentPagePoint:e.viewportPageCenter,s=Tn.createId(se(r)),a=function(e,t,n){const r={id:Dn(),type:"bookmark",x:n.x-150,y:n.y-160,opacity:1,props:{assetId:null,url:t}};return e.batch((()=>{e.createShapes([r]).select(r.id),Eh(e,n)})),e.getShape(r.id)}(e,r,o);let l=e.getAsset(s),c=!1;if(!l){c=!0;const t=await e.getAssetForExternalContent({type:"url",url:r});if(!t)throw Error("Could not create an asset");l=t}e.batch((()=>{c&&e.createAssets([l]),e.updateShapes([{...a,props:{...a.props,assetId:l.id}}])}))}))}async function Ch(e,t,n){if(!t.length)return[];const r=Ei.From(n),i=[];for(const o of t)switch(o.type){case"bookmark":i.push({id:Dn(),type:"bookmark",x:r.x-150,y:r.y-160,opacity:1,props:{assetId:o.id,url:o.props.src}}),r.x+=300;break;case"image":i.push({id:Dn(),type:"image",x:r.x-o.props.w/2,y:r.y-o.props.h/2,opacity:1,props:{assetId:o.id,w:o.props.w,h:o.props.h}}),r.x+=o.props.w;break;case"video":i.push({id:Dn(),type:"video",x:r.x-o.props.w/2,y:r.y-o.props.h/2,opacity:1,props:{assetId:o.id,w:o.props.w,h:o.props.h}}),r.x+=o.props.w}return e.batch((()=>{const r=t.filter((t=>!e.getAsset(t.id)));r.length&&e.createAssets(r),e.createShapes(i).select(...i.map((e=>e.id))),Eh(e,n)})),i.map((e=>e.id))}function Eh(e,t){const{viewportPageBounds:n}=e;let{selectionPageBounds:r}=e;if(r){const n=r.center.sub(t);e.updateShapes(e.selectedShapes.map((t=>{const r=e.getShapeParentTransform(t).decompose().rotation,i=Ei.Rot(n,-r);return{id:t.id,type:t.type,x:t.x-i.x,y:t.y-i.y}})))}r=e.selectionPageBounds,r&&!n.contains(r)&&e.zoomToSelection()}class Ih extends qc{constructor(){super(...arguments),s(this,"onPointerDown",(e=>{this.parent.transition("pointing",e)})),s(this,"onEnter",(()=>{this.editor.setCursor({type:"cross",rotation:0})})),s(this,"onCancel",(()=>{this.editor.setCurrentTool("select")})),s(this,"onKeyUp",(e=>{if("Enter"===e.key){if(this.editor.instanceState.isReadonly)return null;const{onlySelectedShape:t}=this.editor;t&&this.editor.getShapeUtil(t).canEdit(t)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(t.id),this.editor.root.current.value.transition("editing_shape",{...e,target:"shape",shape:t}))}}))}}s(Ih,"id","idle");class Mh extends qc{constructor(){super(...arguments),s(this,"shape",void 0),s(this,"markId",""),s(this,"onEnter",(()=>{this.didTimeout=!1;const e=this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{filter:e=>!e.isLocked&&this.editor.getShapeUtil(e).canBind(e),margin:0,hitInside:!0,renderingOnly:!0});e?this.editor.setHintingShapes([e.id]):this.createArrowShape(),this.startPreciseTimeout()})),s(this,"onExit",(()=>{this.shape=void 0,this.editor.setHintingShapes([]),this.clearPreciseTimeout()})),s(this,"onPointerMove",(()=>{if(this.editor.inputs.isDragging){if(this.shape||this.createArrowShape(),!this.shape)throw Error("expected shape");this.updateArrowShapeEndHandle(),this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,handle:this.editor.getShapeHandles(this.shape).find((e=>"end"===e.id)),isCreating:!0,onInteractionEnd:"arrow"})}})),s(this,"onPointerUp",(()=>{this.cancel()})),s(this,"onCancel",(()=>{this.cancel()})),s(this,"onComplete",(()=>{this.cancel()})),s(this,"onInterrupt",(()=>{this.cancel()})),s(this,"preciseTimeout",-1),s(this,"didTimeout",!1)}cancel(){this.shape&&this.editor.bailToMark(this.markId),this.editor.setHintingShapes([]),this.parent.transition("idle",{})}createArrowShape(){var e;const{originPagePoint:t}=this.editor.inputs,n=Dn();this.markId="creating:".concat(n),this.editor.mark(this.markId),this.editor.createShapes([{id:n,type:"arrow",x:t.x,y:t.y}]);const r=this.editor.getShape(n);if(!r)throw Error("expected shape");const i=this.editor.getShapeHandles(r);if(!i)throw Error("expected handles for arrow");const o=this.editor.getShapeUtil("arrow"),s=this.shape,a=i.find((e=>"start"===e.id)),l=null===(e=o.onHandleChange)||void 0===e?void 0:e.call(o,r,{handle:{...a,x:0,y:0},isPrecise:!0,initial:s});if(l){var c;const e=null===(c=l.props)||void 0===c?void 0:c.start;"binding"===(null===e||void 0===e?void 0:e.type)&&this.editor.setHintingShapes([e.boundShapeId]),this.editor.updateShapes([l],{squashing:!0})}this.shape=this.editor.getShape(n),this.editor.select(n)}updateArrowShapeEndHandle(){const e=this.shape;if(!e)throw Error("expected shape");const t=this.editor.getShapeHandles(e);if(!t)throw Error("expected handles for arrow");const n={...e,props:{...e.props,end:{...e.props.end,x:0,y:0}}};{var r;const o=this.editor.getShapeUtil("arrow"),s=this.shape,a=this.editor.getPointInShapeSpace(e,this.editor.inputs.currentPagePoint),l=t.find((e=>"end"===e.id)),c=null===(r=o.onHandleChange)||void 0===r?void 0:r.call(o,n,{handle:{...l,x:a.x,y:a.y},isPrecise:!1,initial:s});if(c){var i;const e=null===(i=c.props)||void 0===i?void 0:i.end;"binding"===(null===e||void 0===e?void 0:e.type)&&this.editor.setHintingShapes([e.boundShapeId]),this.editor.updateShapes([c],{squashing:!0})}}{var o;const e=this.editor.getShapeUtil("arrow"),r=this.shape,i=t.find((e=>"start"===e.id)),s=null===(o=e.onHandleChange)||void 0===o?void 0:o.call(e,n,{handle:{...i,x:0,y:0},isPrecise:this.didTimeout,initial:r});s&&this.editor.updateShapes([s],{squashing:!0})}this.shape=this.editor.getShape(e.id)}startPreciseTimeout(){this.preciseTimeout=window.setTimeout((()=>{this.isActive&&(this.didTimeout=!0)}),320)}clearPreciseTimeout(){clearTimeout(this.preciseTimeout)}}s(Mh,"id","pointing");class Th extends qc{constructor(){super(...arguments),s(this,"shapeType","arrow")}}s(Th,"id","arrow"),s(Th,"initial","idle"),s(Th,"children",(()=>[Ih,Mh]));class Ah extends qc{constructor(){super(...arguments),s(this,"info",{}),s(this,"initialShape",void 0),s(this,"shapeType","highlight"===this.parent.id?"highlight":"draw"),s(this,"util",this.editor.getShapeUtil(this.shapeType)),s(this,"isPen",!1),s(this,"segmentMode","free"),s(this,"didJustShiftClickToExtendPreviousShapeLine",!1),s(this,"pagePointWhereCurrentSegmentChanged",{}),s(this,"pagePointWhereNextSegmentChanged",null),s(this,"lastRecordedPoint",{}),s(this,"mergeNextPoint",!1),s(this,"currentLineLength",0),s(this,"canDraw",!1),s(this,"markId",null),s(this,"onEnter",(e=>{this.markId=null,this.info=e,this.canDraw=!this.editor.isMenuOpen,this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.canDraw&&this.startShape()})),s(this,"onPointerMove",(()=>{const{editor:{inputs:e}}=this;if(this.isPen!==e.isPen){if(this.markId)return this.editor.bailToMark(this.markId),void this.startShape()}else!this.canDraw&&e.isDragging&&(this.startShape(),this.canDraw=!0);this.canDraw&&(e.isPen?Ei.Dist(e.currentPagePoint,this.lastRecordedPoint)>=1/this.editor.zoomLevel?(this.lastRecordedPoint=e.currentPagePoint.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0:this.mergeNextPoint=!1,this.updateShapes())})),s(this,"onKeyDown",(e=>{if("Shift"===e.key)switch(this.segmentMode){case"free":this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break;case"starting_free":this.segmentMode="starting_straight"}this.updateShapes()})),s(this,"onKeyUp",(e=>{if("Shift"===e.key)switch(this.editor.snaps.clear(),this.segmentMode){case"straight":this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break;case"starting_straight":this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free"}this.updateShapes()})),s(this,"onExit",(()=>{this.editor.snaps.clear(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.currentPagePoint.clone()})),s(this,"onPointerUp",(()=>{this.complete()})),s(this,"onCancel",(()=>{this.cancel()})),s(this,"onComplete",(()=>{this.complete()})),s(this,"onInterrupt",(()=>{this.editor.inputs.isDragging||(this.markId&&this.editor.bailToMark(this.markId),this.cancel())}))}canClose(){return"highlight"!==this.shapeType}getIsClosed(e,t){if(!this.canClose())return!1;const n=Ud[t],r=e[0].points[0],i=e[e.length-1],o=i.points[i.points.length-1];return r!==o&&this.currentLineLength>4*n&&Ei.Dist(r,o)<2*n}startShape(){const{inputs:{originPagePoint:e,isPen:t}}=this.editor;this.markId="draw start "+Va(),this.editor.mark(this.markId),this.isPen=t;const n=this.isPen?1.25*this.info.point.z:.5;if(this.segmentMode=this.editor.inputs.shiftKey?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=e.clone(),this.initialShape){const t=this.editor.getShape(this.initialShape.id);if(t&&"straight"===this.segmentMode){this.didJustShiftClickToExtendPreviousShapeLine=!0;const n=Z(t.props.segments);if(!n)throw Error("Expected a previous segment!");const r=Z(n.points);if(!r)throw Error("Expected a previous point!");const{x:i,y:o}=this.editor.getPointInShapeSpace(t,e).toFixed(),s=this.isPen?1.25*this.info.point.z:.5,a={type:this.segmentMode,points:[{x:r.x,y:r.y,z:+s.toFixed(2)},{x:i,y:o,z:+s.toFixed(2)}]},l=ia.applyToPoint(this.editor.getShapePageTransform(t.id),r);this.pagePointWhereCurrentSegmentChanged=l,this.pagePointWhereNextSegmentChanged=null;const c=[...t.props.segments,a];this.currentLineLength=this.getLineLength(c);const u={id:t.id,type:this.shapeType,props:{segments:c}};return this.canClose()&&(u.props.isClosed=this.getIsClosed(c,t.props.size)),void this.editor.updateShapes([u])}}this.pagePointWhereCurrentSegmentChanged=e.clone();const r=Dn();this.editor.createShapes([{id:r,type:this.shapeType,x:e.x,y:e.y,props:{isPen:this.isPen,segments:[{type:this.segmentMode,points:[{x:0,y:0,z:+n.toFixed(2)}]}]}}]),this.currentLineLength=0,this.initialShape=this.editor.getShape(r)}updateShapes(){const{inputs:e}=this.editor,{initialShape:t}=this;if(!t)return;const{id:n,props:{size:r}}=t,i=this.editor.getShape(n);if(!i)return;const{segments:o}=i.props,{x:s,y:a,z:l}=this.editor.getPointInShapeSpace(i,e.currentPagePoint).toFixed(),c={x:s,y:a,z:this.isPen?+(1.25*l).toFixed(2):.5};switch(this.segmentMode){case"starting_straight":{const{pagePointWhereNextSegmentChanged:t}=this;if(null===t)throw Error("We should have a point where the segment changed");if(Ei.Dist(t,e.currentPagePoint)>4){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";const e=Z(o);if(!e)throw Error("Expected a previous segment!");const t=Z(e.points);if(!t)throw Error("Expected a previous last point!");let s;const a=this.editor.getPointInShapeSpace(i,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if("straight"===e.type){this.currentLineLength+=Ei.Dist(t,a),s={type:"straight",points:[{...t},a]};const e=this.editor.getShapePageTransform(i);this.pagePointWhereCurrentSegmentChanged=ia.applyToPoint(e,t)}else s={type:"straight",points:[a,c]};const l={id:n,type:this.shapeType,props:{segments:[...o,s]}};this.canClose()&&(l.props.isClosed=this.getIsClosed(o,r)),this.editor.updateShapes([l],{squashing:!0})}break}case"starting_free":{const{pagePointWhereNextSegmentChanged:t}=this;if(null===t)throw Error("We should have a point where the segment changed");if(Ei.Dist(t,e.currentPagePoint)>4){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";const e=o.slice(),t=Z(e[e.length-1].points);if(!t)throw Error("No previous point!");const i={type:"free",points:[...Ei.PointsBetween(t,c,6).map((e=>e.toFixed().toJson()))]},s=[...e,i];this.currentLineLength=this.getLineLength(s);const a={id:n,type:this.shapeType,props:{segments:s}};this.canClose()&&(a.props.isClosed=this.getIsClosed(s,r)),this.editor.updateShapes([a],{squashing:!0})}break}case"straight":{const e=o.slice(),t=e[e.length-1],{pagePointWhereCurrentSegmentChanged:s}=this,{currentPagePoint:a,ctrlKey:l}=this.editor.inputs;if(!s)throw Error("We should have a point where the segment changed");let c,u=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.isDragging&&(u=!l,this.didJustShiftClickToExtendPreviousShapeLine=!1):u=!l;let d,h=this.editor.getPointInShapeSpace(i,a).toFixed().toJson(),p=!1;if((this.editor.user.isSnapMode?!l:l)&&e.length>2){let e,t=8/this.editor.zoomLevel;for(let n=0,r=o.length-2;n<r;n++){const r=o[n];if(!r)break;if("free"===r.type)continue;const i=r.points[0],s=Z(r.points);if(!i||!s)continue;const a=Ei.NearestPointOnLineSegment(i,s,h),l=Ei.Dist(a,h);if(l<t){e=a.toFixed().toJson(),t=l,d=r;break}}e&&(p=!0,h=e)}if(p&&d){const e=this.editor.getShapePageTransform(i),t=d.points[0],n=Z(d.points);if(!n)throw Error("Expected a last point!");const r=ia.applyToPoint(e,t),o=ia.applyToPoint(e,n),s=ia.applyToPoint(e,h);this.editor.snaps.setLines([{id:Va(),type:"points",points:[r,s,o]}])}else{if(this.editor.snaps.clear(),u){const e=Ei.Angle(s,a),t=qi(e,24)-e;c=Ei.RotWith(a,s,t)}else c=a;h=this.editor.getPointInShapeSpace(i,c).toFixed().toJson()}this.currentLineLength+=Ei.Dist(t.points[0],h),e[e.length-1]={...t,type:"straight",points:[t.points[0],h]};const f={id:n,type:this.shapeType,props:{segments:e}};this.canClose()&&(f.props.isClosed=this.getIsClosed(o,r)),this.editor.updateShapes([f],{squashing:!0});break}case"free":{const e=o.slice(),t=e[e.length-1],i=[...t.points];if(i.length&&this.mergeNextPoint){const{z:e}=i[i.length-1];i[i.length-1]={x:c.x,y:c.y,z:e?Math.max(e,c.z):c.z}}else this.currentLineLength+=Ei.Dist(i[i.length-1],c),i.push(c);e[e.length-1]={...t,points:i},this.currentLineLength=this.getLineLength(e);const s={id:n,type:this.shapeType,props:{segments:e}};if(this.canClose()&&(s.props.isClosed=this.getIsClosed(e,r)),this.editor.updateShapes([s],{squashing:!0}),i.length>500){this.editor.updateShapes([{id:n,type:this.shapeType,props:{isComplete:!0}}]);const{currentPagePoint:e}=this.editor.inputs,t=Dn();this.editor.createShapes([{id:t,type:this.shapeType,x:ro(e.x),y:ro(e.y),props:{isPen:this.isPen,segments:[{type:"free",points:[{x:0,y:0,z:this.isPen?+(1.25*l).toFixed():.5}]}]}}]),this.initialShape=structuredClone(this.editor.getShape(t)),this.mergeNextPoint=!1,this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.currentLineLength=0}break}}}getLineLength(e){let t=0;for(const n of e)for(let e=0;e<n.points.length-1;e++){const r=n.points[e],i=n.points[e+1];t+=Ei.Sub(i,r).len2()}return Math.sqrt(t)}complete(){if(!this.canDraw)return void this.cancel();const{initialShape:e}=this;e&&(this.editor.updateShapes([{id:e.id,type:e.type,props:{isComplete:!0}}]),this.parent.transition("idle",{}))}cancel(){this.parent.transition("idle",this.info)}}s(Ah,"id","drawing");class jh extends qc{constructor(){super(...arguments),s(this,"onPointerDown",(e=>{this.parent.transition("drawing",e)})),s(this,"onEnter",(()=>{this.editor.setCursor({type:"cross",rotation:0})})),s(this,"onCancel",(()=>{this.editor.setCurrentTool("select")}))}}s(jh,"id","idle");class Oh extends qc{constructor(){super(...arguments),s(this,"shapeType","draw"),s(this,"onExit",(()=>{this.children.drawing.initialShape=void 0}))}}s(Oh,"id","draw"),s(Oh,"initial","idle"),s(Oh,"children",(()=>[jh,Ah]));class Lh extends cd{constructor(){super(...arguments),s(this,"shapeType","frame")}}s(Lh,"id","frame"),s(Lh,"initial","idle");class zh extends qc{constructor(){super(...arguments),s(this,"onPointerDown",(e=>{this.parent.transition("pointing",e)})),s(this,"onEnter",(()=>{this.editor.setCursor({type:"cross",rotation:0})})),s(this,"onKeyUp",(e=>{if("Enter"===e.key){if(this.editor.instanceState.isReadonly)return null;const{onlySelectedShape:t}=this.editor;t&&this.editor.getShapeUtil(t).canEdit(t)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(t.id),this.editor.root.current.value.transition("editing_shape",{...e,target:"shape",shape:t}))}})),s(this,"onCancel",(()=>{this.editor.setCurrentTool("select")}))}}s(zh,"id","idle");class Rh extends qc{constructor(){super(...arguments),s(this,"markId",""),s(this,"onPointerUp",(()=>{this.complete()})),s(this,"onPointerMove",(e=>{if(this.editor.inputs.isDragging){const{originPagePoint:t}=this.editor.inputs,n=Dn();this.markId="creating:".concat(n),this.editor.mark(this.markId),this.editor.createShapes([{id:n,type:"geo",x:t.x,y:t.y,props:{w:1,h:1,geo:this.editor.getStyleForNextShape(_r)}}]).select(n).setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:"geo"})}})),s(this,"onCancel",(()=>{this.cancel()})),s(this,"onComplete",(()=>{this.complete()})),s(this,"onInterrupt",(()=>{this.cancel()}))}complete(){const{originPagePoint:e}=this.editor.inputs,t=Dn();this.markId="creating:".concat(t),this.editor.mark(this.markId),this.editor.createShapes([{id:t,type:"geo",x:e.x,y:e.y,props:{geo:this.editor.getStyleForNextShape(_r),w:1,h:1}}]);const n=this.editor.getShape(t);if(!n)return;const r="star"===n.props.geo?((e,t,n)=>{const r=zi/e/2,i=2*Math.floor(e/4),o=2*e-i,s=2*Math.floor(e/2),a=Math.cos(i*r-Li)*t/2,l=Math.cos(o*r-Li)*t/2,c=Math.sin(0*r-Li)*n/2,u=Math.sin(s*r-Li)*n/2;return new Ti(0,0,a-l,u-c)})(5,200,200):"cloud"===n.props.geo?new Ti(0,0,300,180):new Ti(0,0,200,200),i=r.center,o=this.editor.getShapeParentTransform(n);o&&i.rot(-o.rotation()),this.editor.select(t),this.editor.updateShapes([{id:n.id,type:"geo",x:n.x-i.x,y:n.y-i.y,props:{geo:this.editor.getStyleForNextShape(_r),w:r.width,h:r.height}}]),this.editor.instanceState.isToolLocked?this.parent.transition("idle",{}):this.editor.setCurrentTool("select",{})}cancel(){this.parent.transition("idle",{})}}s(Rh,"id","pointing");class Dh extends qc{constructor(){super(...arguments),s(this,"shapeType","geo")}}s(Dh,"id","geo"),s(Dh,"initial","idle"),s(Dh,"children",(()=>[zh,Rh]));class Nh extends qc{constructor(){super(...arguments),s(this,"shapeType","highlight"),s(this,"onExit",(()=>{this.children.drawing.initialShape=void 0}))}}s(Nh,"id","highlight"),s(Nh,"initial","idle"),s(Nh,"children",(()=>[jh,Ah]));class Fh extends qc{constructor(){super(...arguments),s(this,"shapeId",""),s(this,"onEnter",(e=>{this.shapeId=e.shapeId,this.editor.setCursor({type:"cross",rotation:0})})),s(this,"onPointerDown",(()=>{this.parent.transition("pointing",{shapeId:this.shapeId})})),s(this,"onCancel",(()=>{this.editor.setCurrentTool("select")}))}}s(Fh,"id","idle");class Bh extends qc{constructor(){super(...arguments),s(this,"shape",{}),s(this,"markId",void 0),s(this,"onEnter",(e=>{const{inputs:t}=this.editor,{currentPagePoint:n}=t;this.markId=void 0;const r=e.shapeId&&this.editor.getShape(e.shapeId);if(r&&t.shiftKey){this.markId="creating:".concat(r.id),this.editor.mark(this.markId),this.shape=r;const e=this.editor.getShapeHandles(this.shape);if(!e)return;const t=e.filter((e=>"vertex"===e.type)).sort(Xl),i=t[t.length-1],o=t[t.length-2],s=ia.applyToPoint(this.editor.getShapeParentTransform(this.shape),new Ei(this.shape.x,this.shape.y));let a,l,c;const u=Ei.Sub(n,s);Ei.Dist(i,o)<2||Ei.Dist(u,i)<2?(a=i.index,l=i.id,c={...i,x:u.x+.1,y:u.y+.1}):(a=ql(i.index),l="handle:"+a,c={id:l,type:"vertex",index:a,x:u.x+.1,y:u.y+.1,canBind:!1});const d=Ae(this.shape.props.handles);d[c.id]=c,this.editor.updateShapes([{id:this.shape.id,type:this.shape.type,props:{handles:d}}])}else{const e=Dn();this.markId="creating:".concat(e),this.editor.mark(this.markId),this.editor.createShapes([{id:e,type:"line",x:n.x,y:n.y}]),this.editor.select(e),this.shape=this.editor.getShape(e)}})),s(this,"onPointerMove",(()=>{if(this.shape&&this.editor.inputs.isDragging){const e=this.editor.getShapeHandles(this.shape);if(console,!e)throw this.markId&&this.editor.bailToMark(this.markId),Error("No handles found");const t=Z(e);this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,isCreating:!0,handle:{...t,x:t.x-.1,y:t.y-.1},onInteractionEnd:"line"})}})),s(this,"onPointerUp",(()=>{this.complete()})),s(this,"onCancel",(()=>{this.cancel()})),s(this,"onComplete",(()=>{this.complete()})),s(this,"onInterrupt",(()=>{this.parent.transition("idle",{}),this.markId&&this.editor.bailToMark(this.markId),this.editor.snaps.clear()}))}complete(){this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clear()}cancel(){this.markId&&this.editor.bailToMark(this.markId),this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clear()}}s(Bh,"id","pointing");class Uh extends qc{constructor(){super(...arguments),s(this,"shapeType","line")}}s(Uh,"id","line"),s(Uh,"initial","idle"),s(Uh,"children",(()=>[Fh,Bh]));class Hh extends qc{constructor(){super(...arguments),s(this,"onPointerDown",(e=>{this.parent.transition("pointing",e)})),s(this,"onEnter",(()=>{this.editor.setCursor({type:"cross",rotation:0})})),s(this,"onCancel",(()=>{this.editor.setCurrentTool("select")}))}}s(Hh,"id","idle");class Vh extends qc{constructor(){super(...arguments),s(this,"dragged",!1),s(this,"info",{}),s(this,"wasFocusedOnEnter",!1),s(this,"markId",""),s(this,"shape",{}),s(this,"onEnter",(()=>{this.wasFocusedOnEnter=!this.editor.isMenuOpen,this.wasFocusedOnEnter&&(this.shape=this.createShape())})),s(this,"onPointerMove",(e=>{this.editor.inputs.isDragging&&(this.wasFocusedOnEnter||(this.shape=this.createShape()),this.editor.setCurrentTool("select.translating",{...e,target:"shape",shape:this.shape,isCreating:!0,editAfterComplete:!0,onInteractionEnd:"note"}))})),s(this,"onPointerUp",(()=>{this.complete()})),s(this,"onInterrupt",(()=>{this.cancel()})),s(this,"onComplete",(()=>{this.complete()})),s(this,"onCancel",(()=>{this.cancel()}))}complete(){this.wasFocusedOnEnter&&(this.editor.instanceState.isToolLocked?this.parent.transition("idle",{}):(this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape",{...this.info,target:"shape",shape:this.shape})))}cancel(){this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}createShape(){const{inputs:{originPagePoint:e}}=this.editor,t=Dn();this.markId="creating:".concat(t),this.editor.mark(this.markId),this.editor.createShapes([{id:t,type:"note",x:e.x,y:e.y}]).select(t);const n=this.editor.getShape(t),r=this.editor.getShapeGeometry(n).bounds;return this.editor.updateShapes([{id:t,type:"note",x:n.x-r.width/2,y:n.y-r.height/2}]),this.editor.getShape(t)}}s(Vh,"id","pointing");class Kh extends qc{constructor(){super(...arguments),s(this,"shapeType","note")}}function Wh(e){const t=e.getShapeAtPoint(e.inputs.currentPagePoint,{hitInside:!1,hitLabels:!1,margin:8/e.zoomLevel,renderingOnly:!0});if(!t)return e.setHoveredShape(null);let n;const r=e.getOutermostSelectableShape(t);return n=r===t||r.id===e.focusedGroupId||e.selectedShapeIds.includes(r.id)?t:r,e.setHoveredShape(n.id)}s(Kh,"id","note"),s(Kh,"initial","idle"),s(Kh,"children",(()=>[Hh,Vh]));class $h extends qc{constructor(){super(...arguments),s(this,"onPointerMove",(e=>{switch(e.target){case"shape":case"canvas":Wh(this.editor)}})),s(this,"onPointerDown",(e=>{this.parent.transition("pointing",e)})),s(this,"onEnter",(()=>{this.editor.setCursor({type:"cross",rotation:0})})),s(this,"onKeyDown",(e=>{if("Enter"===e.key){if(this.editor.instanceState.isReadonly)return null;const{onlySelectedShape:t}=this.editor;t&&this.editor.getShapeUtil(t).canEdit(t)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(t.id),this.editor.root.current.value.transition("editing_shape",{...e,target:"shape",shape:t}))}})),s(this,"onCancel",(()=>{this.editor.setCurrentTool("select")}))}}s($h,"id","idle");class Yh extends qc{constructor(){super(...arguments),s(this,"shape",void 0),s(this,"markId",""),s(this,"onExit",(()=>{this.editor.setHintingShapes([])})),s(this,"onPointerMove",(e=>{if(this.editor.inputs.isDragging){const{inputs:{originPagePoint:t}}=this.editor,n=Dn();if(this.markId="creating:".concat(n),this.editor.mark(this.markId),this.editor.createShapes([{id:n,type:"text",x:t.x,y:t.y,props:{text:"",autoSize:!1,w:20}}]),this.editor.select(n),this.shape=this.editor.getShape(n),!this.shape)return;this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"right",isCreating:!0,creationCursorOffset:{x:1,y:1},editAfterComplete:!0,onInteractionEnd:"text"})}})),s(this,"onPointerUp",(()=>{this.complete()})),s(this,"onComplete",(()=>{this.cancel()})),s(this,"onCancel",(()=>{this.cancel()})),s(this,"onInterrupt",(()=>{this.cancel()}))}complete(){var e;this.editor.mark("creating text shape");const t=Dn(),{x:n,y:r}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:t,type:"text",x:n,y:r,props:{text:"",autoSize:!0}}]).select(t),this.editor.setEditingShape(t),this.editor.setCurrentTool("select"),null===(e=this.editor.root.current.value)||void 0===e||e.transition("editing_shape",{})}cancel(){this.parent.transition("idle",{}),this.editor.bailToMark(this.markId)}}s(Yh,"id","pointing");class qh extends qc{constructor(){super(...arguments),s(this,"shapeType","text")}}s(qh,"id","text"),s(qh,"initial","idle"),s(qh,"children",(()=>[$h,Yh]));const Gh=[qh,Oh,Dh,Kh,Uh,Lh,Th,Nh];function Xh(){return Wn({isDarkMode:tu()})}const Qh=t.memo((function(e){let{theme:t,d:n,color:r,fill:i}=e;switch(i){case"none":return null;case"solid":return(0,Zr.jsx)("path",{fill:t[r].semi,d:n});case"semi":return(0,Zr.jsx)("path",{fill:t.solid,d:n});case"pattern":return(0,Zr.jsx)(Zh,{theme:t,color:r,fill:i,d:n})}})),Zh=function(e){let{d:t,color:n,theme:r}=e;const i=di(),o=q("zoomLevel",(()=>i.zoomLevel),[i]),s=Math.ceil(o),a=i.zoomLevel<=.18;return(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsx)("path",{fill:r[n].pattern,d:t}),(0,Zr.jsx)("path",{fill:a?r[n].semi:"url(#".concat(bo["".concat(s,"_").concat(r.id)],")"),d:t})]})};function Jh(e){let{d:t,color:n,fill:r,theme:i}=e;if("none"===r)return;if("pattern"===r){const e=document.createElementNS("http://www.w3.org/2000/svg","g"),r=document.createElementNS("http://www.w3.org/2000/svg","path");r.setAttribute("d",t),r.setAttribute("fill",i[n].pattern);const o=document.createElementNS("http://www.w3.org/2000/svg","path");return o.setAttribute("d",t),o.setAttribute("fill","url(#hash_pattern)"),e.appendChild(r),e.appendChild(o),e}const o=document.createElementNS("http://www.w3.org/2000/svg","path");switch(o.setAttribute("d",t),r){case"semi":o.setAttribute("fill",i.solid);break;case"solid":o.setAttribute("fill",i[n].semi)}return o}function ep(e,t){if(t){const n=document.createElementNS("http://www.w3.org/2000/svg","g");return n.appendChild(t),n.appendChild(e),n}return e}function tp(e,t,n){var r,i;const{padding:o=0}=n,s=document.createElementNS("http://www.w3.org/2000/svg","text");if(s.setAttribute("font-size",n.fontSize+"px"),s.setAttribute("font-family",n.fontFamily),s.setAttribute("font-style",n.fontStyle),s.setAttribute("font-weight",n.fontWeight),s.setAttribute("line-height",n.lineHeight*n.fontSize+"px"),s.setAttribute("dominant-baseline","mathematical"),s.setAttribute("alignment-baseline","mathematical"),0===t.length)return s;const a=Ti.From(t[0].box);for(const{box:d}of t)a.union(d);const l=o+(null!==(r=n.offsetX)&&void 0!==r?r:0),c=(null!==(i=n.offsetY)&&void 0!==i?i:0)+n.fontSize/2+("start"===n.verticalTextAlign?o:"end"===n.verticalTextAlign?n.height-o-a.height:(Math.ceil(n.height)-a.height)/2);let u=null;for(const{text:d,box:h}of t){if(null!==u&&h.y>u){const e=document.createElementNS("http://www.w3.org/2000/svg","tspan");e.setAttribute("alignment-baseline","mathematical"),e.setAttribute("x",l+"px"),e.setAttribute("y",h.y+c+"px"),e.textContent="\n",s.appendChild(e)}const e=document.createElementNS("http://www.w3.org/2000/svg","tspan");e.setAttribute("alignment-baseline","mathematical"),e.setAttribute("x",h.x+l+"px"),e.setAttribute("y",h.y+c+"px");const t=d.replace(/\s/g,"\xa0");e.textContent=t,s.appendChild(e),u=h.y}return n.stroke&&n.strokeWidth&&(s.setAttribute("stroke",n.stroke),s.setAttribute("stroke-width",n.strokeWidth+"px")),n.fill&&s.setAttribute("fill",n.fill),s}function np(e){return{key:"".concat(Xn.id,":").concat(e),getElement:async()=>{const t=function(e){const t=Qn[e];for(const n of document.fonts)if(t.includes(n.family))return n;return null}(e);if(!t)return null;const n=t.$$_url,r=t.$$_fontface;if(!n||!r)return null;const i=await(await fetch(n)).blob(),o=await new Promise(((e,t)=>{const n=new FileReader;n.onload=()=>e(n.result),n.onerror=t,n.readAsDataURL(i)})),s=r.replace(n,o),a=document.createElementNS("http://www.w3.org/2000/svg","style");return a.textContent=s,a}}}function rp(e,t){return{key:"".concat(Xn.id,":").concat(e),getElement:async()=>{if("pattern"!==e)return null;const n=8/12,r=document.createElement("div");return r.innerHTML='\n\t\t\t\t<svg>\n\t\t\t\t\t<defs>\n\t\t\t\t\t\t<mask id="hash_pattern_mask">\n\t\t\t\t\t\t\t<rect x="0" y="0" width="8" height="8" fill="white" />\n\t\t\t\t\t\t\t<g\n\t\t\t\t\t\t\t\tstrokeLinecap="round"\n\t\t\t\t\t\t\t\tstroke="black"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<line x1="'.concat(1*n,'" y1="').concat(2,'" x2="').concat(2,'" y2="').concat(1*n,'" />\n\t\t\t\t\t\t\t\t<line x1="').concat(5*n,'" y1="').concat(7*n,'" x2="').concat(7*n,'" y2="').concat(5*n,'" />\n\t\t\t\t\t\t\t\t<line x1="').concat(6,'" y1="').concat(11*n,'" x2="').concat(11*n,'" y2="').concat(6,'" />\n\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t</mask>\n\t\t\t\t\t\t<pattern\n\t\t\t\t\t\t\tid="hash_pattern"\n\t\t\t\t\t\t\twidth="8"\n\t\t\t\t\t\t\theight="8"\n\t\t\t\t\t\t\tpatternUnits="userSpaceOnUse"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<rect x="0" y="0" width="8" height="8" fill="').concat(t.solid,'" mask="url(#hash_pattern_mask)" />\n\t\t\t\t\t\t</pattern>\n\t\t\t\t\t</defs>\n\t\t\t\t</svg>\n\t\t\t'),Array.from(r.querySelectorAll("defs > *"))}}}function ip(){return{key:"".concat(Xn.id,":pattern"),component:cp}}const op=8,sp=(e,t,n)=>new Promise(((r,i)=>{const o=op*t*e,s=document.createElement("canvas");s.width=o,s.height=o;const a=s.getContext("2d");if(!a)return;a.fillStyle=n?"#212529":"#f8f9fa",a.fillRect(0,0,o,o),a.globalCompositeOperation="destination-out",a.lineCap="round",a.lineWidth=1.25*t*e;const l=8/12,c=n=>n*t*e;a.beginPath(),a.moveTo(c(1*l),c(2)),a.lineTo(c(2),c(1*l)),a.moveTo(c(5*l),c(7*l)),a.lineTo(c(7*l),c(5*l)),a.moveTo(c(6),c(11*l)),a.lineTo(c(11*l),c(6)),a.stroke(),s.toBlob((e=>{!e||ti.throwToBlob.value?i():r(e)}))})),ap=(e,t)=>{const n=document.createElement("canvas");n.width=e[0],n.height=e[1];const r=n.getContext("2d");return r?(t(r),n.toDataURL()):""},lp=()=>{const e=[];for(let t=1;t<=Math.ceil(yo);t++){const n=ap([1,1],(e=>{e.fillStyle=Kn.lightMode.black.semi,e.fillRect(0,0,1,1)})),r=ap([1,1],(e=>{e.fillStyle=Kn.darkMode.black.semi,e.fillRect(0,0,1,1)}));e.push({zoom:t,url:n,darkMode:!1}),e.push({zoom:t,url:r,darkMode:!0})}return e};function cp(){const e=di(),n=(0,t.useRef)(null),{defs:r,isReady:i}=function(){const e=di().instanceState.devicePixelRatio,[n,r]=(0,t.useState)(!1),i=(0,t.useMemo)((()=>lp()),[]),[o,s]=(0,t.useState)(i);return(0,t.useEffect)((()=>{const t=[];for(let r=1;r<=Math.ceil(yo);r++)t.push(sp(e,r,!1).then((e=>({zoom:r,url:URL.createObjectURL(e),darkMode:!1})))),t.push(sp(e,r,!0).then((e=>({zoom:r,url:URL.createObjectURL(e),darkMode:!0}))));let n=!1;return Promise.all(t).then((e=>{n||(s(e),r(!0))})),()=>{n=!0,r(!1)}}),[e]),{defs:(0,Zr.jsx)(Zr.Fragment,{children:o.map((e=>{const t=e.zoom+(e.darkMode?"_dark":"_light");return(0,Zr.jsx)("pattern",{id:bo[t],width:op,height:op,patternUnits:"userSpaceOnUse",children:(0,Zr.jsx)("image",{href:e.url,width:op,height:op})},t)}))}),isReady:n}}();return(0,t.useEffect)((()=>{if(i&&e.environment.isSafari){const e=up(n.current);e&&requestAnimationFrame((()=>{e.style.display="none",requestAnimationFrame((()=>{e.style.display=""}))}))}}),[e,i]),(0,Zr.jsx)("g",{ref:n,children:r})}function up(e){return e.classList.contains("tl-html-layer")?e:e.parentElement?up(e.parentElement):null}function dp(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{closed:r=!1,snap:i=1,start:o="outset",end:s="outset",lengthRatio:a=2,style:l="dashed"}=n;let c=0,u=0,d=1,h=0,p=0;switch(l){case"dashed":d=1,c=Math.min(t*a,e/4);break;case"dotted":d=100,c=t/d;break;default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||("outset"===o?(e+=c/2,p+=c/2):"skip"===o&&(e-=c,p-=c),"outset"===s?e+=c/2:"skip"===s&&(e-=c)),u=Math.floor(e/c/(2*d)),u-=u%i,u<3&&"dashed"===l?e/t<5?(c=e,u=1,h=0):(c=.333*e,h=.333*e):(u=Math.max(u,3),c=e/u/(2*d),r?(p=c/2,h=(e-u*c)/u):h=(e-u*c)/Math.max(1,u-1)),{strokeDasharray:[c,h].join(" "),strokeDashoffset:p.toString()}}function hp(e,n,r){const i=di(),o=(0,t.useRef)(null),s=(0,t.useRef)(!1),a=(0,t.useRef)(),l=q("isEditing",(()=>i.editingShapeId===e),[i,e]);(0,t.useEffect)((()=>{const e=o.current;e&&l&&document.activeElement!==e&&e.focus()}),[l]);const c=(0,t.useCallback)((()=>{const t=s.current;s.current=!1,requestAnimationFrame((()=>{const n=o.current;if(!n)return;const r=i.getShape(e);r&&(n.value=r.props.text,n.value.length&&!t&&n.select())}))}),[i,e]),u=(0,t.useCallback)((()=>{const t=a.current;requestAnimationFrame((()=>{const n=o.current,{editingShapeId:r}=i;var a;if(n&&r){if(r===e)if(t)if(t.length){s.current=!0,n.focus();const e=window.getSelection();e&&t.forEach((t=>e.addRange(t)))}else n.focus();else n.focus()}else null===(a=window.getSelection())||void 0===a||a.removeAllRanges(),i.complete()}))}),[i,e]),d=(0,t.useCallback)((e=>{if(l)switch((e.ctrlKey||e.metaKey)&&li(e),e.key){case"Enter":(e.ctrlKey||e.metaKey)&&i.complete();break;case"Tab":oi(e),e.shiftKey?wh.unindent(e.currentTarget):wh.indent(e.currentTarget)}}),[i,l]),h=(0,t.useCallback)((t=>{if(!l)return;let r=wh.normalizeText(t.currentTarget.value);const o=r.replace(/\t/g,bh);if(o!==r){const e=t.currentTarget.selectionStart;t.currentTarget.value=o,t.currentTarget.selectionStart=e+(o.length-r.length),t.currentTarget.selectionEnd=e+(o.length-r.length),r=o}i.updateShapes([{id:e,type:n,props:{text:r}}])}),[i,e,n,l]),p=0===r.trim().length;(0,t.useEffect)((()=>{if(!l)return;if(o.current){let e=function(){var e,t;const n=null===(e=(t=window).getSelection)||void 0===e?void 0:e.call(t);if(n&&"None"!==n.type){const e=[];if(n)for(let t=0;t<n.rangeCount;t++){var r;e.push(null===(r=n.getRangeAt)||void 0===r?void 0:r.call(n,t))}a.current=e}};return document.addEventListener("selectionchange",e),()=>{document.removeEventListener("selectionchange",e)}}}),[l]);const f=(0,t.useCallback)((t=>{i.dispatch({...ci(t),type:"pointer",name:"pointer_down",target:"shape",shape:i.getShape(e)}),li(t)}),[i,e]);return{rInput:o,isEditing:l,handleFocus:c,handleBlur:u,handleKeyDown:d,handleChange:h,handleInputPointerDown:f,handleDoubleClick:li,isEmpty:p}}const pp=t.memo((function(e){let{id:t,text:n,size:r,font:i,position:o,width:s,labelColor:a}=e;const{rInput:l,isEditing:c,handleFocus:u,handleBlur:d,handleKeyDown:h,handleChange:p,isEmpty:f,handleInputPointerDown:g,handleDoubleClick:m}=hp(t,"arrow",n),y=wh.normalizeTextForDom(n).trim().length>0;return c||y?(0,Zr.jsx)("div",{className:"tl-arrow-label","data-font":i,"data-align":"center","data-hastext":!f,"data-isediting":c,style:{textAlign:"center",fontSize:Kd[r],lineHeight:Kd[r]*Bd.lineHeight+"px",transform:"translate(".concat(o.x,"px, ").concat(o.y,"px)"),color:a},children:(0,Zr.jsxs)("div",{className:"tl-arrow-label__inner",children:[(0,Zr.jsx)("p",{style:{width:s||"9px"},children:n?wh.normalizeTextForDom(n):" "}),c&&(0,Zr.jsx)("textarea",{ref:l,className:"tl-text tl-text-input",name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:!0,placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",datatype:"wysiwyg",defaultValue:n,onFocus:u,onChange:p,onKeyDown:h,onBlur:d,onContextMenu:li,onPointerDown:g,onDoubleClick:m})]})}):null}));let fp=0;class gp extends Sl{constructor(){super(...arguments),s(this,"canEdit",(()=>!0)),s(this,"canBind",(()=>!1)),s(this,"canSnap",(()=>!1)),s(this,"hideResizeHandles",(()=>!0)),s(this,"hideRotateHandle",(()=>!0)),s(this,"hideSelectionBoundsBg",(()=>!0)),s(this,"hideSelectionBoundsFg",(()=>!0)),s(this,"onHandleChange",((e,t)=>{let{handle:n,isPrecise:r}=t;const i=n.id;if("middle"===i){const{start:t,end:r}=jc(this.editor,e),i=Ei.Sub(r,t),o=Ei.Per(i),s=Ei.Med(r,t),a=Ei.Sub(s,o),l=Ei.Add(s,o),c=Ei.NearestPointOnLineSegment(a,l,n,!1);let u=Ei.Dist(c,s);return Ei.Clockwise(c,r,s)&&(u*=-1),{id:e.id,type:e.type,props:{bend:u}}}const o=ge(e),s=this.editor.getShapePageTransform(o.id).applyToPoint(n);if(this.editor.inputs.ctrlKey)return o.props[i]={type:"point",x:n.x,y:n.y},o;const a=this.editor.getShapePageTransform(e.id).applyToPoint(n),l=this.editor.getShapeAtPoint(a,{hitInside:!0,hitFrameInside:!0,margin:0,filter:e=>!e.isLocked&&this.editor.getShapeUtil(e).canBind(e)});if(!l)return o.props[i]={type:"point",x:n.x,y:n.y},o;const c=this.editor.getShapeGeometry(l),u=Ti.ZeroFix(c.bounds),d=this.editor.getPointInShapeSpace(l,s);let h=r;if(!h){const e=o.props[i];("point"===e.type||"binding"===e.type&&l.id!==e.boundShapeId)&&(h=this.editor.inputs.pointerVelocity.len()<.5)}if(h&&(h=Ei.Dist(d,u.center)>Math.max(4,Math.min(.15*Math.min(u.width,u.height),16))/this.editor.zoomLevel),!r){c.isClosed||(h=!0);const e=o.props["start"===i?"end":"start"];"binding"===e.type&&l.id===e.boundShapeId&&Ei.Equals(e.normalizedAnchor,{x:.5,y:.5})&&(h=!0)}return o.props[i]={type:"binding",boundShapeId:l.id,normalizedAnchor:h?{x:(d.x-u.minX)/u.width,y:(d.y-u.minY)/u.height}:{x:.5,y:.5},isExact:this.editor.inputs.altKey},"binding"===o.props.start.type&&"binding"===o.props.end.type&&o.props.start.boundShapeId===o.props.end.boundShapeId&&Ei.Equals(o.props.start.normalizedAnchor,o.props.end.normalizedAnchor)&&(o.props.end.normalizedAnchor.x+=.05),o})),s(this,"onTranslateStart",(e=>{const t="binding"===e.props.start.type?e.props.start.boundShapeId:null,n="binding"===e.props.end.type?e.props.end.boundShapeId:null,{selectedShapeIds:r}=this.editor;if(t&&(r.includes(t)||this.editor.isAncestorSelected(t))||n&&(r.includes(n)||this.editor.isAncestorSelected(n)))return;const{start:i,end:o}=jc(this.editor,e);return{id:e.id,type:e.type,props:{...e.props,start:{type:"point",x:i.x,y:i.y},end:{type:"point",x:o.x,y:o.y}}}})),s(this,"onResize",((e,t)=>{const{scaleX:n,scaleY:r}=t,i=jc(this.editor,e),{start:o,end:s}=ge(e.props);let{bend:a}=e.props;"point"===o.type&&(o.x=i.start.x*n,o.y=i.start.y*r),"point"===s.type&&(s.x=i.end.x*n,s.y=i.end.y*r);const l=Math.abs(n),c=Math.abs(r);n<0&&r>=0?(0!==a&&(a*=-1,a*=Math.max(l,c)),"binding"===o.type&&(o.normalizedAnchor.x=1-o.normalizedAnchor.x),"binding"===s.type&&(s.normalizedAnchor.x=1-s.normalizedAnchor.x)):n>=0&&r<0?(0!==a&&(a*=-1,a*=Math.max(l,c)),"binding"===o.type&&(o.normalizedAnchor.y=1-o.normalizedAnchor.y),"binding"===s.type&&(s.normalizedAnchor.y=1-s.normalizedAnchor.y)):n>=0&&r>=0?0!==a&&(a*=Math.max(l,c)):n<0&&r<0&&(0!==a&&(a*=Math.max(l,c)),"binding"===o.type&&(o.normalizedAnchor.x=1-o.normalizedAnchor.x,o.normalizedAnchor.y=1-o.normalizedAnchor.y),"binding"===s.type&&(s.normalizedAnchor.x=1-s.normalizedAnchor.x,s.normalizedAnchor.y=1-s.normalizedAnchor.y));return{props:{start:o,end:s,bend:a}}})),s(this,"onDoubleClickHandle",((e,t)=>{switch(t.id){case"start":return{id:e.id,type:e.type,props:{...e.props,arrowheadStart:"none"===e.props.arrowheadStart?"arrow":"none"}};case"end":return{id:e.id,type:e.type,props:{...e.props,arrowheadEnd:"none"===e.props.arrowheadEnd?"arrow":"none"}}}})),s(this,"onEditEnd",(e=>{const{id:t,type:n,props:{text:r}}=e;r.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:t,type:n,props:{text:r.trimEnd()}}])}))}getDefaultProps(){return{dash:"draw",size:"m",fill:"none",color:"black",labelColor:"black",bend:0,start:{type:"point",x:0,y:0},end:{type:"point",x:2,y:0},arrowheadStart:"none",arrowheadEnd:"arrow",text:"",font:"draw"}}getGeometry(e){const t=this.editor.getArrowInfo(e),n=t.isStraight?new vl({start:Ei.From(t.start.point),end:Ei.From(t.end.point)}):new fd({center:Ei.Cast(t.handleArc.center),radius:t.handleArc.radius,start:Ei.Cast(t.start.point),end:Ei.Cast(t.end.point),sweepFlag:t.bodyArc.sweepFlag,largeArcFlag:t.bodyArc.largeArcFlag});let r;if(e.props.text.trim()){const i=n.bounds,{w:o,h:s}=this.editor.textMeasure.measureText(e.props.text,{...Bd,fontFamily:Wd[e.props.font],fontSize:Kd[e.props.size],maxWidth:null});let a=o,l=s;if(i.width>i.height){a=Math.max(Math.min(o,64),Math.min(i.width-64,o));const{w:t,h:n}=this.editor.textMeasure.measureText(e.props.text,{...Bd,fontFamily:Wd[e.props.font],fontSize:Kd[e.props.size],maxWidth:a});a=t,l=n}if(a>16*Kd[e.props.size]){a=16*Kd[e.props.size];const{w:t,h:n}=this.editor.textMeasure.measureText(e.props.text,{...Bd,fontFamily:Wd[e.props.font],fontSize:Kd[e.props.size],maxWidth:a});a=t,l=n}r=new xl({x:t.middle.x-a/2-4.25,y:t.middle.y-l/2-4.25,width:a+8.5,height:l+8.5,isFilled:!0,isLabel:!0})}return new ll({children:r?[n,r]:[n],isSnappable:!1})}getHandles(e){const t=this.editor.getArrowInfo(e);return[{id:"start",type:"vertex",index:"a0",x:t.start.handle.x,y:t.start.handle.y,canBind:!0},{id:"middle",type:"virtual",index:"a2",x:t.middle.x,y:t.middle.y,canBind:!1},{id:"end",type:"vertex",index:"a3",x:t.end.handle.x,y:t.end.handle.y,canBind:!0}]}component(e){var n;const r=Xh(),i=this.editor.onlySelectedShape,o=this.editor.isInAny("select.idle","select.pointing_handle","select.dragging_handle","arrow.dragging")&&!this.editor.instanceState.isReadonly,s=this.editor.getArrowInfo(e),a=Ti.ZeroFix(this.editor.getShapeGeometry(e).bounds),l=t.useMemo((()=>this.editor.environment.isSafari?fp+=1:0),[e]);if(null===s||void 0===s||!s.isValid)return null;const c=Ud[e.props.size],u=s.start.arrowhead&&sd(s,"start",c),d=s.end.arrowhead&&sd(s,"end",c),h=s.isStraight?Fc(s):Vc(s);let p=null;if(i===e&&o){const t=2,{strokeDasharray:n,strokeDashoffset:r}=dp(s.isStraight?Ei.Dist(s.start.handle,s.end.handle):Math.abs(s.handleArc.length),t,{end:"skip",start:"skip",lengthRatio:2.5});p="binding"===e.props.start.type||"binding"===e.props.end.type?(0,Zr.jsx)("path",{className:"tl-arrow-hint",d:s.isStraight?Nc(s):Hc(s),strokeDasharray:n,strokeDashoffset:r,strokeWidth:t,markerStart:"binding"===e.props.start.type?e.props.start.isExact?"":vp(e.props.start.normalizedAnchor)?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",markerEnd:"binding"===e.props.end.type?e.props.end.isExact?"":vp(e.props.end.normalizedAnchor)?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",opacity:.16}):null}const{strokeDasharray:f,strokeDashoffset:g}=dp(s.isStraight?s.length:Math.abs(s.bodyArc.length),c,{style:e.props.dash}),m=e.props.text.trim()?this.editor.getShapeGeometry(e).children[1]:null,y=!("none"===s.start.arrowhead||"arrow"===s.start.arrowhead),v=!("none"===s.end.arrowhead||"arrow"===s.end.arrowhead),b=(e.id+"_clip_"+l).replace(":","_");return(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsxs)(sl,{id:e.id,style:{minWidth:50,minHeight:50},children:[(0,Zr.jsx)("defs",{children:(0,Zr.jsxs)("mask",{id:b,children:[(0,Zr.jsx)("rect",{x:no(-100+a.minX),y:no(-100+a.minY),width:no(a.width+200),height:no(a.height+200),fill:"white"}),m&&(0,Zr.jsx)("rect",{x:m.x,y:m.y,width:m.w,height:m.h,fill:"black",rx:4,ry:4}),u&&y&&(0,Zr.jsx)("path",{d:u,fill:"arrow"===s.start.arrowhead?"none":"black",stroke:"none"}),d&&v&&(0,Zr.jsx)("path",{d:d,fill:"arrow"===s.end.arrowhead?"none":"black",stroke:"none"})]})}),(0,Zr.jsxs)("g",{fill:"none",stroke:r[e.props.color].solid,strokeWidth:c,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none",children:[p,(0,Zr.jsxs)("g",{mask:"url(#".concat(b,")"),children:[(0,Zr.jsx)("rect",{x:no(a.minX-100),y:no(a.minY-100),width:no(a.width+200),height:no(a.height+200),opacity:0}),(0,Zr.jsx)("path",{d:h,strokeDasharray:f,strokeDashoffset:g})]}),u&&y&&"none"!==e.props.fill&&(0,Zr.jsx)(Qh,{theme:r,d:u,color:e.props.color,fill:e.props.fill}),d&&v&&"none"!==e.props.fill&&(0,Zr.jsx)(Qh,{theme:r,d:d,color:e.props.color,fill:e.props.fill}),u&&(0,Zr.jsx)("path",{d:u}),d&&(0,Zr.jsx)("path",{d:d})]})]}),(0,Zr.jsx)(pp,{id:e.id,text:e.props.text,font:e.props.font,size:e.props.size,position:s.middle,width:null!==(n=null===m||void 0===m?void 0:m.w)&&void 0!==n?n:0,labelColor:r[e.props.labelColor].solid})]})}indicator(e){const{start:t,end:n}=jc(this.editor,e),r=this.editor.getArrowInfo(e),i=this.editor.getShapeGeometry(e),o=i.bounds,s=e.props.text.trim()?i.children[1]:null,a=dd(e.id);if(!r)return null;if(Ei.Equals(t,n))return null;const l=Ud[e.props.size],c=r.start.arrowhead&&sd(r,"start",l),u=r.end.arrowhead&&sd(r,"end",l),d=r.isStraight?Fc(r):Vc(r),h=c&&"arrow"!==r.start.arrowhead||u&&"arrow"!==r.end.arrowhead||!!s,p=(e.id+"_clip").replace(":","_");return a&&s?(0,Zr.jsx)("rect",{x:no(s.x),y:no(s.y),width:s.w,height:s.h,rx:3.5,ry:3.5}):(0,Zr.jsxs)("g",{children:[h&&(0,Zr.jsx)("defs",{children:(0,Zr.jsxs)("mask",{id:p,children:[(0,Zr.jsx)("rect",{x:o.minX-100,y:o.minY-100,width:o.w+200,height:o.h+200,fill:"white"}),s&&(0,Zr.jsx)("rect",{x:no(s.x),y:no(s.y),width:s.w,height:s.h,fill:"black",rx:3.5,ry:3.5}),c&&(0,Zr.jsx)("path",{d:c,fill:"arrow"===r.start.arrowhead?"none":"black",stroke:"none"}),u&&(0,Zr.jsx)("path",{d:u,fill:"arrow"===r.end.arrowhead?"none":"black",stroke:"none"})]})}),(0,Zr.jsxs)("g",{...h?{mask:"url(#".concat(p,")")}:void 0,children:[h&&(0,Zr.jsx)("rect",{x:o.minX-100,y:o.minY-100,width:o.width+200,height:o.height+200,opacity:0}),(0,Zr.jsx)("path",{d:d})]}),c&&(0,Zr.jsx)("path",{d:c}),u&&(0,Zr.jsx)("path",{d:u}),s&&(0,Zr.jsx)("rect",{x:no(s.x),y:no(s.y),width:s.w,height:s.h,rx:3.5,ry:3.5})]})}toSvg(e,t){const n=Wn({isDarkMode:this.editor.user.isDarkMode});t.addExportDef(rp(e.props.fill,n));const r=n[e.props.color].solid,i=this.editor.getArrowInfo(e),o=Ud[e.props.size],s=document.createElementNS("http://www.w3.org/2000/svg","g");if(!i)return s;const a=i.start.arrowhead&&sd(i,"start",o),l=i.end.arrowhead&&sd(i,"end",o),c=this.editor.getShapeGeometry(e),u=c.bounds,d=e.props.text.trim()?c.children[1]:null,h=(e.id+"_clip").replace(":","_");if(a||l||d){const e=document.createElementNS("http://www.w3.org/2000/svg","defs"),t=document.createElementNS("http://www.w3.org/2000/svg","mask");t.id=h;const n=document.createElementNS("http://www.w3.org/2000/svg","rect");if(n.setAttribute("x",u.minX-100+""),n.setAttribute("y",u.minY-100+""),n.setAttribute("width",u.width+200+""),n.setAttribute("height",u.height+200+""),n.setAttribute("fill","white"),t.appendChild(n),a&&t.appendChild(mp(a,i.start.arrowhead)),l&&t.appendChild(mp(l,i.end.arrowhead)),d){const e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttribute("x",d.x+""),e.setAttribute("y",d.y+""),e.setAttribute("width",d.w+""),e.setAttribute("height",d.h+""),e.setAttribute("fill","black"),t.appendChild(e)}e.appendChild(t),s.appendChild(e)}const p=document.createElementNS("http://www.w3.org/2000/svg","g");p.setAttribute("mask","url(#".concat(h,")")),s.appendChild(p);const f=document.createElementNS("http://www.w3.org/2000/svg","rect");f.setAttribute("x","-100"),f.setAttribute("y","-100"),f.setAttribute("width",u.width+200+""),f.setAttribute("height",u.height+200+""),f.setAttribute("fill","transparent"),f.setAttribute("stroke","none"),p.appendChild(f);const g=function(e,t,n){const r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",e),r.setAttribute("fill","none"),r.setAttribute("stroke",t),r.setAttribute("stroke-width",n+""),r}(i.isStraight?Fc(i):Vc(i),r,o),{strokeDasharray:m,strokeDashoffset:y}=dp(i.isStraight?i.length:Math.abs(i.bodyArc.length),o,{style:e.props.dash});if(g.setAttribute("stroke-dasharray",m),g.setAttribute("stroke-dashoffset",y),p.appendChild(g),a&&s.appendChild(yp(a,e.props.color,o,"arrow"===e.props.arrowheadStart?"none":e.props.fill,n)),l&&s.appendChild(yp(l,e.props.color,o,"arrow"===e.props.arrowheadEnd?"none":e.props.fill,n)),d){t.addExportDef(np(e.props.font));const r={fontSize:Kd[e.props.size],lineHeight:Bd.lineHeight,fontFamily:Qn[e.props.font],padding:0,textAlign:"middle",width:d.w-8,verticalTextAlign:"middle",height:d.h,fontStyle:"normal",fontWeight:"normal",overflow:"wrap"},i=tp(this.editor,this.editor.textMeasure.measureTextSpans(e.props.text,r),r);i.setAttribute("fill",n[e.props.labelColor].solid);Array.from(i.children).forEach((e=>{const t=parseFloat(e.getAttribute("x")||"0"),n=parseFloat(e.getAttribute("y")||"0");e.setAttribute("x",t+4+d.x+"px"),e.setAttribute("y",n+d.y+"px")}));const o=i.cloneNode(!0);o.setAttribute("stroke-width","2"),o.setAttribute("fill",n.background),o.setAttribute("stroke",n.background),s.appendChild(o),s.appendChild(i)}return s}getCanvasSvgDefs(){return[ip()]}}function mp(e,t){const n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d",e),n.setAttribute("fill","arrow"===t?"none":"black"),n.setAttribute("stroke","none"),n}function yp(e,t,n,r,i){const o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d",e),o.setAttribute("fill","none"),o.setAttribute("stroke",i[t].solid),o.setAttribute("stroke-width",n+"");const s=Jh({d:e,fill:r,color:t,theme:i});if(s){const e=document.createElementNS("http://www.w3.org/2000/svg","g");return e.appendChild(s),e.appendChild(o),e}return o}function vp(e){return.5!==e.x||.5!==e.y}s(gp,"type","arrow"),s(gp,"props",rr),s(gp,"migrations",or);const bp=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function wp(e){return bp.map((t=>{const{offsetX:n,offsetY:r,blur:i,spread:o,color:s}=t,a=new Ei(n,r),{x:l,y:c}=a.rot(-e);return"".concat(l,"px ").concat(c,"px ").concat(i,"px ").concat(o,"px ").concat(s)})).join(", ")}const xp="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function Sp(e){let{url:t,zoomLevel:n}=e;return(0,Zr.jsx)("a",{className:Jr("tl-hyperlink-button",{"tl-hyperlink-button__hidden":n<.32}),href:t,target:"_blank",rel:"noopener noreferrer",onPointerDown:li,onPointerUp:li,title:t,draggable:!1,children:(0,Zr.jsx)("div",{className:"tl-hyperlink-button__icon",style:{mask:'url("'.concat(xp,'") center 100% / 100% no-repeat'),WebkitMask:'url("'.concat(xp,'") center 100% / 100% no-repeat')}})})}class kp extends id{constructor(){super(...arguments),s(this,"canResize",(()=>!1)),s(this,"hideSelectionBoundsFg",(()=>!0)),s(this,"onBeforeCreate",(e=>{Pp(this.editor,e)})),s(this,"onBeforeUpdate",((e,t)=>{if(e.props.url!==t.props.url){if(!Me(t.props.url))return{...t,props:{...t.props,url:e.props.url}};Pp(this.editor,t)}}))}getDefaultProps(){return{url:"",w:300,h:320,assetId:null}}component(e){const t=e.props.assetId?this.editor.getAsset(e.props.assetId):null,n=this.editor.getShapePageTransform(e).rotation(),r=_p(e);return(0,Zr.jsx)(rd,{children:(0,Zr.jsxs)("div",{className:"tl-bookmark__container",style:{boxShadow:wp(n)},children:[(0,Zr.jsxs)("div",{className:"tl-bookmark__image_container",children:[null!==t&&void 0!==t&&t.props.image?(0,Zr.jsx)("img",{className:"tl-bookmark__image",draggable:!1,src:null===t||void 0===t?void 0:t.props.image,alt:(null===t||void 0===t?void 0:t.props.title)||""}):(0,Zr.jsx)("div",{className:"tl-bookmark__placeholder"}),(0,Zr.jsx)(Sp,{url:e.props.url,zoomLevel:this.editor.zoomLevel})]}),(0,Zr.jsxs)("div",{className:"tl-bookmark__copy_container",children:[(null===t||void 0===t?void 0:t.props.title)&&(0,Zr.jsx)("h2",{className:"tl-bookmark__heading",children:_h((null===t||void 0===t?void 0:t.props.title)||"",54)}),(null===t||void 0===t?void 0:t.props.description)&&(0,Zr.jsx)("p",{className:"tl-bookmark__description",children:_h((null===t||void 0===t?void 0:t.props.description)||"",128)}),(0,Zr.jsx)("a",{className:"tl-bookmark__link",href:e.props.url||"",target:"_blank",rel:"noopener noreferrer",onPointerDown:li,onPointerUp:li,onClick:li,children:_h(r,45)})]})]})})}indicator(e){return(0,Zr.jsx)("rect",{width:no(e.props.w),height:no(e.props.h),rx:"8",ry:"8"})}}s(kp,"type","bookmark"),s(kp,"props",sr),s(kp,"migrations",lr);const _p=e=>{try{const t=new URL(e.props.url),n=t.pathname.replace(/\/*$/,"");return"".concat(t.hostname).concat(n)}catch(ZI){return e.props.url}};function Pp(e,t){const{url:n}=t.props,r=Tn.createId(se(n));e.getAsset(r)?t.props.assetId!==r&&e.updateShapes([{id:t.id,type:t.type,props:{assetId:r}}]):(e.updateShapes([{id:t.id,type:t.type,props:{assetId:null}}]),Cp(e,t))}const Cp=re((async(e,t)=>{const{url:n}=t.props,r=await e.getAssetForExternalContent({type:"url",url:n});r&&e.batch((()=>{e.createAssets([r]),e.updateShapes([{id:t.id,type:t.type,props:{assetId:r.id}}])}))}),500);function Ep(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=e.length;if(n<2)return"";let r=e[0].point,i=e[1].point;if(2===n)return"M".concat(Ai(r),"L").concat(Ai(i));let o="";for(let s=2,a=n-1;s<a;s++)r=e[s].point,i=e[s+1].point,o+=ji(r,i);return t?"M".concat(ji(e[0].point,e[1].point),"Q").concat(Ai(e[1].point)).concat(ji(e[1].point,e[2].point),"T").concat(o).concat(ji(e[n-1].point,e[0].point)).concat(ji(e[0].point,e[1].point),"Z"):"M".concat(Ai(e[0].point),"Q").concat(Ai(e[1].point)).concat(ji(e[1].point,e[2].point)).concat(e.length>3?"T":"").concat(o,"L").concat(Ai(e[n-1].point))}function Ip(){const e=di();return q("zoom",(()=>e.zoomLevel<.35),[e])}const Mp=e=>.65*e+.35*Di(e*Oi/2),Tp=e=>({size:1+e,thinning:.5,streamline:.62+(1+e)/8*.06,smoothing:.62,easing:Ci.easeOutSine,simulatePressure:!0}),Ap=e=>({size:1+1.2*e,thinning:.62,streamline:.62,smoothing:.62,simulatePressure:!1,easing:Mp}),jp=e=>({size:1+e,thinning:0,streamline:.62+(1+e)/8*.06,smoothing:.62,simulatePressure:!1,easing:Ci.linear});function Op(e){let{strokeWidth:t,showAsComplete:n}=e;return{size:1+t,thinning:0,streamline:.5,smoothing:.5,simulatePressure:!1,easing:Ci.easeOutSine,last:n}}function Lp(e,t,n,r){return{...r?jp(t):"draw"===e.dash?e.isPen?Ap(t):Tp(t):jp(t),last:e.isComplete||n}}function zp(e){const t=[];for(const n of e)if("free"===n.type||n.points.length<2)t.push(...n.points.map(Ei.Cast));else{const e=Math.max(4,Math.floor(Ei.Dist(n.points[0],n.points[1])/16));t.push(...Ei.PointsBetween(n.points[0],n.points[1],e))}return t}function Rp(e,t){return{draw:"none",solid:"none",dotted:"0.1 ".concat(2*t),dashed:"".concat(2*t," ").concat(2*t)}[e.props.dash]}class Dp extends Sl{constructor(){super(...arguments),s(this,"hideResizeHandles",(e=>Fp(e))),s(this,"hideRotateHandle",(e=>Fp(e))),s(this,"hideSelectionBoundsFg",(e=>Fp(e))),s(this,"onResize",((e,t)=>{const{scaleX:n,scaleY:r}=t,i=[];for(const o of e.props.segments)i.push({...o,points:o.points.map((e=>{let{x:t,y:i,z:o}=e;return{x:ro(n*t),y:ro(r*i),z:o}}))});return{props:{segments:i}}}))}getDefaultProps(){return{segments:[],color:"black",fill:"none",dash:"draw",size:"m",isComplete:!1,isClosed:!1,isPen:!1}}getGeometry(e){const t=zp(e.props.segments),n=Ud[e.props.size];if(1===e.props.segments.length){const e=Ti.FromPoints(t);if(e.width<2*n&&e.height<2*n)return new md({x:-n,y:-n,radius:n,isFilled:!0})}const r=Id(t,Lp(e.props,n,!0,!0)).map((e=>e.point));return e.props.isClosed?new wl({points:r,isFilled:"none"!==e.props.fill}):new bl({points:r})}component(e){var t;const n=Xh(),r=Ip(),i=Ud[e.props.size],o=zp(e.props.segments),s=e.props.isComplete||"straight"===(null===(t=Z(e.props.segments))||void 0===t?void 0:t.type);let a=i;r||e.props.isPen||"draw"!==e.props.dash||1!==o.length||(a+=de(e.id)()*(i/6));const l=Lp(e.props,a,s,r),c=Id(o,l),u=c.length>1?Ep(c,e.props.isClosed):Np(o[0],a);if(!r&&"draw"===e.props.dash||c.length<2){Ad(c,l);const t=Pd(c,l);return(0,Zr.jsxs)(sl,{id:e.id,children:[(0,Zr.jsx)(Qh,{theme:n,fill:e.props.isClosed?e.props.fill:"none",color:e.props.color,d:u}),(0,Zr.jsx)("path",{d:To(t,!0),strokeLinecap:"round",fill:n[e.props.color].solid})]})}return(0,Zr.jsxs)(sl,{id:e.id,children:[(0,Zr.jsx)(Qh,{theme:n,color:e.props.color,fill:e.props.isClosed?e.props.fill:"none",d:u}),(0,Zr.jsx)("path",{d:u,strokeLinecap:"round",fill:"none",stroke:n[e.props.color].solid,strokeWidth:i,strokeDasharray:Rp(e,i),strokeDashoffset:"0"})]})}indicator(e){var t;const n=Ip(),r=Ud[e.props.size],i=zp(e.props.segments);let o=r;n||e.props.isPen||"draw"!==e.props.dash||1!==i.length||(o+=de(e.id)()*(r/6));const s=e.props.isComplete||"straight"===(null===(t=Z(e.props.segments))||void 0===t?void 0:t.type),a=Id(i,Lp(e.props,o,s,!0)),l=a.length>1?Ep(a,e.props.isClosed):Np(i[0],o);return(0,Zr.jsx)("path",{d:l})}toSvg(e,t){var n;const r=Wn({isDarkMode:this.editor.user.isDarkMode});t.addExportDef(rp(e.props.fill,r));const{color:i}=e.props,o=Ud[e.props.size],s=zp(e.props.segments),a=e.props.isComplete||"straight"===(null===(n=Z(e.props.segments))||void 0===n?void 0:n.type);let l=o;e.props.isPen||"draw"!==e.props.dash||1!==s.length||(l+=de(e.id)()*(o/6));const c=Lp(e.props,l,a,!1),u=Id(s,c),d=u.length>1?Ep(u,e.props.isClosed):Np(s[0],l);let h;if("draw"===e.props.dash||u.length<2){Ad(u,c);const e=Pd(u,c),t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d",To(e,!0)),t.setAttribute("fill",r[i].solid),t.setAttribute("stroke-linecap","round"),h=t}else{const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d",d),t.setAttribute("stroke",r[i].solid),t.setAttribute("fill","none"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-width",o.toString()),t.setAttribute("stroke-dasharray",Rp(e,o)),t.setAttribute("stroke-dashoffset","0"),h=t}const p=Jh({fill:e.props.isClosed?e.props.fill:"none",d:d,color:e.props.color,theme:r});if(p){const e=document.createElementNS("http://www.w3.org/2000/svg","g");return e.appendChild(p),e.appendChild(h),e}return h}getCanvasSvgDefs(){return[ip()]}expandSelectionOutlinePx(e){const t="draw"===e.props.dash?1.6:1;return Ud[e.props.size]*t/2}}function Np(e,t){const n=.5*(t+1);return"M ".concat(e.x," ").concat(e.y," m -").concat(n,", 0 a ").concat(n,",").concat(n," 0 1,0 ").concat(2*n,",0 a ").concat(n,",").concat(n," 0 1,0 -").concat(2*n,",0")}function Fp(e){return 1===e.props.segments.length&&e.props.segments[0].points.length<2}s(Dp,"type","draw"),s(Dp,"props",ur),s(Dp,"migrations",hr);class Bp extends id{constructor(){super(...arguments),s(this,"hideSelectionBoundsFg",(e=>!this.canResize(e))),s(this,"canEdit",(()=>!0)),s(this,"canUnmount",(e=>{var t;return!(null===(t=vh(e.props.url))||void 0===t||null===(t=t.definition)||void 0===t||!t.canUnmount)})),s(this,"canResize",(e=>{var t;return!(null===(t=vh(e.props.url))||void 0===t||null===(t=t.definition)||void 0===t||!t.doesResize)})),s(this,"canEditInReadOnly",(()=>!0)),s(this,"isAspectRatioLocked",(e=>{var t;const n=vh(e.props.url);return null!==(t=null===n||void 0===n?void 0:n.definition.isAspectRatioLocked)&&void 0!==t&&t})),s(this,"onResize",((e,t)=>{var n,r;const i=this.isAspectRatioLocked(e),o=vh(e.props.url);let s=null!==(n=null===o||void 0===o?void 0:o.definition.minWidth)&&void 0!==n?n:200,a=null!==(r=null===o||void 0===o?void 0:o.definition.minHeight)&&void 0!==r?r:200;if(i){const t=e.props.w/e.props.h;t>1?s*=t:a/=t}return function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{newPoint:r,handle:i,scaleX:o,scaleY:s}=t,{minWidth:a=1,maxWidth:l=1/0,minHeight:c=1,maxHeight:u=1/0}=n;let d=e.props.w*o,h=e.props.h*s;const p=new Ei(0,0);if(d>0){if(d<a){switch(i){case"top_left":case"left":case"bottom_left":p.x=d-a;break;case"top":case"bottom":p.x=(d-a)/2;break;default:p.x=0}d=a}}else if(p.x=d,d=-d,d<a){switch(i){case"top_left":case"left":case"bottom_left":p.x=-d;break;default:p.x=-a}d=a}if(h>0){if(h<c){switch(i){case"top_left":case"top":case"top_right":p.y=h-c;break;case"right":case"left":p.y=(h-c)/2;break;default:p.y=0}h=c}}else if(p.y=h,h=-h,h<c){switch(i){case"top_left":case"top":case"top_right":p.y=-h;break;default:p.y=-c}h=c}const{x:f,y:g}=p.rot(e.rotation).add(r);return{x:f,y:g,props:{w:Math.min(l,d),h:Math.min(u,h)}}}(e,t,{minWidth:s,minHeight:a})}))}getDefaultProps(){return{w:300,h:300,url:""}}component(e){var n,r;const{w:i,h:o,url:s}=e.props,a=dd(e.id),l=(0,t.useMemo)((()=>yh(s)),[s]),c=q("is hovering",(()=>{const{editingShapeId:e,hoveredShapeId:t}=this.editor.currentPageState;if(e&&t!==e){const t=this.editor.getShape(e);if(t&&this.editor.isShapeOfType(t,"embed"))return!0}return!1}),[]),u=this.editor.getShapePageTransform(e).rotation(),d=a||c;if("github_gist"===(null===l||void 0===l?void 0:l.definition.type)){const t=l.url.split("/").pop();if(!t)throw Error("No gist id!");return(0,Zr.jsx)(rd,{className:"tl-embed-container",id:e.id,children:(0,Zr.jsx)(Up,{id:t,width:no(i),height:no(o),isInteractive:d,pageRotation:u})})}const h=(p={...mr,...null!==(n=null===l||void 0===l?void 0:l.definition.overridePermissions)&&void 0!==n?n:{}},Object.entries(p).filter((e=>{let[t,n]=e;return n})).map((e=>{let[t]=e;return t})).join(" "));var p;return(0,Zr.jsx)(rd,{className:"tl-embed-container",id:e.id,children:null!==l&&void 0!==l&&l.definition?(0,Zr.jsx)("iframe",{className:"tl-embed",sandbox:h,src:l.embedUrl,width:no(i),height:no(o),draggable:!1,frameBorder:"0",referrerPolicy:"no-referrer-when-downgrade",style:{border:0,pointerEvents:d?"auto":"none",zIndex:d?"":"-1",boxShadow:wp(u),borderRadius:null!==(r=null===l||void 0===l?void 0:l.definition.overrideOutlineRadius)&&void 0!==r?r:8,background:null===l||void 0===l?void 0:l.definition.backgroundColor}}):null})}indicator(e){var n,r;const i=(0,t.useMemo)((()=>vh(e.props.url)),[e.props.url]);return(0,Zr.jsx)("rect",{width:no(e.props.w),height:no(e.props.h),rx:null!==(n=null===i||void 0===i?void 0:i.definition.overrideOutlineRadius)&&void 0!==n?n:8,ry:null!==(r=null===i||void 0===i?void 0:i.definition.overrideOutlineRadius)&&void 0!==r?r:8})}}function Up(e){let{id:t,file:n,isInteractive:r,width:i,height:o,style:s,pageRotation:a}=e;return(0,Zr.jsx)("iframe",{className:"tl-embed",draggable:!1,width:no(i),height:no(o),frameBorder:"0",scrolling:"no",seamless:!0,referrerPolicy:"no-referrer-when-downgrade",style:{...s,pointerEvents:r?"all":"none",zIndex:r?"":"-1",boxShadow:wp(a)},srcDoc:'\n\t\t\t<html>\n\t\t\t\t<head>\n\t\t\t\t\t<base target="_blank">\n\t\t\t\t</head>\n\t\t\t\t<body>\n\t\t\t\t\t<script src='.concat("https://gist.github.com/".concat(t,".js").concat(n?"?file=".concat(n):""),'><\/script>\n\t\t\t\t\t<style type="text/css">\n\t\t\t\t\t\t* { margin: 0px; }\n\t\t\t\t\t\ttable { height: 100%; background-color: red; }\n\t\t\t\t\t\t.gist { background-color: none; height: 100%;  }\n\t\t\t\t\t\t.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }\n\t\t\t\t\t</style>\n\t\t\t\t</body>\n\t\t\t</html>')})}s(Bp,"type","embed"),s(Bp,"props",yr),s(Bp,"migrations",br);const Hp=(0,t.forwardRef)(((e,n)=>{let{id:r,name:i,isEditing:o}=e;const s=di(),a=(0,t.useCallback)((e=>{"Enter"!==e.key||e.nativeEvent.isComposing||(li(e),e.currentTarget.blur(),s.setEditingShape(null))}),[s]),l=(0,t.useCallback)((e=>{const t=s.getShape(r);if(!t)return;const n=t.props.name,i=e.currentTarget.value.trim();n!==i&&s.updateShapes([{id:r,type:"frame",props:{name:i}}],{squashing:!0})}),[r,s]),c=(0,t.useCallback)((e=>{const t=s.getShape(r);if(!t)return;const n=t.props.name,i=e.currentTarget.value;n!==i&&s.updateShapes([{id:r,type:"frame",props:{name:i}}],{squashing:!0})}),[r,s]);return(0,Zr.jsxs)("div",{className:"tl-frame-label ".concat(o?"tl-frame-label__editing":""),children:[(0,Zr.jsx)("input",{className:"tl-frame-name-input",ref:n,style:{display:o?void 0:"none"},value:i,autoFocus:!0,onKeyDown:a,onBlur:l,onChange:c}),Kp(i,"Frame")+String.fromCharCode(8203)]})})),Vp=function(e){let{id:n,name:r,width:i,height:o}=e;const s=di(),a=q("shape rotation",(()=>Hi(s.getShapePageTransform(n).rotation())),[s,n]),l=dd(n),c=(0,t.useRef)(null),u=(0,t.useCallback)((e=>{const t=ci(e);s.editingShapeId!==n&&(s.dispatch({type:"pointer",name:"pointer_down",target:"shape",shape:s.getShape(n),...t}),e.preventDefault())}),[s,n]);(0,t.useEffect)((()=>{const e=c.current;e&&l&&(e.focus(),e.select(),requestAnimationFrame((()=>{document.activeElement!==e&&(e.focus(),e.select())})))}),[c,l]);const d=((a+Math.PI/4)*(2/Math.PI)+4)%4,h=["top","left","bottom","right"][Math.floor(d)];let p;switch(h){case"top":p="";break;case"right":p="translate(".concat(no(i),"px, 0px) rotate(90deg)");break;case"bottom":p="translate(".concat(no(i),"px, ").concat(no(o),"px) rotate(180deg)");break;case"left":p="translate(0px, ".concat(no(o),"px) rotate(270deg)")}return(0,Zr.jsx)("div",{className:"tl-frame-heading",style:{overflow:l?"visible":"hidden",maxWidth:"calc(var(--tl-zoom) * ".concat("top"===h||"bottom"===h?Math.ceil(i):Math.ceil(o),"px + var(--space-5))"),bottom:"100%",transform:"".concat(p," scale(var(--tl-scale)) translateX(calc(-1 * var(--space-3))")},onPointerDown:u,children:(0,Zr.jsx)("div",{className:"tl-frame-heading-hit-area",children:(0,Zr.jsx)(Hp,{ref:c,id:n,name:r,isEditing:l})})})};function Kp(e,t){return e.match(/^\s*$/)?t:e}class Wp extends id{constructor(){super(...arguments),s(this,"canBind",(()=>!0)),s(this,"canEdit",(()=>!0)),s(this,"canReceiveNewChildrenOfType",((e,t)=>!e.isLocked)),s(this,"canDropShapes",((e,t)=>!e.isLocked)),s(this,"onDragShapesOver",((e,t)=>t.every((t=>t.parentId===e.id))?{shouldHint:!1}:(this.editor.reparentShapes(t.map((e=>e.id)),e.id),{shouldHint:!0}))),s(this,"onDragShapesOut",((e,t)=>{const n=this.editor.getShape(e.parentId);n&&this.editor.isShapeOfType(n,"group")?this.editor.reparentShapes(t,n.id):this.editor.reparentShapes(t,this.editor.currentPageId)})),s(this,"onResizeEnd",(e=>{const t=this.editor.getShapePageBounds(e),n=this.editor.getSortedChildIdsForParent(e.id),r=[];for(const i of n){const e=this.editor.getShapePageBounds(i);t.includes(e)||r.push(i)}r.length>0&&this.editor.reparentShapes(r,this.editor.currentPageId)}))}getDefaultProps(){return{w:320,h:180,name:""}}getGeometry(e){return new xl({width:e.props.w,height:e.props.h,isFilled:!1})}component(e){const t=this.editor.getShapeGeometry(e).bounds,n=Xh();return(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsx)(sl,{children:(0,Zr.jsx)("rect",{className:"tl-frame__body",width:t.width,height:t.height,fill:n.solid,stroke:n.text})}),(0,Zr.jsx)(Vp,{id:e.id,name:e.props.name,width:t.width,height:t.height})]})}toSvg(e){const t=Wn({isDarkMode:this.editor.user.isDarkMode}),n=document.createElementNS("http://www.w3.org/2000/svg","g"),r=document.createElementNS("http://www.w3.org/2000/svg","rect");r.setAttribute("width",e.props.w.toString()),r.setAttribute("height",e.props.h.toString()),r.setAttribute("fill",t.solid),r.setAttribute("stroke",t.black.solid),r.setAttribute("stroke-width","1"),r.setAttribute("rx","1"),r.setAttribute("ry","1"),n.appendChild(r);const i=((Hi(this.editor.getShapePageTransform(e.id).rotation())+Math.PI/4)*(2/Math.PI)+4)%4;let o;switch(["top","left","bottom","right"][Math.floor(i)]){case"top":default:o="";break;case"right":o="translate(".concat(no(e.props.w),"px, 0px) rotate(90deg)");break;case"bottom":o="translate(".concat(no(e.props.w),"px, ").concat(no(e.props.h),"px) rotate(180deg)");break;case"left":o="translate(0px, ".concat(no(e.props.h),"px) rotate(270deg)")}const s={fontSize:12,fontFamily:"Inter, sans-serif",textAlign:"start",width:e.props.w,height:32,padding:0,lineHeight:1,fontStyle:"normal",fontWeight:"normal",overflow:"truncate-ellipsis",verticalTextAlign:"middle"},a=this.editor.textMeasure.measureTextSpans(Kp(e.props.name,"Frame")+String.fromCharCode(8203),s),l=a[0],c=Z(a),u=c.box.w+c.box.x-l.box.x,d=tp(this.editor,a,{offsetY:-s.height-2,...s});d.style.setProperty("transform",o);const h=document.createElementNS("http://www.w3.org/2000/svg","rect");return h.setAttribute("x","-8px"),h.setAttribute("y",-s.height-4+"px"),h.setAttribute("width",u+16+"px"),h.setAttribute("height","".concat(s.height,"px")),h.setAttribute("rx","4px"),h.setAttribute("ry","4px"),h.setAttribute("fill",t.background),n.appendChild(h),n.appendChild(d),n}indicator(e){const t=this.editor.getShapeGeometry(e).bounds;return(0,Zr.jsx)("rect",{width:no(t.width),height:no(t.height),className:"tl-frame-indicator"})}providesBackgroundForChildren(){return!0}}s(Wp,"type","frame"),s(Wp,"props",wr),s(Wp,"migrations",xr);const $p=t.memo((function(e){let{id:t,type:n,text:r,size:i,labelColor:o,font:s,align:a,verticalAlign:l,wrap:c,bounds:u}=e;const{rInput:d,isEmpty:h,isEditing:p,handleFocus:f,handleChange:g,handleKeyDown:m,handleBlur:y,handleInputPointerDown:v,handleDoubleClick:b}=hp(t,n,r),w=wh.normalizeTextForDom(r),x=w.length>0,S=function(e){return"start-legacy"===e||"middle-legacy"===e||"end-legacy"===e}(a),k=Xh();return p||x?(0,Zr.jsx)("div",{className:"tl-text-label","data-font":s,"data-align":a,"data-hastext":!h,"data-isediting":p,"data-textwrap":!!c,style:{justifyContent:"middle"===a||S?"center":a,alignItems:"middle"===l?"center":l,...u?{top:u.minY,left:u.minX,width:u.width,height:u.height,position:"absolute"}:{}},children:(0,Zr.jsxs)("div",{className:"tl-text-label__inner",style:{fontSize:Vd[i],lineHeight:Vd[i]*Bd.lineHeight+"px",minHeight:Bd.lineHeight+32,minWidth:0,color:k[o].solid},children:[(0,Zr.jsx)("div",{className:"tl-text tl-text-content",dir:"ltr",children:w}),p&&(0,Zr.jsx)("textarea",{ref:d,className:"tl-text tl-text-input",name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:!0,placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",datatype:"wysiwyg",defaultValue:r,onFocus:f,onChange:g,onKeyDown:m,onBlur:y,onContextMenu:li,onPointerDown:v,onDoubleClick:b})]})}):null}));function Yp(e){let{bounds:t,editor:n,font:r,shape:i}=e;const o={fontSize:Vd[i.props.size],fontFamily:r,textAlign:i.props.align,verticalTextAlign:i.props.verticalAlign,width:Math.ceil(t.width),height:Math.ceil(t.height),padding:16,lineHeight:Bd.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap",offsetX:0},s=n.textMeasure.measureTextSpans(i.props.text,o),a=function(e,t,n,r){if(("start-legacy"===e||"end-legacy"===e)&&0!==n.length){const i=Ti.From(n[0].box);for(const{box:e}of n)i.union(e);if("start-legacy"===e)return(r-2*t-i.width)/2;if("end-legacy"===e)return-(r-2*t-i.width)/2}}(i.props.align,16,s,t.width);a&&(o.offsetX=a);return tp(0,s,o)}function qp(e){return"".concat(no(e.x),",").concat(no(e.y)," ")}function Gp(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=0,n=0,r=0,i=0;function o(){const e=t^t<<11;return t=n,n=r,r=i,i^=(i>>>19^e^e>>>8)>>>0,i/4294967296*2}for(let s=0;s<e.length+64;s++)t^=0|e.charCodeAt(s),o();return o}function Xp(e){let t="M";let n,r,i;for(let o=0,s=e.length;o<s;o+=3)n=e[o],r=e[o+1],i=e[o+2],t+="".concat(qp(n),"L").concat(qp(r),"Q").concat(qp(i));return t+="".concat(qp(e[0])),t}function Qp(e,t,n,r,i){const o=[],s=Gp(e);let a,l=t[0];const c=t.length;for(let u=0,d=c*i;u<d;u++){a=Ei.AddXY(t[(u+1)%c],s()*n,s()*n);const e=Ei.Sub(a,l),i=Ei.Len(e),d=Ei.Div(e,i).mul(Math.min(i/4,r));o.push(Ei.Add(l,d),Ei.Add(a,d.neg()),a),l=a}return o}function Zp(e,t,n){let r="M ".concat(qp(t[0]),"L"),i="M ".concat(qp(t[0]),"L");const o=n/3,s=2*n,a=Gp(e);let l,c,u=t[0],d=t[0];for(let h=0,p=t.length-1;h<p;h++){l=t[h+1],c=Ei.AddXY(t[h+1],a()*o,a()*o);const e=Ei.Sub(l,u),n=Ei.Len(e),f=Ei.Div(e,n).mul(Math.min(n/4,s)),g=Ei.Add(u,f),m=Ei.Add(l,f.neg()),y=Ei.Sub(c,d),v=Ei.Len(y),b=Ei.Div(y,v).mul(Math.min(v/4,s)),w=Ei.Add(d,b),x=Ei.Add(c,b.neg());h===p-1?(r+="".concat(qp(g),"L ").concat(qp(l)),i+="".concat(qp(w),"L ").concat(qp(c))):(r+="".concat(qp(g),"L ").concat(qp(m),"Q ").concat(qp(l)),i+="".concat(qp(w),"L ").concat(qp(x),"Q ").concat(qp(c)),u=l,d=c)}return[r,r+i]}function Jp(e,t){const n=Math.min(e,t)/2,r=Math.max(e,t)-2*n;return Math.PI*(2*n)+2*r}const ef=(e,t,n,r,i)=>{switch(e){case"s":return t;case"m":return n;case"l":return r;case"xl":return i}};function tf(e,t,n,r){const i=de(n),o=Jp(e,t),s=Math.max(Math.ceil(o/ef(r,50,70,100,130)),6,Math.ceil(o/Math.min(e,t))),a=o/s*.2,l=Math.max(e-2*a,1),c=Math.max(t-2*a,1),u=(e-l)/2,d=(t-c)/2,h=Jp(l,c)/s,p=function(e,t,n){const r=Math.min(e,t)/2,i=Math.max(e,t)-2*r,o=(Math.PI*(2*r)+2*i)/n,s=e>t?[{type:"straight",start:new Ei(r,0),delta:new Ei(1,0)},{type:"arc",center:new Ei(e-r,r),startAngle:-Oi/2},{type:"straight",start:new Ei(e-r,t),delta:new Ei(-1,0)},{type:"arc",center:new Ei(r,r),startAngle:Oi/2}]:[{type:"straight",start:new Ei(e,r),delta:new Ei(0,1)},{type:"arc",center:new Ei(r,t-r),startAngle:0},{type:"straight",start:new Ei(0,t-r),delta:new Ei(0,-1)},{type:"arc",center:new Ei(r,r),startAngle:Oi}];let a=0;const l=[];for(let c=0;c<n;c++){const e=s[0];"straight"===e.type?l.push(Ei.Add(e.start,Ei.Mul(e.delta,a))):l.push(Xi(e.center.x,e.center.y,r,e.startAngle+a/r)),a+=o;let t="straight"===e.type?i:Oi*r;for(;a>t;)a-=t,s.push(s.shift()),t="straight"===s[0].type?i:Oi*r}return l}(l,c,s).map((e=>e.addXY(u,d))),f=e<20?0:.3*a,g=t<20?0:.3*a,m=p.slice(0);for(let v=0;v<Math.floor(s/2);v++)m[v]=Ei.AddXY(m[v],i()*f,i()*g),m[s-v-1]=Ei.AddXY(m[s-v-1],i()*f,i()*g);const y=[];for(let v=0;v<m.length;v++){const n=v===m.length-1?0:v+1,r=m[v],i=m[n],o=p[v],s=p[n],a=Ei.Average([o,s]),l=Ei.Angle(o,s)-Math.PI/2,c=Ei.Dist(o,s),f=h-c,g=Ei.Dist(r,i)/c,b=(Math.max(u,d)+f)*g,w=Ei.Add(a,Ei.FromAngle(l,b));w.x<0?w.x=0:w.x>e&&(w.x=e),w.y<0?w.y=0:w.y>t&&(w.y=t);const x=nf(r,i,w),S=Ei.Dist(x||Ei.Average([r,i]),r);y.push({leftPoint:r,rightPoint:i,arcPoint:w,center:x,radius:S})}return y}function nf(e,t,n){const r=e.x*(t.y-n.y)-e.y*(t.x-n.x)+t.x*n.y-n.x*t.y,i=-((e.x*e.x+e.y*e.y)*(n.y-t.y)+(t.x*t.x+t.y*t.y)*(e.y-n.y)+(n.x*n.x+n.y*n.y)*(t.y-e.y))/(2*r),o=-((e.x*e.x+e.y*e.y)*(t.x-n.x)+(t.x*t.x+t.y*t.y)*(n.x-e.x)+(n.x*n.x+n.y*n.y)*(e.x-t.x))/(2*r);return Number.isFinite(i)&&Number.isFinite(o)?new Ei(i,o):null}function rf(e,t,n,r){const i=[],o=tf(e,t,n,r);for(const{center:s,radius:a,leftPoint:l,rightPoint:c}of o)i.push(...af(l,c,s,a,10));return i}function of(e,t,n,r){const i=tf(e,t,n,r);let o="M".concat(no(i[0].leftPoint.x),",").concat(no(i[0].leftPoint.y));for(const{leftPoint:s,rightPoint:a,radius:l,center:c}of i){if(null===c){o+=" L".concat(no(a.x),",").concat(no(a.y));continue}const e=lf(s,a,c)?"0":"1";o+=" A".concat(no(l),",").concat(no(l)," 0 ").concat(e,",1 ").concat(no(a.x),",").concat(no(a.y))}return o+=" Z",o}function sf(e,t,n,r){const i=de(n),o="s"===r?.5:"m"===r?.7:"l"===r?.9:1.6,s=e=>e+i()*o*2,a=tf(e,t,n,r),l=a.reduce(((e,t)=>e+Ei.Dist(t.leftPoint,t.rightPoint)),0)/a.length>15*o?e=>new Ei(s(e.x),s(e.y)):e=>e;let c="M".concat(no(a[0].leftPoint.x),",").concat(no(a[0].leftPoint.y)),u=l(a[0].leftPoint),d="M".concat(no(u.x),",").concat(no(u.y));for(const{leftPoint:h,center:p,rightPoint:f,radius:g,arcPoint:m}of a){if(null===p){c+=" L".concat(no(f.x),",").concat(no(f.y));const e=l(f);d+=" L".concat(no(e.x),",").concat(no(e.y)),u=e;continue}const e=lf(h,f,p)?"0":"1";c+=" A".concat(no(g),",").concat(no(g)," 0 ").concat(e,",1 ").concat(no(f.x),",").concat(no(f.y));const t=l(f),n=nf(u,t,l(m));if(!n){d+=" L".concat(no(t.x),",").concat(no(t.y)),u=t;continue}const r=Math.abs(Ei.Dist(n,u));d+=" A".concat(no(r),",").concat(no(r)," 0 ").concat(e,",1 ").concat(no(t.x),",").concat(no(t.y)),u=t}return c+d+" Z"}function af(e,t,n,r,i){if(null===n)return[Ei.From(e),Ei.From(t)];const o=[],s=Ei.Angle(n,e),a=Vi(s,Ei.Angle(n,t));for(let l=0;l<i;l++){const e=s+a*(l/(i-1)),t=Xi(n.x,n.y,r,e);o.push(t)}return o}function lf(e,t,n){return(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x)>0}const cf=t.memo((function(e){let{dash:t,fill:n,color:r,strokeWidth:i,w:o,h:s,id:a,size:l}=e;const c=Xh(),u=of(o,s,a,l),d=tf(o,s,a,l);return(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsx)(Qh,{theme:c,d:u,fill:n,color:r}),(0,Zr.jsx)("g",{strokeWidth:i,stroke:c[r].solid,fill:"none",pointerEvents:"all",children:d.map(((e,n)=>{let{leftPoint:r,rightPoint:o,center:s,radius:a}=e;const l=s?a*Hi(Hi(Ei.Angle(s,o))-Hi(Ei.Angle(s,r))):Ei.Dist(r,o),{strokeDasharray:c,strokeDashoffset:u}=dp(l,i,{style:t,start:"outset",end:"outset"});return(0,Zr.jsx)("path",{d:s?"M".concat(r.x,",").concat(r.y,"A").concat(a,",").concat(a,",0,0,1,").concat(o.x,",").concat(o.y):"M".concat(r.x,",").concat(r.y,"L").concat(o.x,",").concat(o.y),strokeDasharray:c,strokeDashoffset:u},n)}))})]})}));const uf=t.memo((function(e){let{w:t,h:n,strokeWidth:r,dash:i,color:o,fill:s}=e;const a=Xh(),l=t/2,c=n/2,u=Math.max(0,l),d=Math.max(0,c),h=Ui(u,d),{strokeDasharray:p,strokeDashoffset:f}=dp(h<64?2*h:h,r,{style:i,snap:4,closed:!0}),g="M".concat(l-u,",").concat(c,"a").concat(u,",").concat(d,",0,1,1,").concat(2*u,",0a").concat(u,",").concat(d,",0,1,1,-").concat(2*u,",0");return(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsx)(Qh,{theme:a,d:g,color:o,fill:s}),(0,Zr.jsx)("path",{d:g,strokeWidth:r,width:no(t),height:no(n),fill:"none",stroke:a[o].solid,strokeDasharray:p,strokeDashoffset:f,pointerEvents:"all"})]})}));function df(e,t){if(t>e){const n=e/2;return"\n    M0,".concat(n,"\n    a").concat(n,",").concat(n,",0,1,1,").concat(2*n,",0\n    L").concat(e,",").concat(t-n,"\n    a").concat(n,",").concat(n,",0,1,1,-").concat(2*n,",0\n    Z")}const n=t/2;return"\n    M".concat(n,",0\n    L").concat(e-n,",0\n    a").concat(n,",").concat(n,",0,1,1,0,").concat(2*n,"\n    L").concat(n,",").concat(t,"\n    a").concat(n,",").concat(n,",0,1,1,0,").concat(2*-n,"\n    Z")}function hf(e,t){if(e>t){const n=t/2;return Ui(n,n)+2*(e-2*n)}const n=e/2;return Ui(n,n)+2*(t-2*n)}const pf=t.memo((function(e){let{w:t,h:n,strokeWidth:r,dash:i,color:o,fill:s}=e;const a=Xh(),l=df(t,n),c=hf(t,n),{strokeDasharray:u,strokeDashoffset:d}=dp(c<64?2*c:c,r,{style:i,snap:4,start:"outset",end:"outset",closed:!0});return(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsx)(Qh,{theme:a,d:l,color:o,fill:s}),(0,Zr.jsx)("path",{d:l,strokeWidth:r,width:no(t),height:no(n),fill:"none",stroke:a[o].solid,strokeDasharray:u,strokeDashoffset:d,pointerEvents:"all"})]})}));function ff(e){let{w:t,h:n,strokeWidth:r,dash:i,color:o,theme:s,fill:a}=e;const l=df(t,n),c=hf(t,n),{strokeDasharray:u,strokeDashoffset:d}=dp(c<64?2*c:c,r,{style:i,snap:4,closed:!0}),h=document.createElementNS("http://www.w3.org/2000/svg","path");h.setAttribute("d",l),h.setAttribute("stroke-width",r.toString()),h.setAttribute("width",t.toString()),h.setAttribute("height",n.toString()),h.setAttribute("fill","none"),h.setAttribute("stroke",s[o].solid),h.setAttribute("stroke-dasharray",u),h.setAttribute("stroke-dashoffset",d);return ep(h,Jh({d:l,fill:a,color:o,theme:s}))}const gf=t.memo((function(e){let{dash:t,fill:n,color:r,strokeWidth:i,outline:o,lines:s}=e;const a=Xh(),l="M"+o[0]+"L"+o.slice(1)+"Z";return(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsx)(Qh,{theme:a,d:l,fill:n,color:r}),(0,Zr.jsxs)("g",{strokeWidth:i,stroke:a[r].solid,fill:"none",pointerEvents:"all",children:[Array.from(Array(o.length)).map(((e,n)=>{const r=o[n],s=o[(n+1)%o.length],a=Ei.Dist(r,s),{strokeDasharray:l,strokeDashoffset:c}=dp(a,i,{style:t,start:"outset",end:"outset"});return(0,Zr.jsx)("line",{x1:r.x,y1:r.y,x2:s.x,y2:s.y,strokeDasharray:l,strokeDashoffset:c},n)})),s&&s.map(((e,n)=>{let[o,s]=e;const l=Ei.Dist(o,s),{strokeDasharray:c,strokeDashoffset:u}=dp(l,i,{style:t,start:"skip",end:"outset",snap:"dotted"===t?4:void 0});return(0,Zr.jsx)("path",{d:"M".concat(o.x,",").concat(o.y,"L").concat(s.x,",").concat(s.y),stroke:a[r].solid,strokeWidth:i,fill:"none",strokeDasharray:c,strokeDashoffset:u},"line_fg_".concat(n))}))]})]})}));const mf=t.memo((function(e){let{fill:t,color:n,strokeWidth:r,w:i,h:o,id:s,size:a}=e;const l=Xh(),c=sf(i,o,s,a);return(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsx)(Qh,{theme:l,d:c,fill:t,color:n}),(0,Zr.jsx)("path",{d:c,stroke:l[n].solid,strokeWidth:r,fill:"none"})]})}));t.memo((function(e){let{id:t,w:n,h:r,strokeWidth:i,fill:o,color:s}=e;const a=Xh(),l=wf(t,n,r,i),c=bf(t,n,r,i);return(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsx)(Qh,{theme:a,d:l,color:s,fill:o}),(0,Zr.jsx)("path",{d:c,fill:a[s].solid,strokeWidth:0,pointerEvents:"all"})]})}));function yf(e){return{size:1+e,thinning:.25,end:{taper:e},start:{taper:e},streamline:0,smoothing:1,simulatePressure:!1}}function vf(e,t,n,r){const i=de(e),o=t/2,s=n/2,a=Ui(o,s),l=[],c=zi*i(),u=zi+Li/2+Math.abs(i())*Li,d=Math.max(16,a/10);for(let h=0;h<d;h++){const e=h/(d-1),r=c+e*u,a=Math.cos(r),p=Math.sin(r);l.push(new Ei(o*a+.5*t+.05*i(),s*p+n/2+.05*i(),Math.min(1,.5+Math.abs(.5-(i()>0?Ci.easeInOutSine(e):Ci.easeInExpo(e)))/2)))}return Id(l,yf(r))}function bf(e,t,n,r){const i=yf(r);return To(Pd(Ad(vf(e,t,n,r),i),i))}function wf(e,t,n,r){return Ep(vf(e,t,n,r))}const xf=t.memo((function(e){let{id:t,outline:n,lines:r,fill:i,color:o,strokeWidth:s}=e;const a=Xh();let l=Xp(Qp(t,n,s/3,2*s,2));if(r)for(const[u,d]of r)l+="M".concat(u.x,",").concat(u.y,"L").concat(d.x,",").concat(d.y);const c=Xp(Qp(t,n,0,2*s,1));return(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsx)(Qh,{d:c,fill:i,color:o,theme:a}),(0,Zr.jsx)("path",{d:l,stroke:a[o].solid,strokeWidth:s,fill:"none"})]})}));const Sf=t.memo((function(e){let{fill:t,color:n,strokeWidth:r,w:i,h:o,id:s,size:a}=e;const l=Xh(),c=of(i,o,s,a);return(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsx)(Qh,{theme:l,d:c,fill:t,color:n}),(0,Zr.jsx)("path",{d:c,stroke:l[n].solid,strokeWidth:r,fill:"none"})]})}));const kf=t.memo((function(e){let{w:t,h:n,strokeWidth:r,fill:i,color:o}=e;const s=Xh(),a=t/2,l=n/2,c=Math.max(0,a),u=Math.max(0,l),d="M".concat(a-c,",").concat(l,"a").concat(c,",").concat(u,",0,1,1,").concat(2*c,",0a").concat(c,",").concat(u,",0,1,1,-").concat(2*c,",0");return(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsx)(Qh,{d:d,color:o,fill:i,theme:s}),(0,Zr.jsx)("path",{d:d,stroke:s[o].solid,strokeWidth:r,fill:"none"})]})}));const _f=t.memo((function(e){let{w:t,h:n,strokeWidth:r,fill:i,color:o}=e;const s=Xh(),a=Pf(t,n);return(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsx)(Qh,{d:a,color:o,fill:i,theme:s}),(0,Zr.jsx)("path",{d:a,stroke:s[o].solid,strokeWidth:r,fill:"none"})]})}));function Pf(e,t){let n;if(t>e){const r=e/2;n="\n    M0,".concat(r,"\n    a").concat(r,",").concat(r,",0,1,1,").concat(2*r,",0\n    L").concat(e,",").concat(t-r,"\n    a").concat(r,",").concat(r,",0,1,1,-").concat(2*r,",0\n    Z")}else{const r=t/2;n="\n    M".concat(r,",0\n    L").concat(e-r,",0\n    a").concat(r,",").concat(r,",0,1,1,0,").concat(2*r,"\n    L").concat(r,",").concat(t,"\n    a").concat(r,",").concat(r,",0,1,1,0,").concat(2*-r,"\n    Z")}return n}const Cf=t.memo((function(e){let{outline:t,lines:n,fill:r,color:i,strokeWidth:o}=e;const s=Xh();let a="M"+t[0]+"L"+t.slice(1)+"Z";if(n)for(const[l,c]of n)a+="M".concat(l.x,",").concat(l.y,"L").concat(c.x,",").concat(c.y);return(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsx)(Qh,{d:a,fill:r,color:i,theme:s}),(0,Zr.jsx)("path",{d:a,stroke:s[i].solid,strokeWidth:o,fill:"none"})]})}));const Ef=51;class If extends id{constructor(){super(...arguments),s(this,"canEdit",(()=>!0)),s(this,"onEditEnd",(e=>{const{id:t,type:n,props:{text:r}}=e;r.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:t,type:n,props:{text:r.trimEnd()}}])})),s(this,"onResize",((e,t)=>{let{handle:n,newPoint:r,scaleX:i,scaleY:o,initialShape:s}=t,a=s.props.w*i,l=(s.props.h+s.props.growY)*o,c=0,u=0;if(e.props.text.trim()){let t=Math.max(Math.abs(a),Ef),n=Math.max(Math.abs(l),Ef);t<Ef&&n===Ef&&(t=Ef),t===Ef&&n<Ef&&(n=Ef);const r=Mf(this.editor,{...e,props:{...e.props,w:t,h:n}}),i=Math.max(Math.abs(a),r.w)*Math.sign(a),o=Math.max(Math.abs(l),r.h)*Math.sign(l);c=Math.abs(i)-Math.abs(a),u=Math.abs(o)-Math.abs(l),a=i,l=o}const d=new Ei(0,0);i<0&&(d.x+=a),"left"!==n&&"top_left"!==n&&"bottom_left"!==n||(d.x+=i<0?c:-c),o<0&&(d.y+=l),"top"!==n&&"top_left"!==n&&"top_right"!==n||(d.y+=o<0?u:-u);const{x:h,y:p}=d.rot(e.rotation).add(r);return{x:h,y:p,props:{w:Math.max(Math.abs(a),1),h:Math.max(Math.abs(l),1),growY:0}}})),s(this,"onBeforeCreate",(e=>{if(!e.props.text)return e.props.growY?{...e,props:{...e.props,growY:0}}:void 0;const t=e.props.h,n=Mf(this.editor,e).h;let r=null;return n>t?r=n-t:e.props.growY&&(r=0),null!==r?{...e,props:{...e.props,growY:r}}:void 0})),s(this,"onBeforeUpdate",((e,t)=>{const n=e.props.text,r=t.props.text;if(n===r&&e.props.font===t.props.font&&e.props.size===t.props.size)return;if(n&&!r)return{...t,props:{...t.props,growY:0}};const i=e.props.w,o=e.props.h,s=Mf(this.editor,t),a=s.w,l=s.h;if(!n&&r&&1===r.length){let n=Math.max(i,a),r=Math.max(o,l);return e.props.w<Ef&&e.props.h<Ef&&(n=Math.max(n,Ef),r=Math.max(r,Ef),n=Math.max(n,r),r=Math.max(n,r)),{...t,props:{...t.props,w:n,h:r,growY:0}}}let c=null;return l>o?c=l-o:e.props.growY&&(c=0),null!==c?{...t,props:{...t.props,growY:c,w:Math.max(t.props.w,a)}}:a>e.props.w?{...t,props:{...t.props,w:a}}:void 0})),s(this,"onDoubleClick",(e=>{if(this.editor.inputs.altKey)switch(e.props.geo){case"rectangle":return{...e,props:{geo:"check-box"}};case"check-box":return{...e,props:{geo:"rectangle"}}}}))}getDefaultProps(){return{w:100,h:100,geo:"rectangle",color:"black",labelColor:"black",fill:"none",dash:"draw",size:"m",font:"draw",text:"",align:"middle",verticalAlign:"middle",growY:0,url:""}}getGeometry(e){const t=Math.max(1,e.props.w),n=Math.max(1,e.props.h+e.props.growY),r=t/2,i=n/2,o=Ud[e.props.size],s="none"!==e.props.fill;let a;switch(e.props.geo){case"cloud":a=new wl({points:rf(t,n,e.id,e.props.size),isFilled:s});break;case"triangle":a=new wl({points:[new Ei(r,0),new Ei(t,n),new Ei(0,n)],isFilled:s});break;case"diamond":a=new wl({points:[new Ei(r,0),new Ei(t,i),new Ei(r,n),new Ei(0,i)],isFilled:s});break;case"pentagon":a=new wl({points:Qi(t,n,5),isFilled:s});break;case"hexagon":a=new wl({points:Qi(t,n,6),isFilled:s});break;case"octagon":a=new wl({points:Qi(t,n,8),isFilled:s});break;case"ellipse":a=new bd({width:t,height:n,isFilled:s});break;case"oval":a=new wd({width:t,height:n,isFilled:s});break;case"star":{const e=5,r=zi/e/2,i=2*Math.floor(e/4),o=2*e-i,l=0,c=2*Math.floor(e/2),u=Math.cos(i*r-Li)*t/2,d=Math.cos(o*r-Li)*t/2,h=Math.sin(l*r-Li)*n/2,p=Math.sin(c*r-Li)*n/2,f=t-Math.abs(u-d),g=n-Math.abs(p-h),m=1,y=(t-(t/2+d-(t/2-u)))/2,v=(n-(n/2+h-(n/2-p)))/2,b=(t+f)/2,w=(n+g)/2,x=b*m/2,S=w*m/2;a=new wl({points:Array.from(Array(2*e)).map(((e,t)=>{const n=t*r-Li;return new Ei(y+(t%2?x:b)*Math.cos(n),v+(t%2?S:w)*Math.sin(n))})),isFilled:s});break}case"rhombus":{const e=Math.min(.38*t,.38*n);a=new wl({points:[new Ei(e,0),new Ei(t,0),new Ei(t-e,n),new Ei(0,n)],isFilled:s});break}case"rhombus-2":{const e=Math.min(.38*t,.38*n);a=new wl({points:[new Ei(0,0),new Ei(t-e,0),new Ei(t,n),new Ei(e,n)],isFilled:s});break}case"trapezoid":{const e=Math.min(.38*t,.38*n);a=new wl({points:[new Ei(e,0),new Ei(t-e,0),new Ei(t,n),new Ei(0,n)],isFilled:s});break}case"arrow-right":{const e=.38*Math.min(t,n),r=.16*n;a=new wl({points:[new Ei(0,r),new Ei(t-e,r),new Ei(t-e,0),new Ei(t,n/2),new Ei(t-e,n),new Ei(t-e,n-r),new Ei(0,n-r)],isFilled:s});break}case"arrow-left":{const e=.38*Math.min(t,n),r=.16*n;a=new wl({points:[new Ei(e,0),new Ei(e,r),new Ei(t,r),new Ei(t,n-r),new Ei(e,n-r),new Ei(e,n),new Ei(0,n/2)],isFilled:s});break}case"arrow-up":{const e=.16*t,r=.38*Math.min(t,n);a=new wl({points:[new Ei(t/2,0),new Ei(t,r),new Ei(t-e,r),new Ei(t-e,n),new Ei(e,n),new Ei(e,r),new Ei(0,r)],isFilled:s});break}case"arrow-down":{const e=.16*t,r=.38*Math.min(t,n);a=new wl({points:[new Ei(e,0),new Ei(t-e,0),new Ei(t-e,n-r),new Ei(t,n-r),new Ei(t/2,n),new Ei(0,n-r),new Ei(e,n-r)],isFilled:s});break}case"check-box":case"x-box":case"rectangle":a=new xl({width:t,height:n,isFilled:s,isSnappable:!0})}const l=Mf(this.editor,e),c=Math.min(t,Math.max(l.w,Math.min(32,Math.max(1,t-8)))),u=Math.min(n,Math.max(l.h,Math.min(32,Math.max(1,t-8)))),d=Tf(e.props,o),h=d?d.map((e=>new bl({points:e}))):[];return new ll({children:[a,new xl({x:"start"===e.props.align?0:"end"===e.props.align?t-c:(t-c)/2,y:"start"===e.props.verticalAlign?0:"end"===e.props.verticalAlign?n-u:(n-u)/2,width:c,height:u,isFilled:!0,isSnappable:!1,isLabel:!0}),...h],isSnappable:!1})}component(e){const{id:t,type:n,props:r}=e,i=Ud[r.size],{w:o,color:s,labelColor:a,fill:l,dash:c,growY:u,font:d,align:h,verticalAlign:p,size:f,text:g}=r;return(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsx)(sl,{id:t,children:(()=>{const n=r.h+u;switch(r.geo){case"cloud":if("solid"===c)return(0,Zr.jsx)(Sf,{color:s,fill:l,strokeWidth:i,w:o,h:n,id:t,size:f});if("dashed"===c||"dotted"===c)return(0,Zr.jsx)(cf,{color:s,fill:l,strokeWidth:i,w:o,h:n,id:t,size:f,dash:c});if("draw"===c)return(0,Zr.jsx)(mf,{color:s,fill:l,strokeWidth:i,w:o,h:n,id:t,size:f});break;case"ellipse":if("solid"===c)return(0,Zr.jsx)(kf,{strokeWidth:i,w:o,h:n,color:s,fill:l});if("dashed"===c||"dotted"===c)return(0,Zr.jsx)(uf,{id:t,strokeWidth:i,w:o,h:n,dash:c,color:s,fill:l});if("draw"===c)return(0,Zr.jsx)(kf,{strokeWidth:i,w:o,h:n,color:s,fill:l});break;case"oval":if("solid"===c)return(0,Zr.jsx)(_f,{strokeWidth:i,w:o,h:n,color:s,fill:l});if("dashed"===c||"dotted"===c)return(0,Zr.jsx)(pf,{id:t,strokeWidth:i,w:o,h:n,dash:c,color:s,fill:l});if("draw"===c)return(0,Zr.jsx)(_f,{strokeWidth:i,w:o,h:n,color:s,fill:l});break;default:{const n=this.editor.getShapeGeometry(e),r=n instanceof ll?n.children[0].vertices:n.vertices,o=Tf(e.props,i);if("solid"===c)return(0,Zr.jsx)(Cf,{fill:l,color:s,strokeWidth:i,outline:r,lines:o});if("dashed"===c||"dotted"===c)return(0,Zr.jsx)(gf,{dash:c,fill:l,color:s,strokeWidth:i,outline:r,lines:o});if("draw"===c)return(0,Zr.jsx)(xf,{id:t,fill:l,color:s,strokeWidth:i,outline:r,lines:o})}}})()}),(0,Zr.jsxs)(rd,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h+r.growY},children:[(0,Zr.jsx)($p,{id:t,type:n,font:d,fill:l,size:f,align:h,verticalAlign:p,text:g,labelColor:a,wrap:!0,bounds:"cloud"===r.geo?this.getGeometry(e).bounds:void 0}),e.props.url&&(0,Zr.jsx)(Sp,{url:e.props.url,zoomLevel:this.editor.zoomLevel})]})]})}indicator(e){const{id:t,props:n}=e,{w:r,size:i}=n,o=n.h+n.growY,s=Ud[i];switch(n.geo){case"ellipse":return"draw"===n.dash?(0,Zr.jsx)("path",{d:wf(t,r,o,s)}):(0,Zr.jsx)("ellipse",{cx:r/2,cy:o/2,rx:r/2,ry:o/2});case"oval":return(0,Zr.jsx)("path",{d:Pf(r,o)});case"cloud":return(0,Zr.jsx)("path",{d:of(r,o,t,i)});default:{const r=this.editor.getShapeGeometry(e),i=r instanceof ll?r.children[0].vertices:r.vertices;let o;if("draw"===n.dash){o=Xp(Qp(t,i,0,2*s,1))}else o="M"+i[0]+"L"+i.slice(1)+"Z";const a=Tf(e.props,s);if(a)for(const[e,t]of a)o+="M".concat(e.x,",").concat(e.y,"L").concat(t.x,",").concat(t.y);return(0,Zr.jsx)("path",{d:o})}}}toSvg(e,t){const{id:n,props:r}=e,i=Ud[r.size],o=Wn({isDarkMode:this.editor.user.isDarkMode});let s;switch(t.addExportDef(rp(e.props.fill,o)),r.geo){case"ellipse":switch(r.dash){case"draw":s=function(e){let{id:t,w:n,h:r,strokeWidth:i,fill:o,color:s,theme:a}=e;const l=document.createElementNS("http://www.w3.org/2000/svg","path");return l.setAttribute("d",bf(t,n,r,i)),l.setAttribute("fill",a[s].solid),ep(l,Jh({d:wf(t,n,r,i),fill:o,color:s,theme:a}))}({id:n,w:r.w,h:r.h,color:r.color,fill:r.fill,strokeWidth:i,theme:o});break;case"solid":s=function(e){let{w:t,h:n,strokeWidth:r,fill:i,color:o,theme:s}=e;const a=t/2,l=n/2,c=Math.max(0,a),u=Math.max(0,l),d="M".concat(a-c,",").concat(l,"a").concat(c,",").concat(u,",0,1,1,").concat(2*c,",0a").concat(c,",").concat(u,",0,1,1,-").concat(2*c,",0"),h=document.createElementNS("http://www.w3.org/2000/svg","path");return h.setAttribute("d",d),h.setAttribute("stroke-width",r.toString()),h.setAttribute("width",t.toString()),h.setAttribute("height",n.toString()),h.setAttribute("fill","none"),h.setAttribute("stroke",s[o].solid),ep(h,Jh({d:d,fill:i,color:o,theme:s}))}({strokeWidth:i,w:r.w,h:r.h,color:r.color,fill:r.fill,theme:o});break;default:s=function(e){let{w:t,h:n,strokeWidth:r,dash:i,color:o,theme:s,fill:a}=e;const l=t/2,c=n/2,u=Math.max(0,l-r/2),d=Math.max(0,c-r/2),h=Ui(u,d),{strokeDasharray:p,strokeDashoffset:f}=dp(h<64?2*h:h,r,{style:i,snap:4,closed:!0}),g="M".concat(l-u,",").concat(c,"a").concat(u,",").concat(d,",0,1,1,").concat(2*u,",0a").concat(u,",").concat(d,",0,1,1,-").concat(2*u,",0"),m=document.createElementNS("http://www.w3.org/2000/svg","path");return m.setAttribute("d",g),m.setAttribute("stroke-width",r.toString()),m.setAttribute("width",t.toString()),m.setAttribute("height",n.toString()),m.setAttribute("fill","none"),m.setAttribute("stroke",s[o].solid),m.setAttribute("stroke-dasharray",p),m.setAttribute("stroke-dashoffset",f),ep(m,Jh({d:g,fill:a,color:o,theme:s}))}({id:n,strokeWidth:i,w:r.w,h:r.h,dash:r.dash,color:r.color,fill:r.fill,theme:o})}break;case"oval":switch(r.dash){case"draw":default:s=ff({id:n,strokeWidth:i,w:r.w,h:r.h,dash:r.dash,color:r.color,fill:r.fill,theme:o});break;case"solid":s=function(e){let{w:t,h:n,strokeWidth:r,fill:i,color:o,theme:s}=e;const a=Pf(t,n),l=document.createElementNS("http://www.w3.org/2000/svg","path");return l.setAttribute("d",a),l.setAttribute("stroke-width",r.toString()),l.setAttribute("width",t.toString()),l.setAttribute("height",n.toString()),l.setAttribute("fill","none"),l.setAttribute("stroke",s[o].solid),ep(l,Jh({d:a,fill:i,color:o,theme:s}))}({strokeWidth:i,w:r.w,h:r.h,color:r.color,fill:r.fill,theme:o})}break;case"cloud":switch(r.dash){case"draw":s=function(e){let{fill:t,color:n,strokeWidth:r,theme:i,w:o,h:s,id:a,size:l}=e;const c=sf(o,s,a,l),u=document.createElementNS("http://www.w3.org/2000/svg","path");return u.setAttribute("d",c),u.setAttribute("stroke-width",r.toString()),u.setAttribute("stroke",i[n].solid),u.setAttribute("fill","none"),ep(u,Jh({d:c,fill:t,color:n,theme:i}))}({id:n,strokeWidth:i,w:r.w,h:r.h,color:r.color,fill:r.fill,size:r.size,theme:o});break;case"solid":s=function(e){let{fill:t,color:n,strokeWidth:r,theme:i,w:o,h:s,id:a,size:l}=e;const c=of(o,s,a,l),u=document.createElementNS("http://www.w3.org/2000/svg","path");return u.setAttribute("d",c),u.setAttribute("stroke-width",r.toString()),u.setAttribute("stroke",i[n].solid),u.setAttribute("fill","none"),ep(u,Jh({d:c,fill:t,color:n,theme:i}))}({strokeWidth:i,w:r.w,h:r.h,color:r.color,fill:r.fill,size:r.size,id:n,theme:o});break;default:s=function(e){let{dash:t,fill:n,color:r,theme:i,strokeWidth:o,w:s,h:a,id:l,size:c}=e;const u=of(s,a,l,c),d=tf(s,a,l,c),h=document.createElementNS("http://www.w3.org/2000/svg","g");h.setAttribute("stroke-width",o.toString()),h.setAttribute("stroke",i[r].solid),h.setAttribute("fill","none");for(const{leftPoint:p,rightPoint:f,center:g,radius:m}of d){const e=g?m*Hi(Hi(Ei.Angle(g,f))-Hi(Ei.Angle(g,p))):Ei.Dist(p,f),{strokeDasharray:n,strokeDashoffset:r}=dp(e,o,{style:t,start:"outset",end:"outset"}),i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d",g?"M".concat(p.x,",").concat(p.y,"A").concat(m,",").concat(m,",0,0,1,").concat(f.x,",").concat(f.y):"M".concat(p.x,",").concat(p.y,"L").concat(f.x,",").concat(f.y)),i.setAttribute("stroke-dasharray",n.toString()),i.setAttribute("stroke-dashoffset",r.toString()),h.appendChild(i)}return ep(h,Jh({d:u,fill:n,color:r,theme:i}))}({id:n,strokeWidth:i,w:r.w,h:r.h,dash:r.dash,color:r.color,fill:r.fill,theme:o,size:r.size})}break;default:{const t=this.editor.getShapeGeometry(e),a=t instanceof ll?t.children[0].vertices:t.vertices,l=Tf(e.props,i);switch(r.dash){case"draw":s=function(e){let{id:t,outline:n,lines:r,fill:i,color:o,theme:s,strokeWidth:a}=e,l=Xp(Qp(t,n,a/3,2*a,2));if(r)for(const[d,h]of r)l+="M".concat(d.x,",").concat(d.y,"L").concat(h.x,",").concat(h.y);const c=Xp(Qp(t,n,0,2*a,1)),u=document.createElementNS("http://www.w3.org/2000/svg","path");return u.setAttribute("d",l),u.setAttribute("fill","none"),u.setAttribute("stroke",s[o].solid),u.setAttribute("stroke-width",a.toString()),ep(u,Jh({d:c,fill:i,color:o,theme:s}))}({id:n,fill:r.fill,color:r.color,strokeWidth:i,outline:a,lines:l,theme:o});break;case"solid":s=function(e){let{outline:t,lines:n,fill:r,color:i,strokeWidth:o,theme:s}=e;const a="M"+t[0]+"L"+t.slice(1)+"Z",l=a;let c=a;if(n)for(const[d,h]of n)c+="M".concat(d.x,",").concat(d.y,"L").concat(h.x,",").concat(h.y);const u=document.createElementNS("http://www.w3.org/2000/svg","path");return u.setAttribute("d",c),u.setAttribute("stroke-width",o.toString()),u.setAttribute("stroke",s[i].solid),u.setAttribute("fill","none"),ep(u,Jh({d:l,fill:r,color:i,theme:s}))}({fill:r.fill,color:r.color,strokeWidth:i,outline:a,lines:l,theme:o});break;default:s=function(e){let{dash:t,fill:n,color:r,theme:i,strokeWidth:o,outline:s,lines:a}=e;const l=document.createElementNS("http://www.w3.org/2000/svg","g");if(l.setAttribute("stroke-width",o.toString()),l.setAttribute("stroke",i[r].solid),l.setAttribute("fill","none"),Array.from(Array(s.length)).forEach(((e,n)=>{const r=s[n],i=s[(n+1)%s.length],a=Ei.Dist(r,i),{strokeDasharray:c,strokeDashoffset:u}=dp(a,o,{style:t}),d=document.createElementNS("http://www.w3.org/2000/svg","line");d.setAttribute("x1",r.x.toString()),d.setAttribute("y1",r.y.toString()),d.setAttribute("x2",i.x.toString()),d.setAttribute("y2",i.y.toString()),d.setAttribute("stroke-dasharray",c.toString()),d.setAttribute("stroke-dashoffset",u.toString()),l.appendChild(d)})),a)for(const[u,d]of a){const e=Ei.Dist(u,d),{strokeDasharray:n,strokeDashoffset:r}=dp(e,o,{style:t,start:"skip",end:"skip",snap:"dotted"===t?4:2}),i=document.createElementNS("http://www.w3.org/2000/svg","line");i.setAttribute("x1",u.x.toString()),i.setAttribute("y1",u.y.toString()),i.setAttribute("x2",d.x.toString()),i.setAttribute("y2",d.y.toString()),i.setAttribute("stroke-dasharray",n.toString()),i.setAttribute("stroke-dashoffset",r.toString()),l.appendChild(i)}const c=Jh({d:"M"+s[0]+"L"+s.slice(1)+"Z",fill:n,color:r,theme:i});return ep(l,c)}({dash:r.dash,fill:r.fill,color:r.color,strokeWidth:i,outline:a,lines:l,theme:o})}break}}if(r.text){const n=this.editor.getShapeGeometry(e).bounds;t.addExportDef(np(e.props.font));const r=Yp({editor:this.editor,shape:e,font:Qn[e.props.font],bounds:n}),i=r.cloneNode(!0);i.setAttribute("fill",o[e.props.labelColor].solid),i.setAttribute("stroke","none");const a=r.cloneNode(!0);a.setAttribute("stroke-width","2"),a.setAttribute("fill",o.background),a.setAttribute("stroke",o.background);const l=document.createElementNS("http://www.w3.org/2000/svg","g");if(l.append(a),l.append(i),"g"===s.nodeName)return s.appendChild(l),s;{const e=document.createElementNS("http://www.w3.org/2000/svg","g");return e.appendChild(s),e.appendChild(l),e}}return s}getCanvasSvgDefs(){return[ip()]}}function Mf(e,t){const n=t.props.text;if(!n)return{w:0,h:0};const r=e.textMeasure.measureText("w",{...Bd,fontFamily:Wd[t.props.font],fontSize:Vd[t.props.size],maxWidth:100}),i=e.textMeasure.measureText(n,{...Bd,fontFamily:Wd[t.props.font],fontSize:Vd[t.props.size],minWidth:r.w+"px",maxWidth:Math.max(0,Math.ceil(r.w+{s:2,m:3.5,l:5,xl:10}[t.props.size]),Math.ceil(t.props.w-32))});return{w:i.w+32,h:i.h+32}}function Tf(e,t){switch(e.geo){case"x-box":return function(e,t,n,r){const i="draw"===r?.62:0;if("dashed"===r)return[[new Ei(0,0),new Ei(e/2,t/2)],[new Ei(e,t),new Ei(e/2,t/2)],[new Ei(0,t),new Ei(e/2,t/2)],[new Ei(e,0),new Ei(e/2,t/2)]];const o=t=>Math.max(0,Math.min(e,t)),s=e=>Math.max(0,Math.min(t,e));return[[new Ei(o(n*i),s(n*i)),new Ei(o(e-n*i),s(t-n*i))],[new Ei(o(n*i),s(t-n*i)),new Ei(o(e-n*i),s(n*i))]]}(e.w,e.h,t,e.dash);case"check-box":return function(e,t){const n=.82*Math.min(e,t),r=(e-n)/2,i=(t-n)/2,o=t=>Math.max(0,Math.min(e,t)),s=e=>Math.max(0,Math.min(t,e));return[[new Ei(o(r+.25*n),s(i+.52*n)),new Ei(o(r+.45*n),s(i+.82*n))],[new Ei(o(r+.45*n),s(i+.82*n)),new Ei(o(r+.82*n),s(i+.22*n))]]}(e.w,e.h);default:return}}s(If,"type","geo"),s(If,"props",Pr),s(If,"migrations",Er);class Af extends Sl{constructor(){super(...arguments),s(this,"hideResizeHandles",(e=>Df(e))),s(this,"hideRotateHandle",(e=>Df(e))),s(this,"hideSelectionBoundsFg",(e=>Df(e))),s(this,"onResize",((e,t)=>{const{scaleX:n,scaleY:r}=t,i=[];for(const o of e.props.segments)i.push({...o,points:o.points.map((e=>{let{x:t,y:i,z:o}=e;return{x:n*t,y:r*i,z:o}}))});return{props:{segments:i}}}))}getDefaultProps(){return{segments:[],color:"black",size:"m",isComplete:!1,isPen:!1}}getGeometry(e){const t=Rf(e);if(Df(e))return new md({x:-t/2,y:-t/2,radius:t/2,isFilled:!0});const{strokePoints:n,sw:r}=jf(e,t,!0),i=Op({strokeWidth:r,showAsComplete:!0});return Ad(n,i),new wl({points:Pd(n,i),isFilled:!0})}component(e){return(0,Zr.jsx)(Lf,{strokeWidth:Rf(e),shape:e,opacity:.35})}backgroundComponent(e){return(0,Zr.jsx)(Lf,{strokeWidth:Rf(e),shape:e,opacity:.82})}indicator(e){var t;const n=Ip(),r=Rf(e),i=zp(e.props.segments);let o=r;n||e.props.isPen||1!==i.length||(o+=de(e.id)()*(r/6));const s=Id(i,Op({strokeWidth:r,showAsComplete:e.props.isComplete||"straight"===(null===(t=Z(e.props.segments))||void 0===t?void 0:t.type)}));let a;return a=s.length<2?function(e,t){const n=t/2;return"M ".concat(e.x," ").concat(e.y," m -").concat(n,", 0 a ").concat(n,",").concat(n," 0 1,0 ").concat(2*n,",0 a ").concat(n,",").concat(n," 0 1,0 -").concat(2*n,",0")}(i[0],o):Ep(s,!1),(0,Zr.jsx)("path",{d:a})}toSvg(e){const t=Wn({isDarkMode:this.editor.user.isDarkMode});return zf(Rf(e),e,.35,t)}toBackgroundSvg(e){const t=Wn({isDarkMode:this.editor.user.isDarkMode});return zf(Rf(e),e,.82,t)}}function jf(e,t,n){var r;const i=zp(e.props.segments),o=e.props.isComplete||"straight"===(null===(r=Z(e.props.segments))||void 0===r?void 0:r.type);let s=t;n||e.props.isPen||1!==i.length||(s+=de(e.id)()*(t/6));return{strokePoints:Id(i,Op({strokeWidth:s,showAsComplete:o})),sw:s}}function Of(e,t,n){const{strokePoints:r,sw:i}=jf(e,t,n);return{solidStrokePath:r.length>1?Ep(r,!1):function(e){const t=.1;return"M ".concat(e.x," ").concat(e.y," m -").concat(t,", 0 a ").concat(t,",").concat(t," 0 1,0 ").concat(.2,",0 a ").concat(t,",").concat(t," 0 1,0 -").concat(.2,",0")}(e.props.segments[0].points[0]),sw:i}}function Lf(e){let{strokeWidth:n,shape:r,opacity:i}=e;const o=Xh(),s=Ip(),{solidStrokePath:a,sw:l}=Of(r,n,s),c=function(){const[e,n]=(0,t.useState)(!1);return(0,t.useEffect)((()=>{const e=CSS.supports("color","color(display-p3 1 1 1)"),t=matchMedia("(color-gamut: p3)");n(e&&t.matches);const r=()=>n(e&&t.matches);return t.addEventListener("change",r),()=>t.removeEventListener("change",r)}),[]),q(ti.forceSrgb)||!e?"srgb":"p3"}(),u=o[r.props.color].highlight[c];return(0,Zr.jsx)(sl,{id:r.id,style:{opacity:i},children:(0,Zr.jsx)("path",{d:a,strokeLinecap:"round",fill:"none",pointerEvents:"all",stroke:u,strokeWidth:l})})}function zf(e,t,n,r){const{solidStrokePath:i,sw:o}=Of(t,e,!1),s=document.createElementNS("http://www.w3.org/2000/svg","path");return s.setAttribute("d",i),s.setAttribute("fill","none"),s.setAttribute("stroke",r[t.props.color].highlight.srgb),s.setAttribute("stroke-width","".concat(o)),s.setAttribute("opacity","".concat(n)),s}function Rf(e){return 1.12*Hd[e.props.size]}function Df(e){return 1===e.props.segments.length&&e.props.segments[0].points.length<2}function Nf(){const[e,n]=(0,t.useState)(!1);return(0,t.useEffect)((()=>{const e=window.matchMedia("(prefers-reduced-motion: reduce)"),t=()=>{n(e.matches)};return t(),e.addEventListener("change",t),()=>e.removeEventListener("change",t)}),[]),e}s(Af,"type","highlight"),s(Af,"props",Mr),s(Af,"migrations",Tr);const Ff=async e=>{const t=await(async e=>new Promise(((t,n)=>{const r=new Image;r.onload=()=>t(r),r.onerror=()=>n(new Error("Failed to load image")),r.crossOrigin="anonymous",r.src=e})))(e),n=document.createElement("canvas");n.width=t.width,n.height=t.height;const r=n.getContext("2d");if(r)return r.drawImage(t,0,0),n.toDataURL()};class Bf extends id{constructor(){super(...arguments),s(this,"isAspectRatioLocked",(()=>!0)),s(this,"canCrop",(()=>!0)),s(this,"onDoubleClick",(e=>{const t=e.props.assetId?this.editor.getAsset(e.props.assetId):void 0;if(!t)return;t.props.src&&"mimeType"in t.props&&"image/gif"===t.props.mimeType&&this.editor.updateShapes([{type:"image",id:e.id,props:{playing:!e.props.playing}}])})),s(this,"onDoubleClickEdge",(e=>{const t=e.props;if(!t)return;if(this.editor.croppingShapeId!==e.id)return;const n=ge(t.crop)||{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},r=1/(n.bottomRight.x-n.topLeft.x)*e.props.w,i=1/(n.bottomRight.y-n.topLeft.y)*e.props.h,o=new Ei(n.topLeft.x*r,n.topLeft.y*i).rot(e.rotation),s={id:e.id,type:e.type,x:e.x-o.x,y:e.y-o.y,props:{crop:{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},w:r,h:i}};this.editor.updateShapes([s])}))}getDefaultProps(){return{w:100,h:100,assetId:null,playing:!0,url:"",crop:null}}component(e){var n,r;const i=Uf(e),o=ud(e.id),s=Nf(),[a,l]=(0,t.useState)(""),c=e.props.assetId?this.editor.getAsset(e.props.assetId):void 0;if("bookmark"===(null===c||void 0===c?void 0:c.type))throw Error("Bookmark assets can't be rendered as images");const u=q("onlySelectedShape",(()=>{var t;return e.id===(null===(t=this.editor.onlySelectedShape)||void 0===t?void 0:t.id)}),[this.editor])&&o&&this.editor.isInAny("select.crop","select.cropping","select.pointing_crop_handle"),d=s&&((null===c||void 0===c||null===(n=c.props.mimeType)||void 0===n?void 0:n.includes("video"))||(null===c||void 0===c||null===(r=c.props.mimeType)||void 0===r?void 0:r.includes("gif")));return(0,t.useEffect)((()=>{if(null!==c&&void 0!==c&&c.props.src&&"mimeType"in c.props&&"image/gif"===(null===c||void 0===c?void 0:c.props.mimeType)){let e=!1;return(async()=>{const t=await Ff(c.props.src);e||t&&l(t)})(),()=>{e=!0}}}),[s,null===c||void 0===c?void 0:c.props]),(0,Zr.jsxs)(Zr.Fragment,{children:[(null===c||void 0===c?void 0:c.props.src)&&u&&(0,Zr.jsx)("div",{style:i,children:(0,Zr.jsx)("div",{className:"tl-image",style:{opacity:.1,backgroundImage:"url(".concat(!e.props.playing||d?a:c.props.src,")")},draggable:!1})}),(0,Zr.jsxs)(rd,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h},children:[(0,Zr.jsxs)("div",{className:"tl-image-container",style:i,children:[null!==c&&void 0!==c&&c.props.src?(0,Zr.jsx)("div",{className:"tl-image",style:{backgroundImage:"url(".concat(!e.props.playing||d?a:c.props.src,")")},draggable:!1}):null,(null===c||void 0===c?void 0:c.props.isAnimated)&&!e.props.playing&&(0,Zr.jsx)("div",{className:"tl-image__tg",children:"GIF"})]}),"url"in e.props&&e.props.url&&(0,Zr.jsx)(Sp,{url:e.props.url,zoomLevel:this.editor.zoomLevel})]})]})}indicator(e){return ud(e.id)?null:(0,Zr.jsx)("rect",{width:no(e.props.w),height:no(e.props.h)})}async toSvg(e){const t=document.createElementNS("http://www.w3.org/2000/svg","g"),n=e.props.assetId?this.editor.getAsset(e.props.assetId):null;let r=(null===n||void 0===n?void 0:n.props.src)||"";r&&r.startsWith("http")&&(r=await async function(e){const t=await fetch(e),n=await t.blob();return new Promise(((e,t)=>{const r=new FileReader;r.onloadend=()=>e(r.result),r.onerror=t,r.readAsDataURL(n)}))}(r)||"");const i=document.createElementNS("http://www.w3.org/2000/svg","image");i.setAttributeNS("http://www.w3.org/1999/xlink","href",r);const o=Uf(e),s=e.props.crop;if(o.transform&&s){const{transform:e,width:n,height:r}=o,a=[new Ei(s.topLeft.x*n,s.topLeft.y*r),new Ei(s.bottomRight.x*n,s.topLeft.y*r),new Ei(s.bottomRight.x*n,s.bottomRight.y*r),new Ei(s.topLeft.x*n,s.bottomRight.y*r)],l=document.createElementNS("http://www.w3.org/2000/svg","g");l.style.clipPath="polygon(".concat(a.map((e=>"".concat(e.x,"px ").concat(e.y,"px"))).join(","),")"),i.setAttribute("width",n.toString()),i.setAttribute("height",r.toString()),i.style.transform=e,l.appendChild(i),t.appendChild(l)}else i.setAttribute("width",e.props.w.toString()),i.setAttribute("height",e.props.h.toString()),t.appendChild(i);return t}}function Uf(e){const t=e.props.crop,n=null===t||void 0===t?void 0:t.topLeft;if(!n)return{width:e.props.w,height:e.props.h};const r=1/(t.bottomRight.x-t.topLeft.x)*e.props.w,i=1/(t.bottomRight.y-t.topLeft.y)*e.props.h,o=-n.x*r,s=-n.y*i;return{transform:"translate(".concat(o,"px, ").concat(s,"px)"),width:r,height:i}}function Hf(e,t){const{start:n,end:r}=e;return t?"M".concat(no(n.x),",").concat(no(n.y)," L").concat(no(r.x),",").concat(no(r.y)," "):"".concat(no(r.x),",").concat(no(r.y)," ")}function Vf(e,t){const{a:n,b:r,c:i,d:o}=e;return Ei.Equals(n,o)?"":"".concat(t?"M".concat(no(n.x),",").concat(no(n.y)):"","C").concat(no(r.x),",").concat(no(r.y)," ").concat(no(i.x),",").concat(no(i.y)," ").concat(no(o.x),",").concat(no(o.y))}function Kf(e,t){let n=e.segments.reduce(((e,t,n)=>e+Vf(t,0===n)),"");return t&&(n+="Z"),n}function Wf(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e instanceof bl?function(e,t){let n=e.segments.reduce(((e,t,n)=>e+Hf(t,0===n)),"");return t&&(n+="Z"),n}(e,t):Kf(e,t)}function $f(e){return{size:e,thinning:.4,streamline:0,smoothing:.5,simulatePressure:!0,last:!0}}function Yf(e,t,n){return Id(t.vertices,$f(n))}function qf(e,t,n){const r=function(e,t,n){const r=$f(n);return Pd(Ad(Yf(0,t,n),r),r)}(0,t,n);return To(r)}s(Bf,"type","image"),s(Bf,"props",jr),s(Bf,"migrations",Lr);const Gf=new jl;class Xf extends Sl{constructor(){super(...arguments),s(this,"hideResizeHandles",(()=>!0)),s(this,"hideRotateHandle",(()=>!0)),s(this,"hideSelectionBoundsFg",(()=>!0)),s(this,"hideSelectionBoundsBg",(()=>!0)),s(this,"onResize",((e,t)=>{const{scaleX:n,scaleY:r}=t,i=ge(e.props.handles);return Object.values(e.props.handles).forEach((e=>{let{id:t,x:o,y:s}=e;i[t].x=o*n,i[t].y=s*r})),{props:{handles:i}}})),s(this,"onHandleChange",((e,t)=>{let{handle:n}=t;const r=ge(e);switch(n.id){case"start":case"end":r.props.handles[n.id]={...r.props.handles[n.id],x:n.x,y:n.y};break;default:{const t="handle:"+n.index,i=e.props.handles[t];r.props.handles[t]=i?{...i,x:n.x,y:n.y}:{id:t,type:"vertex",canBind:!1,index:n.index,x:n.x,y:n.y};break}}return r}))}getDefaultProps(){return{dash:"draw",size:"m",color:"black",spline:"line",handles:{start:{id:"start",type:"vertex",canBind:!1,canSnap:!0,index:"a1",x:0,y:0},end:{id:"end",type:"vertex",canBind:!1,canSnap:!0,index:"a2",x:.1,y:.1}}}}getGeometry(e){return Qf(e)}getHandles(e){return Gf.get(e.props,(()=>{const t=e.props.handles,n=Qf(e),r=Object.values(t).sort(Xl),i=r.slice();for(let e=0;e<n.segments.length;e++){const t=n.segments[e].midPoint(),o=Yl(r[e].index,r[e+1].index);i.push({id:"mid-".concat(e),type:"create",index:o,x:t.x,y:t.y})}return i.sort(Xl)}))}getOutlineSegments(e){return this.editor.getShapeGeometry(e).segments.map((e=>e.vertices))}component(e){const t=Xh(),n=Qf(e),r=Ud[e.props.size],{dash:i,color:o}=e.props;if("line"===e.props.spline){if("solid"===i){const i=n.points,s="M"+i[0]+"L"+i.slice(1);return(0,Zr.jsxs)(sl,{id:e.id,children:[(0,Zr.jsx)(Qh,{d:s,fill:"none",color:o,theme:t}),(0,Zr.jsx)("path",{d:s,stroke:t[o].solid,strokeWidth:r,fill:"none"})]})}if("dashed"===i||"dotted"===i){const s=n.points,a="M"+s[0]+"L"+s.slice(1);return(0,Zr.jsxs)(sl,{id:e.id,children:[(0,Zr.jsx)(Qh,{d:a,fill:"none",color:o,theme:t}),(0,Zr.jsx)("g",{stroke:t[o].solid,strokeWidth:r,children:n.segments.map(((e,t)=>{const{strokeDasharray:o,strokeDashoffset:s}=dp(e.length,r,{style:i,start:t>0?"outset":"none",end:t<n.segments.length-1?"outset":"none"});return(0,Zr.jsx)("path",{strokeDasharray:o,strokeDashoffset:s,d:Hf(e,!0),fill:"none"},t)}))})]})}if("draw"===i){const i=n.points,[s,a]=Zp(e.id,i,r);return(0,Zr.jsxs)(sl,{id:e.id,children:[(0,Zr.jsx)(Qh,{d:s,fill:"none",color:o,theme:t}),(0,Zr.jsx)("path",{d:a,stroke:t[o].solid,strokeWidth:r,fill:"none"})]})}}if("cubic"===e.props.spline){const s=Wf(n);if("solid"===i)return(0,Zr.jsxs)(sl,{id:e.id,children:[(0,Zr.jsx)(Qh,{d:s,fill:"none",color:o,theme:t}),(0,Zr.jsx)("path",{strokeWidth:r,stroke:t[o].solid,fill:"none",d:s})]});if("dashed"===i||"dotted"===i)return(0,Zr.jsxs)(sl,{id:e.id,children:[(0,Zr.jsx)(Qh,{d:s,fill:"none",color:o,theme:t}),(0,Zr.jsx)("g",{stroke:t[o].solid,strokeWidth:r,children:n.segments.map(((e,t)=>{const{strokeDasharray:o,strokeDashoffset:s}=dp(e.length,r,{style:i,start:t>0?"outset":"none",end:t<n.segments.length-1?"outset":"none"});return(0,Zr.jsx)("path",{strokeDasharray:o,strokeDashoffset:s,d:Vf(e,!0),fill:"none"},t)}))})]});if("draw"===i)return(0,Zr.jsxs)(sl,{id:e.id,children:[(0,Zr.jsx)(Qh,{d:s,fill:"none",color:o,theme:t}),(0,Zr.jsx)("path",{d:qf(0,n,r),strokeWidth:1,stroke:t[o].solid,fill:t[o].solid})]})}}indicator(e){const t=Ud[e.props.size],n=Qf(e),{dash:r}=e.props;let i;if("line"===e.props.spline){const o=n.points;if("solid"===r||"dotted"===r||"dashed"===r)i="M"+o[0]+"L"+o.slice(1);else{const[n]=Zp(e.id,o,t);i=n}}else i=function(e,t,n){if("draw"===e.props.dash)return Ep(Yf(0,t,n));return Wf(t)}(e,n,t);return(0,Zr.jsx)("path",{d:i})}toSvg(e){const t=Wn({isDarkMode:this.editor.user.isDarkMode})[e.props.color].solid,n=Qf(e),r=Ud[e.props.size];switch(e.props.dash){case"draw":{let i;if(n instanceof vd)i=qf(0,n,r);else{const[t,o]=Zp(e.id,n.points,r);i=o}const o=document.createElementNS("http://www.w3.org/2000/svg","path");return o.setAttribute("stroke-width",r+"px"),o.setAttribute("stroke",t),o.setAttribute("fill","none"),o.setAttribute("d",i),o}case"solid":{let e;if(n instanceof vd)e=Kf(n,!1);else{const t=n.points;e="M"+t[0]+"L"+t.slice(1)}const i=document.createElementNS("http://www.w3.org/2000/svg","path");return i.setAttribute("stroke-width",r+"px"),i.setAttribute("stroke",t),i.setAttribute("fill","none"),i.setAttribute("d",e),i}default:{const{segments:i}=n,o=document.createElementNS("http://www.w3.org/2000/svg","g");o.setAttribute("stroke",t),o.setAttribute("stroke-width",r.toString());const s=n instanceof vd?Vf:Hf;return i.forEach(((t,n)=>{const a=document.createElementNS("http://www.w3.org/2000/svg","path"),{strokeDasharray:l,strokeDashoffset:c}=dp(t.length,r,{style:e.props.dash,start:n>0?"outset":"none",end:n<i.length-1?"outset":"none"});a.setAttribute("stroke-dasharray",l.toString()),a.setAttribute("stroke-dashoffset",c.toString()),a.setAttribute("d",s(t,!0)),a.setAttribute("fill","none"),o.appendChild(a)})),o}}}}function Qf(e){const{spline:t,handles:n}=e.props,r=Object.values(n).sort(Xl).map(Ei.From);switch(t){case"cubic":return new vd({points:r});case"line":return new bl({points:r})}}s(Xf,"type","line"),s(Xf,"props",Dr),s(Xf,"migrations",Fr);const Zf=200;class Jf extends Sl{constructor(){super(...arguments),s(this,"canEdit",(()=>!0)),s(this,"hideResizeHandles",(()=>!0)),s(this,"hideSelectionBoundsFg",(()=>!0)),s(this,"onBeforeCreate",(e=>eg(this.editor,e,e.props.growY))),s(this,"onBeforeUpdate",((e,t)=>{if(e.props.text!==t.props.text||e.props.font!==t.props.font||e.props.size!==t.props.size)return eg(this.editor,t,e.props.growY)})),s(this,"onEditEnd",(e=>{const{id:t,type:n,props:{text:r}}=e;r.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:t,type:n,props:{text:r.trimEnd()}}])}))}getDefaultProps(){return{color:"black",size:"m",text:"",font:"draw",align:"middle",verticalAlign:"middle",growY:0,url:""}}getHeight(e){return Zf+e.props.growY}getGeometry(e){const t=this.getHeight(e);return new xl({width:Zf,height:t,isFilled:!0})}component(e){const{id:t,type:n,props:{color:r,font:i,size:o,align:s,text:a,verticalAlign:l}}=e,c=Xh(),u="black"===r?"yellow":r;return(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsx)("div",{style:{position:"absolute",width:Zf,height:this.getHeight(e)},children:(0,Zr.jsxs)("div",{className:"tl-note__container",style:{color:c[u].solid,backgroundColor:c[u].solid},children:[(0,Zr.jsx)("div",{className:"tl-note__scrim"}),(0,Zr.jsx)($p,{id:t,type:n,font:i,size:o,align:s,verticalAlign:l,text:a,labelColor:"black",wrap:!0})]})}),"url"in e.props&&e.props.url&&(0,Zr.jsx)(Sp,{url:e.props.url,zoomLevel:this.editor.zoomLevel})]})}indicator(e){return(0,Zr.jsx)("rect",{rx:"7",width:no(Zf),height:no(this.getHeight(e))})}toSvg(e,t){t.addExportDef(np(e.props.font));const n=Wn({isDarkMode:this.editor.user.isDarkMode}),r=this.editor.getShapeGeometry(e).bounds,i=document.createElementNS("http://www.w3.org/2000/svg","g"),o="black"===e.props.color?"yellow":e.props.color,s=document.createElementNS("http://www.w3.org/2000/svg","rect");s.setAttribute("rx","10"),s.setAttribute("width",Zf.toString()),s.setAttribute("height",r.height.toString()),s.setAttribute("fill",n[o].solid),s.setAttribute("stroke",n[o].solid),s.setAttribute("stroke-width","1"),i.appendChild(s);const a=document.createElementNS("http://www.w3.org/2000/svg","rect");a.setAttribute("rx","10"),a.setAttribute("width",Zf.toString()),a.setAttribute("height",r.height.toString()),a.setAttribute("fill",n.background),a.setAttribute("opacity",".28"),i.appendChild(a);const l=Yp({editor:this.editor,shape:e,font:Qn[e.props.font],bounds:r});return l.setAttribute("fill",n.text),l.setAttribute("stroke","none"),i.appendChild(l),i}}function eg(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=e.textMeasure.measureText(t.props.text,{...Bd,fontFamily:Wd[t.props.font],fontSize:Vd[t.props.size],maxWidth:166}).h+34;let i=null;if(r>Zf?i=r-Zf:n&&(i=0),null!==i)return{...t,props:{...t.props,growY:i}}}function tg(e,t){let{initialBounds:n,scaleX:r,scaleY:i,newPoint:o}=t;const s=Math.max(.01,Math.min(Math.abs(r),Math.abs(i))),a=new Ei(0,0);r<0&&(a.x=-n.width*s),i<0&&(a.y=-n.height*s);const{x:l,y:c}=Ei.Add(o,a.rot(e.rotation));return{x:l,y:c,props:{scale:s*e.props.scale}}}s(Jf,"type","note"),s(Jf,"props",Br),s(Jf,"migrations",Hr);const ng=new jl;class rg extends Sl{constructor(){super(...arguments),s(this,"canEdit",(()=>!0)),s(this,"isAspectRatioLocked",(()=>!0)),s(this,"onResize",((e,t)=>{const{initialBounds:n,initialShape:r,scaleX:i,handle:o}=t;if("scale_shape"===t.mode||"right"!==o&&"left"!==o)return{id:e.id,type:e.type,...tg(e,t)};{const t=n.width;let s=t*i;const a=new Ei(0,0);s=Math.max(1,Math.abs(s)),"left"===o?(a.x=t-s,i<0&&(a.x+=s)):i<0&&(a.x-=s);const{x:l,y:c}=a.rot(e.rotation).add(r);return{id:e.id,type:e.type,x:l,y:c,props:{w:s/r.props.scale,autoSize:!1}}}})),s(this,"onBeforeCreate",(e=>{if(!e.props.autoSize)return;if(e.props.text.trim())return;const t=this.getMinDimensions(e);return{...e,x:e.x-t.width/2,y:e.y-t.height/2}})),s(this,"onEditEnd",(e=>{const{id:t,type:n,props:{text:r}}=e,i=e.props.text.trimEnd();0===i.length?this.editor.deleteShapes([e.id]):i!==e.props.text&&this.editor.updateShapes([{id:t,type:n,props:{text:r.trimEnd()}}])})),s(this,"onBeforeUpdate",((e,t)=>{if(!t.props.autoSize)return;const n=e.props.size!==t.props.size||e.props.align!==t.props.align||e.props.font!==t.props.font||1!==e.props.scale&&1===t.props.scale,r=e.props.text!==t.props.text;if(!n&&!r)return;const i=this.getMinDimensions(e),o=ig(this.editor,t.props),s=i.width*e.props.scale,a=i.height*e.props.scale,l=o.width*t.props.scale,c=o.height*t.props.scale;let u;switch(t.props.align){case"middle":u=new Ei((l-s)/2,r?0:(c-a)/2);break;case"end":u=new Ei(l-s,r?0:(c-a)/2);break;default:if(r)break;u=new Ei(0,(c-a)/2)}if(u){u.rot(t.rotation);const{x:e,y:n}=t;return{...t,x:e-u.x,y:n-u.y,props:{...t.props,w:l}}}return{...t,props:{...t.props,w:l}}})),s(this,"onDoubleClickEdge",(e=>e.props.autoSize?1!==e.props.scale?{id:e.id,type:e.type,props:{scale:1}}:void 0:{id:e.id,type:e.type,props:{autoSize:!0}}))}getDefaultProps(){return{color:"black",size:"m",w:8,text:"",font:"draw",align:"middle",autoSize:!0,scale:1}}getMinDimensions(e){return ng.get(e.props,(e=>ig(this.editor,e)))}getGeometry(e){const{scale:t}=e.props,{width:n,height:r}=this.getMinDimensions(e);return new xl({width:n*t,height:r*t,isFilled:!0})}component(e){const{id:t,type:n,props:{text:r,color:i}}=e,o=Wn({isDarkMode:this.editor.user.isDarkMode}),{width:s,height:a}=this.getMinDimensions(e),{rInput:l,isEmpty:c,isEditing:u,handleFocus:d,handleChange:h,handleKeyDown:p,handleBlur:f,handleInputPointerDown:g,handleDoubleClick:m}=hp(t,n,r);return(0,Zr.jsx)(rd,{id:e.id,children:(0,Zr.jsxs)("div",{className:"tl-text-shape__wrapper tl-text-shadow","data-font":e.props.font,"data-align":e.props.align,"data-hastext":!c,"data-isediting":u,"data-textwrap":!0,style:{fontSize:Hd[e.props.size],lineHeight:Hd[e.props.size]*Bd.lineHeight+"px",transform:"scale(".concat(e.props.scale,")"),transformOrigin:"top left",width:Math.max(1,s),height:Math.max(Hd[e.props.size]*Bd.lineHeight,a),color:o[i].solid},children:[(0,Zr.jsx)("div",{className:"tl-text tl-text-content",dir:"ltr",children:r}),u?(0,Zr.jsx)("textarea",{ref:l,className:"tl-text tl-text-input",name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:u,placeholder:"",spellCheck:"true",wrap:"off",dir:"ltr",datatype:"wysiwyg",defaultValue:r,onFocus:d,onChange:h,onKeyDown:p,onBlur:f,onTouchEnd:li,onContextMenu:li,onPointerDown:g,onDoubleClick:m}):null]})})}indicator(e){const t=this.editor.getShapeGeometry(e).bounds,n=di();return e.props.autoSize&&n.editingShapeId===e.id?null:(0,Zr.jsx)("rect",{width:no(t.width),height:no(t.height)})}toSvg(e,t){var n,r;t.addExportDef(np(e.props.font));const i=Wn({isDarkMode:this.editor.user.isDarkMode}),o=this.editor.getShapeGeometry(e).bounds,s=e.props.text,a=o.width/(null!==(n=e.props.scale)&&void 0!==n?n:1),l=o.height/(null!==(r=e.props.scale)&&void 0!==r?r:1),c={fontSize:Hd[e.props.size],fontFamily:Qn[e.props.font],textAlign:e.props.align,verticalTextAlign:"middle",width:a,height:l,padding:0,lineHeight:Bd.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap"},u=i[e.props.color].solid,d=document.createElementNS("http://www.w3.org/2000/svg","g"),h=tp(this.editor,this.editor.textMeasure.measureTextSpans(s,c),{...c,stroke:i.background,strokeWidth:2,fill:i.background,padding:0}),p=h.cloneNode(!0);return p.setAttribute("fill",u),p.setAttribute("stroke","none"),d.append(h),d.append(p),d}}function ig(e,t){const{font:n,text:r,autoSize:i,size:o,w:s}=t,a=i?16:Math.max(16,s),l=Hd[o],c=i?null:Math.floor(Math.max(a,s)),u=e.textMeasure.measureText(r,{...Bd,fontFamily:Wd[n],fontSize:l,maxWidth:c});return i&&(u.w+=1),{width:Math.max(a,u.w),height:Math.max(l,u.h)}}s(rg,"type","text"),s(rg,"props",Vr),s(rg,"migrations",Wr);class og extends id{constructor(){super(...arguments),s(this,"canEdit",(()=>!0)),s(this,"isAspectRatioLocked",(()=>!0))}getDefaultProps(){return{w:100,h:100,assetId:null,time:0,playing:!0,url:""}}component(e){return(0,Zr.jsx)(sg,{shape:e,videoUtil:this})}indicator(e){return(0,Zr.jsx)("rect",{width:no(e.props.w),height:no(e.props.h)})}toSvg(e){const t=document.createElementNS("http://www.w3.org/2000/svg","g"),n=document.createElementNS("http://www.w3.org/2000/svg","image");return n.setAttributeNS("http://www.w3.org/1999/xlink","href",function(e){const t=e.split(":")[1],n=document.querySelector(".tl-video-shape-".concat(t));if(n){const e=document.createElement("canvas");return e.width=n.videoWidth,e.height=n.videoHeight,e.getContext("2d").drawImage(n,0,0),e.toDataURL("image/png")}throw new Error("Video with id "+t+" not found")}(e.id)),n.setAttribute("width",e.props.w.toString()),n.setAttribute("height",e.props.h.toString()),t.appendChild(n),t}}s(og,"type","video"),s(og,"props",$r),s(og,"migrations",qr);const sg=W((function(e){const{shape:n,videoUtil:r}=e,i=r.editor.getShapeGeometry(n).bounds.w*r.editor.zoomLevel>=110,o=n.props.assetId?r.editor.getAsset(n.props.assetId):null,{time:s,playing:a}=n.props,l=dd(n.id),c=Nf(),u=t.useRef(null),d=t.useCallback((e=>{const t=e.currentTarget;r.editor.updateShapes([{type:"video",id:n.id,props:{playing:!0,time:t.currentTime}}])}),[n.id,r.editor]),h=t.useCallback((e=>{const t=e.currentTarget;r.editor.updateShapes([{type:"video",id:n.id,props:{playing:!1,time:t.currentTime}}])}),[n.id,r.editor]),p=t.useCallback((e=>{const t=e.currentTarget;l&&r.editor.updateShapes([{type:"video",id:n.id,props:{time:t.currentTime}}])}),[l,n.id,r.editor]),[f,g]=t.useState(!1),m=t.useCallback((e=>{const t=e.currentTarget;s!==t.currentTime&&(t.currentTime=s),a||t.pause(),g(!0)}),[a,s]);return t.useEffect((()=>{const e=u.current;e&&(f&&!l&&s!==e.currentTime&&(e.currentTime=s),l&&document.activeElement!==e&&e.focus())}),[l,f,s]),t.useEffect((()=>{if(c){const e=u.current;e.pause(),e.currentTime=0}}),[u,c]),(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsx)(rd,{id:n.id,children:(0,Zr.jsx)("div",{className:"tl-counter-scaled",children:null!==o&&void 0!==o&&o.props.src?(0,Zr.jsx)("video",{ref:u,style:l?{pointerEvents:"all"}:void 0,className:"tl-video tl-video-shape-".concat(n.id.split(":")[1]),width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:!0,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:l&&i,onPlay:d,onPause:h,onTimeUpdate:p,onLoadedData:m,hidden:!f,children:(0,Zr.jsx)("source",{src:o.props.src})}):null})}),"url"in n.props&&n.props.url&&(0,Zr.jsx)(Sp,{url:n.props.url,zoomLevel:r.editor.zoomLevel})]})})),ag=[rg,kp,Dp,If,Jf,Xf,Wp,gp,Af,Bp,Bf,og];class lg extends qc{constructor(){super(...arguments),s(this,"info",{}),s(this,"scribbleId","id"),s(this,"markId",""),s(this,"excludedShapeIds",new Set),s(this,"onEnter",(e=>{this.markId="erase scribble begin",this.editor.mark(this.markId),this.info=e;const{originPagePoint:t}=this.editor.inputs;this.excludedShapeIds=new Set(this.editor.currentPageShapes.filter((e=>{if(this.editor.isShapeOrAncestorLocked(e))return!0;if(this.editor.isShapeOfType(e,"group")||this.editor.isShapeOfType(e,"frame")){const n=this.editor.getPointInShapeSpace(e,t);return this.editor.getShapeGeometry(e).bounds.containsPoint(n)}return!1})).map((e=>e.id)));const n=this.editor.scribbles.addScribble({color:"muted-1",size:12});this.scribbleId=n.id,this.update()})),s(this,"pushPointToScribble",(()=>{const{x:e,y:t}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,t)})),s(this,"onExit",(()=>{this.editor.scribbles.stop(this.scribbleId)})),s(this,"onPointerMove",(()=>{this.update()})),s(this,"onPointerUp",(()=>{this.complete()})),s(this,"onCancel",(()=>{this.cancel()})),s(this,"onComplete",(()=>{this.complete()}))}update(){const{zoomLevel:e,currentPageShapes:t,erasingShapeIds:n,inputs:{currentPagePoint:r,previousPagePoint:i}}=this.editor,{excludedShapeIds:o}=this;this.pushPointToScribble();const s=new Set(n);for(const a of t){if(this.editor.isShapeOfType(a,"group"))continue;const t=this.editor.getShapeMask(a.id);if(t&&!to(r,t))continue;const n=this.editor.getShapeGeometry(a),o=this.editor.getPointInShapeSpace(a,i),l=this.editor.getPointInShapeSpace(a,r);n.hitTestLineSegment(o,l,8/e)&&s.add(this.editor.getOutermostSelectableShape(a).id)}this.editor.setErasingShapes([...s].filter((e=>!o.has(e))))}complete(){this.editor.deleteShapes(this.editor.currentPageState.erasingShapeIds),this.editor.setErasingShapes([]),this.parent.transition("idle",{})}cancel(){this.editor.setErasingShapes([]),this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}}s(lg,"id","erasing");class cg extends qc{constructor(){super(...arguments),s(this,"onPointerDown",(e=>{this.parent.transition("pointing",e)})),s(this,"onCancel",(()=>{this.editor.setCurrentTool("select")}))}}s(cg,"id","idle");class ug extends qc{constructor(){super(...arguments),s(this,"onEnter",(()=>{const{inputs:{currentPagePoint:e},currentPageShapesSorted:t,zoomLevel:n}=this.editor,r=new Set,i=r.size;for(let o=t.length-1;o>=0;o--){const s=t[o];if(!this.editor.isShapeOrAncestorLocked(s)&&!this.editor.isShapeOfType(s,"group")&&this.editor.isPointInShape(s,e,{hitInside:!1,margin:8/n})){const e=this.editor.getOutermostSelectableShape(s);if(this.editor.isShapeOfType(e,"frame")&&r.size>i)break;r.add(e.id)}}this.editor.setErasingShapes([...r])})),s(this,"onPointerMove",(e=>{this.editor.inputs.isDragging&&this.parent.transition("erasing",e)})),s(this,"onPointerUp",(()=>{this.complete()})),s(this,"onCancel",(()=>{this.cancel()})),s(this,"onComplete",(()=>{this.complete()})),s(this,"onInterrupt",(()=>{this.cancel()}))}complete(){const{erasingShapeIds:e}=this.editor;e.length&&(this.editor.mark("erase end"),this.editor.deleteShapes(e)),this.editor.setErasingShapes([]),this.parent.transition("idle",{})}cancel(){this.editor.setErasingShapes([]),this.parent.transition("idle",{})}}s(ug,"id","pointing");class dg extends qc{constructor(){super(...arguments),s(this,"onEnter",(()=>{this.editor.setCursor({type:"cross",rotation:0})}))}}s(dg,"id","eraser"),s(dg,"initial","idle"),s(dg,"children",(()=>[cg,ug,lg]));class hg extends qc{constructor(){super(...arguments),s(this,"onEnter",(()=>{this.update()})),s(this,"onPointerMove",(()=>{this.update()})),s(this,"onPointerUp",(()=>{this.complete()})),s(this,"onCancel",(()=>{this.complete()})),s(this,"onComplete",(()=>{this.complete()}))}update(){const{currentScreenPoint:e,previousScreenPoint:t}=this.editor.inputs,n=Ei.Sub(e,t);(Math.abs(n.x)>0||Math.abs(n.y)>0)&&this.editor.pan(n)}complete(){this.editor.slideCamera({speed:Math.min(2,this.editor.inputs.pointerVelocity.len()),direction:this.editor.inputs.pointerVelocity,friction:xo}),this.parent.transition("idle",{})}}s(hg,"id","dragging");class pg extends qc{constructor(){super(...arguments),s(this,"onEnter",(()=>{this.editor.setCursor({type:"grab",rotation:0})})),s(this,"onPointerDown",(e=>{this.parent.transition("pointing",e)})),s(this,"onCancel",(()=>{this.editor.setCurrentTool("select")}))}}s(pg,"id","idle");class fg extends qc{constructor(){super(...arguments),s(this,"onEnter",(()=>{this.editor.stopCameraAnimation(),this.editor.updateInstanceState({cursor:{type:"grabbing",rotation:0}},{ephemeral:!0})})),s(this,"onPointerMove",(e=>{this.editor.inputs.isDragging&&this.parent.transition("dragging",e)})),s(this,"onPointerUp",(()=>{this.complete()})),s(this,"onCancel",(()=>{this.complete()})),s(this,"onComplete",(()=>{this.complete()})),s(this,"onInterrupt",(()=>{this.complete()}))}complete(){this.parent.transition("idle",{})}}s(fg,"id","pointing");class gg extends qc{constructor(){super(...arguments),s(this,"onDoubleClick",(e=>{if("settle"===e.phase){const{currentScreenPoint:e}=this.editor.inputs;this.editor.zoomIn(e,{duration:220,easing:Ci.easeOutQuint})}})),s(this,"onTripleClick",(e=>{if("settle"===e.phase){const{currentScreenPoint:e}=this.editor.inputs;this.editor.zoomOut(e,{duration:320,easing:Ci.easeOutQuint})}})),s(this,"onQuadrupleClick",(e=>{if("settle"===e.phase){const{zoomLevel:e,inputs:{currentScreenPoint:t}}=this.editor;1===e?this.editor.zoomToFit({duration:400,easing:Ci.easeOutQuint}):this.editor.resetZoom(t,{duration:320,easing:Ci.easeOutQuint})}}))}}s(gg,"id","hand"),s(gg,"initial","idle"),s(gg,"children",(()=>[pg,fg,hg]));class mg extends qc{constructor(){super(...arguments),s(this,"onPointerDown",(e=>{this.parent.transition("lasering",e)}))}}s(mg,"id","idle");class yg extends qc{constructor(){super(...arguments),s(this,"scribbleId","id"),s(this,"onEnter",(()=>{const e=this.editor.scribbles.addScribble({color:"laser",opacity:.7,size:4,delay:1200,shrink:.05,taper:!0});this.scribbleId=e.id,this.pushPointToScribble()})),s(this,"onExit",(()=>{this.editor.scribbles.stop(this.scribbleId)})),s(this,"onPointerMove",(()=>{this.pushPointToScribble()})),s(this,"onPointerUp",(()=>{this.complete()})),s(this,"pushPointToScribble",(()=>{const{x:e,y:t}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,t)})),s(this,"onCancel",(()=>{this.cancel()})),s(this,"onComplete",(()=>{this.complete()}))}complete(){this.parent.transition("idle",{})}cancel(){this.parent.transition("idle",{})}}s(yg,"id","lasering");class vg extends qc{constructor(){super(...arguments),s(this,"onEnter",(()=>{this.editor.setCursor({type:"cross",rotation:0})}))}}s(vg,"id","laser"),s(vg,"initial","idle"),s(vg,"children",(()=>[mg,yg]));class bg extends qc{constructor(){super(...arguments),s(this,"info",{}),s(this,"brush",new Ti),s(this,"initialSelectedShapeIds",[]),s(this,"excludedShapeIds",new Set),s(this,"initialStartShape",null),s(this,"onEnter",(e=>{const{altKey:t,currentPagePoint:n}=this.editor.inputs;t?this.parent.transition("scribble_brushing",e):(this.excludedShapeIds=new Set(this.editor.currentPageShapes.filter((e=>this.editor.isShapeOfType(e,"group")||this.editor.isShapeOrAncestorLocked(e))).map((e=>e.id))),this.info=e,this.initialSelectedShapeIds=this.editor.selectedShapeIds.slice(),this.initialStartShape=this.editor.getShapesAtPoint(n)[0],this.onPointerMove())})),s(this,"onExit",(()=>{this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null})})),s(this,"onPointerMove",(()=>{this.hitTestShapes()})),s(this,"onPointerUp",(()=>{this.complete()})),s(this,"onComplete",(()=>{this.complete()})),s(this,"onCancel",(e=>{this.editor.setSelectedShapes(this.initialSelectedShapeIds,{squashing:!0}),this.parent.transition("idle",e)})),s(this,"onKeyDown",(e=>{this.editor.inputs.altKey?this.parent.transition("scribble_brushing",e):this.hitTestShapes()})),s(this,"onKeyUp",(()=>{this.hitTestShapes()})),s(this,"onInterrupt",(()=>{this.editor.updateInstanceState({brush:null})}))}complete(){this.parent.transition("idle",{})}hitTestShapes(){const{zoomLevel:e,currentPageId:t,currentPageShapes:n,inputs:{originPagePoint:r,currentPagePoint:i,shiftKey:o,ctrlKey:s}}=this.editor;this.brush.setTo(Ti.FromPoints([r,i]));const a=new Set(o?this.initialSelectedShapeIds:[]);let l,c,u,d,h,p;const{corners:f}=this.brush,{excludedShapeIds:g}=this;e:for(let m=0,y=n.length;m<y;m++)if(u=n[m],!g.has(u.id)&&!a.has(u.id)&&(d=this.editor.getShapePageBounds(u),d))if(this.brush.contains(d))this.handleHit(u,i,t,a,f);else if(!s&&!this.editor.isShapeOfType(u,"frame")&&this.brush.collides(d)){const n=this.editor.getShapeGeometry(u);if(h=this.editor.getShapePageTransform(u),!h)continue e;p=h.clone().invert().applyToPoints(f);t:for(let r=0;r<p.length;r++)if(l=p[r],c=p[(r+1)%p.length],n.hitTestLineSegment(l,c,8/e)){this.handleHit(u,i,t,a,f);break t}}this.editor.updateInstanceState({brush:{...this.brush.toJson()}}),this.editor.setSelectedShapes(Array.from(a),{squashing:!0})}handleHit(e,t,n,r,i){if(e.parentId===n)return void r.add(e.id);const o=this.editor.getOutermostSelectableShape(e),s=this.editor.getShapeMask(o.id);(!s||function(e,t){let n,r,i,o;for(let s=0,a=e.length;s<a;s++){n=e[s],r=e[(s+1)%a];for(let e=0,s=t.length;e<s;e++)if(i=t[e],o=t[(e+1)%s],ml(n,r,i,o))return!0}return!1}(s,i)||to(t,s))&&r.add(o.id)}}function wg(e){var t;const{zoomLevel:n,inputs:{currentPagePoint:r}}=e;return null!==(t=e.getShapeAtPoint(r,{hitInside:!1,hitLabels:!1,margin:8/n,renderingOnly:!0}))&&void 0!==t?t:e.getSelectedShapeAtPoint(r)}function xg(e,t,n){if(!t)throw Error("Needs to translate a cropped shape!");const{crop:r}=t.props;if(!r)return;const i=e.inputs.shiftKey?Math.abs(n.x)<Math.abs(n.y)?"x":"y":null;"x"===i?n.x=0:"y"===i&&(n.y=0),n.rot(-t.rotation);const o=1/(r.bottomRight.x-r.topLeft.x)*t.props.w,s=1/(r.bottomRight.y-r.topLeft.y)*t.props.h,a=r.bottomRight.y-r.topLeft.y,l=r.bottomRight.x-r.topLeft.x,c=ge(r);c.topLeft.x=Math.min(1-l,Math.max(0,c.topLeft.x-n.x/o)),c.topLeft.y=Math.min(1-a,Math.max(0,c.topLeft.y-n.y/s)),c.bottomRight.x=c.topLeft.x+l,c.bottomRight.y=c.topLeft.y+a;return{id:t.id,type:t.type,props:{crop:c}}}s(bg,"id","brushing");class Sg extends qc{constructor(){super(...arguments),s(this,"onEnter",(()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0});const{onlySelectedShape:e}=this.editor;this.editor.on("change-history",this.cleanupCroppingState),e&&(this.editor.mark("crop"),this.editor.setCroppingShape(e.id))})),s(this,"onExit",(()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.editor.off("change-history",this.cleanupCroppingState)})),s(this,"onCancel",(()=>{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})})),s(this,"onPointerDown",(e=>{if(!this.editor.isMenuOpen){if(e.ctrlKey)return this.cancel(),void this.editor.root.handleEvent(e);switch(e.target){case"canvas":{const t=wg(this.editor);if(t&&!this.editor.isShapeOfType(t,"group"))return void this.onPointerDown({...e,shape:t,target:"shape"});this.cancel(),this.editor.root.handleEvent(e);break}case"shape":if(e.shape.id===this.editor.croppingShapeId)return void this.editor.setCurrentTool("select.crop.pointing_crop",e);var t;null!==(t=this.editor.getShapeUtil(e.shape))&&void 0!==t&&t.canCrop(e.shape)?(this.editor.setCroppingShape(e.shape.id),this.editor.setSelectedShapes([e.shape.id]),this.editor.setCurrentTool("select.crop.pointing_crop",e)):(this.cancel(),this.editor.root.handleEvent(e));break;case"selection":switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":this.editor.setCurrentTool("select.pointing_rotate_handle",{...e,onInteractionEnd:"select.crop"});break;case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":this.editor.setCurrentTool("select.pointing_crop_handle",{...e,onInteractionEnd:"select.crop"});break;default:this.cancel()}}}})),s(this,"onDoubleClick",(e=>{if(this.editor.inputs.shiftKey||"up"!==e.phase)return;if(!this.editor.croppingShapeId)return;const t=this.editor.getShape(this.editor.croppingShapeId);if(!t)return;const n=this.editor.getShapeUtil(t);var r;n&&("selection"===e.target&&(null===(r=n.onDoubleClickEdge)||void 0===r||r.call(n,t)))})),s(this,"onKeyDown",(()=>{this.nudgeCroppingImage(!1)})),s(this,"onKeyRepeat",(()=>{this.nudgeCroppingImage(!0)})),s(this,"onKeyUp",(e=>{if("Enter"===e.code)this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})})),s(this,"cleanupCroppingState",(()=>{this.editor.croppingShapeId||this.editor.setCurrentTool("select.idle",{})}))}cancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}nudgeCroppingImage(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const{editor:{inputs:{keys:t}}}=this,n=t.has("ShiftLeft"),r=new Ei(0,0);if(t.has("ArrowLeft")&&(r.x+=1),t.has("ArrowRight")&&(r.x-=1),t.has("ArrowUp")&&(r.y+=1),t.has("ArrowDown")&&(r.y-=1),r.equals(new Ei(0,0)))return;n&&r.mul(10);const i=this.editor.getShape(this.editor.croppingShapeId);if(!i)return;const o=xg(this.editor,i,r);o&&(e||this.editor.mark("translate crop"),this.editor.updateShapes([o]))}}s(Sg,"id","idle");class kg extends qc{constructor(){super(...arguments),s(this,"onCancel",(()=>{this.editor.setCurrentTool("select.crop.idle",{})})),s(this,"onPointerMove",(e=>{this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.crop.translating_crop",e)})),s(this,"onPointerUp",(e=>{this.editor.setCurrentTool("select.crop.idle",e)}))}}s(kg,"id","pointing_crop");class _g extends qc{constructor(){super(...arguments),s(this,"info",{}),s(this,"markId","translating crop"),s(this,"snapshot",{}),s(this,"onEnter",(e=>{this.info=e,this.snapshot=this.createSnapshot(),this.editor.mark(this.markId),this.editor.setCursor({type:"move",rotation:0}),this.updateShapes()})),s(this,"onExit",(()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})})),s(this,"onPointerMove",(()=>{this.updateShapes()})),s(this,"onPointerUp",(()=>{this.complete()})),s(this,"onComplete",(()=>{this.complete()})),s(this,"onCancel",(()=>{this.cancel()})),s(this,"onKeyDown",(e=>{switch(e.key){case"Alt":case"Shift":return void this.updateShapes()}})),s(this,"onKeyUp",(e=>{switch(e.key){case"Enter":return void this.complete();case"Alt":case"Shift":this.updateShapes()}}))}complete(){this.updateShapes(),this.editor.setCurrentTool("select.crop.idle",this.info)}cancel(){this.editor.bailToMark(this.markId),this.editor.setCurrentTool("select.crop.idle",this.info)}createSnapshot(){return{shape:this.editor.onlySelectedShape}}updateShapes(){const e=this.snapshot.shape;if(!e)return;const{originPagePoint:t,currentPagePoint:n}=this.editor.inputs,r=n.clone().sub(t),i=xg(this.editor,e,r);i&&this.editor.updateShapes([i],{squashing:!0})}}s(_g,"id","translating_crop");class Pg extends qc{}s(Pg,"id","crop"),s(Pg,"initial","idle"),s(Pg,"children",(()=>[Sg,_g,kg]));const Cg={bottom:"ns-resize",top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom_left:"nesw-resize",bottom_right:"nwse-resize",top_left:"nwse-resize",top_right:"nesw-resize",bottom_left_rotate:"swne-rotate",bottom_right_rotate:"senw-rotate",top_left_rotate:"nwse-rotate",top_right_rotate:"nesw-rotate",mobile_rotate:"grabbing"};class Eg extends qc{constructor(){super(...arguments),s(this,"info",{}),s(this,"onEnter",(e=>{this.info=e,this.updateCursor()})),s(this,"onPointerMove",(()=>{this.editor.inputs.isDragging&&this.parent.transition("resizing",this.info)})),s(this,"onPointerUp",(()=>{this.complete()})),s(this,"onCancel",(()=>{this.cancel()})),s(this,"onComplete",(()=>{this.cancel()})),s(this,"onInterrupt",(()=>{this.cancel()}))}updateCursor(){const e=this.editor.selectedShapes,t=Cg[this.info.handle];this.editor.updateInstanceState({cursor:{type:t,rotation:1===e.length?e[0].rotation:0}})}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle",{})}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle",{})}}s(Eg,"id","pointing_resize_handle");class Ig extends qc{constructor(){super(...arguments),s(this,"info",{}),s(this,"markId",""),s(this,"snapshot",{}),s(this,"onEnter",(e=>{this.info=e,this.markId="cropping",this.editor.mark(this.markId),this.snapshot=this.createSnapshot(),this.updateShapes()})),s(this,"onPointerMove",(()=>{this.updateShapes()})),s(this,"onPointerUp",(()=>{this.complete()})),s(this,"onComplete",(()=>{this.complete()})),s(this,"onCancel",(()=>{this.cancel()})),s(this,"getDefaultCrop",(()=>({topLeft:{x:0,y:0},bottomRight:{x:1,y:1}})))}updateCursor(){const e=this.editor.selectedShapes[0];if(!e)return;const t=Cg[this.info.handle];this.editor.updateInstanceState({cursor:{type:t,rotation:e.rotation}})}updateShapes(){var e;const{shape:t,cursorHandleOffset:n}=this.snapshot;if(!t)return;if(!this.editor.getShapeUtil("image"))return;const r=t.props,i=this.editor.inputs.currentPagePoint.clone().sub(n),o=this.editor.inputs.originPagePoint.clone().sub(n),s=i.clone().sub(o).rot(-t.rotation),a=null!==(e=r.crop)&&void 0!==e?e:this.getDefaultCrop(),l=ge(a),c=new Ei(t.x,t.y),u=new Ei(0,0),d=1/(a.bottomRight.x-a.topLeft.x)*r.w,h=1/(a.bottomRight.y-a.topLeft.y)*r.h;let p=!1;switch(this.info.handle){case"top":case"top_left":case"top_right":if(h<8)break;p=!0,l.topLeft.y=l.topLeft.y+s.y/h;h*(l.bottomRight.y-l.topLeft.y)<8?(l.topLeft.y=l.bottomRight.y-8/h,u.y=(l.topLeft.y-a.topLeft.y)*h):l.topLeft.y<=0?(l.topLeft.y=0,u.y=(l.topLeft.y-a.topLeft.y)*h):u.y=s.y;break;case"bottom":case"bottom_left":case"bottom_right":if(h<8)break;p=!0,l.bottomRight.y=Math.min(1,l.bottomRight.y+s.y/h);h*(l.bottomRight.y-l.topLeft.y)<8&&(l.bottomRight.y=l.topLeft.y+8/h);break}switch(this.info.handle){case"left":case"top_left":case"bottom_left":if(d<8)break;p=!0,l.topLeft.x=l.topLeft.x+s.x/d;d*(l.bottomRight.x-l.topLeft.x)<8?(l.topLeft.x=l.bottomRight.x-8/d,u.x=(l.topLeft.x-a.topLeft.x)*d):l.topLeft.x<=0?(l.topLeft.x=0,u.x=(l.topLeft.x-a.topLeft.x)*d):u.x=s.x;break;case"right":case"top_right":case"bottom_right":if(d<8)break;p=!0,l.bottomRight.x=Math.min(1,l.bottomRight.x+s.x/d);d*(l.bottomRight.x-l.topLeft.x)<8&&(l.bottomRight.x=l.topLeft.x+8/d);break}if(!p)return;c.add(u.rot(t.rotation));const f={id:t.id,type:t.type,x:c.x,y:c.y,props:{crop:l,w:(l.bottomRight.x-l.topLeft.x)*d,h:(l.bottomRight.y-l.topLeft.y)*h}};this.editor.updateShapes([f],{squashing:!0}),this.updateCursor()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle",{}))}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle",{}))}createSnapshot(){const{selectionRotation:e,inputs:{originPagePoint:t}}=this.editor,n=this.editor.onlySelectedShape,r=this.editor.selectionRotatedPageBounds,i=Ei.RotWith(r.getHandlePoint(this.info.handle),r.point,e);return{shape:n,cursorHandleOffset:Ei.Sub(t,i)}}}s(Ig,"id","cropping");class Mg extends qc{constructor(){super(...arguments),s(this,"shapeId",""),s(this,"initialHandle",{}),s(this,"initialAdjacentHandle",null),s(this,"initialPagePoint",{}),s(this,"markId",""),s(this,"initialPageTransform",void 0),s(this,"initialPageRotation",void 0),s(this,"info",{}),s(this,"isPrecise",!1),s(this,"isPreciseId",null),s(this,"pointingId",null),s(this,"onEnter",(e=>{const{shape:t,isCreating:n,handle:r}=e;this.info=e,this.parent.currentToolIdMask=e.onInteractionEnd,this.shapeId=t.id,this.markId=n?"creating:".concat(t.id):"dragging handle",n||this.editor.mark(this.markId),this.initialHandle=ge(r),this.initialPageTransform=this.editor.getShapePageTransform(t),this.initialPageRotation=this.initialPageTransform.rotation(),this.initialPagePoint=this.editor.inputs.originPagePoint.clone(),this.editor.updateInstanceState({cursor:{type:n?"cross":"grabbing",rotation:0}},{ephemeral:!0});const i=this.editor.getShapeHandles(t).sort(Xl),o=i.findIndex((t=>t.id===e.handle.id));this.initialAdjacentHandle=null;for(let a=o+1;a<i.length;a++){const t=i[a];if("vertex"===t.type&&"middle"!==t.id&&t.id!==e.handle.id){this.initialAdjacentHandle=t;break}}if(!this.initialAdjacentHandle)for(let a=i.length-1;a>=0;a--){const t=i[a];if("vertex"===t.type&&"middle"!==t.id&&t.id!==e.handle.id){this.initialAdjacentHandle=t;break}}const s=t.props[e.handle.id];this.isPrecise=!1,"binding"===(null===s||void 0===s?void 0:s.type)?(this.editor.setHintingShapes([s.boundShapeId]),this.isPrecise=!Ei.Equals(s.normalizedAnchor,{x:.5,y:.5}),this.isPrecise?this.isPreciseId=s.boundShapeId:this.resetExactTimeout()):this.editor.setHintingShapes([]),this.update(),this.editor.select(this.shapeId)})),s(this,"exactTimeout",-1),s(this,"onPointerMove",(()=>{this.update()})),s(this,"onKeyDown",(()=>{this.update()})),s(this,"onKeyUp",(()=>{this.update()})),s(this,"onPointerUp",(()=>{this.complete()})),s(this,"onComplete",(()=>{this.complete()})),s(this,"onCancel",(()=>{this.cancel()})),s(this,"onExit",(()=>{this.parent.currentToolIdMask=void 0,this.editor.setHintingShapes([]),this.editor.snaps.clear(),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})}))}resetExactTimeout(){-1!==this.exactTimeout&&this.clearExactTimeout(),this.exactTimeout=setTimeout((()=>{this.isActive&&!this.isPrecise&&(this.isPrecise=!0,this.isPreciseId=this.pointingId,this.update()),this.exactTimeout=-1}),750)}clearExactTimeout(){-1!==this.exactTimeout&&(clearTimeout(this.exactTimeout),this.exactTimeout=-1)}complete(){this.editor.snaps.clear();const{onInteractionEnd:e}=this.info;this.editor.instanceState.isToolLocked&&e?this.editor.setCurrentTool(e,{shapeId:this.shapeId}):this.parent.transition("idle",{})}cancel(){this.editor.bailToMark(this.markId),this.editor.snaps.clear();const{onInteractionEnd:e}=this.info;e?this.editor.setCurrentTool(e,{shapeId:this.shapeId}):this.parent.transition("idle",{})}update(){var e;const{editor:t,shapeId:n,initialPagePoint:r}=this,{initialHandle:i,initialPageRotation:o,initialAdjacentHandle:s}=this,{user:{isSnapMode:a},hintingShapeIds:l,snaps:c,inputs:{currentPagePoint:u,shiftKey:d,ctrlKey:h,altKey:p,pointerVelocity:f}}=t,g=this.info.shape,m=t.getShape(n);if(!m)return;const y=t.getShapeUtil(m);let v=u.clone().sub(r).rot(-o).add(i);if(d&&s&&"middle"!==i.id){const e=Ei.Angle(s,v),t=qi(e,24)-e;v=Ei.RotWith(v,s,t)}if(t.snaps.clear(),i.canSnap&&(a?!h:h)){const e=t.getShapePageTransform(m.id);if(!e)throw Error("Expected a page transform");const n=t.getShapeHandles(m).filter((e=>{let{type:t}=e;return"vertex"===t})).sort(Xl).findIndex((e=>{let{index:t}=e;return i.index===t})),r=y.getOutlineSegments(m).map((t=>ia.applyToPoints(e,t))).filter(((e,t)=>t!==n-1&&t!==n)),o=c.getSnappingHandleDelta({additionalSegments:r,handlePoint:ia.applyToPoint(e,v)});o&&(o.rot(-t.getShapeParentTransform(m).rotation()),v.add(o))}const b=null===(e=y.onHandleChange)||void 0===e?void 0:e.call(y,m,{handle:{...i,x:v.x,y:v.y},isPrecise:this.isPrecise||p,initial:g}),w={...m,...b};if(i.canBind){const e=w.props[i.id];"binding"===(null===e||void 0===e?void 0:e.type)?l[0]!==e.boundShapeId&&(t.setHintingShapes([e.boundShapeId]),this.pointingId=e.boundShapeId,this.isPrecise=f.len()<.5||p,this.isPreciseId=this.isPrecise?e.boundShapeId:null,this.resetExactTimeout()):l.length>0&&(t.setHintingShapes([]),this.pointingId=null,this.isPrecise=!1,this.isPreciseId=null,this.resetExactTimeout())}b&&t.updateShapes([w],{squashing:!0})}}s(Mg,"id","dragging_handle");class Tg extends qc{constructor(){super(...arguments),s(this,"onEnter",(()=>{const{editingShape:e}=this.editor;if(!e)throw Error("Entered editing state without an editing shape");Wh(this.editor),this.editor.select(e)})),s(this,"onExit",(()=>{var e;const{editingShapeId:t}=this.editor.currentPageState;if(!t)return;this.editor.setEditingShape(null);const n=this.editor.getShape(t),r=this.editor.getShapeUtil(n);null===(e=r.onEditEnd)||void 0===e||e.call(r,n),setTimeout((()=>{this.editor.updateViewportScreenBounds()}),500)})),s(this,"onPointerMove",(e=>{switch(e.target){case"shape":case"canvas":return void Wh(this.editor)}})),s(this,"onPointerDown",(e=>{switch(e.target){case"canvas":{const t=wg(this.editor);if(t)return void this.onPointerDown({...e,shape:t,target:"shape"});break}case"shape":{const{shape:t}=e,{editingShape:n}=this.editor;if(!n)throw Error("Expected an editing shape!");if(t.type===n.type){if(!this.editor.isShapeOfType(t,"geo")&&!this.editor.isShapeOfType(t,"arrow"))return t.id!==n.id?void this.parent.transition("pointing_shape",e):void(this.editor.isShapeOfType(t,"frame")&&this.editor.setEditingShape(null));{const r=this.editor.getShapeUtil(t).getGeometry(t).children[1];if(r){const i=this.editor.getPointInShapeSpace(t,this.editor.inputs.currentPagePoint);if(r.bounds.containsPoint(i))return t.id===n.id?void 0:void this.parent.transition("pointing_shape",e)}}}break}}this.parent.transition("idle",e),this.editor.root.handleEvent(e)})),s(this,"onComplete",(e=>{this.parent.transition("idle",e)})),s(this,"onCancel",(e=>{this.parent.transition("idle",e)}))}}function Ag(e){const{onlySelectedShape:t}=e;return!(!t||e.isShapeOrAncestorLocked(t)||!e.getShapeUtil(t).canCrop(t))}function jg(e){const{selectedShapeIds:t}=e,{shiftKey:n,altKey:r,currentPagePoint:i}=e.inputs,o=e.getShapeAtPoint(i,{hitInside:!1,margin:8/e.zoomLevel,hitLabels:!0,renderingOnly:!0,filter:e=>!e.isLocked});if(o){const i=e.getOutermostSelectableShape(o);if(n&&!r)e.cancelDoubleClick(),t.includes(i.id)?(e.mark("deselecting shape"),e.deselect(i)):(e.mark("shift selecting shape"),e.setSelectedShapes([...t,i.id]));else{let n;n=i===o||i.id===e.focusedGroupId||t.includes(i.id)?o:i,n&&!t.includes(n.id)&&(e.mark("selecting shape"),e.select(n.id))}}else{if(n)return;{t.length>0&&(e.mark("selecting none"),e.selectNone());const{focusedGroupId:n}=e;if(Rn(n)){const t=e.getShape(n);e.isPointInShape(t,i,{margin:0,hitInside:!0})||e.setFocusedGroup(null)}}}}s(Tg,"id","editing_shape");class Og extends qc{constructor(){super(...arguments),s(this,"onEnter",(()=>{this.parent.currentToolIdMask=void 0,Wh(this.editor),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})})),s(this,"onPointerMove",(()=>{Wh(this.editor)})),s(this,"onPointerDown",(e=>{if(this.editor.isMenuOpen)return;const t=e.ctrlKey&&Ag(this.editor);if(e.ctrlKey&&!t)return"shape"===e.target&&this.isDarwin&&this.editor.inputs.keys.has("ControlLeft")&&!this.editor.isShapeOrAncestorLocked(e.shape)?void this.parent.transition("pointing_shape",e):void this.parent.transition("brushing",e);switch(e.target){case"canvas":{const t=wg(this.editor);if(t)return void this.onPointerDown({...e,shape:t,target:"shape"});const{onlySelectedShape:n,selectedShapeIds:r,inputs:{currentPagePoint:i}}=this.editor;if((r.length>1||n&&!this.editor.getShapeUtil(n).hideSelectionBoundsBg(n))&&Dg(this.editor,i))return void this.onPointerDown({...e,target:"selection"});this.parent.transition("pointing_canvas",e);break}case"shape":if(this.editor.isShapeOrAncestorLocked(e.shape)){this.parent.transition("pointing_canvas",e);break}this.parent.transition("pointing_shape",e);break;case"handle":if(this.editor.instanceState.isReadonly)break;this.editor.inputs.altKey?this.parent.transition("pointing_shape",e):this.parent.transition("pointing_handle",e);break;case"selection":switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":this.parent.transition("pointing_rotate_handle",e);break;case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":t?this.parent.transition("pointing_crop_handle",e):this.parent.transition("pointing_resize_handle",e);break;default:{const{hoveredShape:t}=this.editor;if(t&&!this.editor.selectedShapeIds.includes(t.id))return void this.onPointerDown({...e,shape:t,target:"shape"});this.parent.transition("pointing_selection",e)}}}})),s(this,"onDoubleClick",(e=>{if(!this.editor.inputs.shiftKey&&"up"===e.phase)switch(e.target){case"canvas":{var t;const{hoveredShape:n}=this.editor,r=n&&!this.editor.isShapeOfType(n,"group")?n:null!==(t=this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint))&&void 0!==t?t:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:8/this.editor.zoomLevel,hitInside:!1}),{focusedGroupId:i}=this.editor;if(r){if(this.editor.isShapeOfType(r,"group"))return void jg(this.editor);{const e=this.editor.getShape(r.parentId);if(e&&this.editor.isShapeOfType(e,"group")&&(!i||e.id!==i))return void jg(this.editor)}return void this.onDoubleClick({...e,shape:r,target:"shape"})}this.editor.inputs.shiftKey||this.handleDoubleClickOnCanvas(e);break}case"selection":{if(this.editor.instanceState.isReadonly)break;const{onlySelectedShape:t}=this.editor;if(t){const r=this.editor.getShapeUtil(t);if(!this.canInteractWithShapeInReadOnly(t))return;if("right"===e.handle||"left"===e.handle||"top"===e.handle||"bottom"===e.handle){var n;const e=null===(n=r.onDoubleClickEdge)||void 0===n?void 0:n.call(r,t);if(e)return this.editor.mark("double click edge"),void this.editor.updateShapes([e])}if(r.canCrop(t)&&!this.editor.isShapeOrAncestorLocked(t))return void this.parent.transition("crop",e);this.shouldStartEditingShape(t)&&this.startEditingShape(t,e)}break}case"shape":{const{shape:t}=e,n=this.editor.getShapeUtil(t);if("video"!==t.type&&"embed"!==t.type&&this.editor.instanceState.isReadonly)break;if(n.onDoubleClick){var r;const o=null===(r=n.onDoubleClick)||void 0===r?void 0:r.call(n,t);if(o)return void this.editor.updateShapes([o]);var i;if(n.canCrop(t)&&!this.editor.isShapeOrAncestorLocked(t))return this.editor.mark("select and crop"),this.editor.select(null===(i=e.shape)||void 0===i?void 0:i.id),void this.parent.transition("crop",e)}this.shouldStartEditingShape(t)?this.startEditingShape(t,e):this.handleDoubleClickOnCanvas(e);break}case"handle":{var o;if(this.editor.instanceState.isReadonly)break;const{shape:t,handle:n}=e,r=this.editor.getShapeUtil(t),i=null===(o=r.onDoubleClickHandle)||void 0===o?void 0:o.call(r,t,n);i?this.editor.updateShapes([i]):this.shouldStartEditingShape(t)&&this.startEditingShape(t,e)}}})),s(this,"onRightClick",(e=>{switch(e.target){case"canvas":{const{hoveredShape:t}=this.editor,n=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:8/this.editor.zoomLevel,hitInside:!1,hitLabels:!0,hitFrameInside:!1,renderingOnly:!0});if(n)return void this.onRightClick({...e,shape:n,target:"shape"});const{onlySelectedShape:r,selectedShapeIds:i,inputs:{currentPagePoint:o}}=this.editor;if((i.length>1||r&&!this.editor.getShapeUtil(r).hideSelectionBoundsBg(r))&&Dg(this.editor,o))return void this.onRightClick({...e,target:"selection"});this.editor.selectNone();break}case"shape":{const{selectedShapeIds:t}=this.editor.currentPageState,{shape:n}=e,r=this.editor.getOutermostSelectableShape(n,(e=>!t.includes(e.id)));t.includes(r.id)||(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([r.id]));break}}})),s(this,"onCancel",(()=>{this.editor.focusedGroupId!==this.editor.currentPageId&&this.editor.selectedShapeIds.length>0?this.editor.popFocusedGroupId():(this.editor.mark("clearing selection"),this.editor.selectNone())})),s(this,"onKeyDown",(e=>{switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":this.nudgeSelectedShapes(!1)}})),s(this,"onKeyRepeat",(e=>{switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":this.nudgeSelectedShapes(!0)}})),s(this,"onKeyUp",(e=>{switch(e.code){case"Enter":{const{selectedShapes:t}=this.editor;if(t.every((e=>this.editor.isShapeOfType(e,"group"))))return void this.editor.setSelectedShapes(t.flatMap((e=>this.editor.getSortedChildIdsForParent(e.id))));const{onlySelectedShape:n}=this.editor;if(n&&this.shouldStartEditingShape(n))return void this.startEditingShape(n,{...e,target:"shape",shape:n});Ag(this.editor)&&this.parent.transition("crop",e);break}}})),s(this,"isDarwin",window.navigator.userAgent.toLowerCase().indexOf("mac")>-1)}shouldStartEditingShape(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.editor.onlySelectedShape;return!!e&&((!this.editor.isShapeOrAncestorLocked(e)||"embed"===e.type)&&(!!this.canInteractWithShapeInReadOnly(e)&&this.editor.getShapeUtil(e).canEdit(e)))}startEditingShape(e,t){this.editor.isShapeOrAncestorLocked(e)&&"embed"!==e.type||(this.editor.mark("editing shape"),this.editor.setEditingShape(e.id),this.parent.transition("editing_shape",t))}handleDoubleClickOnCanvas(e){if(this.editor.instanceState.isReadonly)return;this.editor.mark("creating text shape");const t=Dn(),{x:n,y:r}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:t,type:"text",x:n,y:r,props:{text:"",autoSize:!0}}]);const i=this.editor.getShape(t);if(!i)return;const o=this.editor.getShapeUtil(i);this.editor.instanceState.isReadonly&&!o.canEditInReadOnly(i)||(this.editor.setEditingShape(t),this.editor.select(t),this.parent.transition("editing_shape",e))}nudgeSelectedShapes(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const{editor:{inputs:{keys:t}}}=this,n=t.has("ShiftLeft"),r=new Ei(0,0);if(t.has("ArrowLeft")&&(r.x-=1),t.has("ArrowRight")&&(r.x+=1),t.has("ArrowUp")&&(r.y-=1),t.has("ArrowDown")&&(r.y+=1),r.equals(new Ei(0,0)))return;e||this.editor.mark("nudge shapes");const{gridSize:i}=this.editor.documentSettings,o=this.editor.instanceState.isGridMode?n?i*Rg:i:n?Lg:zg;this.editor.nudgeShapes(this.editor.selectedShapeIds,r.mul(o))}canInteractWithShapeInReadOnly(e){if(!this.editor.instanceState.isReadonly)return!0;return!!this.editor.getShapeUtil(e).canEditInReadOnly(e)}}s(Og,"id","idle");const Lg=10,zg=1,Rg=5;function Dg(e,t){const{selectionRotatedPageBounds:n}=e;if(!n)return!1;const{selectionRotation:r}=e;return r?to(t,n.corners.map((e=>Ei.RotWith(e,n.point,r)))):n.containsPoint(t)}class Ng extends qc{constructor(){super(...arguments),s(this,"onEnter",(()=>{const{inputs:e}=this.editor;e.shiftKey||this.editor.selectedShapeIds.length>0&&(this.editor.mark("selecting none"),this.editor.selectNone())})),s(this,"onPointerMove",(e=>{this.editor.inputs.isDragging&&this.parent.transition("brushing",e)})),s(this,"onPointerUp",(()=>{jg(this.editor),this.complete()})),s(this,"onComplete",(()=>{this.complete()})),s(this,"onInterrupt",(()=>{this.parent.transition("idle",{})}))}complete(){this.parent.transition("idle",{})}}s(Ng,"id","pointing_canvas");class Fg extends qc{constructor(){super(...arguments),s(this,"info",{}),s(this,"onEnter",(e=>{this.info=e,this.parent.currentToolIdMask=e.onInteractionEnd;const t=this.editor.selectedShapes[0];t&&(this.updateCursor(t),this.editor.setCroppingShape(t.id))})),s(this,"onExit",(()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.parent.currentToolIdMask=void 0})),s(this,"onPointerMove",(()=>{this.editor.inputs.isDragging&&this.parent.transition("cropping",{...this.info,onInteractionEnd:this.info.onInteractionEnd})})),s(this,"onPointerUp",(()=>{this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle",{}))})),s(this,"onCancel",(()=>{this.cancel()})),s(this,"onComplete",(()=>{this.cancel()})),s(this,"onInterrupt",(()=>{this.cancel()}))}updateCursor(e){const t=Cg[this.info.handle];this.editor.updateInstanceState({cursor:{type:t,rotation:e.rotation}})}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle",{}))}}s(Fg,"id","pointing_crop_handle");class Bg extends qc{constructor(){super(...arguments),s(this,"info",{}),s(this,"onEnter",(e=>{this.info=e;const t=e.shape.props[e.handle.id];"binding"===(null===t||void 0===t?void 0:t.type)&&this.editor.setHintingShapes([t.boundShapeId]),this.editor.updateInstanceState({cursor:{type:"grabbing",rotation:0}},{ephemeral:!0})})),s(this,"onExit",(()=>{this.editor.setHintingShapes([]),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})})),s(this,"onPointerUp",(()=>{this.parent.transition("idle",this.info)})),s(this,"onPointerMove",(()=>{this.editor.inputs.isDragging&&this.parent.transition("dragging_handle",this.info)})),s(this,"onCancel",(()=>{this.cancel()})),s(this,"onComplete",(()=>{this.cancel()})),s(this,"onInterrupt",(()=>{this.cancel()}))}cancel(){this.parent.transition("idle",{})}}s(Bg,"id","pointing_handle");class Ug extends qc{constructor(){super(...arguments),s(this,"info",{}),s(this,"onEnter",(e=>{this.parent.currentToolIdMask=e.onInteractionEnd,this.info=e,this.updateCursor()})),s(this,"onExit",(()=>{this.parent.currentToolIdMask=void 0,this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})})),s(this,"onPointerMove",(()=>{const{isDragging:e}=this.editor.inputs;e&&this.parent.transition("rotating",this.info)})),s(this,"onPointerUp",(()=>{this.complete()})),s(this,"onCancel",(()=>{this.cancel()})),s(this,"onComplete",(()=>{this.cancel()})),s(this,"onInterrupt",(()=>{this.cancel()}))}updateCursor(){const{selectionRotation:e}=this.editor;this.editor.updateInstanceState({cursor:{type:Cg[this.info.handle],rotation:e}})}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle",{})}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle",{})}}s(Ug,"id","pointing_rotate_handle");class Hg extends qc{constructor(){super(...arguments),s(this,"info",{}),s(this,"onEnter",(e=>{this.info=e})),s(this,"onPointerUp",(e=>{jg(this.editor),this.parent.transition("idle",e)})),s(this,"onPointerMove",(e=>{if(this.editor.inputs.isDragging){if(this.editor.instanceState.isReadonly)return;this.parent.transition("translating",e)}})),s(this,"onDoubleClick",(e=>{const{hoveredShape:t}=this.editor,n=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{hitInside:!0,margin:0,renderingOnly:!0});var r,i;if(n)return this.parent.transition("idle",{}),void(null===(r=(i=this.parent).onDoubleClick)||void 0===r||r.call(i,{...e,target:"shape",shape:this.editor.getShape(n)}))})),s(this,"onCancel",(()=>{this.cancel()})),s(this,"onComplete",(()=>{this.cancel()})),s(this,"onInterrupt",(()=>{this.cancel()}))}cancel(){this.parent.transition("idle",{})}}s(Hg,"id","pointing_selection");class Vg extends qc{constructor(){super(...arguments),s(this,"hitShape",{}),s(this,"hitShapeForPointerUp",{}),s(this,"didSelectOnEnter",!1),s(this,"onEnter",(e=>{const{selectedShapeIds:t,focusedGroupId:n,selectionRotatedPageBounds:r,inputs:{currentPagePoint:i,shiftKey:o,altKey:s}}=this.editor;this.hitShape=e.shape;const a=this.editor.getOutermostSelectableShape(e.shape);if(this.editor.getShapeUtil(e.shape).onClick||a.id===n||t.includes(a.id)||this.editor.isAncestorSelected(a.id)||t.length>1&&null!==r&&void 0!==r&&r.containsPoint(i))return this.didSelectOnEnter=!1,void(this.hitShapeForPointerUp=a);this.didSelectOnEnter=!0,o&&!s?(this.editor.cancelDoubleClick(),t.includes(a.id)||(this.editor.mark("shift selecting shape"),this.editor.setSelectedShapes([...t,a.id]))):(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([a.id]))})),s(this,"onPointerUp",(e=>{var t;const{zoomLevel:n,focusedGroupId:r,selectedShapeIds:i,inputs:{currentPagePoint:o,shiftKey:s}}=this.editor,a=null!==(t=this.editor.getShapeAtPoint(o,{margin:8/n,hitInside:!0,renderingOnly:!0}))&&void 0!==t?t:this.hitShape,l=a?this.editor.getOutermostSelectableShape(a):this.hitShapeForPointerUp;if(l){const t=this.editor.getShapeUtil(l);if(t.onClick){var c;const n=null===(c=t.onClick)||void 0===c?void 0:c.call(t,l);if(n)return this.editor.mark("shape on click"),this.editor.updateShapes([n]),void this.parent.transition("idle",e)}if(l.id===r)return i.length>0?(this.editor.mark("clearing shape ids"),this.editor.setSelectedShapes([])):this.editor.popFocusedGroupId(),void this.parent.transition("idle",e)}if(!this.didSelectOnEnter){const e=this.editor.getOutermostSelectableShape(a,(e=>!i.includes(e.id)));if(i.includes(e.id))if(s)this.editor.mark("deselecting on pointer up"),this.editor.deselect(l);else if(i.includes(l.id)){if(1===i.length&&(this.editor.isShapeOfType(l,"geo")||this.editor.isShapeOfType(l,"arrow"))){const e=this.editor.getShapeGeometry(l).children[1];if(e){const t=this.editor.getPointInShapeSpace(l,o);if(e.bounds.containsPoint(t,0)&&e.hitTestPoint(t))return void this.editor.batch((()=>{this.editor.mark("editing on pointer up"),this.editor.select(l.id);const e=this.editor.getShapeUtil(l);this.editor.instanceState.isReadonly&&!e.canEditInReadOnly(l)||(this.editor.setEditingShape(l.id),this.editor.setCurrentTool("select.editing_shape"))}))}}this.editor.mark("selecting on pointer up"),this.editor.select(l.id)}else this.editor.mark("selecting on pointer up"),this.editor.select(l);else if(s){const t=this.editor.getShapeAncestors(e);this.editor.mark("shift deselecting on pointer up"),this.editor.setSelectedShapes([...this.editor.selectedShapeIds.filter((e=>!t.find((t=>t.id===e)))),e.id])}else this.editor.mark("selecting on pointer up"),this.editor.setSelectedShapes([e.id])}this.parent.transition("idle",e)})),s(this,"onPointerMove",(e=>{if(this.editor.inputs.isDragging){if(this.editor.instanceState.isReadonly)return;this.parent.transition("translating",e)}})),s(this,"onCancel",(()=>{this.cancel()})),s(this,"onComplete",(()=>{this.cancel()})),s(this,"onInterrupt",(()=>{this.cancel()}))}cancel(){this.parent.transition("idle",{})}}s(Vg,"id","pointing_shape");class Kg extends qc{constructor(){super(...arguments),s(this,"info",{}),s(this,"markId",""),s(this,"creationCursorOffset",{x:0,y:0}),s(this,"editAfterComplete",!1),s(this,"snapshot",{}),s(this,"onEnter",(e=>{const{isCreating:t=!1,editAfterComplete:n=!1,creationCursorOffset:r={x:0,y:0}}=e;this.info=e,this.parent.currentToolIdMask=e.onInteractionEnd,this.editAfterComplete=n,this.creationCursorOffset=r,e.isCreating&&this.editor.updateInstanceState({cursor:{type:"cross",rotation:0}},{ephemeral:!0}),this.snapshot=this._createSnapshot(),this.markId=t?"creating:".concat(this.editor.onlySelectedShape.id):"starting resizing",t||this.editor.mark(this.markId),this.handleResizeStart(),this.updateShapes()})),s(this,"onPointerMove",(()=>{this.updateShapes()})),s(this,"onKeyDown",(()=>{this.updateShapes()})),s(this,"onKeyUp",(()=>{this.updateShapes()})),s(this,"onPointerUp",(()=>{this.complete()})),s(this,"onComplete",(()=>{this.complete()})),s(this,"onCancel",(()=>{this.cancel()})),s(this,"onExit",(()=>{this.parent.currentToolIdMask=void 0,this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.editor.snaps.clear()})),s(this,"_createSnapshot",(()=>{const{selectedShapeIds:e,selectionRotation:t,inputs:{originPagePoint:n}}=this.editor,r=this.editor.selectionRotatedPageBounds,i=Ei.RotWith(r.getHandlePoint(this.info.handle),r.point,t),o=Ei.Sub(n,i),s=new Map;e.forEach((t=>{const n=this.editor.getShape(t);if(n){if(s.set(n.id,this._createShapeSnapshot(n)),this.editor.isShapeOfType(n,"frame")&&1===e.length)return;this.editor.visitDescendants(n.id,(e=>{const t=this.editor.getShape(e);if(t&&(s.set(t.id,this._createShapeSnapshot(t)),this.editor.isShapeOfType(t,"frame")))return!1}))}}));const a=![...s.values()].some((e=>!Gi(e.pageRotation,t)||e.isAspectRatioLocked));return{shapeSnapshots:s,selectionBounds:r,cursorHandleOffset:o,selectionRotation:t,selectedShapeIds:e,canShapesDeform:a,initialSelectionPageBounds:this.editor.selectionPageBounds}})),s(this,"_createShapeSnapshot",(e=>{const t=this.editor.getShapePageTransform(e),n=this.editor.getShapeUtil(e);return{shape:e,bounds:this.editor.getShapeGeometry(e).bounds,pageTransform:t,pageRotation:ia.Decompose(t).rotation,isAspectRatioLocked:n.isAspectRatioLocked(e)}}))}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle",{})}complete(){if(this.handleResizeEnd(),this.editAfterComplete&&this.editor.onlySelectedShape)return this.editor.setEditingShape(this.editor.onlySelectedShape.id),void this.editor.setCurrentTool("select.editing_shape");this.editor.instanceState.isToolLocked&&this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle",{})}handleResizeStart(){const{shapeSnapshots:e}=this.snapshot,t=[];e.forEach((e=>{var n;let{shape:r}=e;const i=this.editor.getShapeUtil(r),o=null===(n=i.onResizeStart)||void 0===n?void 0:n.call(i,r);o&&t.push(o)})),t.length>0&&this.editor.updateShapes(t)}handleResizeEnd(){const{shapeSnapshots:e}=this.snapshot,t=[];e.forEach((e=>{var n;let{shape:r}=e;const i=this.editor.getShape(r.id),o=this.editor.getShapeUtil(r),s=null===(n=o.onResizeEnd)||void 0===n?void 0:n.call(o,r,i);s&&t.push(s)})),t.length>0&&this.editor.updateShapes(t)}updateShapes(){const{altKey:e,shiftKey:t}=this.editor.inputs,{shapeSnapshots:n,selectionBounds:r,cursorHandleOffset:i,selectedShapeIds:o,selectionRotation:s,canShapesDeform:a}=this.snapshot,l=t||!a,{ctrlKey:c}=this.editor.inputs,u=this.editor.inputs.currentPagePoint.clone().sub(i).sub(this.creationCursorOffset),d=this.editor.inputs.originPagePoint.clone().sub(i);if(this.editor.instanceState.isGridMode&&!c){const{gridSize:e}=this.editor.documentSettings;u.snapToGrid(e)}const h=this.info.handle,p=$g(h,Math.PI);this.editor.snaps.clear();if((this.editor.user.isSnapMode?!c:c)&&s%Li===0){const{nudge:t}=this.editor.snaps.snapResize({dragDelta:Ei.Sub(u,d),initialSelectionPageBounds:this.snapshot.initialSelectionPageBounds,handle:$g(h,s),isAspectRatioLocked:l,isResizingFromCenter:e});u.add(t)}const f=Ei.RotWith(e?r.center:r.getHandlePoint(p),r.point,s),g=Ei.Sub(u,f).rot(-s),m=Ei.Sub(d,f).rot(-s),y=Ei.DivV(g,m);Number.isFinite(y.x)||(y.x=1),Number.isFinite(y.y)||(y.y=1);const v="top"===h||"bottom"===h,b="left"===h||"right"===h;l?b?y.y=Math.abs(y.x):v?y.x=Math.abs(y.y):Math.abs(y.x)>Math.abs(y.y)?y.y=Math.abs(y.x)*(y.y<0?-1:1):y.x=Math.abs(y.y)*(y.x<0?-1:1):(v&&(y.x=1),b&&(y.y=1)),this.info.isCreating||this.updateCursor({dragHandle:h,isFlippedX:y.x<0,isFlippedY:y.y<0,rotation:s});for(const w of n.keys()){const e=n.get(w);this.editor.resizeShape(w,y,{initialShape:e.shape,initialBounds:e.bounds,initialPageTransform:e.pageTransform,dragHandle:h,mode:1===o.length&&w===o[0]?"resize_bounds":"scale_shape",scaleOrigin:f,scaleAxisRotation:s})}}updateCursor(e){let{dragHandle:t,isFlippedX:n,isFlippedY:r,rotation:i}=e;const o={...this.editor.instanceState.cursor};switch(t){case"top_left":case"bottom_right":o.type="nwse-resize",n!==r&&(o.type="nesw-resize");break;case"top_right":case"bottom_left":o.type="nesw-resize",n!==r&&(o.type="nwse-resize")}o.rotation=i,this.editor.setCursor(o)}}s(Kg,"id","resizing");const Wg=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function $g(e,t){t%=zi;const n=Math.round(t/(Oi/4)),r=Wg.indexOf(e);return Wg[(r+n)%Wg.length]}class Yg extends qc{constructor(){super(...arguments),s(this,"snapshot",{}),s(this,"info",{}),s(this,"markId",""),s(this,"onEnter",(e=>{this.info=e,this.parent.currentToolIdMask=e.onInteractionEnd,this.markId="rotate start",this.editor.mark(this.markId);const t=Zl({editor:this.editor});if(!t)return this.parent.transition("idle",this.info);this.snapshot=t,this.handleStart()})),s(this,"onExit",(()=>{this.editor.setCursor({type:"default",rotation:0}),this.parent.currentToolIdMask=void 0,this.snapshot={}})),s(this,"onPointerMove",(()=>{this.update()})),s(this,"onKeyDown",(()=>{this.update()})),s(this,"onKeyUp",(()=>{this.update()})),s(this,"onPointerUp",(()=>{this.complete()})),s(this,"onComplete",(()=>{this.complete()})),s(this,"onCancel",(()=>{this.cancel()})),s(this,"update",(()=>{const e=this._getRotationFromPointerPosition({snapToNearestDegree:!1});Jl({editor:this.editor,delta:e,snapshot:this.snapshot,stage:"update"}),this.editor.updateInstanceState({cursor:{type:Cg[this.info.handle],rotation:e+this.snapshot.initialSelectionRotation}})})),s(this,"cancel",(()=>{this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)})),s(this,"complete",(()=>{Jl({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!0}),snapshot:this.snapshot,stage:"end"}),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)}))}handleStart(){const e=this._getRotationFromPointerPosition({snapToNearestDegree:!1});Jl({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!1}),snapshot:this.snapshot,stage:"start"}),this.editor.updateInstanceState({cursor:{type:Cg[this.info.handle],rotation:e+this.snapshot.initialSelectionRotation}})}_getRotationFromPointerPosition(e){let{snapToNearestDegree:t}=e;const{selectionRotatedPageBounds:n,selectionRotation:r,inputs:{shiftKey:i,currentPagePoint:o}}=this.editor,{initialCursorAngle:s,initialSelectionRotation:a}=this.snapshot;if(!n)return a;let l=a+(n.center.clone().rotWith(n.point,r).angle(o)-s);if(i)l=qi(l,24);else if(t&&(l=Math.round(l/Ri)*Ri,this.editor.instanceState.isCoarsePointer)){const e=qi(l,4),t=$i(l,e);Math.abs(t)<function(e){return e*Oi/180}(5)&&(l=e)}return l-a}}s(Yg,"id","rotating");class qg extends qc{constructor(){super(...arguments),s(this,"hits",new Set),s(this,"size",0),s(this,"scribbleId","id"),s(this,"initialSelectedShapeIds",new Set),s(this,"newlySelectedShapeIds",new Set),s(this,"onEnter",(()=>{this.initialSelectedShapeIds=new Set(this.editor.inputs.shiftKey?this.editor.selectedShapeIds:[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear();const e=this.editor.scribbles.addScribble({color:"selection-stroke",opacity:.32,size:12});this.scribbleId=e.id,this.updateScribbleSelection(!0),requestAnimationFrame((()=>{this.editor.updateInstanceState({brush:null})}))})),s(this,"onExit",(()=>{this.editor.scribbles.stop(this.scribbleId)})),s(this,"onPointerMove",(()=>{this.updateScribbleSelection(!0)})),s(this,"onPointerUp",(()=>{this.complete()})),s(this,"onKeyDown",(()=>{this.updateScribbleSelection(!1)})),s(this,"onKeyUp",(()=>{this.editor.inputs.altKey?this.updateScribbleSelection(!1):this.parent.transition("brushing",{})})),s(this,"onCancel",(()=>{this.cancel()})),s(this,"onComplete",(()=>{this.complete()})),s(this,"pushPointToScribble",(()=>{const{x:e,y:t}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,t)}))}updateScribbleSelection(e){const{zoomLevel:t,currentPageShapes:n,inputs:{shiftKey:r,originPagePoint:i,previousPagePoint:o,currentPagePoint:s}}=this.editor,{newlySelectedShapeIds:a,initialSelectedShapeIds:l}=this;e&&this.pushPointToScribble();const c=n;let u,d,h,p;for(let f=0,g=c.length;f<g;f++)if(u=c[f],d=this.editor.getShapeGeometry(u),!(this.editor.isShapeOfType(u,"group")||a.has(u.id)||this.editor.isShapeOrAncestorLocked(u))){if(this.editor.isShapeOfType(u,"frame")){const e=this.editor.getPointInShapeSpace(u,i);if(d.bounds.containsPoint(e))continue}if(h=this.editor.getPointInShapeSpace(u,o),p=this.editor.getPointInShapeSpace(u,s),d.hitTestLineSegment(h,p,8/t)){const e=this.editor.getOutermostSelectableShape(u),t=this.editor.getShapeMask(e.id);if(t){if(null!==dl(o,s,t)){if(!to(s,t))continue}}a.add(e.id)}}this.editor.setSelectedShapes([...new Set(r?[...a,...l]:[...a])],{squashing:!0})}complete(){this.parent.transition("idle",{})}cancel(){this.editor.setSelectedShapes([...this.initialSelectedShapeIds],{squashing:!0}),this.parent.transition("idle",{})}}s(qg,"id","scribble_brushing");class Gg{constructor(e){s(this,"prevDroppingShapeId",null),s(this,"droppingNodeTimer",null),s(this,"first",!0),s(this,"dispose",(()=>{this.clear()})),this.editor=e,e.disposables.add(this.dispose)}updateDroppingNode(e,t){var n,r;this.first&&(this.prevDroppingShapeId=null!==(n=null===(r=this.editor.getDroppingOverShape(this.editor.inputs.originPagePoint,e))||void 0===r?void 0:r.id)&&void 0!==n?n:null,this.first=!1);null===this.droppingNodeTimer?this.setDragTimer(e,1e3,t):this.editor.inputs.pointerVelocity.len()>.5&&(clearInterval(this.droppingNodeTimer),this.setDragTimer(e,100,t))}setDragTimer(e,t,n){this.droppingNodeTimer=setTimeout((()=>{this.editor.batch((()=>{this.handleDrag(this.editor.inputs.currentPagePoint,e,n)})),this.droppingNodeTimer=null}),t)}handleDrag(e,t,n){var r,i;t=Q(t.map((e=>this.editor.getShape(e.id))));const o=null!==(r=null===(i=this.editor.getDroppingOverShape(e,t))||void 0===i?void 0:i.id)&&void 0!==r?r:null;if(o===this.prevDroppingShapeId)return;const{prevDroppingShapeId:s}=this,a=s&&this.editor.getShape(s),l=o&&this.editor.getShape(o);var c,u;a&&(null===(c=(u=this.editor.getShapeUtil(a)).onDragShapesOut)||void 0===c||c.call(u,a,t));if(l){var d,h;const e=null===(d=(h=this.editor.getShapeUtil(l)).onDragShapesOver)||void 0===d?void 0:d.call(h,l,t);e&&e.shouldHint&&this.editor.setHintingShapes([l.id])}else this.editor.setHintingShapes([]);null===n||void 0===n||n(),this.prevDroppingShapeId=o}dropShapes(e){const{prevDroppingShapeId:t}=this;if(this.handleDrag(this.editor.inputs.currentPagePoint,e),t){var n,r;const i=this.editor.getShape(t);if(!i)return;null===(n=(r=this.editor.getShapeUtil(i)).onDropShapesOver)||void 0===n||n.call(r,i,e)}}clear(){this.prevDroppingShapeId=null,null!==this.droppingNodeTimer&&clearInterval(this.droppingNodeTimer),this.droppingNodeTimer=null,this.editor.setHintingShapes([]),this.first=!0}}class Xg extends qc{constructor(){super(...arguments),s(this,"info",{}),s(this,"selectionSnapshot",{}),s(this,"snapshot",{}),s(this,"markId",""),s(this,"isCloning",!1),s(this,"isCreating",!1),s(this,"editAfterComplete",!1),s(this,"dragAndDropManager",new Gg(this.editor)),s(this,"onEnter",(e=>{const{isCreating:t=!1,editAfterComplete:n=!1}=e;this.info=e,this.parent.currentToolIdMask=e.onInteractionEnd,this.isCreating=t,this.editAfterComplete=n,this.markId=t?"creating:".concat(this.editor.onlySelectedShape.id):"translating",this.editor.mark(this.markId),this.isCloning=!1,this.info=e,this.editor.setCursor({type:"move",rotation:0}),this.selectionSnapshot=Qg(this.editor),this.isCreating||!this.editor.inputs.altKey?(this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes(),this.editor.on("tick",this.updateParent)):this.startCloning()})),s(this,"onExit",(()=>{this.parent.currentToolIdMask=void 0,this.editor.off("tick",this.updateParent),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clear(),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.dragAndDropManager.clear()})),s(this,"onPointerMove",(()=>{this.updateShapes()})),s(this,"onKeyDown",(()=>{!this.editor.inputs.altKey||this.isCloning?this.updateShapes():this.startCloning()})),s(this,"onKeyUp",(()=>{this.editor.inputs.altKey||!this.isCloning?this.updateShapes():this.stopCloning()})),s(this,"onPointerUp",(()=>{this.complete()})),s(this,"onComplete",(()=>{this.complete()})),s(this,"onCancel",(()=>{this.cancel()})),s(this,"updateParent",(()=>{const{snapshot:e}=this;this.dragAndDropManager.updateDroppingNode(e.movingShapes,this.updateParentTransforms)})),s(this,"updateParentTransforms",(()=>{const{editor:e,snapshot:{shapeSnapshots:t}}=this,n=[];t.forEach((t=>{const r=e.getShape(t.shape.id);if(!r)return null;n.push(r);const i=Kt(r.parentId)?null:ia.Inverse(e.getShapePageTransform(r.parentId));t.parentTransform=i}))}))}startCloning(){this.isCreating||(this.isCloning=!0,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.editor.duplicateShapes(Array.from(this.editor.selectedShapeIds)),this.snapshot=Qg(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.updateShapes()}reset(){this.editor.bailToMark(this.markId)}complete(){if(this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),this.handleEnd(),this.editor.instanceState.isToolLocked&&this.info.onInteractionEnd)this.editor.setCurrentTool(this.info.onInteractionEnd);else if(this.editAfterComplete){const e=this.editor.onlySelectedShape;e&&(this.editor.setEditingShape(e.id),this.editor.setCurrentTool("select.editing_shape"))}else this.parent.transition("idle",{})}cancel(){this.reset(),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.parent.transition("idle",this.info)}handleStart(){const{movingShapes:e}=this.snapshot,t=[];e.forEach((e=>{var n;const r=this.editor.getShapeUtil(e),i=null===(n=r.onTranslateStart)||void 0===n?void 0:n.call(r,e);i&&t.push(i)})),t.length>0&&this.editor.updateShapes(t),this.editor.setHoveredShape(null)}handleEnd(){const{movingShapes:e}=this.snapshot,t=[];e.forEach((e=>{var n;const r=this.editor.getShape(e.id),i=this.editor.getShapeUtil(e),o=null===(n=i.onTranslateEnd)||void 0===n?void 0:n.call(i,e,r);o&&t.push(o)})),t.length>0&&this.editor.updateShapes(t)}handleChange(){const{movingShapes:e}=this.snapshot,t=[];e.forEach((e=>{var n;const r=this.editor.getShape(e.id),i=this.editor.getShapeUtil(e),o=null===(n=i.onTranslate)||void 0===n?void 0:n.call(i,e,r);o&&t.push(o)})),t.length>0&&this.editor.updateShapes(t)}updateShapes(){const{snapshot:e}=this;this.dragAndDropManager.updateDroppingNode(e.movingShapes,this.updateParentTransforms),function(e){let{editor:t,shapeSnapshots:n,averagePagePoint:r,initialSelectionPageBounds:i,initialSelectionSnapPoints:o}=e;const{inputs:s,instanceState:{isGridMode:a},documentSettings:{gridSize:l}}=t,c=Ei.Sub(s.currentPagePoint,s.originPagePoint),u=t.inputs.shiftKey?Math.abs(c.x)<Math.abs(c.y)?"x":"y":null;"x"===u?c.x=0:"y"===u&&(c.y=0);t.snaps.clear();if((t.user.isSnapMode?!s.ctrlKey:s.ctrlKey)&&t.inputs.pointerVelocity.len()<.5){const{nudge:e}=t.snaps.snapTranslate({dragDelta:c,initialSelectionPageBounds:i,lockedAxis:u,initialSelectionSnapPoints:o});c.add(e)}const d=Ei.Add(r,c);a&&!s.ctrlKey&&d.snapToGrid(l);const h=Ei.Sub(d,r);t.updateShapes(Q(n.map((e=>{let{shape:t,pagePoint:n,parentTransform:r}=e;const i=Ei.Add(n,h),o=r?ia.applyToPoint(r,i):i;return{id:t.id,type:t.type,x:o.x,y:o.y}}))),{squashing:!0})}({editor:this.editor,shapeSnapshots:e.shapeSnapshots,averagePagePoint:e.averagePagePoint,initialSelectionPageBounds:e.initialPageBounds,initialSelectionSnapPoints:e.initialSnapPoints}),this.handleChange()}}function Qg(e){const t=[],n=[],r=Q(e.selectedShapeIds.map((r=>{const i=e.getShape(r);if(!i)return null;t.push(i);const o=e.getShapePageTransform(r).point();if(!o)return null;n.push(o);return{shape:i,pagePoint:o,parentTransform:Vt.isId(i.parentId)?null:ia.Inverse(e.getShapePageTransform(i.parentId))}})));return{averagePagePoint:Ei.Average(n),movingShapes:t,shapeSnapshots:r,initialPageBounds:e.selectionPageBounds,initialSnapPoints:1===e.selectedShapeIds.length?e.snaps.snapPointsCache.get(e.selectedShapeIds[0]):e.selectionPageBounds?e.selectionPageBounds.snapPoints.map(((e,t)=>({id:"selection:"+t,x:e.x,y:e.y}))):[]}}s(Xg,"id","translating");class Zg extends qc{constructor(){super(...arguments),s(this,"onExit",(()=>{this.editor.currentPageState.editingShapeId&&this.editor.setEditingShape(null)}))}}s(Zg,"id","select"),s(Zg,"initial","idle"),s(Zg,"children",(()=>[Pg,Ig,Og,Ng,Vg,Xg,bg,qg,Fg,Hg,Eg,Tg,Kg,Yg,Ug,Bg,Mg]));class Jg extends qc{constructor(){super(...arguments),s(this,"info",{}),s(this,"onEnter",(e=>{this.info=e})),s(this,"onPointerDown",(()=>{this.parent.transition("pointing",this.info)}))}}s(Jg,"id","idle");class em extends qc{constructor(){super(...arguments),s(this,"info",{}),s(this,"onEnter",(e=>{this.info=e})),s(this,"onPointerUp",(()=>{this.complete()})),s(this,"onPointerMove",(()=>{this.editor.inputs.isDragging&&this.parent.transition("zoom_brushing",this.info)})),s(this,"onCancel",(()=>{this.cancel()}))}complete(){const{currentScreenPoint:e}=this.editor.inputs;this.editor.inputs.altKey?this.editor.zoomOut(e,{duration:220}):this.editor.zoomIn(e,{duration:220}),this.parent.transition("idle",this.info)}cancel(){this.parent.transition("idle",this.info)}}s(em,"id","pointing");class tm extends qc{constructor(){super(...arguments),s(this,"info",{}),s(this,"zoomBrush",new Ti),s(this,"onEnter",(e=>{this.info=e,this.update()})),s(this,"onExit",(()=>{this.editor.updateInstanceState({zoomBrush:null})})),s(this,"onPointerMove",(()=>{this.update()})),s(this,"onPointerUp",(()=>{this.complete()})),s(this,"onCancel",(()=>{this.cancel()}))}update(){const{inputs:{originPagePoint:e,currentPagePoint:t}}=this.editor;this.zoomBrush.setTo(Ti.FromPoints([e,t])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){const{zoomBrush:e}=this,t=8/this.editor.zoomLevel;if(e.width<t&&e.height<t){const e=this.editor.inputs.currentScreenPoint;this.editor.inputs.altKey?this.editor.zoomOut(e,{duration:220}):this.editor.zoomIn(e,{duration:220})}else{const t=this.editor.inputs.altKey?this.editor.zoomLevel/2:void 0;this.editor.zoomToBounds(e,t,{duration:220})}this.parent.transition("idle",this.info)}}s(tm,"id","zoom_brushing");class nm extends qc{constructor(){super(...arguments),s(this,"info",{}),s(this,"onEnter",(e=>{this.info=e,this.currentToolIdMask=e.onInteractionEnd,this.updateCursor()})),s(this,"onExit",(()=>{this.currentToolIdMask=void 0,this.editor.updateInstanceState({zoomBrush:null,cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.currentToolIdMask=void 0})),s(this,"onKeyDown",(()=>{this.updateCursor()})),s(this,"onKeyUp",(e=>{this.updateCursor(),"KeyZ"===e.code&&this.complete()})),s(this,"onInterrupt",(()=>{this.complete()}))}complete(){this.info.onInteractionEnd&&"select"!==this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("select",{})}updateCursor(){this.editor.inputs.altKey?this.editor.updateInstanceState({cursor:{type:"zoom-out",rotation:0}},{ephemeral:!0}):this.editor.updateInstanceState({cursor:{type:"zoom-in",rotation:0}},{ephemeral:!0})}}s(nm,"id","zoom"),s(nm,"initial","idle"),s(nm,"children",(()=>[Jg,tm,em]));const rm=[dg,gg,vg,nm,Zg];function im(){return im=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},im.apply(this,arguments)}function om(e,t){let{checkForDefaultPrevented:n=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function(r){if(null===e||void 0===e||e(r),!1===n||!r.defaultPrevented)return null===t||void 0===t?void 0:t(r)}}function sm(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return e=>t.forEach((t=>function(e,t){"function"===typeof e?e(t):null!==e&&void 0!==e&&(e.current=t)}(t,e)))}function am(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(0,t.useCallback)(sm(...n),n)}function lm(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=[];const i=()=>{const n=r.map((e=>(0,t.createContext)(e)));return function(r){const i=(null===r||void 0===r?void 0:r[e])||n;return(0,t.useMemo)((()=>({["__scope".concat(e)]:{...r,[e]:i}})),[r,i])}};return i.scopeName=e,[function(n,i){const o=(0,t.createContext)(i),s=r.length;function a(n){const{scope:r,children:i,...a}=n,l=(null===r||void 0===r?void 0:r[e][s])||o,c=(0,t.useMemo)((()=>a),Object.values(a));return(0,t.createElement)(l.Provider,{value:c},i)}return r=[...r,i],a.displayName=n+"Provider",[a,function(r,a){const l=(null===a||void 0===a?void 0:a[e][s])||o,c=(0,t.useContext)(l);if(c)return c;if(void 0!==i)return i;throw new Error("`".concat(r,"` must be used within `").concat(n,"`"))}]},cm(i,...n)]}function cm(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];const i=n[0];if(1===n.length)return i;const o=()=>{const e=n.map((e=>({useScope:e(),scopeName:e.scopeName})));return function(n){const r=e.reduce(((e,t)=>{let{useScope:r,scopeName:i}=t;return{...e,...r(n)["__scope".concat(i)]}}),{});return(0,t.useMemo)((()=>({["__scope".concat(i.scopeName)]:r})),[r])}};return o.scopeName=i.scopeName,o}const um=(0,t.forwardRef)(((e,n)=>{const{children:r,...i}=e,o=t.Children.toArray(r),s=o.find(pm);if(s){const e=s.props.children,r=o.map((n=>n===s?t.Children.count(e)>1?t.Children.only(null):(0,t.isValidElement)(e)?e.props.children:null:n));return(0,t.createElement)(dm,im({},i,{ref:n}),(0,t.isValidElement)(e)?(0,t.cloneElement)(e,void 0,r):null)}return(0,t.createElement)(dm,im({},i,{ref:n}),r)}));um.displayName="Slot";const dm=(0,t.forwardRef)(((e,n)=>{const{children:r,...i}=e;return(0,t.isValidElement)(r)?(0,t.cloneElement)(r,{...fm(i,r.props),ref:n?sm(n,r.ref):r.ref}):t.Children.count(r)>1?t.Children.only(null):null}));dm.displayName="SlotClone";const hm=e=>{let{children:n}=e;return(0,t.createElement)(t.Fragment,null,n)};function pm(e){return(0,t.isValidElement)(e)&&e.type===hm}function fm(e,t){const n={...t};for(const r in t){const i=e[r],o=t[r];/^on[A-Z]/.test(r)?i&&o?n[r]=function(){o(...arguments),i(...arguments)}:i&&(n[r]=i):"style"===r?n[r]={...i,...o}:"className"===r&&(n[r]=[i,o].filter(Boolean).join(" "))}return{...e,...n}}function gm(e){const n=e+"CollectionProvider",[r,i]=lm(n),[o,s]=r(n,{collectionRef:{current:null},itemMap:new Map}),a=e=>{const{scope:n,children:r}=e,i=t.useRef(null),s=t.useRef(new Map).current;return t.createElement(o,{scope:n,itemMap:s,collectionRef:i},r)},l=e+"CollectionSlot",c=t.forwardRef(((e,n)=>{const{scope:r,children:i}=e,o=am(n,s(l,r).collectionRef);return t.createElement(um,{ref:o},i)})),u=e+"CollectionItemSlot",d="data-radix-collection-item",h=t.forwardRef(((e,n)=>{const{scope:r,children:i,...o}=e,a=t.useRef(null),l=am(n,a),c=s(u,r);return t.useEffect((()=>(c.itemMap.set(a,{ref:a,...o}),()=>{c.itemMap.delete(a)}))),t.createElement(um,{[d]:"",ref:l},i)}));return[{Provider:a,Slot:c,ItemSlot:h},function(n){const r=s(e+"CollectionConsumer",n),i=t.useCallback((()=>{const e=r.collectionRef.current;if(!e)return[];const t=Array.from(e.querySelectorAll("[".concat(d,"]"))),n=Array.from(r.itemMap.values()).sort(((e,n)=>t.indexOf(e.ref.current)-t.indexOf(n.ref.current)));return n}),[r.collectionRef,r.itemMap]);return i},i]}const mm=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"].reduce(((e,n)=>{const r=(0,t.forwardRef)(((e,r)=>{const{asChild:i,...o}=e,s=i?um:n;return(0,t.useEffect)((()=>{window[Symbol.for("radix-ui")]=!0}),[]),(0,t.createElement)(s,im({},o,{ref:r}))}));return r.displayName="Primitive.".concat(n),{...e,[n]:r}}),{});function ym(t,n){t&&(0,e.flushSync)((()=>t.dispatchEvent(n)))}function vm(e){const n=(0,t.useRef)(e);return(0,t.useEffect)((()=>{n.current=e})),(0,t.useMemo)((()=>function(){for(var e,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return null===(e=n.current)||void 0===e?void 0:e.call(n,...r)}),[])}const bm="dismissableLayer.update",wm="dismissableLayer.pointerDownOutside",xm="dismissableLayer.focusOutside";let Sm;const km=(0,t.createContext)({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),_m=(0,t.forwardRef)(((e,n)=>{var r;const{disableOutsidePointerEvents:i=!1,onEscapeKeyDown:o,onPointerDownOutside:s,onFocusOutside:a,onInteractOutside:l,onDismiss:c,...u}=e,d=(0,t.useContext)(km),[h,p]=(0,t.useState)(null),f=null!==(r=null===h||void 0===h?void 0:h.ownerDocument)&&void 0!==r?r:null===globalThis||void 0===globalThis?void 0:globalThis.document,[,g]=(0,t.useState)({}),m=am(n,(e=>p(e))),y=Array.from(d.layers),[v]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),b=y.indexOf(v),w=h?y.indexOf(h):-1,x=d.layersWithOutsidePointerEventsDisabled.size>0,S=w>=b,k=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null===globalThis||void 0===globalThis?void 0:globalThis.document;const r=vm(e),i=(0,t.useRef)(!1),o=(0,t.useRef)((()=>{}));return(0,t.useEffect)((()=>{const e=e=>{if(e.target&&!i.current){const t={originalEvent:e};function s(){Em(wm,r,t,{discrete:!0})}"touch"===e.pointerType?(n.removeEventListener("click",o.current),o.current=s,n.addEventListener("click",o.current,{once:!0})):s()}else n.removeEventListener("click",o.current);i.current=!1},t=window.setTimeout((()=>{n.addEventListener("pointerdown",e)}),0);return()=>{window.clearTimeout(t),n.removeEventListener("pointerdown",e),n.removeEventListener("click",o.current)}}),[n,r]),{onPointerDownCapture:()=>i.current=!0}}((e=>{const t=e.target,n=[...d.branches].some((e=>e.contains(t)));S&&!n&&(null===s||void 0===s||s(e),null===l||void 0===l||l(e),e.defaultPrevented||null===c||void 0===c||c())}),f),_=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null===globalThis||void 0===globalThis?void 0:globalThis.document;const r=vm(e),i=(0,t.useRef)(!1);return(0,t.useEffect)((()=>{const e=e=>{if(e.target&&!i.current){Em(xm,r,{originalEvent:e},{discrete:!1})}};return n.addEventListener("focusin",e),()=>n.removeEventListener("focusin",e)}),[n,r]),{onFocusCapture:()=>i.current=!0,onBlurCapture:()=>i.current=!1}}((e=>{const t=e.target;[...d.branches].some((e=>e.contains(t)))||(null===a||void 0===a||a(e),null===l||void 0===l||l(e),e.defaultPrevented||null===c||void 0===c||c())}),f);return function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null===globalThis||void 0===globalThis?void 0:globalThis.document;const r=vm(e);(0,t.useEffect)((()=>{const e=e=>{"Escape"===e.key&&r(e)};return n.addEventListener("keydown",e),()=>n.removeEventListener("keydown",e)}),[r,n])}((e=>{w===d.layers.size-1&&(null===o||void 0===o||o(e),!e.defaultPrevented&&c&&(e.preventDefault(),c()))}),f),(0,t.useEffect)((()=>{if(h)return i&&(0===d.layersWithOutsidePointerEventsDisabled.size&&(Sm=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(h)),d.layers.add(h),Cm(),()=>{i&&1===d.layersWithOutsidePointerEventsDisabled.size&&(f.body.style.pointerEvents=Sm)}}),[h,f,i,d]),(0,t.useEffect)((()=>()=>{h&&(d.layers.delete(h),d.layersWithOutsidePointerEventsDisabled.delete(h),Cm())}),[h,d]),(0,t.useEffect)((()=>{const e=()=>g({});return document.addEventListener(bm,e),()=>document.removeEventListener(bm,e)}),[]),(0,t.createElement)(mm.div,im({},u,{ref:m,style:{pointerEvents:x?S?"auto":"none":void 0,...e.style},onFocusCapture:om(e.onFocusCapture,_.onFocusCapture),onBlurCapture:om(e.onBlurCapture,_.onBlurCapture),onPointerDownCapture:om(e.onPointerDownCapture,k.onPointerDownCapture)}))})),Pm=(0,t.forwardRef)(((e,n)=>{const r=(0,t.useContext)(km),i=(0,t.useRef)(null),o=am(n,i);return(0,t.useEffect)((()=>{const e=i.current;if(e)return r.branches.add(e),()=>{r.branches.delete(e)}}),[r.branches]),(0,t.createElement)(mm.div,im({},e,{ref:o}))}));function Cm(){const e=new CustomEvent(bm);document.dispatchEvent(e)}function Em(e,t,n,r){let{discrete:i}=r;const o=n.originalEvent.target,s=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&o.addEventListener(e,t,{once:!0}),i?ym(o,s):o.dispatchEvent(s)}const Im=_m,Mm=Pm,Tm=(0,t.forwardRef)(((n,r)=>{var i;const{container:o=(null===globalThis||void 0===globalThis||null===(i=globalThis.document)||void 0===i?void 0:i.body),...s}=n;return o?e.createPortal((0,t.createElement)(mm.div,im({},s,{ref:r})),o):null})),Am=Boolean(null===globalThis||void 0===globalThis?void 0:globalThis.document)?t.useLayoutEffect:()=>{};const jm=n=>{const{present:r,children:i}=n,o=function(n){const[r,i]=(0,t.useState)(),o=(0,t.useRef)({}),s=(0,t.useRef)(n),a=(0,t.useRef)("none"),l=n?"mounted":"unmounted",[c,u]=function(e,n){return(0,t.useReducer)(((e,t)=>{const r=n[e][t];return null!==r&&void 0!==r?r:e}),e)}(l,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return(0,t.useEffect)((()=>{const e=Om(o.current);a.current="mounted"===c?e:"none"}),[c]),Am((()=>{const e=o.current,t=s.current;if(t!==n){const r=a.current,i=Om(e);if(n)u("MOUNT");else if("none"===i||"none"===(null===e||void 0===e?void 0:e.display))u("UNMOUNT");else{u(t&&r!==i?"ANIMATION_OUT":"UNMOUNT")}s.current=n}}),[n,u]),Am((()=>{if(r){const t=t=>{const n=Om(o.current).includes(t.animationName);t.target===r&&n&&(0,e.flushSync)((()=>u("ANIMATION_END")))},n=e=>{e.target===r&&(a.current=Om(o.current))};return r.addEventListener("animationstart",n),r.addEventListener("animationcancel",t),r.addEventListener("animationend",t),()=>{r.removeEventListener("animationstart",n),r.removeEventListener("animationcancel",t),r.removeEventListener("animationend",t)}}u("ANIMATION_END")}),[r,u]),{isPresent:["mounted","unmountSuspended"].includes(c),ref:(0,t.useCallback)((e=>{e&&(o.current=getComputedStyle(e)),i(e)}),[])}}(r),s="function"===typeof i?i({present:o.isPresent}):t.Children.only(i),a=am(o.ref,s.ref);return"function"===typeof i||o.isPresent?(0,t.cloneElement)(s,{ref:a}):null};function Om(e){return(null===e||void 0===e?void 0:e.animationName)||"none"}function Lm(e){let{prop:n,defaultProp:r,onChange:i=(()=>{})}=e;const[o,s]=function(e){let{defaultProp:n,onChange:r}=e;const i=(0,t.useState)(n),[o]=i,s=(0,t.useRef)(o),a=vm(r);return(0,t.useEffect)((()=>{s.current!==o&&(a(o),s.current=o)}),[o,s,a]),i}({defaultProp:r,onChange:i}),a=void 0!==n,l=a?n:o,c=vm(i);return[l,(0,t.useCallback)((e=>{if(a){const t="function"===typeof e?e(n):e;t!==n&&c(t)}else s(e)}),[a,n,s,c])]}jm.displayName="Presence";const zm=(0,t.forwardRef)(((e,n)=>(0,t.createElement)(mm.span,im({},e,{ref:n,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...e.style}})))),Rm="ToastProvider",[Dm,Nm,Fm]=gm("Toast"),[Bm,Um]=lm("Toast",[Fm]),[Hm,Vm]=Bm(Rm),Km=e=>{const{__scopeToast:n,label:r="Notification",duration:i=5e3,swipeDirection:o="right",swipeThreshold:s=50,children:a}=e,[l,c]=(0,t.useState)(null),[u,d]=(0,t.useState)(0),h=(0,t.useRef)(!1),p=(0,t.useRef)(!1);return(0,t.createElement)(Dm.Provider,{scope:n},(0,t.createElement)(Hm,{scope:n,label:r,duration:i,swipeDirection:o,swipeThreshold:s,toastCount:u,viewport:l,onViewportChange:c,onToastAdd:(0,t.useCallback)((()=>d((e=>e+1))),[]),onToastRemove:(0,t.useCallback)((()=>d((e=>e-1))),[]),isFocusedToastEscapeKeyDownRef:h,isClosePausedRef:p},a))};Km.propTypes={label(e){if(e.label&&"string"===typeof e.label&&!e.label.trim()){const e="Invalid prop `label` supplied to `".concat(Rm,"`. Expected non-empty `string`.");return new Error(e)}return null}};const Wm="ToastViewport",$m=["F8"],Ym="toast.viewportPause",qm="toast.viewportResume",Gm=(0,t.forwardRef)(((e,n)=>{const{__scopeToast:r,hotkey:i=$m,label:o="Notifications ({hotkey})",...s}=e,a=Vm(Wm,r),l=Nm(r),c=(0,t.useRef)(null),u=(0,t.useRef)(null),d=(0,t.useRef)(null),h=(0,t.useRef)(null),p=am(n,h,a.onViewportChange),f=i.join("+").replace(/Key/g,"").replace(/Digit/g,""),g=a.toastCount>0;(0,t.useEffect)((()=>{const e=e=>{var t;i.every((t=>e[t]||e.code===t))&&(null===(t=h.current)||void 0===t||t.focus())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[i]),(0,t.useEffect)((()=>{const e=c.current,t=h.current;if(g&&e&&t){const n=()=>{if(!a.isClosePausedRef.current){const e=new CustomEvent(Ym);t.dispatchEvent(e),a.isClosePausedRef.current=!0}},r=()=>{if(a.isClosePausedRef.current){const e=new CustomEvent(qm);t.dispatchEvent(e),a.isClosePausedRef.current=!1}},i=t=>{!e.contains(t.relatedTarget)&&r()},o=()=>{e.contains(document.activeElement)||r()};return e.addEventListener("focusin",n),e.addEventListener("focusout",i),e.addEventListener("pointermove",n),e.addEventListener("pointerleave",o),window.addEventListener("blur",n),window.addEventListener("focus",r),()=>{e.removeEventListener("focusin",n),e.removeEventListener("focusout",i),e.removeEventListener("pointermove",n),e.removeEventListener("pointerleave",o),window.removeEventListener("blur",n),window.removeEventListener("focus",r)}}}),[g,a.isClosePausedRef]);const m=(0,t.useCallback)((e=>{let{tabbingDirection:t}=e;const n=l().map((e=>{const n=e.ref.current,r=[n,...fy(n)];return"forwards"===t?r:r.reverse()}));return("forwards"===t?n.reverse():n).flat()}),[l]);return(0,t.useEffect)((()=>{const e=h.current;if(e){const t=t=>{const n=t.altKey||t.ctrlKey||t.metaKey;if("Tab"===t.key&&!n){const n=document.activeElement,s=t.shiftKey;var r;if(t.target===e&&s)return void(null===(r=u.current)||void 0===r||r.focus());const a=m({tabbingDirection:s?"backwards":"forwards"}),l=a.findIndex((e=>e===n));var i,o;if(gy(a.slice(l+1)))t.preventDefault();else s?null===(i=u.current)||void 0===i||i.focus():null===(o=d.current)||void 0===o||o.focus()}};return e.addEventListener("keydown",t),()=>e.removeEventListener("keydown",t)}}),[l,m]),(0,t.createElement)(Mm,{ref:c,role:"region","aria-label":o.replace("{hotkey}",f),tabIndex:-1,style:{pointerEvents:g?void 0:"none"}},g&&(0,t.createElement)(Qm,{ref:u,onFocusFromOutsideViewport:()=>{gy(m({tabbingDirection:"forwards"}))}}),(0,t.createElement)(Dm.Slot,{scope:r},(0,t.createElement)(mm.ol,im({tabIndex:-1},s,{ref:p}))),g&&(0,t.createElement)(Qm,{ref:d,onFocusFromOutsideViewport:()=>{gy(m({tabbingDirection:"backwards"}))}}))})),Xm="ToastFocusProxy",Qm=(0,t.forwardRef)(((e,n)=>{const{__scopeToast:r,onFocusFromOutsideViewport:i,...o}=e,s=Vm(Xm,r);return(0,t.createElement)(zm,im({"aria-hidden":!0,tabIndex:0},o,{ref:n,style:{position:"fixed"},onFocus:e=>{var t;const n=e.relatedTarget;!(null!==(t=s.viewport)&&void 0!==t&&t.contains(n))&&i()}}))})),Zm="Toast",Jm=(0,t.forwardRef)(((e,n)=>{const{forceMount:r,open:i,defaultOpen:o,onOpenChange:s,...a}=e,[l=!0,c]=Lm({prop:i,defaultProp:o,onChange:s});return(0,t.createElement)(jm,{present:r||l},(0,t.createElement)(ny,im({open:l},a,{ref:n,onClose:()=>c(!1),onPause:vm(e.onPause),onResume:vm(e.onResume),onSwipeStart:om(e.onSwipeStart,(e=>{e.currentTarget.setAttribute("data-swipe","start")})),onSwipeMove:om(e.onSwipeMove,(e=>{const{x:t,y:n}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","move"),e.currentTarget.style.setProperty("--radix-toast-swipe-move-x","".concat(t,"px")),e.currentTarget.style.setProperty("--radix-toast-swipe-move-y","".concat(n,"px"))})),onSwipeCancel:om(e.onSwipeCancel,(e=>{e.currentTarget.setAttribute("data-swipe","cancel"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")})),onSwipeEnd:om(e.onSwipeEnd,(e=>{const{x:t,y:n}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","end"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.setProperty("--radix-toast-swipe-end-x","".concat(t,"px")),e.currentTarget.style.setProperty("--radix-toast-swipe-end-y","".concat(n,"px")),c(!1)}))})))})),[ey,ty]=Bm(Zm,{onClose(){}}),ny=(0,t.forwardRef)(((n,r)=>{const{__scopeToast:i,type:o="foreground",duration:s,open:a,onClose:l,onEscapeKeyDown:c,onPause:u,onResume:d,onSwipeStart:h,onSwipeMove:p,onSwipeCancel:f,onSwipeEnd:g,...m}=n,y=Vm(Zm,i),[v,b]=(0,t.useState)(null),w=am(r,(e=>b(e))),x=(0,t.useRef)(null),S=(0,t.useRef)(null),k=s||y.duration,_=(0,t.useRef)(0),P=(0,t.useRef)(k),C=(0,t.useRef)(0),{onToastAdd:E,onToastRemove:I}=y,M=vm((()=>{var e;(null===v||void 0===v?void 0:v.contains(document.activeElement))&&(null===(e=y.viewport)||void 0===e||e.focus()),l()})),T=(0,t.useCallback)((e=>{e&&e!==1/0&&(window.clearTimeout(C.current),_.current=(new Date).getTime(),C.current=window.setTimeout(M,e))}),[M]);(0,t.useEffect)((()=>{const e=y.viewport;if(e){const t=()=>{T(P.current),null===d||void 0===d||d()},n=()=>{const e=(new Date).getTime()-_.current;P.current=P.current-e,window.clearTimeout(C.current),null===u||void 0===u||u()};return e.addEventListener(Ym,n),e.addEventListener(qm,t),()=>{e.removeEventListener(Ym,n),e.removeEventListener(qm,t)}}}),[y.viewport,k,u,d,T]),(0,t.useEffect)((()=>{a&&!y.isClosePausedRef.current&&T(k)}),[a,k,y.isClosePausedRef,T]),(0,t.useEffect)((()=>(E(),()=>I())),[E,I]);const A=(0,t.useMemo)((()=>v?dy(v):null),[v]);return y.viewport?(0,t.createElement)(t.Fragment,null,A&&(0,t.createElement)(ry,{__scopeToast:i,role:"status","aria-live":"foreground"===o?"assertive":"polite","aria-atomic":!0},A),(0,t.createElement)(ey,{scope:i,onClose:M},(0,e.createPortal)((0,t.createElement)(Dm.ItemSlot,{scope:i},(0,t.createElement)(Im,{asChild:!0,onEscapeKeyDown:om(c,(()=>{y.isFocusedToastEscapeKeyDownRef.current||M(),y.isFocusedToastEscapeKeyDownRef.current=!1}))},(0,t.createElement)(mm.li,im({role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":a?"open":"closed","data-swipe-direction":y.swipeDirection},m,{ref:w,style:{userSelect:"none",touchAction:"none",...n.style},onKeyDown:om(n.onKeyDown,(e=>{"Escape"===e.key&&(null===c||void 0===c||c(e.nativeEvent),e.nativeEvent.defaultPrevented||(y.isFocusedToastEscapeKeyDownRef.current=!0,M()))})),onPointerDown:om(n.onPointerDown,(e=>{0===e.button&&(x.current={x:e.clientX,y:e.clientY})})),onPointerMove:om(n.onPointerMove,(e=>{if(!x.current)return;const t=e.clientX-x.current.x,n=e.clientY-x.current.y,r=Boolean(S.current),i=["left","right"].includes(y.swipeDirection),o=["left","up"].includes(y.swipeDirection)?Math.min:Math.max,s=i?o(0,t):0,a=i?0:o(0,n),l="touch"===e.pointerType?10:2,c={x:s,y:a},u={originalEvent:e,delta:c};r?(S.current=c,hy("toast.swipeMove",p,u,{discrete:!1})):py(c,y.swipeDirection,l)?(S.current=c,hy("toast.swipeStart",h,u,{discrete:!1}),e.target.setPointerCapture(e.pointerId)):(Math.abs(t)>l||Math.abs(n)>l)&&(x.current=null)})),onPointerUp:om(n.onPointerUp,(e=>{const t=S.current,n=e.target;if(n.hasPointerCapture(e.pointerId)&&n.releasePointerCapture(e.pointerId),S.current=null,x.current=null,t){const n=e.currentTarget,r={originalEvent:e,delta:t};py(t,y.swipeDirection,y.swipeThreshold)?hy("toast.swipeEnd",g,r,{discrete:!0}):hy("toast.swipeCancel",f,r,{discrete:!0}),n.addEventListener("click",(e=>e.preventDefault()),{once:!0})}}))})))),y.viewport))):null}));ny.propTypes={type(e){if(e.type&&!["foreground","background"].includes(e.type)){const e="Invalid prop `type` supplied to `".concat(Zm,"`. Expected `foreground | background`.");return new Error(e)}return null}};const ry=e=>{const{__scopeToast:n,children:r,...i}=e,o=Vm(Zm,n),[s,a]=(0,t.useState)(!1),[l,c]=(0,t.useState)(!1);return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>{};const t=vm(e);Am((()=>{let e=0,n=0;return e=window.requestAnimationFrame((()=>n=window.requestAnimationFrame(t))),()=>{window.cancelAnimationFrame(e),window.cancelAnimationFrame(n)}}),[t])}((()=>a(!0))),(0,t.useEffect)((()=>{const e=window.setTimeout((()=>c(!0)),1e3);return()=>window.clearTimeout(e)}),[]),l?null:(0,t.createElement)(Tm,{asChild:!0},(0,t.createElement)(zm,i,s&&(0,t.createElement)(t.Fragment,null,o.label," ",r)))},iy=(0,t.forwardRef)(((e,n)=>{const{__scopeToast:r,...i}=e;return(0,t.createElement)(mm.div,im({},i,{ref:n}))})),oy=(0,t.forwardRef)(((e,n)=>{const{__scopeToast:r,...i}=e;return(0,t.createElement)(mm.div,im({},i,{ref:n}))})),sy="ToastAction",ay=(0,t.forwardRef)(((e,n)=>{const{altText:r,...i}=e;return r?(0,t.createElement)(uy,{altText:r,asChild:!0},(0,t.createElement)(cy,im({},i,{ref:n}))):null}));ay.propTypes={altText:e=>e.altText?null:new Error("Missing prop `altText` expected on `".concat(sy,"`"))};const ly="ToastClose",cy=(0,t.forwardRef)(((e,n)=>{const{__scopeToast:r,...i}=e,o=ty(ly,r);return(0,t.createElement)(uy,{asChild:!0},(0,t.createElement)(mm.button,im({type:"button"},i,{ref:n,onClick:om(e.onClick,o.onClose)})))})),uy=(0,t.forwardRef)(((e,n)=>{const{__scopeToast:r,altText:i,...o}=e;return(0,t.createElement)(mm.div,im({"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":i||void 0},o,{ref:n}))}));function dy(e){const t=[];return Array.from(e.childNodes).forEach((e=>{if(e.nodeType===e.TEXT_NODE&&e.textContent&&t.push(e.textContent),function(e){return e.nodeType===e.ELEMENT_NODE}(e)){const n=e.ariaHidden||e.hidden||"none"===e.style.display,r=""===e.dataset.radixToastAnnounceExclude;if(!n)if(r){const n=e.dataset.radixToastAnnounceAlt;n&&t.push(n)}else t.push(...dy(e))}})),t}function hy(e,t,n,r){let{discrete:i}=r;const o=n.originalEvent.currentTarget,s=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:n});t&&o.addEventListener(e,t,{once:!0}),i?ym(o,s):o.dispatchEvent(s)}const py=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=Math.abs(e.x),i=Math.abs(e.y),o=r>i;return"left"===t||"right"===t?o&&r>n:!o&&i>n};function fy(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function gy(e){const t=document.activeElement;return e.some((e=>e===t||(e.focus(),document.activeElement!==t)))}const my=Jm,yy=iy,vy=oy,by=ay,wy=cy,xy="2.0.0-canary.3e78b18f728f";let Sy={fonts:{draw:"https://unpkg.com/@tldraw/assets@".concat(xy,"/fonts/Shantell_Sans-Normal-SemiBold.woff2"),serif:"https://unpkg.com/@tldraw/assets@".concat(xy,"/fonts/IBMPlexSerif-Medium.woff2"),sansSerif:"https://unpkg.com/@tldraw/assets@".concat(xy,"/fonts/IBMPlexSans-Medium.woff2"),monospace:"https://unpkg.com/@tldraw/assets@".concat(xy,"/fonts/IBMPlexMono-Medium.woff2")}};let ky={...Sy,icons:Object.fromEntries(["align-bottom-center","align-bottom-left","align-bottom-right","align-bottom","align-center-center","align-center-horizontal","align-center-left","align-center-right","align-center-vertical","align-left","align-right","align-top-center","align-top-left","align-top-right","align-top","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","aspect-ratio","avatar","blob","bring-forward","bring-to-front","check","checkbox-checked","checkbox-empty","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","code","collab","color","comment","cross-2","cross","dash-dashed","dash-dotted","dash-draw","dash-solid","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","drag-handle-dots","duplicate","edit","external-link","file","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","hidden","image","info-circle","leading","link","lock-small","lock","menu","minus","mixed","pack","page","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","ruler","search","send-backward","send-to-back","settings-horizontal","settings-vertical-1","settings-vertical","share-1","share-2","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","status-offline","status-online","stretch-horizontal","stretch-vertical","text-align-center","text-align-justify","text-align-left","text-align-right","tool-arrow","tool-embed","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-text","trash","triangle-down","triangle-up","twitter","undo","ungroup","unlock-small","unlock","vertical-align-center","vertical-align-end","vertical-align-start","visible","warning-triangle","zoom-in","zoom-out"].map((e=>[e,"https://unpkg.com/@tldraw/assets@".concat(xy,"/icons/icon/").concat(e,".svg")]))),translations:Object.fromEntries(Gr.map((e=>[e.locale,"https://unpkg.com/@tldraw/assets@".concat(xy,"/translations/").concat(e.locale,".json")]))),embedIcons:Object.fromEntries(gr.map((e=>[e.type,"https://unpkg.com/@tldraw/assets@".concat(xy,"/embed-icons/").concat(e.type,".png")])))};function _y(e){return e?{fonts:Object.assign({...ky.fonts},{...null===e||void 0===e?void 0:e.fonts}),icons:Object.assign({...ky.icons},{...null===e||void 0===e?void 0:e.icons}),embedIcons:Object.assign({...ky.embedIcons},{...null===e||void 0===e?void 0:e.embedIcons}),translations:Object.assign({...ky.translations},{...null===e||void 0===e?void 0:e.translations})}:ky}const Py=(0,t.createContext)(null);function Cy(e){let{assetUrls:t,children:n}=e;return(0,Zr.jsx)(Py.Provider,{value:t,children:n})}function Ey(){const e=(0,t.useContext)(Py);if(!e)throw new Error("useAssetUrls must be used within an AssetUrlsProvider");return e}const Iy={"action.convert-to-bookmark":"Convert to Bookmark","action.convert-to-embed":"Convert to Embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-json.short":"JSON","action.copy-as-json":"Copy as JSON","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-json.short":"JSON","action.export-as-json":"Export as JSON","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.print":"Print","action.redo":"Redo","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.cloud":"Cloud","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus-2":"Rhombus 2","geo-style.rhombus":"Rhombus","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.asset":"Asset","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","menu.title":"Menu","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.view":"View","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.default-project-name":"Shared Project","share-menu.copy-link":"Copy share link","share-menu.readonly-link":"Read-only","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy read-only link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to view (but not edit) this project.","share-menu.project-too-large":"Sorry, this project can't be shared because it's too large. We're working on it!","share-menu.upload-failed":"Sorry, we couldn't upload your project at the moment. Please try again or let us know if the problem persists.","status.offline":"Offline","status.online":"Online","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following You","people-menu.user":"(You)","people-menu.invite":"Invite others","help-menu.title":"Help and resources","help-menu.about":"About","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the site's URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","edit-pages-dialog.move-down":"Move down","edit-pages-dialog.move-up":"Move up","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","home-project-dialog.title":"Home project","home-project-dialog.description":"This is your local home project. It's just for you!","rename-project-dialog.title":"Rename project","rename-project-dialog.cancel":"Cancel","rename-project-dialog.rename":"Rename","home-project-dialog.ok":"Ok","style-panel.title":"Styles","style-panel.align":"Align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrows","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","tool-panel.drawing":"Drawing","tool-panel.shapes":"Shapes","tool-panel.more":"More","debug-panel.more":"More","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesn't look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Don't ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Don't ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Don't ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"We've updated this document to work with the current version of tldraw. If you'd like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Don't ask again","cursor-chat.type-to-chat":"Type to chat..."},My={locale:"en",label:"English",messages:Iy};const Ty=t.createContext({}),Ay=()=>t.useContext(Ty),jy=W((function(e){let{overrides:n,children:r}=e;const i=di().user.locale,o=Ey(),[s,a]=t.useState((()=>n&&n.en?{locale:"en",label:"English",messages:{...Iy,...n.en}}:{locale:"en",label:"English",messages:Iy}));return t.useEffect((()=>{let e=!1;return async function(){const t=await async function(e,t){if(!(await fetch(t.translations.en)).ok)return console.warn("No main translations found."),My;if("en"===e)return My;const n=Gr.find((t=>t.locale===e));if(!n)return console.warn("No translation found for locale ".concat(e)),My;const r=await fetch(t.translations[n.locale]),i=await r.json();if(!i)return console.warn("No messages found for locale ".concat(e)),My;const o=[];for(const s in My.messages)i[s]||o.push(s);return o.length,{locale:e,label:n.label,messages:{...My.messages,...i}}}(i,o);t&&!e&&(n&&n[i]?a({...t,messages:{...t.messages,...n[i]}}):a(t))}(),()=>{e=!0}}),[o,i,n]),(0,Zr.jsx)(Ty.Provider,{value:s,children:r})}));function Oy(){const e=Ay();return t.useCallback((function(t){var n;return null!==(n=e.messages[t])&&void 0!==n?n:t}),[e])}function Ly(e){return(0,Zr.jsx)("svg",{width:16,height:16,viewBox:"0 0 16 16",...e,children:(0,Zr.jsxs)("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[(0,Zr.jsx)("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),(0,Zr.jsx)("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:(0,Zr.jsx)("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}const zy=(0,t.memo)((function(e){let{small:n,invertIcon:r,icon:i,color:o,className:s,...a}=e;const l=Ey().icons[i],c=(0,t.useRef)(null);return(0,t.useLayoutEffect)((()=>{null!==c&&void 0!==c&&c.current&&(c.current.style.webkitMask="url(".concat(l,") center 100% / 100% no-repeat"))}),[c,l]),(0,Zr.jsx)("div",{...a,ref:c,className:Jr("tlui-icon",{"tlui-icon__small":n},s),style:{color:o,mask:"url(".concat(l,") center 100% / 100% no-repeat"),transform:r?"scale(-1, 1)":void 0}})}));const Ry="undefined"!==typeof window&&window.navigator.userAgent.toLowerCase().indexOf("mac")>-1,Dy=Ry?"\u2318":"Ctrl",Ny=Ry?"\u2325":"Alt";function Fy(e){return"\u2014 "+e.split(",")[0].split("").map((e=>{const t=e.replace(/\$/g,Dy).replace(/\?/g,Ny).replace(/!/g,"\u21e7");return t[0].toUpperCase()+t.slice(1)})).join("\u2009")}function By(e){let{children:t}=e;return(0,Zr.jsx)("kbd",{className:"tlui-kbd",children:(n=t,n.split(",")[0].split("").map((e=>{const t=e.replace(/\$/g,Dy).replace(/\?/g,Ny).replace(/!/g,"\u21e7");return t[0].toUpperCase()+t.slice(1)}))).map(((e,t)=>(0,Zr.jsx)("span",{children:e},t)))});var n}const Uy=t.forwardRef((function(e,t){var n;let{label:r,icon:i,invertIcon:o,iconLeft:s,smallIcon:a,kbd:l,isChecked:c=!1,type:u,children:d,spinner:h,...p}=e;const f=Oy(),g=r?f(r):"";return(0,Zr.jsxs)("button",{ref:t,draggable:!1,type:"button",...p,title:null!==(n=p.title)&&void 0!==n?n:g,className:Jr("tlui-button","tlui-button__".concat(u),p.className),children:[s&&(0,Zr.jsx)(zy,{icon:s,className:"tlui-button__icon-left",small:!0}),d,r&&(0,Zr.jsxs)("span",{className:"tlui-button__label",draggable:!1,children:[g,c&&(0,Zr.jsx)(zy,{icon:"check"})]}),l&&(0,Zr.jsx)(By,{children:l}),i&&!h&&(0,Zr.jsx)(zy,{icon:i,small:!!r||a,invertIcon:o}),h&&(0,Zr.jsx)(Ly,{})]})})),Hy=r["useId".toString()]||(()=>{});let Vy=0;function Ky(e){const[n,r]=t.useState(Hy());return Am((()=>{e||r((e=>null!==e&&void 0!==e?e:String(Vy++)))}),[e]),e||(n?"radix-".concat(n):"")}const Wy="focusScope.autoFocusOnMount",$y="focusScope.autoFocusOnUnmount",Yy={bubbles:!1,cancelable:!0},qy=(0,t.forwardRef)(((e,n)=>{const{loop:r=!1,trapped:i=!1,onMountAutoFocus:o,onUnmountAutoFocus:s,...a}=e,[l,c]=(0,t.useState)(null),u=vm(o),d=vm(s),h=(0,t.useRef)(null),p=am(n,(e=>c(e))),f=(0,t.useRef)({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;(0,t.useEffect)((()=>{if(i){function e(e){if(f.paused||!l)return;const t=e.target;l.contains(t)?h.current=t:Zy(h.current,{select:!0})}function t(e){if(f.paused||!l)return;const t=e.relatedTarget;null!==t&&(l.contains(t)||Zy(h.current,{select:!0}))}function n(e){if(document.activeElement===document.body)for(const t of e)t.removedNodes.length>0&&Zy(l)}document.addEventListener("focusin",e),document.addEventListener("focusout",t);const r=new MutationObserver(n);return l&&r.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",e),document.removeEventListener("focusout",t),r.disconnect()}}}),[i,l,f.paused]),(0,t.useEffect)((()=>{if(l){Jy.add(f);const t=document.activeElement;if(!l.contains(t)){const n=new CustomEvent(Wy,Yy);l.addEventListener(Wy,u),l.dispatchEvent(n),n.defaultPrevented||(!function(e){let{select:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=document.activeElement;for(const r of e)if(Zy(r,{select:t}),document.activeElement!==n)return}((e=Gy(l),e.filter((e=>"A"!==e.tagName))),{select:!0}),document.activeElement===t&&Zy(l))}return()=>{l.removeEventListener(Wy,u),setTimeout((()=>{const e=new CustomEvent($y,Yy);l.addEventListener($y,d),l.dispatchEvent(e),e.defaultPrevented||Zy(null!==t&&void 0!==t?t:document.body,{select:!0}),l.removeEventListener($y,d),Jy.remove(f)}),0)}}var e}),[l,u,d,f]);const g=(0,t.useCallback)((e=>{if(!r&&!i)return;if(f.paused)return;const t="Tab"===e.key&&!e.altKey&&!e.ctrlKey&&!e.metaKey,n=document.activeElement;if(t&&n){const t=e.currentTarget,[i,o]=function(e){const t=Gy(e),n=Xy(t,e),r=Xy(t.reverse(),e);return[n,r]}(t);i&&o?e.shiftKey||n!==o?e.shiftKey&&n===i&&(e.preventDefault(),r&&Zy(o,{select:!0})):(e.preventDefault(),r&&Zy(i,{select:!0})):n===t&&e.preventDefault()}}),[r,i,f.paused]);return(0,t.createElement)(mm.div,im({tabIndex:-1},a,{ref:p,onKeyDown:g}))}));function Gy(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function Xy(e,t){for(const n of e)if(!Qy(n,{upTo:t}))return n}function Qy(e,t){let{upTo:n}=t;if("hidden"===getComputedStyle(e).visibility)return!0;for(;e;){if(void 0!==n&&e===n)return!1;if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1}function Zy(e){let{select:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&function(e){return e instanceof HTMLInputElement&&"select"in e}(e)&&t&&e.select()}}const Jy=function(){let e=[];return{add(t){const n=e[0];t!==n&&(null===n||void 0===n||n.pause()),e=ev(e,t),e.unshift(t)},remove(t){var n;e=ev(e,t),null===(n=e[0])||void 0===n||n.resume()}}}();function ev(e,t){const n=[...e],r=n.indexOf(t);return-1!==r&&n.splice(r,1),n}let tv=0;function nv(){(0,t.useEffect)((()=>{var e,t;const n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",null!==(e=n[0])&&void 0!==e?e:rv()),document.body.insertAdjacentElement("beforeend",null!==(t=n[1])&&void 0!==t?t:rv()),tv++,()=>{1===tv&&document.querySelectorAll("[data-radix-focus-guard]").forEach((e=>e.remove())),tv--}}),[])}function rv(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",e}var iv=function(){return iv=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},iv.apply(this,arguments)};function ov(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}Object.create;function sv(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}Object.create;"function"===typeof SuppressedError&&SuppressedError;var av="right-scroll-bar-position",lv="width-before-scroll-bar";function cv(e,n){return function(e,n){var r=(0,t.useState)((function(){return{value:e,callback:n,facade:{get current(){return r.value},set current(e){var t=r.value;t!==e&&(r.value=e,r.callback(e,t))}}}}))[0];return r.callback=n,r.facade}(n||null,(function(t){return e.forEach((function(e){return function(e,t){return"function"===typeof e?e(t):e&&(e.current=t),e}(e,t)}))}))}function uv(e){return e}function dv(e,t){void 0===t&&(t=uv);var n=[],r=!1,i={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:e},useMedium:function(e){var i=t(e,r);return n.push(i),function(){n=n.filter((function(e){return e!==i}))}},assignSyncMedium:function(e){for(r=!0;n.length;){var t=n;n=[],t.forEach(e)}n={push:function(t){return e(t)},filter:function(){return n}}},assignMedium:function(e){r=!0;var t=[];if(n.length){var i=n;n=[],i.forEach(e),t=n}var o=function(){var n=t;t=[],n.forEach(e)},s=function(){return Promise.resolve().then(o)};s(),n={push:function(e){t.push(e),s()},filter:function(e){return t=t.filter(e),n}}}};return i}var hv=function(e){void 0===e&&(e={});var t=dv(null);return t.options=iv({async:!0,ssr:!1},e),t}(),pv=function(){},fv=t.forwardRef((function(e,n){var r=t.useRef(null),i=t.useState({onScrollCapture:pv,onWheelCapture:pv,onTouchMoveCapture:pv}),o=i[0],s=i[1],a=e.forwardProps,l=e.children,c=e.className,u=e.removeScrollBar,d=e.enabled,h=e.shards,p=e.sideCar,f=e.noIsolation,g=e.inert,m=e.allowPinchZoom,y=e.as,v=void 0===y?"div":y,b=ov(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as"]),w=p,x=cv([r,n]),S=iv(iv({},b),o);return t.createElement(t.Fragment,null,d&&t.createElement(w,{sideCar:hv,removeScrollBar:u,shards:h,noIsolation:f,inert:g,setCallbacks:s,allowPinchZoom:!!m,lockRef:r}),a?t.cloneElement(t.Children.only(l),iv(iv({},S),{ref:x})):t.createElement(v,iv({},S,{className:c,ref:x}),l))}));fv.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},fv.classNames={fullWidth:lv,zeroRight:av};var gv,mv=function(e){var n=e.sideCar,r=ov(e,["sideCar"]);if(!n)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var i=n.read();if(!i)throw new Error("Sidecar medium not found");return t.createElement(i,iv({},r))};mv.isSideCarExport=!0;function yv(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=gv||n.nc;return t&&e.setAttribute("nonce",t),e}var vv=function(){var e=0,t=null;return{add:function(n){var r,i;0==e&&(t=yv())&&(i=n,(r=t).styleSheet?r.styleSheet.cssText=i:r.appendChild(document.createTextNode(i)),function(e){(document.head||document.getElementsByTagName("head")[0]).appendChild(e)}(t)),e++},remove:function(){! --e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},bv=function(){var e=function(){var e=vv();return function(n,r){t.useEffect((function(){return e.add(n),function(){e.remove()}}),[n&&r])}}();return function(t){var n=t.styles,r=t.dynamic;return e(n,r),null}},wv={left:0,top:0,right:0,gap:0},xv=function(e){return parseInt(e||"",10)||0},Sv=function(e){if(void 0===e&&(e="margin"),"undefined"===typeof window)return wv;var t=function(e){var t=window.getComputedStyle(document.body),n=t["padding"===e?"paddingLeft":"marginLeft"],r=t["padding"===e?"paddingTop":"marginTop"],i=t["padding"===e?"paddingRight":"marginRight"];return[xv(n),xv(r),xv(i)]}(e),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,r-n+t[2]-t[0])}},kv=bv(),_v=function(e,t,n,r){var i=e.left,o=e.top,s=e.right,a=e.gap;return void 0===n&&(n="margin"),"\n  .".concat("with-scroll-bars-hidden"," {\n   overflow: hidden ").concat(r,";\n   padding-right: ").concat(a,"px ").concat(r,";\n  }\n  body {\n    overflow: hidden ").concat(r,";\n    overscroll-behavior: contain;\n    ").concat([t&&"position: relative ".concat(r,";"),"margin"===n&&"\n    padding-left: ".concat(i,"px;\n    padding-top: ").concat(o,"px;\n    padding-right: ").concat(s,"px;\n    margin-left:0;\n    margin-top:0;\n    margin-right: ").concat(a,"px ").concat(r,";\n    "),"padding"===n&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),"\n  }\n  \n  .").concat(av," {\n    right: ").concat(a,"px ").concat(r,";\n  }\n  \n  .").concat(lv," {\n    margin-right: ").concat(a,"px ").concat(r,";\n  }\n  \n  .").concat(av," .").concat(av," {\n    right: 0 ").concat(r,";\n  }\n  \n  .").concat(lv," .").concat(lv," {\n    margin-right: 0 ").concat(r,";\n  }\n  \n  body {\n    ").concat("--removed-body-scroll-bar-size",": ").concat(a,"px;\n  }\n")},Pv=function(e){var n=e.noRelative,r=e.noImportant,i=e.gapMode,o=void 0===i?"margin":i,s=t.useMemo((function(){return Sv(o)}),[o]);return t.createElement(kv,{styles:_v(s,!n,o,r?"":"!important")})},Cv=!1;if("undefined"!==typeof window)try{var Ev=Object.defineProperty({},"passive",{get:function(){return Cv=!0,!0}});window.addEventListener("test",Ev,Ev),window.removeEventListener("test",Ev,Ev)}catch(hA){Cv=!1}var Iv=!!Cv&&{passive:!1},Mv=function(e,t){var n=window.getComputedStyle(e);return"hidden"!==n[t]&&!(n.overflowY===n.overflowX&&!function(e){return"TEXTAREA"===e.tagName}(e)&&"visible"===n[t])},Tv=function(e,t){var n=t;do{if("undefined"!==typeof ShadowRoot&&n instanceof ShadowRoot&&(n=n.host),Av(e,n)){var r=jv(e,n);if(r[1]>r[2])return!0}n=n.parentNode}while(n&&n!==document.body);return!1},Av=function(e,t){return"v"===e?function(e){return Mv(e,"overflowY")}(t):function(e){return Mv(e,"overflowX")}(t)},jv=function(e,t){return"v"===e?[(n=t).scrollTop,n.scrollHeight,n.clientHeight]:function(e){return[e.scrollLeft,e.scrollWidth,e.clientWidth]}(t);var n},Ov=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},Lv=function(e){return[e.deltaX,e.deltaY]},zv=function(e){return e&&"current"in e?e.current:e},Rv=function(e){return"\n  .block-interactivity-".concat(e," {pointer-events: none;}\n  .allow-interactivity-").concat(e," {pointer-events: all;}\n")},Dv=0,Nv=[];const Fv=(Bv=function(e){var n=t.useRef([]),r=t.useRef([0,0]),i=t.useRef(),o=t.useState(Dv++)[0],s=t.useState((function(){return bv()}))[0],a=t.useRef(e);t.useEffect((function(){a.current=e}),[e]),t.useEffect((function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(o));var t=sv([e.lockRef.current],(e.shards||[]).map(zv),!0).filter(Boolean);return t.forEach((function(e){return e.classList.add("allow-interactivity-".concat(o))})),function(){document.body.classList.remove("block-interactivity-".concat(o)),t.forEach((function(e){return e.classList.remove("allow-interactivity-".concat(o))}))}}}),[e.inert,e.lockRef.current,e.shards]);var l=t.useCallback((function(e,t){if("touches"in e&&2===e.touches.length)return!a.current.allowPinchZoom;var n,o=Ov(e),s=r.current,l="deltaX"in e?e.deltaX:s[0]-o[0],c="deltaY"in e?e.deltaY:s[1]-o[1],u=e.target,d=Math.abs(l)>Math.abs(c)?"h":"v";if("touches"in e&&"h"===d&&"range"===u.type)return!1;var h=Tv(d,u);if(!h)return!0;if(h?n=d:(n="v"===d?"h":"v",h=Tv(d,u)),!h)return!1;if(!i.current&&"changedTouches"in e&&(l||c)&&(i.current=n),!n)return!0;var p=i.current||n;return function(e,t,n,r,i){var o=function(e,t){return"h"===e&&"rtl"===t?-1:1}(e,window.getComputedStyle(t).direction),s=o*r,a=n.target,l=t.contains(a),c=!1,u=s>0,d=0,h=0;do{var p=jv(e,a),f=p[0],g=p[1]-p[2]-o*f;(f||g)&&Av(e,a)&&(d+=g,h+=f),a=a.parentNode}while(!l&&a!==document.body||l&&(t.contains(a)||t===a));return(u&&(i&&0===d||!i&&s>d)||!u&&(i&&0===h||!i&&-s>h))&&(c=!0),c}(p,t,e,"h"===p?l:c,!0)}),[]),c=t.useCallback((function(e){var t=e;if(Nv.length&&Nv[Nv.length-1]===s){var r="deltaY"in t?Lv(t):Ov(t),i=n.current.filter((function(e){return e.name===t.type&&e.target===t.target&&(n=e.delta,i=r,n[0]===i[0]&&n[1]===i[1]);var n,i}))[0];if(i&&i.should)t.cancelable&&t.preventDefault();else if(!i){var o=(a.current.shards||[]).map(zv).filter(Boolean).filter((function(e){return e.contains(t.target)}));(o.length>0?l(t,o[0]):!a.current.noIsolation)&&t.cancelable&&t.preventDefault()}}}),[]),u=t.useCallback((function(e,t,r,i){var o={name:e,delta:t,target:r,should:i};n.current.push(o),setTimeout((function(){n.current=n.current.filter((function(e){return e!==o}))}),1)}),[]),d=t.useCallback((function(e){r.current=Ov(e),i.current=void 0}),[]),h=t.useCallback((function(t){u(t.type,Lv(t),t.target,l(t,e.lockRef.current))}),[]),p=t.useCallback((function(t){u(t.type,Ov(t),t.target,l(t,e.lockRef.current))}),[]);t.useEffect((function(){return Nv.push(s),e.setCallbacks({onScrollCapture:h,onWheelCapture:h,onTouchMoveCapture:p}),document.addEventListener("wheel",c,Iv),document.addEventListener("touchmove",c,Iv),document.addEventListener("touchstart",d,Iv),function(){Nv=Nv.filter((function(e){return e!==s})),document.removeEventListener("wheel",c,Iv),document.removeEventListener("touchmove",c,Iv),document.removeEventListener("touchstart",d,Iv)}}),[]);var f=e.removeScrollBar,g=e.inert;return t.createElement(t.Fragment,null,g?t.createElement(s,{styles:Rv(o)}):null,f?t.createElement(Pv,{gapMode:"margin"}):null)},hv.useMedium(Bv),mv);var Bv,Uv=t.forwardRef((function(e,n){return t.createElement(fv,iv({},e,{ref:n,sideCar:Fv}))}));Uv.classNames=fv.classNames;const Hv=Uv;var Vv=function(e){return"undefined"===typeof document?null:(Array.isArray(e)?e[0]:e).ownerDocument.body},Kv=new WeakMap,Wv=new WeakMap,$v={},Yv=0,qv=function(e){return e&&(e.host||qv(e.parentNode))},Gv=function(e,t,n,r){var i=function(e,t){return t.map((function(t){if(e.contains(t))return t;var n=qv(t);return n&&e.contains(n)?n:(console.error("aria-hidden",t,"in not contained inside",e,". Doing nothing"),null)})).filter((function(e){return Boolean(e)}))}(t,Array.isArray(e)?e:[e]);$v[n]||($v[n]=new WeakMap);var o=$v[n],s=[],a=new Set,l=new Set(i),c=function(e){e&&!a.has(e)&&(a.add(e),c(e.parentNode))};i.forEach(c);var u=function(e){e&&!l.has(e)&&Array.prototype.forEach.call(e.children,(function(e){if(a.has(e))u(e);else{var t=e.getAttribute(r),i=null!==t&&"false"!==t,l=(Kv.get(e)||0)+1,c=(o.get(e)||0)+1;Kv.set(e,l),o.set(e,c),s.push(e),1===l&&i&&Wv.set(e,!0),1===c&&e.setAttribute(n,"true"),i||e.setAttribute(r,"true")}}))};return u(t),a.clear(),Yv++,function(){s.forEach((function(e){var t=Kv.get(e)-1,i=o.get(e)-1;Kv.set(e,t),o.set(e,i),t||(Wv.has(e)||e.removeAttribute(r),Wv.delete(e)),i||e.removeAttribute(n)})),--Yv||(Kv=new WeakMap,Kv=new WeakMap,Wv=new WeakMap,$v={})}},Xv=function(e,t,n){void 0===n&&(n="data-aria-hidden");var r=Array.from(Array.isArray(e)?e:[e]),i=t||Vv(e);return i?(r.push.apply(r,Array.from(i.querySelectorAll("[aria-live]"))),Gv(r,i,n,"aria-hidden")):function(){return null}};const Qv="Dialog",[Zv,Jv]=lm(Qv),[eb,tb]=Zv(Qv),nb=e=>{const{__scopeDialog:n,children:r,open:i,defaultOpen:o,onOpenChange:s,modal:a=!0}=e,l=(0,t.useRef)(null),c=(0,t.useRef)(null),[u=!1,d]=Lm({prop:i,defaultProp:o,onChange:s});return(0,t.createElement)(eb,{scope:n,triggerRef:l,contentRef:c,contentId:Ky(),titleId:Ky(),descriptionId:Ky(),open:u,onOpenChange:d,onOpenToggle:(0,t.useCallback)((()=>d((e=>!e))),[d]),modal:a},r)},rb="DialogPortal",[ib,ob]=Zv(rb,{forceMount:void 0}),sb=e=>{const{__scopeDialog:n,forceMount:r,children:i,container:o}=e,s=tb(rb,n);return(0,t.createElement)(ib,{scope:n,forceMount:r},t.Children.map(i,(e=>(0,t.createElement)(jm,{present:r||s.open},(0,t.createElement)(Tm,{asChild:!0,container:o},e)))))},ab="DialogOverlay",lb=(0,t.forwardRef)(((e,n)=>{const r=ob(ab,e.__scopeDialog),{forceMount:i=r.forceMount,...o}=e,s=tb(ab,e.__scopeDialog);return s.modal?(0,t.createElement)(jm,{present:i||s.open},(0,t.createElement)(cb,im({},o,{ref:n}))):null})),cb=(0,t.forwardRef)(((e,n)=>{const{__scopeDialog:r,...i}=e,o=tb(ab,r);return(0,t.createElement)(Hv,{as:um,allowPinchZoom:!0,shards:[o.contentRef]},(0,t.createElement)(mm.div,im({"data-state":bb(o.open)},i,{ref:n,style:{pointerEvents:"auto",...i.style}})))})),ub="DialogContent",db=(0,t.forwardRef)(((e,n)=>{const r=ob(ub,e.__scopeDialog),{forceMount:i=r.forceMount,...o}=e,s=tb(ub,e.__scopeDialog);return(0,t.createElement)(jm,{present:i||s.open},s.modal?(0,t.createElement)(hb,im({},o,{ref:n})):(0,t.createElement)(pb,im({},o,{ref:n})))})),hb=(0,t.forwardRef)(((e,n)=>{const r=tb(ub,e.__scopeDialog),i=(0,t.useRef)(null),o=am(n,r.contentRef,i);return(0,t.useEffect)((()=>{const e=i.current;if(e)return Xv(e)}),[]),(0,t.createElement)(fb,im({},e,{ref:o,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:om(e.onCloseAutoFocus,(e=>{var t;e.preventDefault(),null===(t=r.triggerRef.current)||void 0===t||t.focus()})),onPointerDownOutside:om(e.onPointerDownOutside,(e=>{const t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey;(2===t.button||n)&&e.preventDefault()})),onFocusOutside:om(e.onFocusOutside,(e=>e.preventDefault()))}))})),pb=(0,t.forwardRef)(((e,n)=>{const r=tb(ub,e.__scopeDialog),i=(0,t.useRef)(!1),o=(0,t.useRef)(!1);return(0,t.createElement)(fb,im({},e,{ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{var n,s;(null===(n=e.onCloseAutoFocus)||void 0===n||n.call(e,t),t.defaultPrevented)||(i.current||null===(s=r.triggerRef.current)||void 0===s||s.focus(),t.preventDefault());i.current=!1,o.current=!1},onInteractOutside:t=>{var n,s;null===(n=e.onInteractOutside)||void 0===n||n.call(e,t),t.defaultPrevented||(i.current=!0,"pointerdown"===t.detail.originalEvent.type&&(o.current=!0));const a=t.target;(null===(s=r.triggerRef.current)||void 0===s?void 0:s.contains(a))&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&o.current&&t.preventDefault()}}))})),fb=(0,t.forwardRef)(((e,n)=>{const{__scopeDialog:r,trapFocus:i,onOpenAutoFocus:o,onCloseAutoFocus:s,...a}=e,l=tb(ub,r),c=am(n,(0,t.useRef)(null));return nv(),(0,t.createElement)(t.Fragment,null,(0,t.createElement)(qy,{asChild:!0,loop:!0,trapped:i,onMountAutoFocus:o,onUnmountAutoFocus:s},(0,t.createElement)(_m,im({role:"dialog",id:l.contentId,"aria-describedby":l.descriptionId,"aria-labelledby":l.titleId,"data-state":bb(l.open)},a,{ref:c,onDismiss:()=>l.onOpenChange(!1)}))),!1)})),gb="DialogTitle",mb=(0,t.forwardRef)(((e,n)=>{const{__scopeDialog:r,...i}=e,o=tb(gb,r);return(0,t.createElement)(mm.h2,im({id:o.titleId},i,{ref:n}))})),yb="DialogClose",vb=(0,t.forwardRef)(((e,n)=>{const{__scopeDialog:r,...i}=e,o=tb(yb,r);return(0,t.createElement)(mm.button,im({type:"button"},i,{ref:n,onClick:om(e.onClick,(()=>o.onOpenChange(!1)))}))}));function bb(e){return e?"open":"closed"}const wb="DialogTitleWarning",[xb,Sb]=function(e,n){const r=(0,t.createContext)(n);function i(e){const{children:n,...i}=e,o=(0,t.useMemo)((()=>i),Object.values(i));return(0,t.createElement)(r.Provider,{value:o},n)}return i.displayName=e+"Provider",[i,function(i){const o=(0,t.useContext)(r);if(o)return o;if(void 0!==n)return n;throw new Error("`".concat(i,"` must be used within `").concat(e,"`"))}]}(wb,{contentName:ub,titleName:gb,docsSlug:"dialog"}),kb=nb,_b=sb,Pb=lb,Cb=db;function Eb(e){let{className:t,children:n}=e;return(0,Zr.jsx)("div",{className:Jr("tlui-dialog__header",t),children:n})}function Ib(e){let{className:t,children:n}=e;return(0,Zr.jsx)(mb,{dir:"ltr",className:Jr("tlui-dialog__header__title",t),children:n})}function Mb(){return(0,Zr.jsx)("div",{className:"tlui-dialog__header__close",children:(0,Zr.jsx)(vb,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:(0,Zr.jsx)(Uy,{type:"icon","aria-label":"Close",onTouchEnd:e=>e.target.click(),children:(0,Zr.jsx)(zy,{small:!0,icon:"cross-2"})})})})}function Tb(e){let{className:t,children:n,style:r}=e;return(0,Zr.jsx)("div",{className:Jr("tlui-dialog__body",t),style:r,children:n})}function Ab(e){let{className:t,children:n}=e;return(0,Zr.jsx)("div",{className:Jr("tlui-dialog__footer",t),children:n})}const jb=t.forwardRef((function(e,n){let{className:r,label:i,icon:o,iconLeft:s,autoselect:a=!1,autofocus:l=!1,defaultValue:c,placeholder:u,onComplete:d,onValueChange:h,onCancel:p,onBlur:f,shouldManuallyMaintainScrollPositionWhenFocused:g=!1,children:m,value:y}=e;const v=di(),b=t.useRef(null);t.useImperativeHandle(n,(()=>b.current));const w=Oy(),x=t.useRef(null!==c&&void 0!==c?c:""),S=t.useRef(null!==c&&void 0!==c?c:""),[k,_]=t.useState(!1),P=t.useCallback((e=>{_(!0);const t=e.currentTarget;S.current=t.value,requestAnimationFrame((()=>{a&&t.select()}))}),[a]),C=t.useCallback((e=>{const t=e.currentTarget.value;S.current=t,null===h||void 0===h||h(t)}),[h]),E=t.useCallback((e=>{switch(e.key){case"Enter":e.currentTarget.blur(),li(e),null===d||void 0===d||d(e.currentTarget.value);break;case"Escape":e.currentTarget.value=x.current,e.currentTarget.blur(),li(e),null===p||void 0===p||p(e.currentTarget.value)}}),[d,p]),I=t.useCallback((e=>{_(!1);const t=e.currentTarget.value;null===f||void 0===f||f(t)}),[f]);return t.useEffect((()=>{if(!v.environment.isIos)return;const e=window.visualViewport;if(k&&g&&e){const t=()=>{var e;null===(e=b.current)||void 0===e||e.scrollIntoView({block:"center"})};return e.addEventListener("resize",t),e.addEventListener("scroll",t),requestAnimationFrame((()=>{var e;null===(e=b.current)||void 0===e||e.scrollIntoView({block:"center"})})),()=>{e.removeEventListener("resize",t),e.removeEventListener("scroll",t)}}}),[v,k,g]),(0,Zr.jsxs)("div",{draggable:!1,className:"tlui-input__wrapper",children:[m,i&&(0,Zr.jsx)("label",{children:w(i)}),s&&(0,Zr.jsx)(zy,{icon:s,className:"tlui-icon-left",small:!0}),(0,Zr.jsx)("input",{ref:b,className:Jr("tlui-input",r),type:"text",defaultValue:c,onKeyUp:E,onChange:C,onFocus:P,onBlur:I,autoFocus:l,placeholder:u,value:y}),o&&(0,Zr.jsx)(zy,{icon:o,small:!!i})]})}));function Ob(e){return Me(e)?{isValid:!0,hasProtocol:!0}:Me("https://"+e)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}const Lb=W((function(e){let{onClose:t}=e;const n=di().onlySelectedShape;return n&&"url"in n.props&&"string"===typeof n.props.url?(0,Zr.jsx)(zb,{onClose:t,selectedShape:n}):null})),zb=W((function(e){let{onClose:n,selectedShape:r}=e;const i=di(),o=Oy(),s=(0,t.useRef)(null);(0,t.useEffect)((()=>{requestAnimationFrame((()=>{var e;return null===(e=s.current)||void 0===e?void 0:e.focus()}))}),[]);const a=(0,t.useRef)(r.props.url),[l,c]=(0,t.useState)((()=>{const e=Ob(r.props.url),t=!0===e.isValid?e.hasProtocol?r.props.url:"https://"+r.props.url:"https://";return{actual:t,safe:t,valid:!0}})),u=(0,t.useCallback)((e=>{const t=e.replace(/https?:\/\/(https?:\/\/)/,((e,t)=>t)),n=Ob(t),r=!0===n.isValid?n.hasProtocol?t:"https://"+t:"https://";c({actual:t,safe:r,valid:n.isValid})}),[]),d=(0,t.useCallback)((()=>{const{onlySelectedShape:e}=i;e&&(i.updateShapes([{id:e.id,type:e.type,props:{url:""}}]),n())}),[i,n]),h=(0,t.useCallback)((()=>{const{onlySelectedShape:e}=i;e&&(e&&"url"in e.props&&e.props.url!==l.safe&&i.updateShapes([{id:e.id,type:e.type,props:{url:l.safe}}]),n())}),[i,n,l]),p=(0,t.useCallback)((()=>{n()}),[n]);if(!r)return n(),null;const f=a.current&&!l.valid;return(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsxs)(Eb,{children:[(0,Zr.jsx)(Ib,{children:o("edit-link-dialog.title")}),(0,Zr.jsx)(Mb,{})]}),(0,Zr.jsx)(Tb,{children:(0,Zr.jsxs)("div",{className:"tlui-edit-link-dialog",children:[(0,Zr.jsx)(jb,{ref:s,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autofocus:!0,value:l.actual,onValueChange:u,onComplete:h,onCancel:p}),(0,Zr.jsx)("div",{children:l.valid?o("edit-link-dialog.detail"):o("edit-link-dialog.invalid-url")})]})}),(0,Zr.jsxs)(Ab,{className:"tlui-dialog__footer__actions",children:[(0,Zr.jsx)(Uy,{type:"normal",onClick:p,onTouchEnd:p,children:o("edit-link-dialog.cancel")}),f?(0,Zr.jsx)(Uy,{type:"danger",onTouchEnd:d,onClick:d,children:o("edit-link-dialog.clear")}):(0,Zr.jsx)(Uy,{type:"primary",disabled:!l.valid,onTouchEnd:h,onClick:h,children:o("edit-link-dialog.save")})]})]})})),Rb=W((function(e){let{onClose:n}=e;const r=di(),i=Oy(),o=Ey(),[s,a]=(0,t.useState)(null),[l,c]=(0,t.useState)(""),[u,d]=(0,t.useState)(null),[h,p]=(0,t.useState)(!1),f=(0,t.useRef)(-1);return(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsxs)(Eb,{children:[(0,Zr.jsx)(Ib,{children:s?"".concat(i("embed-dialog.title")," \u2014 ").concat(s.title):i("embed-dialog.title")}),(0,Zr.jsx)(Mb,{})]}),s?(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsxs)(Tb,{className:"tlui-embed-dialog__enter",children:[(0,Zr.jsx)(jb,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"http://example.com",autofocus:!0,onValueChange:e=>{c(e);const t=vh(e);d(t&&t.definition.type===s.type?t:null),p(!1),clearTimeout(f.current),f.current=setTimeout((()=>p(!t)),320)}}),""===l?(0,Zr.jsxs)("div",{className:"tlui-embed-dialog__instruction",children:[(0,Zr.jsx)("span",{children:i("embed-dialog.instruction")})," ",s.instructionLink&&(0,Zr.jsxs)("a",{target:"_blank",rel:"noopener noreferrer",href:s.instructionLink,className:"tlui-embed-dialog__instruction__link",children:["Learn more.",(0,Zr.jsx)(zy,{icon:"external-link",small:!0})]})]}):(0,Zr.jsx)("div",{className:"tlui-embed-dialog__warning",children:h?i("embed-dialog.invalid-url"):"\xa0"})]}),(0,Zr.jsxs)(Ab,{className:"tlui-dialog__footer__actions",children:[(0,Zr.jsx)(Uy,{type:"normal",onClick:()=>{a(null),d(null),c("")},label:"embed-dialog.back"}),(0,Zr.jsx)("div",{className:"tlui-embed__spacer"}),(0,Zr.jsx)(Uy,{type:"normal",label:"embed-dialog.cancel",onClick:n}),(0,Zr.jsx)(Uy,{type:"primary",disabled:!u,label:"embed-dialog.create",onClick:()=>{u&&(r.putExternalContent({type:"embed",url:l,point:r.viewportPageCenter,embed:u.definition}),n())}})]})]}):(0,Zr.jsx)(Zr.Fragment,{children:(0,Zr.jsx)(Tb,{className:"tlui-embed-dialog__list",children:gr.map((e=>(0,Zr.jsx)(Uy,{type:"menu",onClick:()=>a(e),label:e.title,children:(0,Zr.jsx)("div",{className:"tlui-embed-dialog__item__image",style:{backgroundImage:"url(".concat(o.embedIcons[e.type],")")}})},e.type)))})})]})}));var Db=n(4235);async function Nb(e,t,n){const{elements:r,files:i}=t,o={shapes:[],rootShapeIds:[],assets:[],schema:e.store.schema.serialize()},s=new Map,a=new Map,{currentPageId:l}=e,c=new Map,u=[],d=new Set;r.forEach((e=>{if(c.set(e.id,Dn()),null!==e.boundElements)for(const t of e.boundElements)"text"===t.type&&d.add(t.id)}));let h="a1";for(const j of r){if(d.has(j.id))continue;const e=c.get(j.id),t={id:e,typeName:"shape",parentId:l,index:h,x:j.x,y:j.y,rotation:0,isLocked:j.locked,opacity:Fb(j.opacity),meta:{}};var p;if(0!==j.angle&&a.set(e,j.angle),j.groupIds&&j.groupIds.length>0)if(s.has(j.groupIds[0]))null===(p=s.get(j.groupIds[0]))||void 0===p||p.push(e);else s.set(j.groupIds[0],[e]);else u.push(e);switch(j.type){case"rectangle":case"ellipse":case"diamond":{var f,g,m;let e="",n="middle";if(null!==j.boundElements)for(const t of j.boundElements)if("text"===t.type){const i=r.find((e=>e.id===t.id));i&&(e=i.text,n=Yb[i.textAlign])}const i="transparent"===j.backgroundColor?j.strokeColor:j.backgroundColor;o.shapes.push({...t,type:"geo",props:{geo:j.type,url:null!==(f=j.link)&&void 0!==f?f:"",w:j.width,h:j.height,size:null!==(g=Bb[j.strokeWidth])&&void 0!==g?g:"draw",color:null!==(m=Kb[i])&&void 0!==m?m:"black",text:e,align:n,dash:Xb(j),fill:Qb(j)}});break}case"freedraw":var y;o.shapes.push({...t,type:"draw",props:{dash:Xb(j),size:Bb[j.strokeWidth],color:null!==(y=Kb[j.strokeColor])&&void 0!==y?y:"black",segments:[{type:"free",points:j.points.map((e=>{let[t,n,r=.5]=e;return{x:t,y:n,z:r}}))}]}});break;case"line":{var v;const e=j.points[0],n=j.points[j.points.length-1],r=Gl(j.points.length);o.shapes.push({...t,type:"line",props:{dash:Xb(j),size:Bb[j.strokeWidth],color:null!==(v=Kb[j.strokeColor])&&void 0!==v?v:"black",spline:j.roundness?"cubic":"line",handles:{start:{id:"start",type:"vertex",index:r[0],x:e[0],y:e[1]},end:{id:"end",type:"vertex",index:r[r.length-1],x:n[0],y:n[1]},...Object.fromEntries(j.points.slice(1,-1).map(((e,t)=>{let[n,i]=e;const o=Va();return[o,{id:o,type:"vertex",index:r[t+1],x:n,y:i}]})))}}});break}case"arrow":{var b,w,x,S,k,_;let e="";if(null!==j.boundElements)for(const t of j.boundElements)if("text"===t.type){const n=r.find((e=>e.id===t.id));n&&(e=n.text)}const n=j.points[0],i=j.points[j.points.length-1],s=c.get(null===(b=j.startBinding)||void 0===b?void 0:b.elementId),a=c.get(null===(w=j.endBinding)||void 0===w?void 0:w.elementId);o.shapes.push({...t,type:"arrow",props:{text:e,bend:Gb(j,n,i),dash:Xb(j),size:null!==(x=Bb[j.strokeWidth])&&void 0!==x?x:"m",color:null!==(S=Kb[j.strokeColor])&&void 0!==S?S:"black",start:s?{type:"binding",boundShapeId:s,normalizedAnchor:{x:.5,y:.5},isExact:!1}:{type:"point",x:n[0],y:n[1]},end:a?{type:"binding",boundShapeId:a,normalizedAnchor:{x:.5,y:.5},isExact:!1}:{type:"point",x:i[0],y:i[1]},arrowheadEnd:null!==(k=qb[j.endArrowhead])&&void 0!==k?k:"none",arrowheadStart:null!==(_=qb[j.startArrowhead])&&void 0!==_?_:"none"}});break}case"text":{var P,C;const{size:e,scale:n}=Hb(j.fontSize);o.shapes.push({...t,type:"text",props:{size:e,scale:n,font:null!==(P=Vb[j.fontFamily])&&void 0!==P?P:"draw",color:null!==(C=Kb[j.strokeColor])&&void 0!==C?C:"black",text:j.text,align:Yb[j.textAlign]}});break}case"image":{var E;const e=i[j.fileId];if(!e)break;const n=Tn.createId();o.assets.push({id:n,typeName:"asset",type:"image",props:{w:j.width,h:j.height,name:null!==(E=j.id)&&void 0!==E?E:"Untitled",isAnimated:!1,mimeType:e.mimeType,src:e.dataURL},meta:{}}),o.shapes.push({...t,type:"image",props:{w:j.width,h:j.height,assetId:n}})}}h=ql(h)}const I=null!==n&&void 0!==n?n:e.inputs.shiftKey?e.inputs.currentPagePoint:void 0;e.mark("paste"),e.putContentOntoCurrentPage(o,{point:I,select:!1,preserveIds:!0});for(const j of s.values())if(j.length>1){e.groupShapes(j);const t=e.getShape(j[0]);null!==t&&void 0!==t&&t.parentId&&Rn(t.parentId)&&u.push(t.parentId)}for(const[j,O]of a)e.select(j),e.rotateShapesBy([j],O);const M=Q(u.map((t=>e.getShape(t)))),T=Ti.Common(M.map((t=>e.getShapePageBounds(t)))),A=e.viewportPageBounds.center;e.updateShapes(M.map((e=>{var t,n;const r=(null!==(t=e.x)&&void 0!==t?t:0)-(T.x+T.w/2),i=(null!==(n=e.y)&&void 0!==n?n:0)-(T.y+T.h/2);return{id:e.id,type:e.type,x:A.x+r,y:A.y+i}}))),e.setSelectedShapes(u)}const Fb=e=>{const t=e/100;return t<.2?.1:t<.4?.25:t<.6?.5:t<.8?.75:1},Bb={1:"s",2:"m",3:"l",4:"xl"},Ub={16:"s",20:"m",28:"l",36:"xl"};function Hb(e){const t=Ub[e];return t?{size:t,scale:1}:e<16?{size:"s",scale:e/16}:e>36?{size:"xl",scale:e/36}:{size:"m",scale:1}}const Vb={1:"draw",2:"sans",3:"mono"},Kb={"#ffffff":"grey","#000000":"black","#343a40":"black","#495057":"grey","#c92a2a":"red","#a61e4d":"light-red","#862e9c":"violet","#5f3dc4":"light-violet","#364fc7":"blue","#1864ab":"light-blue","#0b7285":"light-green","#087f5b":"light-green","#2b8a3e":"green","#5c940d":"light-green","#e67700":"yellow","#d9480f":"orange","#ced4da":"grey","#868e96":"grey","#fa5252":"light-red","#e64980":"red","#be4bdb":"light-violet","#7950f2":"violet","#4c6ef5":"blue","#228be6":"light-blue","#15aabf":"light-green","#12b886":"green","#40c057":"green","#82c91e":"light-green","#fab005":"yellow","#fd7e14":"orange","#212529":"grey"},Wb={solid:"draw",dashed:"dashed",dotted:"dotted"},$b={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},Yb={left:"start",center:"middle",right:"end"},qb={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"};function Gb(e,t,n){let r=0;if(e.points.length>2){const i=new Ei(t[0],t[1]),o=new Ei(n[0],n[1]),s=new Ei(e.points[1][0],e.points[1][1]),a=Ei.Sub(o,i),l=Ei.Per(a),c=Ei.Med(o,i),u=Ei.Sub(c,l),d=Ei.Add(c,l),h=Ei.NearestPointOnLineSegment(u,d,s,!1);r=Ei.Dist(h,c),Ei.Clockwise(h,o,c)&&(r*=-1)}return r}const Xb=e=>{var t;let n=null!==(t=Wb[e.strokeStyle])&&void 0!==t?t:"draw";return"draw"===n&&0===e.roughness&&(n="solid"),n},Qb=e=>{var t;return"transparent"===e.backgroundColor?"none":null!==(t=$b[e.fillStyle])&&void 0!==t?t:"solid"};async function Zb(e,t,n,r){const i=(await Promise.all(t.map((async e=>await(await fetch(e)).blob())))).map((e=>new File([e],"tldrawFile",{type:e.type})));e.mark("paste"),await e.putExternalContent({type:"files",files:i,point:n,ignoreParent:!1,sources:r}),t.forEach((e=>URL.revokeObjectURL(e)))}function Jb(e,t,n){const r=null!==n&&void 0!==n?n:e.inputs.shiftKey?e.inputs.currentPagePoint:void 0;e.mark("paste"),e.putContentOntoCurrentPage(t,{point:r,select:!0})}async function ew(e,t,n,r){try{if(new URL(t).pathname.match(/\.(png|jpe?g|gif|svg|webp)$/i)){var i;if(null!==(i=(await fetch(t,{method:"HEAD"})).headers.get("content-type"))&&void 0!==i&&i.match(/^image\//))return e.mark("paste"),void Zb(e,[t])}}catch(hA){"Failed to fetch"!==hA.message&&console.error(hA)}return e.mark("paste"),await e.putExternalContent({type:"url",point:n,url:t,sources:r})}const tw=()=>{},nw=t.createContext({});function rw(e){let{onEvent:t,children:n}=e;return(0,Zr.jsx)(nw.Provider,{value:null!==t&&void 0!==t?t:tw,children:n})}function iw(){const e=t.useContext(nw);return null!==e&&void 0!==e?e:tw}function ow(e){const t=document.implementation.createHTMLDocument("");return t.documentElement.innerHTML=e.trim(),t.body.textContent||t.body.innerText||""}const sw=["input","select","textarea"];function aw(e){const{activeElement:t}=document;return e.isMenuOpen||t&&(t.getAttribute("contenteditable")||sw.indexOf(t.tagName.toLowerCase())>-1)}async function lw(e){return new Promise(((t,n)=>{const r=new FileReader;r.addEventListener("loadend",(()=>{const e=r.result;t(e)})),r.addEventListener("error",(()=>{n(r.error)})),r.readAsText(e)}))}const cw=e=>e.types.find((e=>e.match(/^image\//))),uw=(e,t,n,r)=>{const i=(e=>{const t=e.split(/[\n\s]/);for(const n of t)try{const e=new URL(n);if("http:"!==e.protocol&&"https:"!==e.protocol)return}catch(ZI){return}return aa(t)})(t);if(i)for(const o of i)ew(e,o,n);else(e=>{try{const t=new URL(e);return"http:"===t.protocol||"https:"===t.protocol}catch(ZI){return!1}})(t)?ew(e,t,n):/^<svg/.test(t)?(e.mark("paste"),e.putExternalContent({type:"svg-text",text:t,point:n,sources:r})):(e.mark("paste"),e.putExternalContent({type:"text",text:t,point:n,sources:r}))},dw=async(e,t,n)=>{const r=[];for(const i of t){if(cw(i))for(const e of i.types)e.match(/^image\//)&&r.push({type:"blob",source:i.getType(e)});i.types.includes("text/html")&&r.push({type:"html",source:new Promise((e=>i.getType("text/html").then((t=>lw(t).then(e)))))}),i.types.includes("text/uri-list")&&r.push({type:"url",source:new Promise((e=>i.getType("text/uri-list").then((t=>lw(t).then(e)))))}),i.types.includes("text/plain")&&r.push({type:"text",source:new Promise((e=>i.getType("text/plain").then((t=>lw(t).then(e)))))})}return await hw(e,r,n)};async function hw(e,t,n){const r=t.filter((e=>("file"===e.type||"blob"===e.type)&&null!==e.source));if(r.length){const t=await Promise.all(r.map((e=>e.source))),i=t.filter(Boolean).map((e=>URL.createObjectURL(e)));return await Zb(e,i,n)}const i=await Promise.all(t.filter((e=>"file"!==e.type)).map((e=>new Promise((t=>{const n=e;"file"!==n.type?n.source.then((e=>{var r;const i=null===(r=e.match(/<tldraw[^>]*>(.*)<\/tldraw>/))||void 0===r?void 0:r[1];if(i)try{const e=(0,Db.decompressFromBase64)(i);if(null===e)return void t({type:"error",data:e,reason:"found tldraw data comment but could not parse base64"});{const n=JSON.parse(e);return"application/tldraw"!==n.type&&t({type:"error",data:n,reason:"found tldraw data comment but JSON was of a different type: ".concat(n.type)}),"string"===typeof n.data?void t({type:"error",data:n,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"}):void t({type:"tldraw",data:n.data})}}catch(ZI){return void t({type:"error",data:i,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"})}else{if("html"===n.type)return void t({type:"text",data:e,subtype:"html"});if("url"===n.type)return void t({type:"text",data:e,subtype:"url"});try{const n=JSON.parse(e);return"excalidraw/clipboard"===n.type?void t({type:"excalidraw",data:n}):void t({type:"text",data:e,subtype:"json"})}catch(ZI){return void t({type:"text",data:e,subtype:"text"})}}t({type:"error",data:e,reason:"unhandled case"})})):t({type:"error",data:null,reason:"unexpected file"})})))));for(const o of i)if("tldraw"===o.type)return void Jb(e,o.data,n);for(const o of i)if("excalidraw"===o.type)return void Nb(e,o.data,n);for(const o of i)if("text"===o.type&&"html"===o.subtype){const t=(new DOMParser).parseFromString(o.data,"text/html").querySelector("body");if(t&&1===Array.from(t.children).filter((e=>1===e.nodeType)).length&&t.firstElementChild&&"A"===t.firstElementChild.tagName&&t.firstElementChild.hasAttribute("href")&&""!==t.firstElementChild.getAttribute("href")){const r=t.firstElementChild.getAttribute("href");return void uw(e,r,n,i)}if(!i.some((e=>"text"===e.type&&"html"!==e.subtype))&&o.data.trim())return void uw(e,ow(o.data),n,i)}for(const o of i)if("text"===o.type&&"url"===o.subtype)return void ew(e,o.data,n,i);for(const o of i)if("text"===o.type&&"text"===o.subtype&&o.data.trim())return void uw(e,o.data,n,i)}const pw=e=>{const t=e.getContentFromCurrentPage(e.selectedShapeIds);if(!t)return void(navigator&&navigator.clipboard&&navigator.clipboard.writeText(""));const n=(0,Db.compressToBase64)(JSON.stringify({type:"application/tldraw",kind:"content",data:t}));if("undefined"!==typeof navigator){var r;const i=t.shapes.map((t=>e.isShapeOfType(t,"text")||e.isShapeOfType(t,"geo")||e.isShapeOfType(t,"arrow")?t.props.text:e.isShapeOfType(t,"bookmark")||e.isShapeOfType(t,"embed")?t.props.url:null)).filter(Te);if(null!==(r=navigator.clipboard)&&void 0!==r&&r.write){const e=new Blob(["<tldraw>".concat(n,"</tldraw>")],{type:"text/html"});let t=i.join(" ");""===t&&(t=" "),navigator.clipboard.write([new ClipboardItem({"text/html":e,"text/plain":new Blob([t],{type:"text/plain"})})])}else navigator.clipboard.writeText&&navigator.clipboard.writeText("<tldraw>".concat(n,"</tldraw>"))}};function fw(){const e=di(),n=iw(),r=q("editor.isFocused",(()=>e.instanceState.isFocused),[e]);(0,t.useEffect)((()=>{if(!r)return;const t=()=>{0===e.selectedShapeIds.length||null!==e.editingShapeId||aw(e)||(pw(e),n("copy",{source:"kbd"}))};function i(){0===e.selectedShapeIds.length||null!==e.editingShapeId||aw(e)||(pw(e),e.deleteShapes(e.selectedShapeIds),n("cut",{source:"kbd"}))}let o=!1;const s=e=>{1===e.button&&(o=!0,requestAnimationFrame((()=>{o=!1})))},a=t=>{o?t.stopPropagation():null!==e.editingShapeId||aw(e)||(t.clipboardData&&!e.inputs.shiftKey?(async(e,t,n)=>{if(null!==e.editingShapeId)return;if(!t)throw Error("No clipboard data");const r=[];for(const i of Object.values(t.items))switch(i.kind){case"file":r.push({type:"file",source:new Promise((e=>e(i.getAsFile())))});break;case"string":"text/html"===i.type?r.push({type:"html",source:new Promise((e=>i.getAsString(e)))}):"text/plain"===i.type?r.push({type:"text",source:new Promise((e=>i.getAsString(e)))}):r.push({type:i.type,source:new Promise((e=>i.getAsString(e)))})}hw(e,r,n)})(e,t.clipboardData):navigator.clipboard.read().then((t=>{Array.isArray(t)&&t[0]instanceof ClipboardItem&&dw(e,t,e.inputs.currentPagePoint)})),n("paste",{source:"kbd"}))};return document.addEventListener("copy",t),document.addEventListener("cut",i),document.addEventListener("paste",a),document.addEventListener("pointerup",s),()=>{document.removeEventListener("copy",t),document.removeEventListener("cut",i),document.removeEventListener("paste",a),document.removeEventListener("pointerup",s)}}),[e,n,r])}function gw(e){const t=e.cloneNode(!0);e.setAttribute("width",+e.getAttribute("width")+""),e.setAttribute("height",+e.getAttribute("height")+"");return(new XMLSerializer).serializeToString(t).replaceAll("&#10;      ","").replaceAll(/((\s|")[0-9]*\.[0-9]{2})([0-9]*)(\b|"|\))/g,"$1")}async function mw(e,t,n){const{type:r,quality:i,scale:o}=n,s=+e.getAttribute("width"),a=+e.getAttribute("height");let l=s*o,c=a*o;const u=await yw(e),d=await dh();if(s>d.maxWidth&&(l=d.maxWidth,c=l/s*a),a>d.maxHeight&&(c=d.maxHeight,l=c/a*s),l*c>d.maxArea){const e=Math.sqrt(d.maxArea/(l*c));l*=e,c*=e}l=Math.floor(l),c=Math.floor(c);const h=l/s,p=await new Promise((e=>{const n=new Image;n.crossOrigin="anonymous",n.onload=async()=>{t&&await new Promise((e=>setTimeout(e,250)));const r=document.createElement("canvas"),i=r.getContext("2d");r.width=l,r.height=c,i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",i.drawImage(n,0,0,l,c),URL.revokeObjectURL(u),e(r)},n.onerror=()=>{e(null)},n.src=u}));if(!p)return null;const f=await new Promise((e=>p.toBlob((t=>{t&&!ti.throwToBlob.value||e(null),e(t)}),"image/"+r,i)));if(!f)return null;const g=new DataView(await f.arrayBuffer());return ce.setPhysChunk(g,h,{type:"image/"+r})}async function yw(e){const t=e.cloneNode(!0);t.setAttribute("encoding",'UTF-8"');const n=new FileReader,r=Array.from(t.querySelectorAll("image"));for(const i of r){const e=i.getAttribute("xlink:href");if(e&&!e.startsWith("data:")){const t=await(await fetch(e)).blob(),r=await new Promise(((e,r)=>{n.onload=()=>e(n.result),n.onerror=()=>r(n.error),n.readAsDataURL(t)}));i.setAttribute("xlink:href",r)}}return function(e){const t=(new XMLSerializer).serializeToString(e),n=window.btoa(unescape(encodeURIComponent(t)));return"data:image/svg+xml;base64,".concat(n)}(t)}function vw(e,t){const n=document.createElement("a");n.href=e,n.download=t,n.click()}const bw=(0,t.createContext)({});function ww(e){let{children:n}=e;const[r,i]=(0,t.useState)([]),o=(0,t.useCallback)((e=>{var t;const n=null!==(t=e.id)&&void 0!==t?t:Va();return i((t=>[...t.filter((t=>t.id!==e.id)),{...e,id:n}])),n}),[]),s=(0,t.useCallback)((e=>(i((t=>t.filter((t=>t.id!==e)))),e)),[]),a=(0,t.useCallback)((()=>{i((()=>[]))}),[]);return(0,Zr.jsx)(bw.Provider,{value:{toasts:r,addToast:o,removeToast:s,clearToasts:a},children:n})}function xw(){const e=(0,t.useContext)(bw);if(!e)throw new Error("useToasts must be used within a ToastsProvider");return e}function Sw(){const e=di(),{addToast:n}=xw(),r=Oy();return(0,t.useCallback)((function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.selectedShapeIds,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"svg";if(0===t.length&&(t=[...e.currentPageShapeIds]),0!==t.length)switch(i){case"svg":window.navigator.clipboard&&(window.navigator.clipboard.write?window.navigator.clipboard.write([new ClipboardItem({"text/plain":_w(e,t)})]):Pw((async()=>gw(await kw(e,t)))));break;case"jpeg":case"png":{const o="jpeg"===i?"image/jpeg":"image/png",s=async function(e,t,n){return await mw(await kw(e,t),e.environment.isSafari,{type:n,quality:1,scale:2})}(e,t,i).then((e=>{if(e){if(window.navigator.clipboard)return e;throw new Error("Copy not supported")}throw n({id:"copy-fail",icon:"warning-triangle",title:r("toast.error.copy-fail.title"),description:r("toast.error.copy-fail.desc")}),new Error("Copy not possible")}));window.navigator.clipboard.write([new ClipboardItem({[o]:s})]).catch((e=>{e.toString().match(/^TypeError: DOMString not supported/)||console.error(e),s.then((e=>{window.navigator.clipboard.write([new ClipboardItem({[o]:e})])}))}));break}case"json":{const n=e.getContentFromCurrentPage(t);if(window.navigator.clipboard){const e=JSON.stringify(n);window.navigator.clipboard.write?window.navigator.clipboard.write([new ClipboardItem({"text/plain":new Blob([e],{type:"text/plain"})})]):Pw((async()=>e))}break}default:throw new Error("Copy type ".concat(i," not supported."))}}),[e,n,r])}async function kw(e,t){const n=await e.getSvg(t,{scale:1,background:e.instanceState.exportBackground});if(!n)throw new Error("Could not construct SVG.");return n}async function _w(e,t){return new Blob([gw(await kw(e,t))],{type:"text/plain"})}async function Pw(e){navigator&&navigator.clipboard&&navigator.clipboard.writeText(await e())}const Cw=(0,t.createContext)({});function Ew(e){let{children:n}=e;const r=di(),i=iw(),[o,s]=(0,t.useState)([]),a=(0,t.useCallback)((e=>{var t;const n=null!==(t=e.id)&&void 0!==t?t:Va();return s((t=>[...t.filter((t=>t.id!==e.id)),{...e,id:n}])),i("open-menu",{source:"dialog",id:n}),r.addOpenMenu(n),n}),[r,i]),l=(0,t.useCallback)(((e,t)=>(s((n=>n.map((n=>n.id===e?{...n,...t}:n)))),i("open-menu",{source:"dialog",id:e}),r.addOpenMenu(e),e)),[r,i]),c=(0,t.useCallback)((e=>(s((t=>t.filter((t=>{var n;return t.id!==e||(null===(n=t.onClose)||void 0===n||n.call(t),!1)})))),i("close-menu",{source:"dialog",id:e}),r.deleteOpenMenu(e),e)),[r,i]),u=(0,t.useCallback)((()=>{s((e=>(e.forEach((e=>{var t;null===(t=e.onClose)||void 0===t||t.call(e),i("close-menu",{source:"dialog",id:e.id}),r.deleteOpenMenu(e.id)})),[])))}),[r,i]);return(0,Zr.jsx)(Cw.Provider,{value:{dialogs:o,addDialog:a,removeDialog:c,clearDialogs:u,updateDialog:l},children:n})}function Iw(){const e=(0,t.useContext)(Cw);if(!e)throw new Error("useDialogs must be used within a DialogsProvider");return e}function Mw(){const e=di(),{addToast:n}=xw(),r=Oy();return(0,t.useCallback)((async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.selectedShapeIds,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"png";if(0===t.length&&(t=[...e.currentPageShapeIds]),0===t.length)return;const o=await e.getSvg(t,{scale:1,background:e.instanceState.exportBackground});if(!o)throw new Error("Could not construct SVG.");let s="shapes"+function(){const e=new Date,t=String(e.getFullYear()).slice(2),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0"),i=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0"),s=String(e.getSeconds()).padStart(2,"0");return" at ".concat(t,"-").concat(n,"-").concat(r," ").concat(i,".").concat(o,".").concat(s)}();if(1===t.length){const n=e.getShape(t[0]);var a;if(e.isShapeOfType(n,"frame"))s=null!==(a=n.props.name)&&void 0!==a?a:"frame";else s=n.id.replace(/:/,"_")}switch(i){case"svg":return void vw(await yw(o),"".concat(s,".svg"));case"webp":case"png":{const t=await mw(o,e.environment.isSafari,{type:i,quality:1,scale:2});if(!t)return void n({id:"export-fail",title:r("toast.error.export-fail.title"),description:r("toast.error.export-fail.desc")});const a=URL.createObjectURL(t);return vw(a,"".concat(s,".").concat(i)),void URL.revokeObjectURL(a)}case"json":{const n=e.getContentFromCurrentPage(t),r=URL.createObjectURL(new Blob([JSON.stringify(n,null,4)],{type:"application/json"}));return vw(r,"".concat(s||"shapes",".json")),void URL.revokeObjectURL(r)}default:throw new Error("Export type ".concat(i," not supported."))}}),[e,n,r])}function Tw(){const e=di(),n=(0,t.useRef)();return(0,t.useEffect)((()=>{const t=window.document.createElement("input");async function r(n){const r=n.target.files;r&&0!==r.length&&(await e.putExternalContent({type:"files",files:Array.from(r),point:e.viewportPageBounds.center,ignoreParent:!1}),t.value="")}return t.type="file",t.accept="image/jpeg,image/png,image/gif,image/svg+xml,video/mp4,video/quicktime",t.multiple=!0,n.current=t,t.addEventListener("change",r),()=>{n.current=void 0,t.removeEventListener("change",r)}}),[e]),(0,t.useCallback)((()=>{var e;null===(e=n.current)||void 0===e||e.click()}),[n])}const Aw=t.createContext({});function jw(e){let{overrides:n,children:r}=e;const i=di(),{addDialog:o,clearDialogs:s}=Iw(),{clearToasts:a}=xw(),l=Tw(),c=function(){const e=di(),n=(0,t.useRef)(null),r=(0,t.useRef)(null);return(0,t.useCallback)((async function(){const t=document.createElement("div"),i=document.createElement("style"),o=(e,t)=>{e&&(e.innerHTML=""),t&&document.head.contains(t)&&document.head.removeChild(t),e&&document.body.contains(e)&&document.body.removeChild(e)};o(n.current,r.current),n.current=t,r.current=i;const s="tl-print-surface-".concat(Va());t.className=s,i.innerHTML="\n\t\t\t.".concat(s," {\n\t\t\t\tdisplay: none;\n\t\t\t}\n\n\t\t\t.").concat(s," svg {\n\t\t\t\tmax-width: 100%;\n\t\t\t\theight: 100%;\n\t\t\t\tdisplay: block;\n\t\t\t}\n\n\t\t\t@media print {\t\t\t\t  \n\t\t\t\thtml, body {\n\t\t\t\t\tmin-height: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t\tmargin: 0;\n\t\t\t\t}\n\n\t\t\t\tbody {\n\t\t\t\t\tposition: relative;\n\t\t\t\t}\n\n\t\t\t\tbody > * {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\n\t\t\t\t.tldraw__editor {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\n\t\t\t\t.").concat(s," {\n\t\t\t\t\tdisplay: block !important;\n\t\t\t\t\tbackground: white;\n\t\t\t\t\tmin-height: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t\tmax-width: 100%;\n\t\t\t\t}\n\n\t\t\t\t.").concat(s,"__item {\n\t\t\t\t\tpadding: 10mm;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tmin-height: 100%;\n\t\t\t\t\tflex-direction: column;\n\t\t\t\t\tpage-break-after: always;\n\t\t\t\t\tposition: relative;\n\t\t\t\t\toverflow: hidden;\n\t\t\t\t\theight: 100%;\n\t\t\t\t}\n\n\t\t\t\t.").concat(s,"__item__main {\n\t\t\t\t\tflex: 1;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t\tmax-height: 100%;\n\t\t\t\t}\n\n\t\t\t\t.").concat(s,"__item__header {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\n\t\t\t\t.").concat(s,"__item__footer {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t\ttext-align: right;\n\t\t\t\t}\n\n\t\t\t\t.").concat(s,"__item__footer__hide {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\n\t\t\t\t").concat("","\n\t\t\t}\n\n\t\t");const a=()=>{document.head.appendChild(i),document.body.appendChild(t)},l=()=>{e.once("change-history",(()=>{o(t,i)}))};function c(e,n,r){try{t.innerHTML+='<div class="'.concat(s,'__item">\n        <div class="').concat(s,'__item__header">\n          ').concat(e.replace(/</g,"&lt;").replace(/>/g,"&gt;"),'\n        </div>\n        <div class="').concat(s,'__item__main">\n          ').concat(r.outerHTML,'\n        </div>\n        <div class="').concat(s,"__item__footer ").concat(s,"__item__footer__").concat(n?"":"hide",'">\n          ').concat(null!==n&&void 0!==n?n:"","\n        </div>\n      </div>")}catch(ZI){console.error(ZI)}}function u(){e.environment.isChromeForIos?(a(),window.print()):e.environment.isSafari?(a(),document.execCommand("print",!1)):window.print()}window.addEventListener("beforeprint",a),window.addEventListener("afterprint",l);const{pages:d,currentPageId:h,selectedShapeIds:p}=e,f={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(e.selectedShapeIds.length>0){const t=await e.getSvg(p,f);if(t){const e=d.find((e=>e.id===h));c("tldraw \u2014 ".concat(null===e||void 0===e?void 0:e.name),null,t),u()}}else{const t=e.currentPage,n=await e.getSvg(e.getSortedChildIdsForParent(t.id),f);n&&(c("tldraw \u2014 ".concat(t.name),null,n),u())}window.removeEventListener("beforeprint",a),window.removeEventListener("afterprint",l)}),[e])}(),{cut:u,copy:d,paste:h}=function(){const e=di(),n=iw(),r=(0,t.useCallback)((function(t){0!==e.selectedShapeIds.length&&(pw(e),n("copy",{source:t}))}),[e,n]),i=(0,t.useCallback)((function(t){0!==e.selectedShapeIds.length&&(pw(e),e.deleteShapes(e.selectedShapeIds),n("cut",{source:t}))}),[e,n]),o=(0,t.useCallback)((async function(t,r,i){null!==e.editingShapeId||aw(e)||(Array.isArray(t)&&t[0]instanceof ClipboardItem?(dw(e,t,i),n("paste",{source:"menu"})):navigator.clipboard.read().then((e=>{o(e,r,i)})))}),[e,n]);return{copy:r,cut:i,paste:o}}(),p=Sw(),f=Mw(),g=iw(),m=t.useMemo((()=>{function e(){return i.isIn("select")||(i.complete(),i.setCurrentTool("select")),!1}function t(){return i.selectedShapeIds.length>0}const r=function(e){return Object.fromEntries(e.map((e=>[e.id,e])))}([{id:"edit-link",label:"action.edit-link",icon:"link",readonlyOk:!1,onSelect(n){t()&&(e()||(g("edit-link",{source:n}),i.mark("edit-link"),o({component:Lb})))}},{id:"insert-embed",label:"action.insert-embed",readonlyOk:!1,kbd:"$i",onSelect(e){g("insert-embed",{source:e}),o({component:Rb})}},{id:"insert-media",label:"action.insert-media",kbd:"$u",readonlyOk:!1,onSelect(e){g("insert-media",{source:e}),l()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"$z",readonlyOk:!1,onSelect(e){g("undo",{source:e}),i.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"$!z",readonlyOk:!1,onSelect(e){g("redo",{source:e}),i.redo()}},{id:"export-as-svg",label:"action.export-as-svg",menuLabel:"action.export-as-svg.short",contextMenuLabel:"action.export-as-svg.short",readonlyOk:!0,onSelect(e){g("export-as",{format:"svg",source:e}),f(i.selectedShapeIds,"svg")}},{id:"export-as-png",label:"action.export-as-png",menuLabel:"action.export-as-png.short",contextMenuLabel:"action.export-as-png.short",readonlyOk:!0,onSelect(e){g("export-as",{format:"png",source:e}),f(i.selectedShapeIds,"png")}},{id:"export-as-json",label:"action.export-as-json",menuLabel:"action.export-as-json.short",contextMenuLabel:"action.export-as-json.short",readonlyOk:!0,onSelect(e){g("export-as",{format:"json",source:e}),f(i.selectedShapeIds,"json")}},{id:"copy-as-svg",label:"action.copy-as-svg",menuLabel:"action.copy-as-svg.short",contextMenuLabel:"action.copy-as-svg.short",kbd:"$!c",readonlyOk:!0,onSelect(e){g("copy-as",{format:"svg",source:e}),p(i.selectedShapeIds,"svg")}},{id:"copy-as-png",label:"action.copy-as-png",menuLabel:"action.copy-as-png.short",contextMenuLabel:"action.copy-as-png.short",readonlyOk:!0,onSelect(e){g("copy-as",{format:"png",source:e}),p(i.selectedShapeIds,"png")}},{id:"copy-as-json",label:"action.copy-as-json",menuLabel:"action.copy-as-json.short",contextMenuLabel:"action.copy-as-json.short",readonlyOk:!0,onSelect(e){g("copy-as",{format:"json",source:e}),p(i.selectedShapeIds,"json")}},{id:"toggle-auto-size",label:"action.toggle-auto-size",readonlyOk:!1,onSelect(n){t()&&(e()||(g("toggle-auto-size",{source:n}),i.mark("toggling auto size"),i.updateShapes(i.selectedShapes.filter((e=>i.isShapeOfType(e,"text")&&!1===e.props.autoSize)).map((e=>({id:e.id,type:e.type,props:{...e.props,w:8,autoSize:!0}}))))))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(e){g("open-embed-link",{source:e});const t=i.selectedShapeIds,n="No embed shapes selected";if(1!==t.length)return void console.error(n);const r=i.getShape(t[0]);r&&i.isShapeOfType(r,"embed")?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"_blank";lo.openWindow(e,t)}(r.props.url,"_blank"):console.error(n)}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(e){var t;if("zoom"!==(null===(t=i.root.current.value)||void 0===t?void 0:t.id)&&(g("zoom-tool",{source:e}),!i.inputs.shiftKey&&!i.inputs.ctrlKey)){var n;const e=i.root.current.value;e&&"idle"===(null===(n=e.current.value)||void 0===n?void 0:n.id)&&i.setCurrentTool("zoom",{onInteractionEnd:e.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",readonlyOk:!1,onSelect(n){t()&&(e()||i.batch((()=>{g("convert-to-bookmark",{source:n});const e=i.selectedShapes,t=[],r=[];for(const n of e){if(!n||!i.isShapeOfType(n,"embed")||!n.props.url)continue;const e=new Ei(n.x,n.y);e.rot(-n.rotation),e.add(new Ei(n.props.w/2-150,n.props.h/2-160)),e.rot(n.rotation);const o={id:Dn(),type:"bookmark",rotation:n.rotation,x:e.x,y:e.y,opacity:1,props:{url:n.props.url}};t.push(o),r.push(n.id)}i.mark("convert shapes to bookmark"),i.deleteShapes(r),i.createShapes(t)})))}},{id:"convert-to-embed",label:"action.convert-to-embed",readonlyOk:!1,onSelect(n){t()&&(e()||(g("convert-to-embed",{source:n}),i.batch((()=>{const e=Q(i.selectedShapeIds.map((e=>i.getShape(e)))),t=[],n=[];for(const r of e){if(!i.isShapeOfType(r,"bookmark"))continue;const{url:e}=r.props,o=vh(r.props.url);if(!o)continue;if(!o.definition)continue;const{width:s,height:a}=o.definition,l=new Ei(r.x,r.y);l.rot(-r.rotation),l.add(new Ei(r.props.w/2-s/2,r.props.h/2-a/2)),l.rot(r.rotation);const c={id:Dn(),type:"embed",x:l.x,y:l.y,rotation:r.rotation,props:{url:e,w:s,h:a}};t.push(c),n.push(r.id)}i.mark("convert shapes to embed"),i.deleteShapes(n),i.createShapes(t)}))))}},{id:"duplicate",kbd:"$d",label:"action.duplicate",icon:"duplicate",readonlyOk:!1,onSelect(n){if(!t())return;if(e())return;g("duplicate-shapes",{source:n});const r=i.selectedShapeIds,o=Ti.Common(Q(r.map((e=>i.getShapePageBounds(e))))),s=i.instanceState.canMoveCamera?{x:o.width+10,y:0}:{x:16/i.zoomLevel,y:16/i.zoomLevel};i.mark("duplicate shapes"),i.duplicateShapes(r,s)}},{id:"ungroup",label:"action.ungroup",kbd:"$!g",icon:"ungroup",readonlyOk:!1,onSelect(n){t()&&(e()||(g("ungroup-shapes",{source:n}),i.mark("ungroup"),i.ungroupShapes(i.selectedShapeIds)))}},{id:"group",label:"action.group",kbd:"$g",icon:"group",readonlyOk:!1,onSelect(n){if(!t())return;if(e())return;g("group-shapes",{source:n});const{onlySelectedShape:r}=i;r&&i.isShapeOfType(r,"group")?(i.mark("ungroup"),i.ungroupShapes(i.selectedShapeIds)):(i.mark("group"),i.groupShapes(i.selectedShapeIds))}},{id:"align-left",label:"action.align-left",kbd:"?A",icon:"align-left",readonlyOk:!1,onSelect(n){t()&&(e()||(g("align-shapes",{operation:"left",source:n}),i.mark("align left"),i.alignShapes(i.selectedShapeIds,"left")))}},{id:"align-center-horizontal",label:"action.align-center-horizontal",contextMenuLabel:"action.align-center-horizontal.short",kbd:"?H",icon:"align-center-horizontal",readonlyOk:!1,onSelect(n){t()&&(e()||(g("align-shapes",{operation:"center-horizontal",source:n}),i.mark("align center horizontal"),i.alignShapes(i.selectedShapeIds,"center-horizontal")))}},{id:"align-right",label:"action.align-right",kbd:"?D",icon:"align-right",readonlyOk:!1,onSelect(n){t()&&(e()||(g("align-shapes",{operation:"right",source:n}),i.mark("align right"),i.alignShapes(i.selectedShapeIds,"right")))}},{id:"align-center-vertical",label:"action.align-center-vertical",contextMenuLabel:"action.align-center-vertical.short",kbd:"?V",icon:"align-center-vertical",readonlyOk:!1,onSelect(n){t()&&(e()||(g("align-shapes",{operation:"center-vertical",source:n}),i.mark("align center vertical"),i.alignShapes(i.selectedShapeIds,"center-vertical")))}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"?W",readonlyOk:!1,onSelect(n){t()&&(e()||(g("align-shapes",{operation:"top",source:n}),i.mark("align top"),i.alignShapes(i.selectedShapeIds,"top")))}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"?S",readonlyOk:!1,onSelect(n){t()&&(e()||(g("align-shapes",{operation:"bottom",source:n}),i.mark("align bottom"),i.alignShapes(i.selectedShapeIds,"bottom")))}},{id:"distribute-horizontal",label:"action.distribute-horizontal",contextMenuLabel:"action.distribute-horizontal.short",icon:"distribute-horizontal",kbd:"?!h",readonlyOk:!1,onSelect(n){t()&&(e()||(g("distribute-shapes",{operation:"horizontal",source:n}),i.mark("distribute horizontal"),i.distributeShapes(i.selectedShapeIds,"horizontal")))}},{id:"distribute-vertical",label:"action.distribute-vertical",contextMenuLabel:"action.distribute-vertical.short",icon:"distribute-vertical",kbd:"?!V",readonlyOk:!1,onSelect(n){t()&&(e()||(g("distribute-shapes",{operation:"vertical",source:n}),i.mark("distribute vertical"),i.distributeShapes(i.selectedShapeIds,"vertical")))}},{id:"stretch-horizontal",label:"action.stretch-horizontal",contextMenuLabel:"action.stretch-horizontal.short",icon:"stretch-horizontal",readonlyOk:!1,onSelect(n){t()&&(e()||(g("stretch-shapes",{operation:"horizontal",source:n}),i.mark("stretch horizontal"),i.stretchShapes(i.selectedShapeIds,"horizontal")))}},{id:"stretch-vertical",label:"action.stretch-vertical",contextMenuLabel:"action.stretch-vertical.short",icon:"stretch-vertical",readonlyOk:!1,onSelect(n){t()&&(e()||(g("stretch-shapes",{operation:"vertical",source:n}),i.mark("stretch vertical"),i.stretchShapes(i.selectedShapeIds,"vertical")))}},{id:"flip-horizontal",label:"action.flip-horizontal",contextMenuLabel:"action.flip-horizontal.short",kbd:"!h",readonlyOk:!1,onSelect(n){t()&&(e()||(g("flip-shapes",{operation:"horizontal",source:n}),i.mark("flip horizontal"),i.flipShapes(i.selectedShapeIds,"horizontal")))}},{id:"flip-vertical",label:"action.flip-vertical",contextMenuLabel:"action.flip-vertical.short",kbd:"!v",readonlyOk:!1,onSelect(n){t()&&(e()||(g("flip-shapes",{operation:"vertical",source:n}),i.mark("flip vertical"),i.flipShapes(i.selectedShapeIds,"vertical")))}},{id:"pack",label:"action.pack",icon:"pack",readonlyOk:!1,onSelect(n){t()&&(e()||(g("pack-shapes",{source:n}),i.mark("pack"),i.packShapes(i.selectedShapeIds,16)))}},{id:"stack-vertical",label:"action.stack-vertical",contextMenuLabel:"action.stack-vertical.short",icon:"stack-vertical",readonlyOk:!1,onSelect(n){t()&&(e()||(g("stack-shapes",{operation:"vertical",source:n}),i.mark("stack-vertical"),i.stackShapes(i.selectedShapeIds,"vertical",16)))}},{id:"stack-horizontal",label:"action.stack-horizontal",contextMenuLabel:"action.stack-horizontal.short",icon:"stack-horizontal",readonlyOk:!1,onSelect(n){t()&&(e()||(g("stack-shapes",{operation:"horizontal",source:n}),i.mark("stack-horizontal"),i.stackShapes(i.selectedShapeIds,"horizontal",16)))}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",readonlyOk:!1,onSelect(n){t()&&(e()||(g("reorder-shapes",{operation:"toFront",source:n}),i.mark("bring to front"),i.bringToFront(i.selectedShapeIds)))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"?]",readonlyOk:!1,onSelect(n){t()&&(e()||(g("reorder-shapes",{operation:"forward",source:n}),i.mark("bring forward"),i.bringForward(i.selectedShapeIds)))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"?[",readonlyOk:!1,onSelect(n){t()&&(e()||(g("reorder-shapes",{operation:"backward",source:n}),i.mark("send backward"),i.sendBackward(i.selectedShapeIds)))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",readonlyOk:!1,onSelect(n){t()&&(e()||(g("reorder-shapes",{operation:"toBack",source:n}),i.mark("send to back"),i.sendToBack(i.selectedShapeIds)))}},{id:"cut",label:"action.cut",kbd:"$x",readonlyOk:!1,onSelect(n){t()&&(e()||(i.mark("cut"),u(n)))}},{id:"copy",label:"action.copy",kbd:"$c",readonlyOk:!0,onSelect(n){t()&&(e()||d(n))}},{id:"paste",label:"action.paste",kbd:"$v",readonlyOk:!1,onSelect(e){var t;null===(t=navigator.clipboard)||void 0===t||t.read().then((t=>{h(t,e,"context-menu"===e?i.inputs.currentPagePoint:void 0)}))}},{id:"select-all",label:"action.select-all",kbd:"$a",readonlyOk:!0,onSelect(t){i.batch((()=>{e()||(g("select-all-shapes",{source:t}),i.mark("select all kbd"),i.selectAll())}))}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(n){t()&&(e()||(g("select-none-shapes",{source:n}),i.mark("select none"),i.selectNone()))}},{id:"delete",label:"action.delete",kbd:"\u232b,del,backspace",icon:"trash",readonlyOk:!1,onSelect(n){t()&&(e()||(g("delete-shapes",{source:n}),i.mark("delete"),i.deleteShapes(i.selectedShapeIds)))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",readonlyOk:!1,onSelect(n){if(!t())return;if(e())return;g("rotate-cw",{source:n}),i.mark("rotate-cw");const r=i.selectionRotation%(Li/2),o=Bi(r,0)||Bi(r,Li/2);i.rotateShapesBy(i.selectedShapeIds,Li/2-(o?0:r))}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",readonlyOk:!1,onSelect(n){if(!t())return;if(e())return;g("rotate-ccw",{source:n}),i.mark("rotate-ccw");const r=i.selectionRotation%(Li/2),o=Bi(r,0);i.rotateShapesBy(i.selectedShapeIds,o?-Li/2:-r)}},{id:"zoom-in",label:"action.zoom-in",kbd:"$=,=",readonlyOk:!0,onSelect(e){g("zoom-in",{source:e}),i.zoomIn(i.viewportScreenCenter,{duration:fo})}},{id:"zoom-out",label:"action.zoom-out",kbd:"$-,-",readonlyOk:!0,onSelect(e){g("zoom-out",{source:e}),i.zoomOut(i.viewportScreenCenter,{duration:fo})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"!0",readonlyOk:!0,onSelect(e){g("reset-zoom",{source:e}),i.resetZoom(i.viewportScreenCenter,{duration:fo})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"!1",readonlyOk:!0,onSelect(e){g("zoom-to-fit",{source:e}),i.zoomToFit({duration:fo})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"!2",readonlyOk:!0,onSelect(n){t()&&(e()||(g("zoom-to-selection",{source:n}),i.zoomToSelection({duration:fo})))}},{id:"toggle-snap-mode",label:"action.toggle-snap-mode",menuLabel:"action.toggle-snap-mode.menu",readonlyOk:!1,onSelect(e){g("toggle-snap-mode",{source:e}),i.user.updateUserPreferences({isSnapMode:!i.user.isSnapMode})},checkbox:!0},{id:"toggle-dark-mode",label:"action.toggle-dark-mode",menuLabel:"action.toggle-dark-mode.menu",kbd:"$/",readonlyOk:!0,onSelect(e){g("toggle-dark-mode",{source:e}),i.user.updateUserPreferences({isDarkMode:!i.user.isDarkMode})},checkbox:!0},{id:"toggle-reduce-motion",label:"action.toggle-reduce-motion",menuLabel:"action.toggle-reduce-motion.menu",readonlyOk:!0,onSelect(e){g("toggle-reduce-motion",{source:e}),i.user.updateUserPreferences({animationSpeed:0===i.user.animationSpeed?1:0})},checkbox:!0},{id:"toggle-transparent",label:"action.toggle-transparent",menuLabel:"action.toggle-transparent.menu",contextMenuLabel:"action.toggle-transparent.context-menu",readonlyOk:!0,onSelect(e){g("toggle-transparent",{source:e}),i.updateInstanceState({exportBackground:!i.instanceState.exportBackground},{ephemeral:!0})},checkbox:!0},{id:"toggle-tool-lock",label:"action.toggle-tool-lock",menuLabel:"action.toggle-tool-lock.menu",readonlyOk:!1,kbd:"q",onSelect(e){g("toggle-tool-lock",{source:e}),i.updateInstanceState({isToolLocked:!i.instanceState.isToolLocked})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",readonlyOk:!1,onSelect(e){g("unlock-all",{source:e});const t=[];for(const n of i.currentPageShapes)n.isLocked&&t.push({id:n.id,type:n.type,isLocked:!1});t.length>0&&i.updateShapes(t)}},{id:"toggle-focus-mode",label:"action.toggle-focus-mode",menuLabel:"action.toggle-focus-mode.menu",readonlyOk:!0,kbd:"$.",checkbox:!0,onSelect(e){requestAnimationFrame((()=>{i.batch((()=>{g("toggle-focus-mode",{source:e}),s(),a(),i.updateInstanceState({isFocusMode:!i.instanceState.isFocusMode})}))}))}},{id:"toggle-grid",label:"action.toggle-grid",menuLabel:"action.toggle-grid.menu",readonlyOk:!0,kbd:"$'",onSelect(e){g("toggle-grid-mode",{source:e}),i.updateInstanceState({isGridMode:!i.instanceState.isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:"action.toggle-debug-mode",menuLabel:"action.toggle-debug-mode.menu",readonlyOk:!0,onSelect(e){g("toggle-debug-mode",{source:e}),i.updateInstanceState({isDebugMode:!i.instanceState.isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"$p",readonlyOk:!0,onSelect(e){g("print",{source:e}),c()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(e){g("exit-pen-mode",{source:e}),i.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(e){g("stop-following",{source:e}),i.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(e){g("zoom-to-content",{source:e}),i.zoomToContent()}},{id:"toggle-lock",label:"action.toggle-lock",readonlyOk:!1,kbd:"!l",onSelect(e){i.mark("locking"),g("toggle-lock",{source:e}),i.toggleLock(i.selectedShapeIds)}}]);return n?n(i,r,void 0):r}),[g,n,i,o,l,f,p,u,d,h,s,a,c]);return(0,Zr.jsx)(Aw.Provider,{value:m,children:r})}function Ow(){const e=t.useContext(Aw);if(!e)throw new Error("useTools must be used within a ToolProvider");return e}function Lw(e){return e.filter((e=>void 0!==e&&null!==e&&!1!==e))}function zw(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=Lw(n);return 0===i.length?null:{id:e,type:"group",checkbox:i.every((e=>"item"===e.type&&e.actionItem.checkbox)),disabled:i.every((e=>e.disabled)),readonlyOk:i.some((e=>e.readonlyOk)),children:i}}function Rw(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];const o=Lw(r);return 0===o.length?null:{id:e,type:"submenu",label:t,children:o,disabled:o.every((e=>e.disabled)),readonlyOk:o.some((e=>e.readonlyOk))}}function Dw(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{readonlyOk:n=!0,disabled:r=!1}=t;return{id:e,type:"custom",disabled:r,readonlyOk:n}}function Nw(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)throw Error("No action item provided to menuItem");if(!e.label)throw Error("Trying to create menu item for action item that doesn't have a label");const{checked:n=!1,disabled:r=!1}=t;return{id:e.id,type:"item",actionItem:e,disabled:r,checked:n,readonlyOk:e.readonlyOk}}function Fw(e){const{selectedShapeIds:t}=e;return t.map((t=>e.getShape(t))).filter((t=>!!t&&((!e.isShapeOfType(t,"arrow")||"binding"!==t.props.start.type)&&(!e.isShapeOfType(t,"arrow")||"binding"!==t.props.end.type))))}const Bw=()=>{const e=di();return q("threeStackableItems",(()=>Fw(e).length>2),[e])},Uw=()=>{const e=di();return q("allowGroup",(()=>Fw(e).length>1),[e])},Hw=()=>{const e=di();return q("allowUngroup",(()=>e.selectedShapeIds.some((t=>{var n;return"group"===(null===(n=e.getShape(t))||void 0===n?void 0:n.type)}))),[e])};function Vw(e,t){const n=Kw(e,t);return te(n,"Menu item ".concat(t.join(" > ")," not found")),n}function Kw(e,t){const[n,...r]=t;if(!n)return null;const i=e.find((e=>e.id===n));if(!i)return null;switch(i.type){case"group":case"submenu":return 0===r.length?i:Kw(i.children,r);case"item":case"custom":return 0===r.length?i:null;default:ee(i,"type")}}const Ww="undefined"!==typeof window&&"navigator"in window&&Boolean(navigator.clipboard)&&Boolean(navigator.clipboard.read),$w=[0,380,420,460,580,640,840,1023],Yw=t.createContext(0);function qw(e){let{children:t}=e;const n=di(),r=q("breakpoint",(()=>{const{width:e}=n.viewportScreenBounds,t=$w;for(let n=0;n<t.length-1;n++)if(e>t[n]&&e<=t[n+1])return n;return t.length}),[n]);return(0,Zr.jsx)(Yw.Provider,{value:r,children:t})}function Gw(){let e=(0,t.useContext)(Yw);const n=new URL(window.location.href).searchParams.get("layout");return"desktop"===n?e=7:"mobile"===n&&(e=1),e}function Xw(){const e=di();return q("hasLinkShapeSelected",(()=>{const{selectedShapes:t}=e;return 1===t.length&&"url"in t[0].props&&"embed"!==t[0].type}),[e])}const Qw=t.createContext({}),Zw=e=>{let{overrides:n,children:r}=e;const i=di(),o=Ow(),s=q("selected count",(()=>i.selectedShapeIds.length),[i]),a=s>0,l=s>1,c=s>2,u=Bw(),d=Uw(),h=Hw(),p=Xw(),f=Gw(),g=q("zoom is 1",(()=>1===i.zoomLevel),[i]),m=(0,t.useMemo)((()=>{const e=[Nw(o["align-left"],{disabled:!l}),Nw(o["align-center-horizontal"],{disabled:!l}),Nw(o["align-right"],{disabled:!l}),Nw(o["stretch-horizontal"],{disabled:!l}),Nw(o["align-top"],{disabled:!l}),Nw(o["align-center-vertical"],{disabled:!l}),Nw(o["align-bottom"],{disabled:!l}),Nw(o["stretch-vertical"],{disabled:!l}),Nw(o["distribute-horizontal"],{disabled:!c}),Nw(o["distribute-vertical"],{disabled:!c}),Nw(o["stack-horizontal"],{disabled:!u}),Nw(o["stack-vertical"],{disabled:!u}),Nw(o["send-to-back"],{disabled:!a}),Nw(o["send-backward"],{disabled:!a}),Nw(o["bring-forward"],{disabled:!a}),Nw(o["bring-to-front"],{disabled:!a}),f<5?Nw(o["zoom-to-100"],{disabled:!!g}):Nw(o["rotate-ccw"],{disabled:!a}),Nw(o["rotate-cw"],{disabled:!a}),Nw(o["edit-link"],{disabled:!p}),d?Nw(o.group,{disabled:!l}):h?Nw(o.ungroup):Nw(o.group,{disabled:!l})];return n?n(i,e,{actions:o,oneSelected:a,twoSelected:l,threeSelected:c}):e}),[i,g,d,n,o,a,l,c,u,h,p,f]);return(0,Zr.jsx)(Qw.Provider,{value:m,children:r})};function Jw(){const e=di();return q("showAutoSizeToggle",(()=>{const{selectedShapes:t}=e;return 1===t.length&&e.isShapeOfType(t[0],"text")&&!1===t[0].props.autoSize}),[e])}const ex=t.createContext({}),tx=W((function(e){var n;let{overrides:r,children:i}=e;const o=di(),s=Ow(),a=Jw(),l=function(){const e=di();return q("onlyFlippableShape",(()=>{const{selectedShapes:t}=e;return 1===t.length&&t.every((t=>e.isShapeOfType(t,"group")||e.isShapeOfType(t,"arrow")||e.isShapeOfType(t,"line")||e.isShapeOfType(t,"draw")))}),[e])}(),c=o.selectedShapeIds.length,u=c>0,d=c>1,h=c>2,p=Bw(),f=q("atLeastOneShapeOnPage",(()=>o.currentPageShapeIds.size>0),[]),g=q("isTransparentBg",(()=>o.instanceState.exportBackground),[]),m=Uw(),y=Hw(),v=Boolean(null===(n=window.navigator.clipboard)||void 0===n?void 0:n.write),b=Xw(),{onlySelectedShape:w}=o,x=w&&o.isShapeOrAncestorLocked(w),S=(0,t.useMemo)((()=>{let e=Lw([zw("selection",a&&Nw(s["toggle-auto-size"]),b&&!x&&Nw(s["edit-link"]),u&&!x&&Nw(s.duplicate),m&&!x&&Nw(s.group),y&&!x&&Nw(s.ungroup),u&&Nw(s["toggle-lock"])),zw("modify",(d||l)&&Rw("arrange","context-menu.arrange",d&&zw("align",Nw(s["align-left"]),Nw(s["align-center-horizontal"]),Nw(s["align-right"]),Nw(s["align-top"]),Nw(s["align-center-vertical"]),Nw(s["align-bottom"])),h&&zw("distribute",Nw(s["distribute-horizontal"]),Nw(s["distribute-vertical"])),d&&zw("stretch",Nw(s["stretch-horizontal"]),Nw(s["stretch-vertical"])),l&&!x&&zw("flip",Nw(s["flip-horizontal"]),Nw(s["flip-vertical"])),d&&zw("order",Nw(s.pack,{disabled:!d}),p&&Nw(s["stack-vertical"]),p&&Nw(s["stack-horizontal"]))),u&&!x&&Rw("reorder","context-menu.reorder",zw("reorder",Nw(s["bring-to-front"]),Nw(s["bring-forward"]),Nw(s["send-backward"]),Nw(s["send-to-back"]))),u&&!x&&Dw("MOVE_TO_PAGE_MENU",{readonlyOk:!1})),zw("clipboard-group",u&&!x&&Nw(s.cut),u&&Nw(s.copy),Ww&&Nw(s.paste)),f&&zw("conversions",Rw("copy-as","context-menu.copy-as",zw("copy-as-group",Nw(s["copy-as-svg"]),v&&Nw(s["copy-as-png"]),Nw(s["copy-as-json"])),zw("export-bg",Nw(s["toggle-transparent"],{checked:!g}))),Rw("export-as","context-menu.export-as",zw("export-as-group",Nw(s["export-as-svg"]),Nw(s["export-as-png"]),Nw(s["export-as-json"])),zw("export-bg,",Nw(s["toggle-transparent"],{checked:!g})))),f&&zw("set-selection-group",Nw(s["select-all"]),u&&Nw(s["select-none"])),u&&!x&&zw("delete-group",Nw(s.delete))]);return r&&(e=r(o,e,{actions:s,oneSelected:u,twoSelected:d,threeSelected:h,showAutoSizeToggle:a,showUngroup:y,onlyFlippableShapeSelected:l})),e}),[o,r,s,u,d,h,a,l,f,p,m,y,v,b,g,x]);return(0,Zr.jsx)(ex.Provider,{value:S,children:i})}));function nx(){const e=t.useContext(ex);if(!e)throw new Error("useContextMenuSchema must be used inside of a TLUiContextMenuSchemaProvider.");return e}const rx=t.createContext({});function ix(e){let{overrides:n,children:r}=e;const i=di(),o=iw(),{addDialog:s}=Iw(),a=Tw(),l=t.useMemo((()=>{const e=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(e){i.setCurrentTool("select"),o("select-tool",{source:e,id:"select"})}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(e){i.setCurrentTool("hand"),o("select-tool",{source:e,id:"hand"})}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",readonlyOk:!1,onSelect(e){i.setCurrentTool("eraser"),o("select-tool",{source:e,id:"eraser"})}},{id:"draw",label:"tool.draw",readonlyOk:!1,icon:"tool-pencil",kbd:"d,b,x",onSelect(e){i.setCurrentTool("draw"),o("select-tool",{source:e,id:"draw"})}},...[..._r.values].map((e=>({id:e,label:"tool.".concat(e),readonlyOk:!1,meta:{geo:e},kbd:"rectangle"===e?"r":"ellipse"===e?"o":void 0,icon:"geo-"+e,onSelect(t){i.batch((()=>{i.updateInstanceState({stylesForNextShape:{...i.instanceState.stylesForNextShape,[_r.id]:e}},{ephemeral:!0}),i.setCurrentTool("geo"),o("select-tool",{source:t,id:"geo-".concat(e)})}))}}))),{id:"arrow",label:"tool.arrow",readonlyOk:!1,icon:"tool-arrow",kbd:"a",onSelect(e){i.setCurrentTool("arrow"),o("select-tool",{source:e,id:"arrow"})}},{id:"line",label:"tool.line",readonlyOk:!1,icon:"tool-line",kbd:"l",onSelect(e){i.setCurrentTool("line"),o("select-tool",{source:e,id:"line"})}},{id:"frame",label:"tool.frame",readonlyOk:!1,icon:"tool-frame",kbd:"f",onSelect(e){i.setCurrentTool("frame"),o("select-tool",{source:e,id:"frame"})}},{id:"text",label:"tool.text",readonlyOk:!1,icon:"tool-text",kbd:"t",onSelect(e){i.setCurrentTool("text"),o("select-tool",{source:e,id:"text"})}},{id:"asset",label:"tool.asset",readonlyOk:!1,icon:"tool-media",kbd:"$u",onSelect(e){a(),o("select-tool",{source:e,id:"media"})}},{id:"note",label:"tool.note",readonlyOk:!1,icon:"tool-note",kbd:"n",onSelect(e){i.setCurrentTool("note"),o("select-tool",{source:e,id:"note"})}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(e){i.setCurrentTool("laser"),o("select-tool",{source:e,id:"laser"})}},{id:"embed",label:"tool.embed",readonlyOk:!1,icon:"tool-embed",onSelect(e){s({component:Rb}),o("select-tool",{source:e,id:"embed"})}}];e.push({id:"highlight",label:"tool.highlight",readonlyOk:!0,icon:"tool-highlight",kbd:"!d",onSelect(e){i.setCurrentTool("highlight"),o("select-tool",{source:e,id:"highlight"})}});const t=Object.fromEntries(e.map((e=>[e.id,e])));return n?n(i,t,{insertMedia:a}):t}),[n,i,o,a,s]);return(0,Zr.jsx)(rx.Provider,{value:l,children:r})}function ox(){const e=t.useContext(rx);if(!e)throw new Error("useTools must be used within a ToolProvider");return e}const sx=t.createContext({}),ax=W((function(e){let{overrides:n,children:r}=e;const i=di(),o=ox(),s=Ow(),a=(0,t.useMemo)((()=>{const e=Q([zw("shortcuts-dialog.tools",Nw(s["toggle-tool-lock"]),Nw(o.select),Nw(o.draw),Nw(o.eraser),Nw(o.hand),Nw(o.rectangle),Nw(o.ellipse),Nw(o.arrow),Nw(o.line),Nw(o.text),Nw(o.frame),Nw(o.note),Nw(o.laser)),zw("shortcuts-dialog.file",Nw(s["insert-media"]),Nw(s.print)),zw("shortcuts-dialog.preferences",Nw(s["toggle-dark-mode"]),Nw(s["toggle-focus-mode"]),Nw(s["toggle-grid"])),zw("shortcuts-dialog.edit",Nw(s.undo),Nw(s.redo),Nw(s.cut),Nw(s.copy),Nw(s.paste),Nw(s["select-all"]),Nw(s.delete),Nw(s.duplicate),Nw(s["export-as-svg"]),Nw(s["export-as-png"])),zw("shortcuts-dialog.view",Nw(s["zoom-in"]),Nw(s["zoom-out"]),Nw(s["zoom-to-100"]),Nw(s["zoom-to-fit"]),Nw(s["zoom-to-selection"])),zw("shortcuts-dialog.transform",Nw(s["bring-to-front"]),Nw(s["bring-forward"]),Nw(s["send-backward"]),Nw(s["send-to-back"]),Nw(s.group),Nw(s.ungroup),Nw(s["flip-horizontal"]),Nw(s["flip-vertical"]),Nw(s["align-top"]),Nw(s["align-center-vertical"]),Nw(s["align-bottom"]),Nw(s["align-left"]),Nw(s["align-center-horizontal"]),Nw(s["align-right"]))]);return n?n(i,e,{tools:o,actions:s}):e}),[i,n,s,o]);return(0,Zr.jsx)(sx.Provider,{value:a,children:r})}));const lx=()=>{const e=Oy(),n=Ld(),r=function(){const e=t.useContext(sx);if(!e)throw new Error("Shortcuts must be used inside of a ShortcutsProvider.");return e}();return(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsxs)(Eb,{className:"tlui-shortcuts-dialog__header",children:[(0,Zr.jsx)(Ib,{children:e("shortcuts-dialog.title")}),(0,Zr.jsx)(Mb,{})]}),(0,Zr.jsx)(Tb,{className:"tlui-shortcuts-dialog__body",children:r.map((function t(r){if(n&&!r.readonlyOk)return null;switch(r.type){case"group":return(0,Zr.jsxs)("div",{className:"tlui-shortcuts-dialog__group",children:[(0,Zr.jsx)("h2",{className:"tlui-shortcuts-dialog__group__title",children:e(r.id)}),(0,Zr.jsx)("div",{className:"tlui-shortcuts-dialog__group__content",children:r.children.filter((e=>"item"===e.type&&e.actionItem.kbd)).map(t)})]},r.id);case"item":{const{id:t,label:n,shortcutsLabel:i,kbd:o}=r.actionItem;return(0,Zr.jsxs)("div",{className:"tlui-shortcuts-dialog__key-pair",children:[(0,Zr.jsx)("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:e(null!==i&&void 0!==i?i:n)}),(0,Zr.jsx)("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:(0,Zr.jsx)(By,{children:o})})]},t)}}}))}),(0,Zr.jsx)("div",{className:"tlui-dialog__scrim"})]})};function cx(){const e=di();return{languages:Gr,currentLanguage:e.user.locale}}const ux=t.createContext({}),dx=W((function(e){let{overrides:n,children:r}=e;const i=di(),o=Ow(),s=i.selectedShapeIds.length,a=s>0,l=s>1,c=s>2,{languages:u,currentLanguage:d}=cx(),{addDialog:h}=Iw(),p=(0,t.useMemo)((()=>{const e=Q([zw("top",Dw("LANGUAGE_MENU",{readonlyOk:!0}),Nw({id:"keyboard-shortcuts",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect(){h({component:lx})}}))]);return n?n(i,e,{actions:o,currentLanguage:d,languages:u,oneSelected:a,twoSelected:l,threeSelected:c}):e}),[i,n,u,o,a,l,c,d,h]);return(0,Zr.jsx)(ux.Provider,{value:p,children:r})}));function hx(){const e=di();return q("useCanRedo",(()=>e.canRedo),[e])}function px(){const e=di();return q("useCanUndo",(()=>e.canUndo),[e])}const fx=t.createContext({});function gx(e){var n;let{overrides:r,children:i}=e;const o=di(),s=Ow(),a=Gw()<5,l=q("isDarkMode",(()=>o.user.isDarkMode),[o]),c=q("animationSpeed",(()=>o.user.animationSpeed),[o]),u=q("isGridMode",(()=>o.instanceState.isGridMode),[o]),d=q("isSnapMode",(()=>o.user.isSnapMode),[o]),h=q("isToolLock",(()=>o.instanceState.isToolLocked),[o]),p=q("isFocusMode",(()=>o.instanceState.isFocusMode),[o]),f=q("isDebugMode",(()=>o.instanceState.isDebugMode),[o]),g=q("exportBackground",(()=>o.instanceState.exportBackground),[o]),m=q("emptyPage",(()=>0===o.currentPageShapeIds.size),[o]),y=q("selectedCount",(()=>o.selectedShapeIds.length),[o]),v=0===y,b=y>0,w=y>1,x=y>2,S=Boolean(null===(n=window.navigator.clipboard)||void 0===n?void 0:n.write),k=Xw(),_=Jw(),P=Uw(),C=Hw(),E=px(),I=hx(),M=q("isZoomedTo100",(()=>1===o.zoomLevel),[o]),T=q("oneEmbedSelected",(()=>{const{onlySelectedShape:e}=o;return!!e&&!(!o.isShapeOfType(e,"embed")||!e.props.url||o.isShapeOrAncestorLocked(e))}),[]),A=q("oneEmbeddableBookmarkSelected",(()=>{const{onlySelectedShape:e}=o;return!!e&&!(!(o.isShapeOfType(e,"bookmark")&&e.props.url&&vh(e.props.url))||o.isShapeOrAncestorLocked(e))}),[]),j=(0,t.useMemo)((()=>{const e=Lw([zw("menu",Rw("file","menu.file",zw("print",Nw(s.print,{disabled:m}))),Rw("edit","menu.edit",zw("undo-actions",Nw(s.undo,{disabled:!E}),Nw(s.redo,{disabled:!I})),zw("clipboard-actions",Nw(s.cut,{disabled:v}),Nw(s.copy,{disabled:v}),Nw(s.paste,{disabled:!Ww})),zw("conversions",Rw("copy-as","menu.copy-as",zw("copy-as-group",Nw(s["copy-as-svg"],{disabled:m}),Nw(s["copy-as-png"],{disabled:m||!S}),Nw(s["copy-as-json"],{disabled:m})),zw("export-bg",Nw(s["toggle-transparent"],{checked:!g}))),Rw("export-as","menu.export-as",zw("export-as-group",Nw(s["export-as-svg"],{disabled:m}),Nw(s["export-as-png"],{disabled:m}),Nw(s["export-as-json"],{disabled:m})),zw("export-bg",Nw(s["toggle-transparent"],{checked:!g})))),zw("set-selection-group",Nw(s["select-all"],{disabled:m}),Nw(s["select-none"],{disabled:!b})),zw("selection",_&&Nw(s["toggle-auto-size"]),k&&Nw(s["edit-link"]),Nw(s.duplicate,{disabled:!b}),P&&Nw(s.group),C&&Nw(s.ungroup),Nw(s["unlock-all"],{disabled:m})),zw("delete-group",Nw(s.delete,{disabled:!b})),zw("embeds",T&&Nw(s["open-embed-link"]),T&&Nw(s["convert-to-bookmark"]),A&&Nw(s["convert-to-embed"]))),Rw("view","menu.view",zw("view-actions",Nw(s["zoom-in"]),Nw(s["zoom-out"]),Nw(s["zoom-to-100"],{disabled:M}),Nw(s["zoom-to-fit"],{disabled:m}),Nw(s["zoom-to-selection"],{disabled:m||!b})))),zw("extras",Nw(s["insert-embed"]),Nw(s["insert-media"])),zw("preferences",Rw("preferences","menu.preferences",zw("preferences-actions",Nw(s["toggle-snap-mode"],{checked:d}),Nw(s["toggle-tool-lock"],{checked:h}),Nw(s["toggle-grid"],{checked:u}),Nw(s["toggle-dark-mode"],{checked:l}),Nw(s["toggle-focus-mode"],{checked:p}),Nw(s["toggle-reduce-motion"],{checked:0===c}),Nw(s["toggle-debug-mode"],{checked:f}))),a&&Dw("LANGUAGE_MENU",{readonlyOk:!0}))]);return r?r(o,e,{actions:s,noneSelected:v,oneSelected:b,twoSelected:w,threeSelected:x}):e}),[o,r,s,b,w,x,m,a,P,C,k,S,_,v,E,I,c,l,u,d,h,p,g,f,M,A,T]);return(0,Zr.jsx)(fx.Provider,{value:j,children:i})}function mx(e){return{id:e.id,type:"item",readonlyOk:e.readonlyOk,toolItem:e}}const yx=t.createContext([]);function vx(e){let{overrides:n,children:r}=e;const i=di(),o=ox(),s=t.useMemo((()=>{const e=Q([mx(o.select),mx(o.hand),mx(o.draw),mx(o.eraser),mx(o.arrow),mx(o.text),mx(o.note),mx(o.asset),mx(o.rectangle),mx(o.ellipse),mx(o.diamond),mx(o.triangle),mx(o.trapezoid),mx(o.rhombus),mx(o.hexagon),mx(o.cloud),mx(o.star),mx(o.oval),mx(o["x-box"]),mx(o["check-box"]),mx(o["arrow-left"]),mx(o["arrow-up"]),mx(o["arrow-down"]),mx(o["arrow-right"]),mx(o.frame),mx(o.line),mx(o.highlight),mx(o.laser)]);return n?n(i,e,{tools:o}):e}),[i,n,o]);return(0,Zr.jsx)(yx.Provider,{value:s,children:r})}function bx(e){return(0,t.useMemo)((()=>e),e)}function wx(e){const n=bx(null==e?[]:Array.isArray(e)?e:[e]);return(0,t.useMemo)((()=>{const e={};for(const t of n)if(t.translations)for(const[n,r]of ve(t.translations)){let t=e[n];t||(t=e[n]={}),Object.assign(t,r)}return e}),[n])}function xx(e){const n=function(){const{addToast:e,removeToast:n,clearToasts:r}=xw(),{addDialog:i,clearDialogs:o,removeDialog:s,updateDialog:a}=Iw(),l=Gw()<5,c=Oy();return(0,t.useMemo)((()=>({addToast:e,removeToast:n,clearToasts:r,addDialog:i,clearDialogs:o,removeDialog:s,updateDialog:a,msg:c,isMobile:l})),[i,e,o,r,c,s,n,a,l])}(),r=bx(null==e?[]:Array.isArray(e)?e:[e]);return(0,t.useMemo)((()=>function(e,t){const n={};for(const r of e)if(r.translations)for(const[e,t]of ve(r.translations)){let r=n[e];r||(r=n[e]={}),Object.assign(r,t)}return{actionsMenu:(n,r,i)=>{for(const o of e)o.actionsMenu&&(r=o.actionsMenu(n,r,{...t,...i}));return r},actions:(n,r)=>{for(const i of e)i.actions&&(r=i.actions(n,r,t));return r},contextMenu:(n,r,i)=>{for(const o of e)o.contextMenu&&(r=o.contextMenu(n,r,{...t,...i}));return r},helpMenu:(n,r,i)=>{for(const o of e)o.helpMenu&&(r=o.helpMenu(n,r,{...t,...i}));return r},menu:(n,r,i)=>{for(const o of e)o.menu&&(r=o.menu(n,r,{...t,...i}));return r},toolbar:(n,r,i)=>{for(const o of e)o.toolbar&&(r=o.toolbar(n,r,{...t,...i}));return r},keyboardShortcutsMenu:(n,r,i)=>{for(const o of e)o.keyboardShortcutsMenu&&(r=o.keyboardShortcutsMenu(n,r,{...t,...i}));return r},tools:(n,r,i)=>{for(const o of e)o.tools&&(r=o.tools(n,r,{...t,...i}));return r},translations:n}}(r,n)),[r,n])}function Sx(e){let{overrides:t,assetUrls:n,onUiEvent:r,children:i}=e;return(0,Zr.jsx)(Cy,{assetUrls:_y(n),children:(0,Zr.jsx)(jy,{overrides:wx(t),children:(0,Zr.jsx)(rw,{onEvent:r,children:(0,Zr.jsx)(ww,{children:(0,Zr.jsx)(Ew,{children:(0,Zr.jsx)(qw,{children:(0,Zr.jsx)(kx,{overrides:t,children:i})})})})})})})}function kx(e){let{overrides:t,children:n}=e;const r=xx(t);return(0,Zr.jsx)(jw,{overrides:r.actions,children:(0,Zr.jsx)(ix,{overrides:r.tools,children:(0,Zr.jsx)(vx,{overrides:r.toolbar,children:(0,Zr.jsx)(Zw,{overrides:r.actionsMenu,children:(0,Zr.jsx)(ax,{overrides:r.keyboardShortcutsMenu,children:(0,Zr.jsx)(tx,{overrides:r.contextMenu,children:(0,Zr.jsx)(dx,{overrides:r.helpMenu,children:(0,Zr.jsx)(gx,{overrides:r.menu,children:n})})})})})})})})}function _x(){const e=di(),n=Ow()["back-to-content"],[r,i]=(0,t.useState)(!1);return(0,t.useEffect)((()=>{let t=!1;const n=setInterval((()=>{const{renderingShapes:n,renderingBounds:r}=e,o=0===n.filter((e=>e.maskedPageBounds&&r.includes(e.maskedPageBounds))).length&&e.currentPageShapes.length>0;t!==o&&(i(o),t=o)}),1e3);return()=>{clearInterval(n)}}),[e]),r?(0,Zr.jsx)(Uy,{iconLeft:n.icon,label:n.label,type:"low",onClick:()=>{n.onSelect("helper-buttons"),i(!1)}}):null}const Px=(0,t.createContext)(void 0);function Cx(e){const n=(0,t.useContext)(Px);return e||n||"ltr"}const Ex=["top","right","bottom","left"],Ix=Math.min,Mx=Math.max,Tx=Math.round,Ax=Math.floor,jx=e=>({x:e,y:e}),Ox={left:"right",right:"left",bottom:"top",top:"bottom"},Lx={start:"end",end:"start"};function zx(e,t,n){return Mx(e,Ix(t,n))}function Rx(e,t){return"function"===typeof e?e(t):e}function Dx(e){return e.split("-")[0]}function Nx(e){return e.split("-")[1]}function Fx(e){return"x"===e?"y":"x"}function Bx(e){return"y"===e?"height":"width"}function Ux(e){return["top","bottom"].includes(Dx(e))?"y":"x"}function Hx(e){return Fx(Ux(e))}function Vx(e){return e.replace(/start|end/g,(e=>Lx[e]))}function Kx(e){return e.replace(/left|right|bottom|top/g,(e=>Ox[e]))}function Wx(e){return"number"!==typeof e?function(e){return{top:0,right:0,bottom:0,left:0,...e}}(e):{top:e,right:e,bottom:e,left:e}}function $x(e){return{...e,top:e.y,left:e.x,right:e.x+e.width,bottom:e.y+e.height}}function Yx(e,t,n){let{reference:r,floating:i}=e;const o=Ux(t),s=Hx(t),a=Bx(s),l=Dx(t),c="y"===o,u=r.x+r.width/2-i.width/2,d=r.y+r.height/2-i.height/2,h=r[a]/2-i[a]/2;let p;switch(l){case"top":p={x:u,y:r.y-i.height};break;case"bottom":p={x:u,y:r.y+r.height};break;case"right":p={x:r.x+r.width,y:d};break;case"left":p={x:r.x-i.width,y:d};break;default:p={x:r.x,y:r.y}}switch(Nx(t)){case"start":p[s]-=h*(n&&c?-1:1);break;case"end":p[s]+=h*(n&&c?-1:1)}return p}async function qx(e,t){var n;void 0===t&&(t={});const{x:r,y:i,platform:o,rects:s,elements:a,strategy:l}=e,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:h=!1,padding:p=0}=Rx(t,e),f=Wx(p),g=a[h?"floating"===d?"reference":"floating":d],m=$x(await o.getClippingRect({element:null==(n=await(null==o.isElement?void 0:o.isElement(g)))||n?g:g.contextElement||await(null==o.getDocumentElement?void 0:o.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),y="floating"===d?{...s.floating,x:r,y:i}:s.reference,v=await(null==o.getOffsetParent?void 0:o.getOffsetParent(a.floating)),b=await(null==o.isElement?void 0:o.isElement(v))&&await(null==o.getScale?void 0:o.getScale(v))||{x:1,y:1},w=$x(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({rect:y,offsetParent:v,strategy:l}):y);return{top:(m.top-w.top+f.top)/b.y,bottom:(w.bottom-m.bottom+f.bottom)/b.y,left:(m.left-w.left+f.left)/b.x,right:(w.right-m.right+f.right)/b.x}}const Gx=e=>({name:"arrow",options:e,async fn(t){const{x:n,y:r,placement:i,rects:o,platform:s,elements:a,middlewareData:l}=t,{element:c,padding:u=0}=Rx(e,t)||{};if(null==c)return{};const d=Wx(u),h={x:n,y:r},p=Hx(i),f=Bx(p),g=await s.getDimensions(c),m="y"===p,y=m?"top":"left",v=m?"bottom":"right",b=m?"clientHeight":"clientWidth",w=o.reference[f]+o.reference[p]-h[p]-o.floating[f],x=h[p]-o.reference[p],S=await(null==s.getOffsetParent?void 0:s.getOffsetParent(c));let k=S?S[b]:0;k&&await(null==s.isElement?void 0:s.isElement(S))||(k=a.floating[b]||o.floating[f]);const _=w/2-x/2,P=k/2-g[f]/2-1,C=Ix(d[y],P),E=Ix(d[v],P),I=C,M=k-g[f]-E,T=k/2-g[f]/2+_,A=zx(I,T,M),j=!l.arrow&&null!=Nx(i)&&T!=A&&o.reference[f]/2-(T<I?C:E)-g[f]/2<0,O=j?T<I?T-I:T-M:0;return{[p]:h[p]+O,data:{[p]:A,centerOffset:T-A-O,...j&&{alignmentOffset:O}},reset:j}}});const Xx=function(e){return void 0===e&&(e={}),{name:"flip",options:e,async fn(t){var n,r;const{placement:i,middlewareData:o,rects:s,initialPlacement:a,platform:l,elements:c}=t,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:h,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:f="none",flipAlignment:g=!0,...m}=Rx(e,t);if(null!=(n=o.arrow)&&n.alignmentOffset)return{};const y=Dx(i),v=Dx(a)===a,b=await(null==l.isRTL?void 0:l.isRTL(c.floating)),w=h||(v||!g?[Kx(a)]:function(e){const t=Kx(e);return[Vx(e),t,Vx(t)]}(a));h||"none"===f||w.push(...function(e,t,n,r){const i=Nx(e);let o=function(e,t,n){const r=["left","right"],i=["right","left"],o=["top","bottom"],s=["bottom","top"];switch(e){case"top":case"bottom":return n?t?i:r:t?r:i;case"left":case"right":return t?o:s;default:return[]}}(Dx(e),"start"===n,r);return i&&(o=o.map((e=>e+"-"+i)),t&&(o=o.concat(o.map(Vx)))),o}(a,g,f,b));const x=[a,...w],S=await qx(t,m),k=[];let _=(null==(r=o.flip)?void 0:r.overflows)||[];if(u&&k.push(S[y]),d){const e=function(e,t,n){void 0===n&&(n=!1);const r=Nx(e),i=Hx(e),o=Bx(i);let s="x"===i?r===(n?"end":"start")?"right":"left":"start"===r?"bottom":"top";return t.reference[o]>t.floating[o]&&(s=Kx(s)),[s,Kx(s)]}(i,s,b);k.push(S[e[0]],S[e[1]])}if(_=[..._,{placement:i,overflows:k}],!k.every((e=>e<=0))){var P,C;const e=((null==(P=o.flip)?void 0:P.index)||0)+1,t=x[e];if(t)return{data:{index:e,overflows:_},reset:{placement:t}};let n=null==(C=_.filter((e=>e.overflows[0]<=0)).sort(((e,t)=>e.overflows[1]-t.overflows[1]))[0])?void 0:C.placement;if(!n)switch(p){case"bestFit":{var E;const e=null==(E=_.map((e=>[e.placement,e.overflows.filter((e=>e>0)).reduce(((e,t)=>e+t),0)])).sort(((e,t)=>e[1]-t[1]))[0])?void 0:E[0];e&&(n=e);break}case"initialPlacement":n=a}if(i!==n)return{reset:{placement:n}}}return{}}}};function Qx(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function Zx(e){return Ex.some((t=>e[t]>=0))}const Jx=function(e){return void 0===e&&(e={}),{name:"hide",options:e,async fn(t){const{rects:n}=t,{strategy:r="referenceHidden",...i}=Rx(e,t);switch(r){case"referenceHidden":{const e=Qx(await qx(t,{...i,elementContext:"reference"}),n.reference);return{data:{referenceHiddenOffsets:e,referenceHidden:Zx(e)}}}case"escaped":{const e=Qx(await qx(t,{...i,altBoundary:!0}),n.floating);return{data:{escapedOffsets:e,escaped:Zx(e)}}}default:return{}}}}};const eS=function(e){return void 0===e&&(e=0),{name:"offset",options:e,async fn(t){const{x:n,y:r}=t,i=await async function(e,t){const{placement:n,platform:r,elements:i}=e,o=await(null==r.isRTL?void 0:r.isRTL(i.floating)),s=Dx(n),a=Nx(n),l="y"===Ux(n),c=["left","top"].includes(s)?-1:1,u=o&&l?-1:1,d=Rx(t,e);let{mainAxis:h,crossAxis:p,alignmentAxis:f}="number"===typeof d?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...d};return a&&"number"===typeof f&&(p="end"===a?-1*f:f),l?{x:p*u,y:h*c}:{x:h*c,y:p*u}}(t,e);return{x:n+i.x,y:r+i.y,data:i}}}},tS=function(e){return void 0===e&&(e={}),{name:"shift",options:e,async fn(t){const{x:n,y:r,placement:i}=t,{mainAxis:o=!0,crossAxis:s=!1,limiter:a={fn:e=>{let{x:t,y:n}=e;return{x:t,y:n}}},...l}=Rx(e,t),c={x:n,y:r},u=await qx(t,l),d=Ux(Dx(i)),h=Fx(d);let p=c[h],f=c[d];if(o){const e="y"===h?"bottom":"right";p=zx(p+u["y"===h?"top":"left"],p,p-u[e])}if(s){const e="y"===d?"bottom":"right";f=zx(f+u["y"===d?"top":"left"],f,f-u[e])}const g=a.fn({...t,[h]:p,[d]:f});return{...g,data:{x:g.x-n,y:g.y-r}}}}},nS=function(e){return void 0===e&&(e={}),{options:e,fn(t){const{x:n,y:r,placement:i,rects:o,middlewareData:s}=t,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=Rx(e,t),u={x:n,y:r},d=Ux(i),h=Fx(d);let p=u[h],f=u[d];const g=Rx(a,t),m="number"===typeof g?{mainAxis:g,crossAxis:0}:{mainAxis:0,crossAxis:0,...g};if(l){const e="y"===h?"height":"width",t=o.reference[h]-o.floating[e]+m.mainAxis,n=o.reference[h]+o.reference[e]-m.mainAxis;p<t?p=t:p>n&&(p=n)}if(c){var y,v;const e="y"===h?"width":"height",t=["top","left"].includes(Dx(i)),n=o.reference[d]-o.floating[e]+(t&&(null==(y=s.offset)?void 0:y[d])||0)+(t?0:m.crossAxis),r=o.reference[d]+o.reference[e]+(t?0:(null==(v=s.offset)?void 0:v[d])||0)-(t?m.crossAxis:0);f<n?f=n:f>r&&(f=r)}return{[h]:p,[d]:f}}}},rS=function(e){return void 0===e&&(e={}),{name:"size",options:e,async fn(t){const{placement:n,rects:r,platform:i,elements:o}=t,{apply:s=(()=>{}),...a}=Rx(e,t),l=await qx(t,a),c=Dx(n),u=Nx(n),d="y"===Ux(n),{width:h,height:p}=r.floating;let f,g;"top"===c||"bottom"===c?(f=c,g=u===(await(null==i.isRTL?void 0:i.isRTL(o.floating))?"start":"end")?"left":"right"):(g=c,f="end"===u?"top":"bottom");const m=p-l[f],y=h-l[g],v=!t.middlewareData.shift;let b=m,w=y;if(d){const e=h-l.left-l.right;w=u||v?Ix(y,e):e}else{const e=p-l.top-l.bottom;b=u||v?Ix(m,e):e}if(v&&!u){const e=Mx(l.left,0),t=Mx(l.right,0),n=Mx(l.top,0),r=Mx(l.bottom,0);d?w=h-2*(0!==e||0!==t?e+t:Mx(l.left,l.right)):b=p-2*(0!==n||0!==r?n+r:Mx(l.top,l.bottom))}await s({...t,availableWidth:w,availableHeight:b});const x=await i.getDimensions(o.floating);return h!==x.width||p!==x.height?{reset:{rects:!0}}:{}}}};function iS(e){return aS(e)?(e.nodeName||"").toLowerCase():"#document"}function oS(e){var t;return(null==e||null==(t=e.ownerDocument)?void 0:t.defaultView)||window}function sS(e){var t;return null==(t=(aS(e)?e.ownerDocument:e.document)||window.document)?void 0:t.documentElement}function aS(e){return e instanceof Node||e instanceof oS(e).Node}function lS(e){return e instanceof Element||e instanceof oS(e).Element}function cS(e){return e instanceof HTMLElement||e instanceof oS(e).HTMLElement}function uS(e){return"undefined"!==typeof ShadowRoot&&(e instanceof ShadowRoot||e instanceof oS(e).ShadowRoot)}function dS(e){const{overflow:t,overflowX:n,overflowY:r,display:i}=mS(e);return/auto|scroll|overlay|hidden|clip/.test(t+r+n)&&!["inline","contents"].includes(i)}function hS(e){return["table","td","th"].includes(iS(e))}function pS(e){const t=fS(),n=mS(e);return"none"!==n.transform||"none"!==n.perspective||!!n.containerType&&"normal"!==n.containerType||!t&&!!n.backdropFilter&&"none"!==n.backdropFilter||!t&&!!n.filter&&"none"!==n.filter||["transform","perspective","filter"].some((e=>(n.willChange||"").includes(e)))||["paint","layout","strict","content"].some((e=>(n.contain||"").includes(e)))}function fS(){return!("undefined"===typeof CSS||!CSS.supports)&&CSS.supports("-webkit-backdrop-filter","none")}function gS(e){return["html","body","#document"].includes(iS(e))}function mS(e){return oS(e).getComputedStyle(e)}function yS(e){return lS(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function vS(e){if("html"===iS(e))return e;const t=e.assignedSlot||e.parentNode||uS(e)&&e.host||sS(e);return uS(t)?t.host:t}function bS(e){const t=vS(e);return gS(t)?e.ownerDocument?e.ownerDocument.body:e.body:cS(t)&&dS(t)?t:bS(t)}function wS(e,t,n){var r;void 0===t&&(t=[]),void 0===n&&(n=!0);const i=bS(e),o=i===(null==(r=e.ownerDocument)?void 0:r.body),s=oS(i);return o?t.concat(s,s.visualViewport||[],dS(i)?i:[],s.frameElement&&n?wS(s.frameElement):[]):t.concat(i,wS(i,[],n))}function xS(e){const t=mS(e);let n=parseFloat(t.width)||0,r=parseFloat(t.height)||0;const i=cS(e),o=i?e.offsetWidth:n,s=i?e.offsetHeight:r,a=Tx(n)!==o||Tx(r)!==s;return a&&(n=o,r=s),{width:n,height:r,$:a}}function SS(e){return lS(e)?e:e.contextElement}function kS(e){const t=SS(e);if(!cS(t))return jx(1);const n=t.getBoundingClientRect(),{width:r,height:i,$:o}=xS(t);let s=(o?Tx(n.width):n.width)/r,a=(o?Tx(n.height):n.height)/i;return s&&Number.isFinite(s)||(s=1),a&&Number.isFinite(a)||(a=1),{x:s,y:a}}const _S=jx(0);function PS(e){const t=oS(e);return fS()&&t.visualViewport?{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}:_S}function CS(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=!1);const i=e.getBoundingClientRect(),o=SS(e);let s=jx(1);t&&(r?lS(r)&&(s=kS(r)):s=kS(e));const a=function(e,t,n){return void 0===t&&(t=!1),!(!n||t&&n!==oS(e))&&t}(o,n,r)?PS(o):jx(0);let l=(i.left+a.x)/s.x,c=(i.top+a.y)/s.y,u=i.width/s.x,d=i.height/s.y;if(o){const e=oS(o),t=r&&lS(r)?oS(r):r;let n=e.frameElement;for(;n&&r&&t!==e;){const e=kS(n),t=n.getBoundingClientRect(),r=mS(n),i=t.left+(n.clientLeft+parseFloat(r.paddingLeft))*e.x,o=t.top+(n.clientTop+parseFloat(r.paddingTop))*e.y;l*=e.x,c*=e.y,u*=e.x,d*=e.y,l+=i,c+=o,n=oS(n).frameElement}}return $x({width:u,height:d,x:l,y:c})}function ES(e){return CS(sS(e)).left+yS(e).scrollLeft}function IS(e,t,n){let r;if("viewport"===t)r=function(e,t){const n=oS(e),r=sS(e),i=n.visualViewport;let o=r.clientWidth,s=r.clientHeight,a=0,l=0;if(i){o=i.width,s=i.height;const e=fS();(!e||e&&"fixed"===t)&&(a=i.offsetLeft,l=i.offsetTop)}return{width:o,height:s,x:a,y:l}}(e,n);else if("document"===t)r=function(e){const t=sS(e),n=yS(e),r=e.ownerDocument.body,i=Mx(t.scrollWidth,t.clientWidth,r.scrollWidth,r.clientWidth),o=Mx(t.scrollHeight,t.clientHeight,r.scrollHeight,r.clientHeight);let s=-n.scrollLeft+ES(e);const a=-n.scrollTop;return"rtl"===mS(r).direction&&(s+=Mx(t.clientWidth,r.clientWidth)-i),{width:i,height:o,x:s,y:a}}(sS(e));else if(lS(t))r=function(e,t){const n=CS(e,!0,"fixed"===t),r=n.top+e.clientTop,i=n.left+e.clientLeft,o=cS(e)?kS(e):jx(1);return{width:e.clientWidth*o.x,height:e.clientHeight*o.y,x:i*o.x,y:r*o.y}}(t,n);else{const n=PS(e);r={...t,x:t.x-n.x,y:t.y-n.y}}return $x(r)}function MS(e,t){const n=vS(e);return!(n===t||!lS(n)||gS(n))&&("fixed"===mS(n).position||MS(n,t))}function TS(e,t,n){const r=cS(t),i=sS(t),o="fixed"===n,s=CS(e,!0,o,t);let a={scrollLeft:0,scrollTop:0};const l=jx(0);if(r||!r&&!o)if(("body"!==iS(t)||dS(i))&&(a=yS(t)),r){const e=CS(t,!0,o,t);l.x=e.x+t.clientLeft,l.y=e.y+t.clientTop}else i&&(l.x=ES(i));return{x:s.left+a.scrollLeft-l.x,y:s.top+a.scrollTop-l.y,width:s.width,height:s.height}}function AS(e,t){return cS(e)&&"fixed"!==mS(e).position?t?t(e):e.offsetParent:null}function jS(e,t){const n=oS(e);if(!cS(e))return n;let r=AS(e,t);for(;r&&hS(r)&&"static"===mS(r).position;)r=AS(r,t);return r&&("html"===iS(r)||"body"===iS(r)&&"static"===mS(r).position&&!pS(r))?n:r||function(e){let t=vS(e);for(;cS(t)&&!gS(t);){if(pS(t))return t;t=vS(t)}return null}(e)||n}const OS={convertOffsetParentRelativeRectToViewportRelativeRect:function(e){let{rect:t,offsetParent:n,strategy:r}=e;const i=cS(n),o=sS(n);if(n===o)return t;let s={scrollLeft:0,scrollTop:0},a=jx(1);const l=jx(0);if((i||!i&&"fixed"!==r)&&(("body"!==iS(n)||dS(o))&&(s=yS(n)),cS(n))){const e=CS(n);a=kS(n),l.x=e.x+n.clientLeft,l.y=e.y+n.clientTop}return{width:t.width*a.x,height:t.height*a.y,x:t.x*a.x-s.scrollLeft*a.x+l.x,y:t.y*a.y-s.scrollTop*a.y+l.y}},getDocumentElement:sS,getClippingRect:function(e){let{element:t,boundary:n,rootBoundary:r,strategy:i}=e;const o=[..."clippingAncestors"===n?function(e,t){const n=t.get(e);if(n)return n;let r=wS(e,[],!1).filter((e=>lS(e)&&"body"!==iS(e))),i=null;const o="fixed"===mS(e).position;let s=o?vS(e):e;for(;lS(s)&&!gS(s);){const t=mS(s),n=pS(s);n||"fixed"!==t.position||(i=null),(o?!n&&!i:!n&&"static"===t.position&&i&&["absolute","fixed"].includes(i.position)||dS(s)&&!n&&MS(e,s))?r=r.filter((e=>e!==s)):i=t,s=vS(s)}return t.set(e,r),r}(t,this._c):[].concat(n),r],s=o[0],a=o.reduce(((e,n)=>{const r=IS(t,n,i);return e.top=Mx(r.top,e.top),e.right=Ix(r.right,e.right),e.bottom=Ix(r.bottom,e.bottom),e.left=Mx(r.left,e.left),e}),IS(t,s,i));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}},getOffsetParent:jS,getElementRects:async function(e){let{reference:t,floating:n,strategy:r}=e;const i=this.getOffsetParent||jS,o=this.getDimensions;return{reference:TS(t,await i(n),r),floating:{x:0,y:0,...await o(n)}}},getClientRects:function(e){return Array.from(e.getClientRects())},getDimensions:function(e){return xS(e)},getScale:kS,isElement:lS,isRTL:function(e){return"rtl"===mS(e).direction}};function LS(e,t,n,r){void 0===r&&(r={});const{ancestorScroll:i=!0,ancestorResize:o=!0,elementResize:s="function"===typeof ResizeObserver,layoutShift:a="function"===typeof IntersectionObserver,animationFrame:l=!1}=r,c=SS(e),u=i||o?[...c?wS(c):[],...wS(t)]:[];u.forEach((e=>{i&&e.addEventListener("scroll",n,{passive:!0}),o&&e.addEventListener("resize",n)}));const d=c&&a?function(e,t){let n,r=null;const i=sS(e);function o(){clearTimeout(n),r&&r.disconnect(),r=null}return function s(a,l){void 0===a&&(a=!1),void 0===l&&(l=1),o();const{left:c,top:u,width:d,height:h}=e.getBoundingClientRect();if(a||t(),!d||!h)return;const p={rootMargin:-Ax(u)+"px "+-Ax(i.clientWidth-(c+d))+"px "+-Ax(i.clientHeight-(u+h))+"px "+-Ax(c)+"px",threshold:Mx(0,Ix(1,l))||1};let f=!0;function g(e){const t=e[0].intersectionRatio;if(t!==l){if(!f)return s();t?s(!1,t):n=setTimeout((()=>{s(!1,1e-7)}),100)}f=!1}try{r=new IntersectionObserver(g,{...p,root:i.ownerDocument})}catch(ZI){r=new IntersectionObserver(g,p)}r.observe(e)}(!0),o}(c,n):null;let h,p=-1,f=null;s&&(f=new ResizeObserver((e=>{let[r]=e;r&&r.target===c&&f&&(f.unobserve(t),cancelAnimationFrame(p),p=requestAnimationFrame((()=>{f&&f.observe(t)}))),n()})),c&&!l&&f.observe(c),f.observe(t));let g=l?CS(e):null;return l&&function t(){const r=CS(e);!g||r.x===g.x&&r.y===g.y&&r.width===g.width&&r.height===g.height||n();g=r,h=requestAnimationFrame(t)}(),n(),()=>{u.forEach((e=>{i&&e.removeEventListener("scroll",n),o&&e.removeEventListener("resize",n)})),d&&d(),f&&f.disconnect(),f=null,l&&cancelAnimationFrame(h)}}const zS=(e,t,n)=>{const r=new Map,i={platform:OS,...n},o={...i.platform,_c:r};return(async(e,t,n)=>{const{placement:r="bottom",strategy:i="absolute",middleware:o=[],platform:s}=n,a=o.filter(Boolean),l=await(null==s.isRTL?void 0:s.isRTL(t));let c=await s.getElementRects({reference:e,floating:t,strategy:i}),{x:u,y:d}=Yx(c,r,l),h=r,p={},f=0;for(let g=0;g<a.length;g++){const{name:n,fn:o}=a[g],{x:m,y:y,data:v,reset:b}=await o({x:u,y:d,initialPlacement:r,placement:h,strategy:i,middlewareData:p,rects:c,platform:s,elements:{reference:e,floating:t}});u=null!=m?m:u,d=null!=y?y:d,p={...p,[n]:{...p[n],...v}},b&&f<=50&&(f++,"object"===typeof b&&(b.placement&&(h=b.placement),b.rects&&(c=!0===b.rects?await s.getElementRects({reference:e,floating:t,strategy:i}):b.rects),({x:u,y:d}=Yx(c,h,l))),g=-1)}return{x:u,y:d,placement:h,strategy:i,middlewareData:p}})(e,t,{...i,platform:o})},RS=e=>({name:"arrow",options:e,fn(t){const{element:n,padding:r}="function"===typeof e?e(t):e;return n&&(i=n,{}.hasOwnProperty.call(i,"current"))?null!=n.current?Gx({element:n.current,padding:r}).fn(t):{}:n?Gx({element:n,padding:r}).fn(t):{};var i}});var DS="undefined"!==typeof document?t.useLayoutEffect:t.useEffect;function NS(e,t){if(e===t)return!0;if(typeof e!==typeof t)return!1;if("function"===typeof e&&e.toString()===t.toString())return!0;let n,r,i;if(e&&t&&"object"==typeof e){if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(r=n;0!==r--;)if(!NS(e[r],t[r]))return!1;return!0}if(i=Object.keys(e),n=i.length,n!==Object.keys(t).length)return!1;for(r=n;0!==r--;)if(!{}.hasOwnProperty.call(t,i[r]))return!1;for(r=n;0!==r--;){const n=i[r];if(("_owner"!==n||!e.$$typeof)&&!NS(e[n],t[n]))return!1}return!0}return e!==e&&t!==t}function FS(e){if("undefined"===typeof window)return 1;return(e.ownerDocument.defaultView||window).devicePixelRatio||1}function BS(e,t){const n=FS(e);return Math.round(t*n)/n}function US(e){const n=t.useRef(e);return DS((()=>{n.current=e})),n}function HS(e){const[n,r]=(0,t.useState)(void 0);return Am((()=>{if(e){r({width:e.offsetWidth,height:e.offsetHeight});const t=new ResizeObserver((t=>{if(!Array.isArray(t))return;if(!t.length)return;const n=t[0];let i,o;if("borderBoxSize"in n){const e=n.borderBoxSize,t=Array.isArray(e)?e[0]:e;i=t.inlineSize,o=t.blockSize}else i=e.offsetWidth,o=e.offsetHeight;r({width:i,height:o})}));return t.observe(e,{box:"border-box"}),()=>t.unobserve(e)}r(void 0)}),[e]),n}const VS="Popper",[KS,WS]=lm(VS),[$S,YS]=KS(VS),qS=e=>{const{__scopePopper:n,children:r}=e,[i,o]=(0,t.useState)(null);return(0,t.createElement)($S,{scope:n,anchor:i,onAnchorChange:o},r)},GS="PopperAnchor",XS=(0,t.forwardRef)(((e,n)=>{const{__scopePopper:r,virtualRef:i,...o}=e,s=YS(GS,r),a=(0,t.useRef)(null),l=am(n,a);return(0,t.useEffect)((()=>{s.onAnchorChange((null===i||void 0===i?void 0:i.current)||a.current)})),i?null:(0,t.createElement)(mm.div,im({},o,{ref:l}))})),QS="PopperContent",[ZS,JS]=KS(QS),ek=(0,t.forwardRef)(((n,r)=>{var i,o,s,a,l,c,u,d;const{__scopePopper:h,side:p="bottom",sideOffset:f=0,align:g="center",alignOffset:m=0,arrowPadding:y=0,avoidCollisions:v=!0,collisionBoundary:b=[],collisionPadding:w=0,sticky:x="partial",hideWhenDetached:S=!1,updatePositionStrategy:k="optimized",onPlaced:_,...P}=n,C=YS(QS,h),[E,I]=(0,t.useState)(null),M=am(r,(e=>I(e))),[T,A]=(0,t.useState)(null),j=HS(T),O=null!==(i=null===j||void 0===j?void 0:j.width)&&void 0!==i?i:0,L=null!==(o=null===j||void 0===j?void 0:j.height)&&void 0!==o?o:0,z=p+("center"!==g?"-"+g:""),R="number"===typeof w?w:{top:0,right:0,bottom:0,left:0,...w},D=Array.isArray(b)?b:[b],N=D.length>0,F={padding:R,boundary:D.filter(tk),altBoundary:N},{refs:B,floatingStyles:U,placement:H,isPositioned:V,middlewareData:K}=function(n){void 0===n&&(n={});const{placement:r="bottom",strategy:i="absolute",middleware:o=[],platform:s,elements:{reference:a,floating:l}={},transform:c=!0,whileElementsMounted:u,open:d}=n,[h,p]=t.useState({x:0,y:0,strategy:i,placement:r,middlewareData:{},isPositioned:!1}),[f,g]=t.useState(o);NS(f,o)||g(o);const[m,y]=t.useState(null),[v,b]=t.useState(null),w=t.useCallback((e=>{e!=_.current&&(_.current=e,y(e))}),[y]),x=t.useCallback((e=>{e!==P.current&&(P.current=e,b(e))}),[b]),S=a||m,k=l||v,_=t.useRef(null),P=t.useRef(null),C=t.useRef(h),E=US(u),I=US(s),M=t.useCallback((()=>{if(!_.current||!P.current)return;const t={placement:r,strategy:i,middleware:f};I.current&&(t.platform=I.current),zS(_.current,P.current,t).then((t=>{const n={...t,isPositioned:!0};T.current&&!NS(C.current,n)&&(C.current=n,e.flushSync((()=>{p(n)})))}))}),[f,r,i,I]);DS((()=>{!1===d&&C.current.isPositioned&&(C.current.isPositioned=!1,p((e=>({...e,isPositioned:!1}))))}),[d]);const T=t.useRef(!1);DS((()=>(T.current=!0,()=>{T.current=!1})),[]),DS((()=>{if(S&&(_.current=S),k&&(P.current=k),S&&k){if(E.current)return E.current(S,k,M);M()}}),[S,k,M,E]);const A=t.useMemo((()=>({reference:_,floating:P,setReference:w,setFloating:x})),[w,x]),j=t.useMemo((()=>({reference:S,floating:k})),[S,k]),O=t.useMemo((()=>{const e={position:i,left:0,top:0};if(!j.floating)return e;const t=BS(j.floating,h.x),n=BS(j.floating,h.y);return c?{...e,transform:"translate("+t+"px, "+n+"px)",...FS(j.floating)>=1.5&&{willChange:"transform"}}:{position:i,left:t,top:n}}),[i,c,j.floating,h.x,h.y]);return t.useMemo((()=>({...h,update:M,refs:A,elements:j,floatingStyles:O})),[h,M,A,j,O])}({strategy:"fixed",placement:z,whileElementsMounted:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return LS(...t,{animationFrame:"always"===k})},elements:{reference:C.anchor},middleware:[eS({mainAxis:f+L,alignmentAxis:m}),v&&tS({mainAxis:!0,crossAxis:!1,limiter:"partial"===x?nS():void 0,...F}),v&&Xx({...F}),rS({...F,apply:e=>{let{elements:t,rects:n,availableWidth:r,availableHeight:i}=e;const{width:o,height:s}=n.reference,a=t.floating.style;a.setProperty("--radix-popper-available-width","".concat(r,"px")),a.setProperty("--radix-popper-available-height","".concat(i,"px")),a.setProperty("--radix-popper-anchor-width","".concat(o,"px")),a.setProperty("--radix-popper-anchor-height","".concat(s,"px"))}}),T&&RS({element:T,padding:y}),nk({arrowWidth:O,arrowHeight:L}),S&&Jx({strategy:"referenceHidden",...F})]}),[W,$]=rk(H),Y=vm(_);Am((()=>{V&&(null===Y||void 0===Y||Y())}),[V,Y]);const q=null===(s=K.arrow)||void 0===s?void 0:s.x,G=null===(a=K.arrow)||void 0===a?void 0:a.y,X=0!==(null===(l=K.arrow)||void 0===l?void 0:l.centerOffset),[Q,Z]=(0,t.useState)();return Am((()=>{E&&Z(window.getComputedStyle(E).zIndex)}),[E]),(0,t.createElement)("div",{ref:B.setFloating,"data-radix-popper-content-wrapper":"",style:{...U,transform:V?U.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Q,"--radix-popper-transform-origin":[null===(c=K.transformOrigin)||void 0===c?void 0:c.x,null===(u=K.transformOrigin)||void 0===u?void 0:u.y].join(" ")},dir:n.dir},(0,t.createElement)(ZS,{scope:h,placedSide:W,onArrowChange:A,arrowX:q,arrowY:G,shouldHideArrow:X},(0,t.createElement)(mm.div,im({"data-side":W,"data-align":$},P,{ref:M,style:{...P.style,animation:V?void 0:"none",opacity:null!==(d=K.hide)&&void 0!==d&&d.referenceHidden?0:void 0}}))))}));function tk(e){return null!==e}const nk=e=>({name:"transformOrigin",options:e,fn(t){var n,r,i,o,s;const{placement:a,rects:l,middlewareData:c}=t,u=0!==(null===(n=c.arrow)||void 0===n?void 0:n.centerOffset),d=u?0:e.arrowWidth,h=u?0:e.arrowHeight,[p,f]=rk(a),g={start:"0%",center:"50%",end:"100%"}[f],m=(null!==(r=null===(i=c.arrow)||void 0===i?void 0:i.x)&&void 0!==r?r:0)+d/2,y=(null!==(o=null===(s=c.arrow)||void 0===s?void 0:s.y)&&void 0!==o?o:0)+h/2;let v="",b="";return"bottom"===p?(v=u?g:"".concat(m,"px"),b="".concat(-h,"px")):"top"===p?(v=u?g:"".concat(m,"px"),b="".concat(l.floating.height+h,"px")):"right"===p?(v="".concat(-h,"px"),b=u?g:"".concat(y,"px")):"left"===p&&(v="".concat(l.floating.width+h,"px"),b=u?g:"".concat(y,"px")),{data:{x:v,y:b}}}});function rk(e){const[t,n="center"]=e.split("-");return[t,n]}const ik=qS,ok=XS,sk=ek,ak="rovingFocusGroup.onEntryFocus",lk={bubbles:!1,cancelable:!0},ck="RovingFocusGroup",[uk,dk,hk]=gm(ck),[pk,fk]=lm(ck,[hk]),[gk,mk]=pk(ck),yk=(0,t.forwardRef)(((e,n)=>(0,t.createElement)(uk.Provider,{scope:e.__scopeRovingFocusGroup},(0,t.createElement)(uk.Slot,{scope:e.__scopeRovingFocusGroup},(0,t.createElement)(vk,im({},e,{ref:n})))))),vk=(0,t.forwardRef)(((e,n)=>{const{__scopeRovingFocusGroup:r,orientation:i,loop:o=!1,dir:s,currentTabStopId:a,defaultCurrentTabStopId:l,onCurrentTabStopIdChange:c,onEntryFocus:u,...d}=e,h=(0,t.useRef)(null),p=am(n,h),f=Cx(s),[g=null,m]=Lm({prop:a,defaultProp:l,onChange:c}),[y,v]=(0,t.useState)(!1),b=vm(u),w=dk(r),x=(0,t.useRef)(!1),[S,k]=(0,t.useState)(0);return(0,t.useEffect)((()=>{const e=h.current;if(e)return e.addEventListener(ak,b),()=>e.removeEventListener(ak,b)}),[b]),(0,t.createElement)(gk,{scope:r,orientation:i,dir:f,loop:o,currentTabStopId:g,onItemFocus:(0,t.useCallback)((e=>m(e)),[m]),onItemShiftTab:(0,t.useCallback)((()=>v(!0)),[]),onFocusableItemAdd:(0,t.useCallback)((()=>k((e=>e+1))),[]),onFocusableItemRemove:(0,t.useCallback)((()=>k((e=>e-1))),[])},(0,t.createElement)(mm.div,im({tabIndex:y||0===S?-1:0,"data-orientation":i},d,{ref:p,style:{outline:"none",...e.style},onMouseDown:om(e.onMouseDown,(()=>{x.current=!0})),onFocus:om(e.onFocus,(e=>{const t=!x.current;if(e.target===e.currentTarget&&t&&!y){const t=new CustomEvent(ak,lk);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){const e=w().filter((e=>e.focusable));Sk([e.find((e=>e.active)),e.find((e=>e.id===g)),...e].filter(Boolean).map((e=>e.ref.current)))}}x.current=!1})),onBlur:om(e.onBlur,(()=>v(!1)))})))})),bk="RovingFocusGroupItem",wk=(0,t.forwardRef)(((e,n)=>{const{__scopeRovingFocusGroup:r,focusable:i=!0,active:o=!1,tabStopId:s,...a}=e,l=Ky(),c=s||l,u=mk(bk,r),d=u.currentTabStopId===c,h=dk(r),{onFocusableItemAdd:p,onFocusableItemRemove:f}=u;return(0,t.useEffect)((()=>{if(i)return p(),()=>f()}),[i,p,f]),(0,t.createElement)(uk.ItemSlot,{scope:r,id:c,focusable:i,active:o},(0,t.createElement)(mm.span,im({tabIndex:d?0:-1,"data-orientation":u.orientation},a,{ref:n,onMouseDown:om(e.onMouseDown,(e=>{i?u.onItemFocus(c):e.preventDefault()})),onFocus:om(e.onFocus,(()=>u.onItemFocus(c))),onKeyDown:om(e.onKeyDown,(e=>{if("Tab"===e.key&&e.shiftKey)return void u.onItemShiftTab();if(e.target!==e.currentTarget)return;const t=function(e,t,n){const r=function(e,t){return"rtl"!==t?e:"ArrowLeft"===e?"ArrowRight":"ArrowRight"===e?"ArrowLeft":e}(e.key,n);return"vertical"===t&&["ArrowLeft","ArrowRight"].includes(r)||"horizontal"===t&&["ArrowUp","ArrowDown"].includes(r)?void 0:xk[r]}(e,u.orientation,u.dir);if(void 0!==t){e.preventDefault();let n=h().filter((e=>e.focusable)).map((e=>e.ref.current));if("last"===t)n.reverse();else if("prev"===t||"next"===t){"prev"===t&&n.reverse();const r=n.indexOf(e.currentTarget);n=u.loop?function(e,t){return e.map(((n,r)=>e[(t+r)%e.length]))}(n,r+1):n.slice(r+1)}setTimeout((()=>Sk(n)))}}))})))})),xk={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Sk(e){const t=document.activeElement;for(const n of e){if(n===t)return;if(n.focus(),document.activeElement!==t)return}}const kk=yk,_k=wk,Pk=["Enter"," "],Ck=["ArrowUp","PageDown","End"],Ek=["ArrowDown","PageUp","Home",...Ck],Ik={ltr:[...Pk,"ArrowRight"],rtl:[...Pk,"ArrowLeft"]},Mk={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Tk="Menu",[Ak,jk,Ok]=gm(Tk),[Lk,zk]=lm(Tk,[Ok,WS,fk]),Rk=WS(),Dk=fk(),[Nk,Fk]=Lk(Tk),[Bk,Uk]=Lk(Tk),Hk=e=>{const{__scopeMenu:n,open:r=!1,children:i,dir:o,onOpenChange:s,modal:a=!0}=e,l=Rk(n),[c,u]=(0,t.useState)(null),d=(0,t.useRef)(!1),h=vm(s),p=Cx(o);return(0,t.useEffect)((()=>{const e=()=>{d.current=!0,document.addEventListener("pointerdown",t,{capture:!0,once:!0}),document.addEventListener("pointermove",t,{capture:!0,once:!0})},t=()=>d.current=!1;return document.addEventListener("keydown",e,{capture:!0}),()=>{document.removeEventListener("keydown",e,{capture:!0}),document.removeEventListener("pointerdown",t,{capture:!0}),document.removeEventListener("pointermove",t,{capture:!0})}}),[]),(0,t.createElement)(ik,l,(0,t.createElement)(Nk,{scope:n,open:r,onOpenChange:h,content:c,onContentChange:u},(0,t.createElement)(Bk,{scope:n,onClose:(0,t.useCallback)((()=>h(!1)),[h]),isUsingKeyboardRef:d,dir:p,modal:a},i)))},Vk=(0,t.forwardRef)(((e,n)=>{const{__scopeMenu:r,...i}=e,o=Rk(r);return(0,t.createElement)(ok,im({},o,i,{ref:n}))})),Kk="MenuPortal",[Wk,$k]=Lk(Kk,{forceMount:void 0}),Yk=e=>{const{__scopeMenu:n,forceMount:r,children:i,container:o}=e,s=Fk(Kk,n);return(0,t.createElement)(Wk,{scope:n,forceMount:r},(0,t.createElement)(jm,{present:r||s.open},(0,t.createElement)(Tm,{asChild:!0,container:o},i)))},qk="MenuContent",[Gk,Xk]=Lk(qk),Qk=(0,t.forwardRef)(((e,n)=>{const r=$k(qk,e.__scopeMenu),{forceMount:i=r.forceMount,...o}=e,s=Fk(qk,e.__scopeMenu),a=Uk(qk,e.__scopeMenu);return(0,t.createElement)(Ak.Provider,{scope:e.__scopeMenu},(0,t.createElement)(jm,{present:i||s.open},(0,t.createElement)(Ak.Slot,{scope:e.__scopeMenu},a.modal?(0,t.createElement)(Zk,im({},o,{ref:n})):(0,t.createElement)(Jk,im({},o,{ref:n})))))})),Zk=(0,t.forwardRef)(((e,n)=>{const r=Fk(qk,e.__scopeMenu),i=(0,t.useRef)(null),o=am(n,i);return(0,t.useEffect)((()=>{const e=i.current;if(e)return Xv(e)}),[]),(0,t.createElement)(e_,im({},e,{ref:o,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:om(e.onFocusOutside,(e=>e.preventDefault()),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)}))})),Jk=(0,t.forwardRef)(((e,n)=>{const r=Fk(qk,e.__scopeMenu);return(0,t.createElement)(e_,im({},e,{ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)}))})),e_=(0,t.forwardRef)(((e,n)=>{const{__scopeMenu:r,loop:i=!1,trapFocus:o,onOpenAutoFocus:s,onCloseAutoFocus:a,disableOutsidePointerEvents:l,onEntryFocus:c,onEscapeKeyDown:u,onPointerDownOutside:d,onFocusOutside:h,onInteractOutside:p,onDismiss:f,disableOutsideScroll:g,...m}=e,y=Fk(qk,r),v=Uk(qk,r),b=Rk(r),w=Dk(r),x=jk(r),[S,k]=(0,t.useState)(null),_=(0,t.useRef)(null),P=am(n,_,y.onContentChange),C=(0,t.useRef)(0),E=(0,t.useRef)(""),I=(0,t.useRef)(0),M=(0,t.useRef)(null),T=(0,t.useRef)("right"),A=(0,t.useRef)(0),j=g?Hv:t.Fragment,O=g?{as:um,allowPinchZoom:!0}:void 0,L=e=>{var t,n;const r=E.current+e,i=x().filter((e=>!e.disabled)),o=document.activeElement,s=null===(t=i.find((e=>e.ref.current===o)))||void 0===t?void 0:t.textValue,a=function(e,t,n){const r=t.length>1&&Array.from(t).every((e=>e===t[0])),i=r?t[0]:t,o=n?e.indexOf(n):-1;let s=function(e,t){return e.map(((n,r)=>e[(t+r)%e.length]))}(e,Math.max(o,0));1===i.length&&(s=s.filter((e=>e!==n)));const a=s.find((e=>e.toLowerCase().startsWith(i.toLowerCase())));return a!==n?a:void 0}(i.map((e=>e.textValue)),r,s),l=null===(n=i.find((e=>e.textValue===a)))||void 0===n?void 0:n.ref.current;!function e(t){E.current=t,window.clearTimeout(C.current),""!==t&&(C.current=window.setTimeout((()=>e("")),1e3))}(r),l&&setTimeout((()=>l.focus()))};(0,t.useEffect)((()=>()=>window.clearTimeout(C.current)),[]),nv();const z=(0,t.useCallback)((e=>{var t,n;return T.current===(null===(t=M.current)||void 0===t?void 0:t.side)&&function(e,t){if(!t)return!1;const n={x:e.clientX,y:e.clientY};return function(e,t){const{x:n,y:r}=e;let i=!1;for(let o=0,s=t.length-1;o<t.length;s=o++){const e=t[o].x,a=t[o].y,l=t[s].x,c=t[s].y;a>r!==c>r&&n<(l-e)*(r-a)/(c-a)+e&&(i=!i)}return i}(n,t)}(e,null===(n=M.current)||void 0===n?void 0:n.area)}),[]);return(0,t.createElement)(Gk,{scope:r,searchRef:E,onItemEnter:(0,t.useCallback)((e=>{z(e)&&e.preventDefault()}),[z]),onItemLeave:(0,t.useCallback)((e=>{var t;z(e)||(null===(t=_.current)||void 0===t||t.focus(),k(null))}),[z]),onTriggerLeave:(0,t.useCallback)((e=>{z(e)&&e.preventDefault()}),[z]),pointerGraceTimerRef:I,onPointerGraceIntentChange:(0,t.useCallback)((e=>{M.current=e}),[])},(0,t.createElement)(j,O,(0,t.createElement)(qy,{asChild:!0,trapped:o,onMountAutoFocus:om(s,(e=>{var t;e.preventDefault(),null===(t=_.current)||void 0===t||t.focus()})),onUnmountAutoFocus:a},(0,t.createElement)(_m,{asChild:!0,disableOutsidePointerEvents:l,onEscapeKeyDown:u,onPointerDownOutside:d,onFocusOutside:h,onInteractOutside:p,onDismiss:f},(0,t.createElement)(kk,im({asChild:!0},w,{dir:v.dir,orientation:"vertical",loop:i,currentTabStopId:S,onCurrentTabStopIdChange:k,onEntryFocus:om(c,(e=>{v.isUsingKeyboardRef.current||e.preventDefault()}))}),(0,t.createElement)(sk,im({role:"menu","aria-orientation":"vertical","data-state":S_(y.open),"data-radix-menu-content":"",dir:v.dir},b,m,{ref:P,style:{outline:"none",...m.style},onKeyDown:om(m.onKeyDown,(e=>{const t=e.target.closest("[data-radix-menu-content]")===e.currentTarget,n=e.ctrlKey||e.altKey||e.metaKey,r=1===e.key.length;t&&("Tab"===e.key&&e.preventDefault(),!n&&r&&L(e.key));const i=_.current;if(e.target!==i)return;if(!Ek.includes(e.key))return;e.preventDefault();const o=x().filter((e=>!e.disabled)).map((e=>e.ref.current));Ck.includes(e.key)&&o.reverse(),function(e){const t=document.activeElement;for(const n of e){if(n===t)return;if(n.focus(),document.activeElement!==t)return}}(o)})),onBlur:om(e.onBlur,(e=>{e.currentTarget.contains(e.target)||(window.clearTimeout(C.current),E.current="")})),onPointerMove:om(e.onPointerMove,P_((e=>{const t=e.target,n=A.current!==e.clientX;if(e.currentTarget.contains(t)&&n){const t=e.clientX>A.current?"right":"left";T.current=t,A.current=e.clientX}})))})))))))})),t_=(0,t.forwardRef)(((e,n)=>{const{__scopeMenu:r,...i}=e;return(0,t.createElement)(mm.div,im({role:"group"},i,{ref:n}))})),n_="MenuItem",r_="menu.itemSelect",i_=(0,t.forwardRef)(((e,n)=>{const{disabled:r=!1,onSelect:i,...o}=e,s=(0,t.useRef)(null),a=Uk(n_,e.__scopeMenu),l=Xk(n_,e.__scopeMenu),c=am(n,s),u=(0,t.useRef)(!1);return(0,t.createElement)(o_,im({},o,{ref:c,disabled:r,onClick:om(e.onClick,(()=>{const e=s.current;if(!r&&e){const t=new CustomEvent(r_,{bubbles:!0,cancelable:!0});e.addEventListener(r_,(e=>null===i||void 0===i?void 0:i(e)),{once:!0}),ym(e,t),t.defaultPrevented?u.current=!1:a.onClose()}})),onPointerDown:t=>{var n;null===(n=e.onPointerDown)||void 0===n||n.call(e,t),u.current=!0},onPointerUp:om(e.onPointerUp,(e=>{var t;u.current||null===(t=e.currentTarget)||void 0===t||t.click()})),onKeyDown:om(e.onKeyDown,(e=>{const t=""!==l.searchRef.current;r||t&&" "===e.key||Pk.includes(e.key)&&(e.currentTarget.click(),e.preventDefault())}))}))})),o_=(0,t.forwardRef)(((e,n)=>{const{__scopeMenu:r,disabled:i=!1,textValue:o,...s}=e,a=Xk(n_,r),l=Dk(r),c=(0,t.useRef)(null),u=am(n,c),[d,h]=(0,t.useState)(!1),[p,f]=(0,t.useState)("");return(0,t.useEffect)((()=>{const e=c.current;var t;e&&f((null!==(t=e.textContent)&&void 0!==t?t:"").trim())}),[s.children]),(0,t.createElement)(Ak.ItemSlot,{scope:r,disabled:i,textValue:null!==o&&void 0!==o?o:p},(0,t.createElement)(_k,im({asChild:!0},l,{focusable:!i}),(0,t.createElement)(mm.div,im({role:"menuitem","data-highlighted":d?"":void 0,"aria-disabled":i||void 0,"data-disabled":i?"":void 0},s,{ref:u,onPointerMove:om(e.onPointerMove,P_((e=>{if(i)a.onItemLeave(e);else if(a.onItemEnter(e),!e.defaultPrevented){e.currentTarget.focus()}}))),onPointerLeave:om(e.onPointerLeave,P_((e=>a.onItemLeave(e)))),onFocus:om(e.onFocus,(()=>h(!0))),onBlur:om(e.onBlur,(()=>h(!1)))}))))})),s_=(0,t.forwardRef)(((e,n)=>{const{checked:r=!1,onCheckedChange:i,...o}=e;return(0,t.createElement)(d_,{scope:e.__scopeMenu,checked:r},(0,t.createElement)(i_,im({role:"menuitemcheckbox","aria-checked":k_(r)?"mixed":r},o,{ref:n,"data-state":__(r),onSelect:om(o.onSelect,(()=>null===i||void 0===i?void 0:i(!!k_(r)||!r)),{checkForDefaultPrevented:!1})})))})),a_="MenuRadioGroup",[l_,c_]=Lk(a_,{value:void 0,onValueChange:()=>{}}),u_="MenuItemIndicator",[d_,h_]=Lk(u_,{checked:!1}),p_=(0,t.forwardRef)(((e,n)=>{const{__scopeMenu:r,forceMount:i,...o}=e,s=h_(u_,r);return(0,t.createElement)(jm,{present:i||k_(s.checked)||!0===s.checked},(0,t.createElement)(mm.span,im({},o,{ref:n,"data-state":__(s.checked)})))})),f_="MenuSub",[g_,m_]=Lk(f_),y_=e=>{const{__scopeMenu:n,children:r,open:i=!1,onOpenChange:o}=e,s=Fk(f_,n),a=Rk(n),[l,c]=(0,t.useState)(null),[u,d]=(0,t.useState)(null),h=vm(o);return(0,t.useEffect)((()=>(!1===s.open&&h(!1),()=>h(!1))),[s.open,h]),(0,t.createElement)(ik,a,(0,t.createElement)(Nk,{scope:n,open:i,onOpenChange:h,content:u,onContentChange:d},(0,t.createElement)(g_,{scope:n,contentId:Ky(),triggerId:Ky(),trigger:l,onTriggerChange:c},r)))},v_="MenuSubTrigger",b_=(0,t.forwardRef)(((e,n)=>{const r=Fk(v_,e.__scopeMenu),i=Uk(v_,e.__scopeMenu),o=m_(v_,e.__scopeMenu),s=Xk(v_,e.__scopeMenu),a=(0,t.useRef)(null),{pointerGraceTimerRef:l,onPointerGraceIntentChange:c}=s,u={__scopeMenu:e.__scopeMenu},d=(0,t.useCallback)((()=>{a.current&&window.clearTimeout(a.current),a.current=null}),[]);return(0,t.useEffect)((()=>d),[d]),(0,t.useEffect)((()=>{const e=l.current;return()=>{window.clearTimeout(e),c(null)}}),[l,c]),(0,t.createElement)(Vk,im({asChild:!0},u),(0,t.createElement)(o_,im({id:o.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":o.contentId,"data-state":S_(r.open)},e,{ref:sm(n,o.onTriggerChange),onClick:t=>{var n;null===(n=e.onClick)||void 0===n||n.call(e,t),e.disabled||t.defaultPrevented||(t.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:om(e.onPointerMove,P_((t=>{s.onItemEnter(t),t.defaultPrevented||e.disabled||r.open||a.current||(s.onPointerGraceIntentChange(null),a.current=window.setTimeout((()=>{r.onOpenChange(!0),d()}),100))}))),onPointerLeave:om(e.onPointerLeave,P_((e=>{var t;d();const n=null===(t=r.content)||void 0===t?void 0:t.getBoundingClientRect();if(n){var i;const t=null===(i=r.content)||void 0===i?void 0:i.dataset.side,o="right"===t,a=o?-5:5,c=n[o?"left":"right"],u=n[o?"right":"left"];s.onPointerGraceIntentChange({area:[{x:e.clientX+a,y:e.clientY},{x:c,y:n.top},{x:u,y:n.top},{x:u,y:n.bottom},{x:c,y:n.bottom}],side:t}),window.clearTimeout(l.current),l.current=window.setTimeout((()=>s.onPointerGraceIntentChange(null)),300)}else{if(s.onTriggerLeave(e),e.defaultPrevented)return;s.onPointerGraceIntentChange(null)}}))),onKeyDown:om(e.onKeyDown,(t=>{const n=""!==s.searchRef.current;var o;e.disabled||n&&" "===t.key||Ik[i.dir].includes(t.key)&&(r.onOpenChange(!0),null===(o=r.content)||void 0===o||o.focus(),t.preventDefault())}))})))})),w_="MenuSubContent",x_=(0,t.forwardRef)(((e,n)=>{const r=$k(qk,e.__scopeMenu),{forceMount:i=r.forceMount,...o}=e,s=Fk(qk,e.__scopeMenu),a=Uk(qk,e.__scopeMenu),l=m_(w_,e.__scopeMenu),c=(0,t.useRef)(null),u=am(n,c);return(0,t.createElement)(Ak.Provider,{scope:e.__scopeMenu},(0,t.createElement)(jm,{present:i||s.open},(0,t.createElement)(Ak.Slot,{scope:e.__scopeMenu},(0,t.createElement)(e_,im({id:l.contentId,"aria-labelledby":l.triggerId},o,{ref:u,align:"start",side:"rtl"===a.dir?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:e=>{var t;a.isUsingKeyboardRef.current&&(null===(t=c.current)||void 0===t||t.focus()),e.preventDefault()},onCloseAutoFocus:e=>e.preventDefault(),onFocusOutside:om(e.onFocusOutside,(e=>{e.target!==l.trigger&&s.onOpenChange(!1)})),onEscapeKeyDown:om(e.onEscapeKeyDown,(e=>{a.onClose(),e.preventDefault()})),onKeyDown:om(e.onKeyDown,(e=>{const t=e.currentTarget.contains(e.target),n=Mk[a.dir].includes(e.key);var r;t&&n&&(s.onOpenChange(!1),null===(r=l.trigger)||void 0===r||r.focus(),e.preventDefault())}))})))))}));function S_(e){return e?"open":"closed"}function k_(e){return"indeterminate"===e}function __(e){return k_(e)?"indeterminate":e?"checked":"unchecked"}function P_(e){return t=>"mouse"===t.pointerType?e(t):void 0}const C_=Hk,E_=Vk,I_=Yk,M_=Qk,T_=t_,A_=i_,j_=s_,O_=p_,L_=y_,z_=b_,R_=x_,D_="DropdownMenu",[N_,F_]=lm(D_,[zk]),B_=zk(),[U_,H_]=N_(D_),V_=e=>{const{__scopeDropdownMenu:n,children:r,dir:i,open:o,defaultOpen:s,onOpenChange:a,modal:l=!0}=e,c=B_(n),u=(0,t.useRef)(null),[d=!1,h]=Lm({prop:o,defaultProp:s,onChange:a});return(0,t.createElement)(U_,{scope:n,triggerId:Ky(),triggerRef:u,contentId:Ky(),open:d,onOpenChange:h,onOpenToggle:(0,t.useCallback)((()=>h((e=>!e))),[h]),modal:l},(0,t.createElement)(C_,im({},c,{open:d,onOpenChange:h,dir:i,modal:l}),r))},K_="DropdownMenuTrigger",W_=(0,t.forwardRef)(((e,n)=>{const{__scopeDropdownMenu:r,disabled:i=!1,...o}=e,s=H_(K_,r),a=B_(r);return(0,t.createElement)(E_,im({asChild:!0},a),(0,t.createElement)(mm.button,im({type:"button",id:s.triggerId,"aria-haspopup":"menu","aria-expanded":s.open,"aria-controls":s.open?s.contentId:void 0,"data-state":s.open?"open":"closed","data-disabled":i?"":void 0,disabled:i},o,{ref:sm(n,s.triggerRef),onPointerDown:om(e.onPointerDown,(e=>{i||0!==e.button||!1!==e.ctrlKey||(s.onOpenToggle(),s.open||e.preventDefault())})),onKeyDown:om(e.onKeyDown,(e=>{i||(["Enter"," "].includes(e.key)&&s.onOpenToggle(),"ArrowDown"===e.key&&s.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(e.key)&&e.preventDefault())}))})))})),$_=e=>{const{__scopeDropdownMenu:n,...r}=e,i=B_(n);return(0,t.createElement)(I_,im({},i,r))},Y_="DropdownMenuContent",q_=(0,t.forwardRef)(((e,n)=>{const{__scopeDropdownMenu:r,...i}=e,o=H_(Y_,r),s=B_(r),a=(0,t.useRef)(!1);return(0,t.createElement)(M_,im({id:o.contentId,"aria-labelledby":o.triggerId},s,i,{ref:n,onCloseAutoFocus:om(e.onCloseAutoFocus,(e=>{var t;a.current||null===(t=o.triggerRef.current)||void 0===t||t.focus(),a.current=!1,e.preventDefault()})),onInteractOutside:om(e.onInteractOutside,(e=>{const t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey,r=2===t.button||n;o.modal&&!r||(a.current=!0)})),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))})),G_=(0,t.forwardRef)(((e,n)=>{const{__scopeDropdownMenu:r,...i}=e,o=B_(r);return(0,t.createElement)(T_,im({},o,i,{ref:n}))})),X_=(0,t.forwardRef)(((e,n)=>{const{__scopeDropdownMenu:r,...i}=e,o=B_(r);return(0,t.createElement)(A_,im({},o,i,{ref:n}))})),Q_=(0,t.forwardRef)(((e,n)=>{const{__scopeDropdownMenu:r,...i}=e,o=B_(r);return(0,t.createElement)(j_,im({},o,i,{ref:n}))})),Z_=(0,t.forwardRef)(((e,n)=>{const{__scopeDropdownMenu:r,...i}=e,o=B_(r);return(0,t.createElement)(O_,im({},o,i,{ref:n}))})),J_=(0,t.forwardRef)(((e,n)=>{const{__scopeDropdownMenu:r,...i}=e,o=B_(r);return(0,t.createElement)(z_,im({},o,i,{ref:n}))})),eP=(0,t.forwardRef)(((e,n)=>{const{__scopeDropdownMenu:r,...i}=e,o=B_(r);return(0,t.createElement)(R_,im({},o,i,{ref:n,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))})),tP=V_,nP=W_,rP=$_,iP=q_,oP=G_,sP=X_,aP=Q_,lP=Z_,cP=e=>{const{__scopeDropdownMenu:n,children:r,open:i,onOpenChange:o,defaultOpen:s}=e,a=B_(n),[l=!1,c]=Lm({prop:i,defaultProp:s,onChange:o});return(0,t.createElement)(L_,im({},a,{open:l,onOpenChange:c}),r)},uP=J_,dP=eP;function hP(e,n){const r=di(),i=(0,t.useRef)(!1),o=iw(),s=(0,t.useRef)(0),a=(0,t.useCallback)((t=>{const o=Date.now();o-s.current<50||(s.current=o,i.current=t,r.batch((()=>{t?(r.complete(),r.addOpenMenu(e)):r.updateInstanceState({openMenus:r.openMenus.filter((t=>!t.startsWith(e)))}),null===n||void 0===n||n(t)})))}),[r,e,n]),l=q("is menu open",(()=>r.openMenus.includes(e)),[r,e]);return(0,t.useEffect)((()=>(i.current&&(o("open-menu",{source:"unknown",id:e}),r.addOpenMenu(e)),()=>{i.current&&(r.deleteOpenMenu(e),r.openMenus.forEach((t=>{t.startsWith(e)&&(o("close-menu",{source:"unknown",id:e}),r.deleteOpenMenu(t))})),i.current=!1)})),[r,e,o]),[l,a]}function pP(e){let{id:t,children:n,modal:r=!1,debugOpen:i=!1}=e;const[o,s]=hP(t);return(0,Zr.jsx)(tP,{open:i||o,dir:"ltr",modal:r,onOpenChange:s,children:n})}function fP(e){let{children:t,"data-testid":n}=e;return(0,Zr.jsx)(nP,{dir:"ltr","data-testid":n,asChild:!0,onTouchEnd:e=>oi(e),children:t})}function gP(e){let{side:t="bottom",align:n="start",sideOffset:r=8,alignOffset:i=8,children:o}=e;const s=fi();return(0,Zr.jsx)(rP,{container:s,children:(0,Zr.jsx)(iP,{className:"tlui-menu",align:n,sideOffset:r,side:t,alignOffset:i,collisionPadding:4,children:o})})}function mP(e){let{id:t,children:n}=e;const[r,i]=hP(t);return(0,Zr.jsx)(cP,{open:r,onOpenChange:i,children:n})}function yP(e){let{label:t,"data-testid":n,"data-direction":r}=e;return(0,Zr.jsx)(uP,{dir:"ltr","data-direction":r,"data-testid":n,asChild:!0,children:(0,Zr.jsx)(Uy,{type:"menu",className:"tlui-menu__submenu__trigger",label:t,icon:"chevron-right"})})}function vP(e){let{alignOffset:t=0,sideOffset:n=5,children:r}=e;const i=fi();return(0,Zr.jsx)(rP,{container:i,children:(0,Zr.jsx)(dP,{className:"tlui-menu tlui-menu__submenu__content",alignOffset:t,sideOffset:n,collisionPadding:4,children:r})})}function bP(e){let{children:t,size:n="medium"}=e;return(0,Zr.jsx)(oP,{dir:"ltr",className:"tlui-menu__group","data-size":n,children:t})}function wP(e){let{noClose:t,...n}=e;return(0,Zr.jsx)(sP,{dir:"ltr",asChild:!0,onClick:t||void 0!==n.isChecked?oi:void 0,children:(0,Zr.jsx)(Uy,{...n})})}function xP(e){let{children:t,onSelect:n,...r}=e;return(0,Zr.jsxs)(aP,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",onSelect:e=>{null===n||void 0===n||n(e),oi(e)},...r,children:[(0,Zr.jsx)(zy,{small:!0,icon:r.checked?"check":"checkbox-empty"}),t]})}function SP(e){let{children:t,onSelect:n,...r}=e;return(0,Zr.jsxs)(aP,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",onSelect:e=>{null===n||void 0===n||n(e),oi(e)},...r,children:[(0,Zr.jsx)("div",{className:"tlui-button__checkbox__indicator",children:(0,Zr.jsx)(lP,{dir:"ltr",children:(0,Zr.jsx)(zy,{icon:"check",small:!0})})}),t]})}let kP=0;const _P=t.memo((function(e){let{renderDebugMenuItems:t}=e;const n=Oy();return(0,Zr.jsxs)("div",{className:"tlui-debug-panel",children:[(0,Zr.jsx)(PP,{}),(0,Zr.jsx)(CP,{}),(0,Zr.jsxs)(pP,{id:"debug",children:[(0,Zr.jsx)(fP,{children:(0,Zr.jsx)(Uy,{type:"icon",icon:"dots-horizontal",title:n("debug-panel.more")})}),(0,Zr.jsx)(gP,{side:"top",align:"end",alignOffset:0,children:(0,Zr.jsx)(EP,{renderDebugMenuItems:t})})]})]})})),PP=W((function(){const e=di();return(0,Zr.jsx)("div",{className:"tlui-debug-panel__current-state",children:e.root.path.value})})),CP=function(){const e=di(),t=q("rendering shapes count",(()=>e.renderingShapes.length),[e]);return(0,Zr.jsxs)("div",{children:[t," Shapes"]})},EP=W((function(e){let{renderDebugMenuItems:n}=e;const r=di(),{addToast:i}=xw(),{addDialog:o}=Iw(),[s,a]=t.useState(!1);return(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsxs)(bP,{children:[(0,Zr.jsx)(wP,{type:"menu",onClick:()=>{i({id:Va(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!1}),i({id:Va(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,icon:"twitter",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]})},label:"Show toast"}),(0,Zr.jsx)(wP,{type:"menu",onClick:()=>{o({component:e=>{let{onClose:t}=e;return(0,Zr.jsx)(TP,{displayDontShowAgain:!0,onCancel:()=>{t()},onContinue:()=>{t()}})},onClose:()=>{}})},label:"Show dialog"}),(0,Zr.jsx)(wP,{type:"menu",onClick:()=>function(e,t){const n=Array(t),r=Math.floor(Math.sqrt(t));for(let i=0;i<t;i++)kP++,n[i]={id:Dn("box"+kP),type:"geo",x:i%r*132,y:132*Math.floor(i/r)};e.batch((()=>{e.createShapes(n).setSelectedShapes(n.map((e=>e.id)))}))}(r,100),label:"Create 100 shapes"}),(0,Zr.jsx)(wP,{type:"menu",onClick:()=>{function e(t){let{children:n}=t,r=0;if(!n.length)return 0;for(const i of[...n])r++,r+=e(i);return r}const{selectedShapes:t}=r,n=0===t.length?r.renderingShapes:t,i=n.map((e=>document.getElementById(e.id).parentElement));let o=i.length;for(const r of i)o+=e(r);window.alert("Shapes ".concat(n.length,", DOM nodes:").concat(o))},label:"Count shapes / nodes"}),(()=>{if(s)throw Error("oh no!")})(),(0,Zr.jsx)(wP,{type:"menu",onClick:()=>{a(!0)},label:"Throw error"}),(0,Zr.jsx)(wP,{type:"menu",onClick:()=>{co()},label:"Hard reset"})]}),(0,Zr.jsxs)(bP,{children:[(0,Zr.jsx)(MP,{flag:ti.debugSvg}),(0,Zr.jsx)(MP,{flag:ti.forceSrgb}),(0,Zr.jsx)(MP,{flag:ti.debugGeometry}),(0,Zr.jsx)(MP,{flag:ti.hideShapes})]}),(0,Zr.jsx)(bP,{children:Object.values(ei).map((e=>(0,Zr.jsx)(MP,{flag:e},e.name)))}),null===n||void 0===n?void 0:n()]})}));function IP(e){let{label:t,value:n,onChange:r}=e;return(0,Zr.jsx)(xP,{title:t,checked:n,onSelect:()=>r(!n),children:(0,Zr.jsx)("span",{className:"tlui-button__label",draggable:!1,children:t})})}const MP=W((function(e){let{flag:t,onChange:n}=e;return(0,Zr.jsx)(IP,{label:t.name.replace(/([a-z0-9])([A-Z])/g,(e=>"".concat(e[0]," ").concat(e[1].toLowerCase()))).replace(/^[a-z]/,(e=>e.toUpperCase())),value:t.value,onChange:e=>{t.set(e),null===n||void 0===n||n(e)}})}));function TP(e){let{title:n="title",body:r="hello hello hello",cancel:i="Cancel",confirm:o="Continue",displayDontShowAgain:s=!1,onCancel:a,onContinue:l}=e;const[c,u]=t.useState(!1);return(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsxs)(Eb,{children:[(0,Zr.jsx)(Ib,{children:n}),(0,Zr.jsx)(Mb,{})]}),(0,Zr.jsx)(Tb,{style:{maxWidth:350},children:r}),(0,Zr.jsxs)(Ab,{className:"tlui-dialog__footer__actions",children:[s&&(0,Zr.jsx)(Uy,{type:"normal",onClick:()=>u(!c),iconLeft:c?"check":"checkbox-empty",style:{marginRight:"auto"},children:"Don't show again"}),(0,Zr.jsx)(Uy,{type:"normal",onClick:a,children:i}),(0,Zr.jsx)(Uy,{type:"primary",onClick:async()=>l(),children:o})]})]})}const AP=e=>{let{id:n,component:r,onClose:i}=e;const{removeDialog:o}=Iw(),s=fi(),a=(0,t.useCallback)((e=>{if(!e){if(i)try{i()}catch(hA){console.warn(hA)}o(n)}}),[n,i,o]);return(0,Zr.jsx)(kb,{onOpenChange:a,defaultOpen:!0,children:(0,Zr.jsx)(_b,{container:s,children:(0,Zr.jsx)(Pb,{dir:"ltr",className:"tlui-dialog__overlay",children:(0,Zr.jsx)(Cb,{dir:"ltr",className:"tlui-dialog__content",children:(0,Zr.jsx)(r,{onClose:()=>a(!1)})})})})})};const jP=t.memo((function(){const{dialogs:e}=Iw();return(0,Zr.jsx)(Zr.Fragment,{children:e.map((e=>(0,Zr.jsx)(AP,{...e},e.id)))})}));function OP(){const e=di(),t=q("follow",(()=>e.instanceState.followingUserId),[e]);return t?(0,Zr.jsx)(LP,{userId:t}):null}function LP(e){let{userId:t}=e;const n=la(t);return n?(0,Zr.jsx)("div",{className:"tlui-following-indicator",style:{borderColor:n.color}}):null}function zP(){const e=di(),{languages:n,currentLanguage:r}=cx(),i=(0,t.useCallback)((t=>e.user.updateUserPreferences({locale:t})),[e]);return(0,Zr.jsxs)(mP,{id:"help menu language",children:[(0,Zr.jsx)(yP,{label:"menu.language","data-direction":"left"}),(0,Zr.jsx)(vP,{sideOffset:-4,children:(0,Zr.jsx)(bP,{children:n.map((e=>{let{locale:t,label:n}=e;return(0,Zr.jsx)(SP,{title:t,checked:t===r,onSelect:()=>i(t),children:(0,Zr.jsx)("span",{className:"tlui-button__label",children:n})},t)}))})})]})}const RP=t.memo((function(){const e=fi(),t=Oy(),[n,r]=hP("help menu");return(0,Zr.jsx)("div",{className:"tlui-help-menu",children:(0,Zr.jsxs)(tP,{dir:"ltr",open:n,onOpenChange:r,modal:!1,children:[(0,Zr.jsx)(nP,{asChild:!0,dir:"ltr",children:(0,Zr.jsx)(Uy,{type:"help",className:"tlui-button",smallIcon:!0,title:t("help-menu.title"),icon:"question-mark"})}),(0,Zr.jsx)(rP,{container:e,children:(0,Zr.jsx)(iP,{className:"tlui-menu",side:"top",sideOffset:8,align:"end",alignOffset:0,collisionPadding:4,children:(0,Zr.jsx)(DP,{})})})]})})}));function DP(){const e=function(){const e=t.useContext(ux);if(!e)throw new Error("useHelpMenuSchema must be used inside of a helpTLUiMenuSchemaProvider.");return e}(),n=Ld();return(0,Zr.jsx)(Zr.Fragment,{children:e.map((function e(t){if(n&&!t.readonlyOk)return null;switch(t.type){case"custom":if("LANGUAGE_MENU"===t.id)return(0,Zr.jsx)(zP,{},"item");break;case"group":return(0,Zr.jsx)(bP,{size:"small",children:t.children.map(e)},t.id);case"submenu":return(0,Zr.jsxs)(mP,{id:"help menu ".concat(t.id),children:[(0,Zr.jsx)(yP,{label:t.label}),(0,Zr.jsx)(vP,{children:t.children.map(e)})]},t.id);case"item":{const{id:e,kbd:n,label:r,onSelect:i,icon:o}=t.actionItem;return(0,Zr.jsx)(wP,{type:"menu",kbd:n,label:r,onClick:()=>i("help-menu"),iconLeft:o},e)}}}))})}const NP="Popover",[FP,BP]=lm(NP,[WS]),UP=WS(),[HP,VP]=FP(NP),KP=e=>{const{__scopePopover:n,children:r,open:i,defaultOpen:o,onOpenChange:s,modal:a=!1}=e,l=UP(n),c=(0,t.useRef)(null),[u,d]=(0,t.useState)(!1),[h=!1,p]=Lm({prop:i,defaultProp:o,onChange:s});return(0,t.createElement)(ik,l,(0,t.createElement)(HP,{scope:n,contentId:Ky(),triggerRef:c,open:h,onOpenChange:p,onOpenToggle:(0,t.useCallback)((()=>p((e=>!e))),[p]),hasCustomAnchor:u,onCustomAnchorAdd:(0,t.useCallback)((()=>d(!0)),[]),onCustomAnchorRemove:(0,t.useCallback)((()=>d(!1)),[]),modal:a},r))},WP="PopoverTrigger",$P=(0,t.forwardRef)(((e,n)=>{const{__scopePopover:r,...i}=e,o=VP(WP,r),s=UP(r),a=am(n,o.triggerRef),l=(0,t.createElement)(mm.button,im({type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":nC(o.open)},i,{ref:a,onClick:om(e.onClick,o.onOpenToggle)}));return o.hasCustomAnchor?l:(0,t.createElement)(ok,im({asChild:!0},s),l)})),YP="PopoverPortal",[qP,GP]=FP(YP,{forceMount:void 0}),XP=e=>{const{__scopePopover:n,forceMount:r,children:i,container:o}=e,s=VP(YP,n);return(0,t.createElement)(qP,{scope:n,forceMount:r},(0,t.createElement)(jm,{present:r||s.open},(0,t.createElement)(Tm,{asChild:!0,container:o},i)))},QP="PopoverContent",ZP=(0,t.forwardRef)(((e,n)=>{const r=GP(QP,e.__scopePopover),{forceMount:i=r.forceMount,...o}=e,s=VP(QP,e.__scopePopover);return(0,t.createElement)(jm,{present:i||s.open},s.modal?(0,t.createElement)(JP,im({},o,{ref:n})):(0,t.createElement)(eC,im({},o,{ref:n})))})),JP=(0,t.forwardRef)(((e,n)=>{const r=VP(QP,e.__scopePopover),i=(0,t.useRef)(null),o=am(n,i),s=(0,t.useRef)(!1);return(0,t.useEffect)((()=>{const e=i.current;if(e)return Xv(e)}),[]),(0,t.createElement)(Hv,{as:um,allowPinchZoom:!0},(0,t.createElement)(tC,im({},e,{ref:o,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:om(e.onCloseAutoFocus,(e=>{var t;e.preventDefault(),s.current||null===(t=r.triggerRef.current)||void 0===t||t.focus()})),onPointerDownOutside:om(e.onPointerDownOutside,(e=>{const t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey,r=2===t.button||n;s.current=r}),{checkForDefaultPrevented:!1}),onFocusOutside:om(e.onFocusOutside,(e=>e.preventDefault()),{checkForDefaultPrevented:!1})})))})),eC=(0,t.forwardRef)(((e,n)=>{const r=VP(QP,e.__scopePopover),i=(0,t.useRef)(!1),o=(0,t.useRef)(!1);return(0,t.createElement)(tC,im({},e,{ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{var n,s;(null===(n=e.onCloseAutoFocus)||void 0===n||n.call(e,t),t.defaultPrevented)||(i.current||null===(s=r.triggerRef.current)||void 0===s||s.focus(),t.preventDefault());i.current=!1,o.current=!1},onInteractOutside:t=>{var n,s;null===(n=e.onInteractOutside)||void 0===n||n.call(e,t),t.defaultPrevented||(i.current=!0,"pointerdown"===t.detail.originalEvent.type&&(o.current=!0));const a=t.target;(null===(s=r.triggerRef.current)||void 0===s?void 0:s.contains(a))&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&o.current&&t.preventDefault()}}))})),tC=(0,t.forwardRef)(((e,n)=>{const{__scopePopover:r,trapFocus:i,onOpenAutoFocus:o,onCloseAutoFocus:s,disableOutsidePointerEvents:a,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:u,onInteractOutside:d,...h}=e,p=VP(QP,r),f=UP(r);return nv(),(0,t.createElement)(qy,{asChild:!0,loop:!0,trapped:i,onMountAutoFocus:o,onUnmountAutoFocus:s},(0,t.createElement)(_m,{asChild:!0,disableOutsidePointerEvents:a,onInteractOutside:d,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:u,onDismiss:()=>p.onOpenChange(!1)},(0,t.createElement)(sk,im({"data-state":nC(p.open),role:"dialog",id:p.contentId},f,h,{ref:n,style:{...h.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}}))))}));function nC(e){return e?"open":"closed"}const rC=KP,iC=$P,oC=XP,sC=ZP,aC=e=>{let{id:t,children:n,onOpenChange:r,open:i}=e;const[o,s]=hP(t,r);return(0,Zr.jsx)(rC,{onOpenChange:s,open:i||o,children:(0,Zr.jsx)("div",{className:"tlui-popover",children:n})})},lC=e=>{let{children:t,disabled:n,"data-testid":r}=e;return(0,Zr.jsx)(iC,{"data-testid":r,disabled:n,asChild:!0,dir:"ltr",children:t})},cC=e=>{let{side:t,children:n,align:r="center",sideOffset:i=8,alignOffset:o=0}=e;const s=fi();return(0,Zr.jsx)(oC,{container:s,children:(0,Zr.jsx)(sC,{className:"tlui-popover__content",side:t,sideOffset:i,align:r,alignOffset:o,dir:"ltr",children:n})})},uC=(0,t.memo)((function(){const e=Oy(),n=fi(),r=function(){const e=t.useContext(Qw);if(!e)throw new Error("useActionsMenuSchema must be used inside of a ActionsMenuSchemaProvider.");return e}(),i=Ld();return(0,Zr.jsxs)(aC,{id:"actions-menu",children:[(0,Zr.jsx)(lC,{children:(0,Zr.jsx)(Uy,{className:"tlui-menu__trigger","data-testid":"main.action-menu",icon:"dots-vertical",title:e("actions-menu.title"),type:"icon",smallIcon:!0})}),(0,Zr.jsx)(oC,{container:n,children:(0,Zr.jsx)(sC,{className:"tlui-popover__content",side:"bottom",dir:"ltr",sideOffset:6,children:(0,Zr.jsx)("div",{className:"tlui-actions-menu tlui-buttons__grid",children:r.map((function(t){if(i&&!t.readonlyOk)return null;if("item"===t.type){const{id:n,icon:r,label:i,kbd:o,onSelect:s}=t.actionItem;return(0,Zr.jsx)(Uy,{"data-testid":"menu-item.".concat(t.id),icon:r,type:"icon",title:i?o?"".concat(e(i)," ").concat(Fy(o)):"".concat(e(i)):o?"".concat(Fy(o)):"",onClick:()=>s("actions-menu"),disabled:t.disabled},n)}}))})})})]})})),dC=W((function(){const e=di(),t=Ow(),n=Oy(),r=t.duplicate;return(0,Zr.jsx)(Uy,{icon:r.icon,type:"icon",onClick:()=>r.onSelect("quick-actions"),disabled:!(e.isIn("select")&&e.selectedShapeIds.length>0),title:"".concat(n(r.label)," ").concat(Fy(r.kbd)),smallIcon:!0})})),hC=t.memo((function(){const e=Oy();return(0,Zr.jsxs)(pP,{id:"main menu",children:[(0,Zr.jsx)(fP,{children:(0,Zr.jsx)(Uy,{type:"icon",className:"tlui-menu__trigger","data-testid":"main.menu",title:e("menu.title"),icon:"menu",smallIcon:!0})}),(0,Zr.jsx)(gP,{alignOffset:0,sideOffset:6,children:(0,Zr.jsx)(pC,{})})]})}));function pC(){const e=di(),n=Oy(),r=function(){const e=t.useContext(fx);if(!e)throw new Error("useMenuSchema must be used inside of a TLUiMenuSchemaProvider.");return e}(),i=Gw(),o=Ld();function s(e,t,r,a){switch(t.type){case"custom":return o&&!t.readonlyOk?null:"LANGUAGE_MENU"===t.id?(0,Zr.jsx)(zP,{},"item"):null;case"group":return o&&!t.readonlyOk?null:(0,Zr.jsx)(bP,{size:a<=1?"medium":i<3||"submenu"===(null===r||void 0===r?void 0:r.type)&&a>2?"tiny":"medium",children:t.children.map((n=>s(e,n,t,a+1)))},t.id);case"submenu":return o&&!t.readonlyOk?null:(0,Zr.jsxs)(mP,{id:"main menu ".concat(r?r.id+" ":"").concat(t.id),children:[(0,Zr.jsx)(yP,{label:t.label,"data-testid":"menu-item.".concat(t.id)}),(0,Zr.jsx)(vP,{sideOffset:-4,alignOffset:-1,children:t.children.map((n=>s(e,n,t,a+1)))})]},t.id);case"item":{if(o&&!t.readonlyOk)return null;const{id:e,checkbox:r,menuLabel:i,label:s,onSelect:a,kbd:l}=t.actionItem,c=null!==i&&void 0!==i?i:s,u=c?n(c):void 0;return r?(0,Zr.jsxs)(xP,{onSelect:()=>a("menu"),title:u||"",checked:t.checked,disabled:t.disabled,children:[u&&(0,Zr.jsx)("span",{className:"tlui-button__label",children:u}),l&&(0,Zr.jsx)(By,{children:l})]},e):(0,Zr.jsx)(wP,{type:"menu","data-testid":"menu-item.".concat(t.id),kbd:l,label:c,onClick:()=>a("menu"),disabled:t.disabled},e)}}}return(0,Zr.jsx)(Zr.Fragment,{children:r.map((t=>s(e,t,null,0)))})}const fC=function(e){let{name:n,id:r,isCurrentPage:i}=e;const o=di(),s=(0,t.useRef)(null),a=(0,t.useCallback)((e=>{o.renamePage(r,e||"New Page",{ephemeral:!0})}),[o,r]),l=(0,t.useCallback)((e=>{o.mark("rename page"),o.renamePage(r,e||"New Page",{ephemeral:!1})}),[o,r]);return(0,Zr.jsx)(jb,{className:"tlui-page-menu__item__input",ref:e=>s.current=e,defaultValue:n,onValueChange:a,onComplete:l,onCancel:l,shouldManuallyMaintainScrollPositionWhenFocused:!0,autofocus:i,autoselect:!0})},gC=(e,t,n,r)=>{let i;const o=e.pages,s=n>r?o[r-1]:o[r],a=n>r?o[r]:o[r+1];i=s&&!a?ql(s.index):!s&&a?function(e){return Kl(void 0,e,1)[0]}(o[0].index):Yl(s.index,a.index),i!==o[n].index&&(e.mark("moving page"),e.updatePage({id:t,index:i}))},mC=W((function(e){let{index:n,listSize:r,item:i,onRename:o}=e;const s=di(),a=Oy(),l=s.pages,c=(0,t.useCallback)((()=>{s.mark("creating page");const e=Vt.createId();s.duplicatePage(i.id,e)}),[s,i]),u=(0,t.useCallback)((()=>{gC(s,i.id,n,n-1)}),[s,i,n]),d=(0,t.useCallback)((()=>{gC(s,i.id,n,n+1)}),[s,i,n]),h=(0,t.useCallback)((()=>{s.mark("deleting page"),s.deletePage(i.id)}),[s,i]);return(0,Zr.jsxs)(pP,{id:"page item submenu ".concat(n),children:[(0,Zr.jsx)(fP,{children:(0,Zr.jsx)(Uy,{type:"icon",title:a("page-menu.submenu.title"),icon:"dots-vertical"})}),(0,Zr.jsxs)(gP,{alignOffset:0,children:[(0,Zr.jsxs)(bP,{children:[o&&(0,Zr.jsx)(sP,{dir:"ltr",onSelect:o,asChild:!0,children:(0,Zr.jsx)(Uy,{type:"menu",label:"page-menu.submenu.rename"})}),(0,Zr.jsx)(sP,{dir:"ltr",onSelect:c,disabled:l.length>=40,asChild:!0,children:(0,Zr.jsx)(Uy,{type:"menu",label:"page-menu.submenu.duplicate-page"})}),n>0&&(0,Zr.jsx)(sP,{dir:"ltr",onSelect:u,asChild:!0,children:(0,Zr.jsx)(Uy,{type:"menu",label:"page-menu.submenu.move-up"})}),n<r-1&&(0,Zr.jsx)(sP,{dir:"ltr",onSelect:d,asChild:!0,children:(0,Zr.jsx)(Uy,{type:"menu",label:"page-menu.submenu.move-down"})})]}),r>1&&(0,Zr.jsx)(bP,{children:(0,Zr.jsx)(sP,{dir:"ltr",onSelect:h,asChild:!0,children:(0,Zr.jsx)(Uy,{type:"menu",label:"page-menu.submenu.delete"})})})]})]})})),yC=function(){const e=di(),n=Oy(),r=Gw(),i=(0,t.useCallback)((()=>m(!1)),[]),[o,s]=hP("page-menu",i),a=36,l=(0,t.useRef)(null),c=q("pages",(()=>e.pages),[e]),u=q("currentPage",(()=>e.currentPage),[e]),d=q("currentPageId",(()=>e.currentPageId),[e]),h=Ld(),p=q("maxPageCountReached",(()=>e.pages.length>=40),[e]),f=q("isCoarsePointer",(()=>e.instanceState.isCoarsePointer),[e]),[g,m]=(0,t.useState)(!1),y=(0,t.useCallback)((()=>{h||m((e=>!e))}),[h]),v=(0,t.useRef)({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[b,w]=(0,t.useState)(Object.fromEntries(c.map(((e,t)=>[e.id,{y:t*a,offsetY:0,isSelected:!1}]))));(0,t.useLayoutEffect)((()=>{w(Object.fromEntries(c.map(((e,t)=>[e.id,{y:t*a,offsetY:0,isSelected:!1}]))))}),[a,c]),(0,t.useEffect)((()=>{o&&requestAnimationFrame((()=>{const e=document.querySelector('[data-testid="page-menu-item-'.concat(d,'"]'));if(e){const t=l.current;if(!t)return;const n=e.offsetTop;n<t.scrollTop&&t.scrollTo({top:n});const r=n+a;r>t.scrollTop+t.offsetHeight&&t.scrollTo({top:r-t.offsetHeight})}}))}),[a,d,o]);const x=(0,t.useCallback)((e=>{const{clientY:t,currentTarget:n}=e,{dataset:{id:r,index:i}}=n;if(!r||!i)return;const o=v.current;si(e.currentTarget,e),o.status="pointing",o.pointing={id:r,index:+i};const s=b[r].y;o.startY=t,o.startIndex=Math.max(0,Math.min(Math.round(s/a),c.length-1))}),[a,c.length,b]),S=(0,t.useCallback)((e=>{const t=v.current;if("pointing"===t.status){const{clientY:n}=e,r=n-t.startY;Math.abs(r)>5&&(t.status="dragging")}if("dragging"===t.status){const{clientY:n}=e,r=n-t.startY,i=b[t.pointing.id],{startIndex:o,pointing:s}=t,l=i.y+r,u=Math.max(0,Math.min(Math.round(l/a),c.length-1)),d={...b};if(d[s.id]={y:i.y,offsetY:r,isSelected:!0},u!==t.dragIndex){t.dragIndex=u;for(let e=0;e<c.length;e++){const n=c[e];if(n.id===t.pointing.id)continue;let{y:r}=d[n.id];u===o?r=e*a:u<o?r=u<=e&&e<o?(e+1)*a:e*a:u>o&&(r=u>=e&&e>o?(e-1)*a:e*a),r!==d[n.id].y&&(d[n.id]={y:r,offsetY:0,isSelected:!0})}}w(d)}}),[a,c,b]),k=(0,t.useCallback)((t=>{const n=v.current;if("dragging"===n.status){const{id:t,index:r}=n.pointing;gC(e,t,r,n.dragIndex)}ai(t.currentTarget,t),n.status="idle"}),[e]),_=(0,t.useCallback)((e=>{const t=v.current;"Escape"===e.key&&("dragging"===t.status&&w(Object.fromEntries(c.map(((e,t)=>[e.id,{y:t*a,offsetY:0,isSelected:!1}])))),t.status="idle")}),[a,c]),P=(0,t.useCallback)((()=>{h||e.batch((()=>{e.mark("creating page");const t=Vt.createId();e.createPage({name:n("page-menu.new-page-initial-name"),id:t}),e.setCurrentPage(t),m(!0)}))}),[e,n,h]);return(0,Zr.jsxs)(aC,{id:"pages",onOpenChange:s,open:o,children:[(0,Zr.jsx)(lC,{children:(0,Zr.jsx)(Uy,{className:"tlui-page-menu__trigger tlui-menu__trigger","data-testid":"main.page-menu",icon:"chevron-down",type:"menu",title:u.name,children:(0,Zr.jsx)("div",{className:"tlui-page-menu__name",children:u.name})})}),(0,Zr.jsx)(cC,{side:"bottom",align:"start",sideOffset:6,children:(0,Zr.jsxs)("div",{className:"tlui-page-menu__wrapper",children:[(0,Zr.jsxs)("div",{className:"tlui-page-menu__header",children:[(0,Zr.jsx)("div",{className:"tlui-page-menu__header__title",children:n("page-menu.title")}),!h&&(0,Zr.jsxs)("div",{className:"tlui-buttons__horizontal",children:[(0,Zr.jsx)(Uy,{type:"icon","data-testid":"page-menu.edit",title:n(g?"page-menu.edit-done":"page-menu.edit-start"),icon:g?"check":"edit",onClick:y}),(0,Zr.jsx)(Uy,{type:"icon","data-testid":"page-menu.create",icon:"plus",title:n(p?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:p,onClick:P})]})]}),(0,Zr.jsx)("div",{className:"tlui-page-menu__list tlui-menu__group",style:{height:a*c.length+4},ref:l,children:c.map(((t,i)=>{var o;const s=null!==(o=b[t.id])&&void 0!==o?o:{position:40*i,offsetY:0};return g?(0,Zr.jsxs)("div",{"data-testid":"page-menu-item-".concat(t.id),className:"tlui-page_menu__item__sortable",style:{zIndex:t.id===u.id?888:i,transform:"translate(0px, ".concat(s.y+s.offsetY,"px)")},children:[(0,Zr.jsx)(Uy,{type:"icon",tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",icon:"drag-handle-dots",onPointerDown:x,onPointerUp:k,onPointerMove:S,onKeyDown:_,"data-id":t.id,"data-index":i}),r<5&&f?(0,Zr.jsx)(Uy,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>{const n=window.prompt("Rename page",t.name);n&&n!==t.name&&e.renamePage(t.id,n)},onDoubleClick:y,isChecked:t.id===u.id,children:(0,Zr.jsx)("span",{children:t.name})}):(0,Zr.jsx)("div",{className:"tlui-page_menu__item__sortable__title",style:{height:a},children:(0,Zr.jsx)(fC,{id:t.id,name:t.name,isCurrentPage:t.id===u.id})}),!h&&(0,Zr.jsx)("div",{className:"tlui-page_menu__item__submenu","data-isediting":g,children:(0,Zr.jsx)(mC,{index:i,item:t,listSize:c.length})})]},t.id+"_editing"):(0,Zr.jsxs)("div",{"data-testid":"page-menu-item-".concat(t.id),className:"tlui-page-menu__item",children:[(0,Zr.jsxs)(Uy,{type:"icon",className:"tlui-page-menu__item__button tlui-page-menu__item__button__checkbox",onClick:()=>e.setCurrentPage(t.id),onDoubleClick:y,isChecked:t.id===u.id,title:n("page-menu.go-to-page"),children:[(0,Zr.jsx)("div",{className:"tlui-page-menu__item__button__check",children:t.id===u.id&&(0,Zr.jsx)(zy,{icon:"check"})}),(0,Zr.jsx)("span",{children:t.name})]}),!h&&(0,Zr.jsx)("div",{className:"tlui-page_menu__item__submenu",children:(0,Zr.jsx)(mC,{index:i,item:t,listSize:c.length,onRename:()=>{if(e.environment.isIos){const n=window.prompt("Rename page",t.name);n&&n!==t.name&&e.renamePage(t.id,n)}else e.batch((()=>{m(!0),e.setCurrentPage(t.id)}))}})})]},t.id)}))})]})})]})},vC=(0,t.memo)((function(){const e=Oy(),t=hx(),n=Ow().redo;return(0,Zr.jsx)(Uy,{"data-testid":"main.redo",icon:n.icon,type:"icon",title:"".concat(e(n.label)," ").concat(Fy(n.kbd)),disabled:!t,onClick:()=>n.onSelect("quick-actions"),smallIcon:!0})})),bC=W((function(){const e=di(),t=Ow(),n=Oy(),r=t.delete;return Ld()?null:(0,Zr.jsx)(Uy,{icon:r.icon,type:"icon",onClick:()=>r.onSelect("quick-actions"),disabled:!(e.isIn("select")&&e.selectedShapeIds.length>0),title:"".concat(n(r.label)," ").concat(Fy(r.kbd)),smallIcon:!0})})),wC=(0,t.memo)((function(){const e=Oy(),t=px(),n=Ow().undo;return(0,Zr.jsx)(Uy,{"data-testid":"main.undo",icon:n.icon,type:"icon",title:"".concat(e(n.label)," ").concat(Fy(n.kbd)),disabled:!t,onClick:()=>n.onSelect("quick-actions"),smallIcon:!0})})),xC=W((function(){const e=di(),t=Gw(),n=Ld();return(0,Zr.jsx)("div",{className:"tlui-menu-zone",children:(0,Zr.jsxs)("div",{className:"tlui-buttons__horizontal",children:[(0,Zr.jsx)(hC,{}),(0,Zr.jsx)(yC,{}),t>=6&&!n&&!e.isInAny("hand","zoom")&&(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsx)(wC,{}),(0,Zr.jsx)(vC,{}),(0,Zr.jsx)(bC,{}),(0,Zr.jsx)(dC,{}),(0,Zr.jsx)(uC,{})]})]})})}));class SC{constructor(e){var t=this;s(this,"dpr",1),s(this,"colors",{shapeFill:"rgba(144, 144, 144, .1)",selectFill:"#2f80ed",viewportFill:"rgba(144, 144, 144, .1)"}),s(this,"id",Va()),s(this,"cvs",null),s(this,"pageBounds",[]),s(this,"collaborators",[]),s(this,"canvasScreenBounds",new Ti),s(this,"canvasPageBounds",new Ti),s(this,"contentPageBounds",new Ti),s(this,"contentScreenBounds",new Ti),s(this,"originPagePoint",new Ei),s(this,"originPageCenter",new Ei),s(this,"isInViewport",!1),s(this,"debug",!1),s(this,"updateContentScreenBounds",(()=>{const{contentScreenBounds:e,contentPageBounds:t,canvasScreenBounds:n}=this;let{x:r,y:i,w:o,h:s}=e;if(t.w>t.h){const e=n.w/(t.w/t.h);e>n.h?(r=(n.w-n.w*(n.h/e))/2,i=0,o=n.w*(n.h/e),s=n.h):(r=0,i=(n.h-e)/2,o=n.w,s=e)}else if(t.w<t.h){const e=n.h/(t.h/t.w);r=(n.w-e)/2,i=0,o=e,s=n.h}else r=n.h/2,i=0,o=n.h,s=n.h;e.set(r,i,o,s)})),s(this,"updateCanvasPageBounds",(()=>{const{canvasPageBounds:e,canvasScreenBounds:t,contentPageBounds:n,contentScreenBounds:r}=this;e.set(0,0,n.width/(r.width/t.width),n.height/(r.height/t.height)),e.center=n.center})),s(this,"getScreenPoint",((e,t)=>{const{canvasScreenBounds:n}=this;return{x:(e-n.minX)*this.dpr,y:(t-n.minY)*this.dpr}})),s(this,"getPagePoint",((e,t)=>{const{contentPageBounds:n,contentScreenBounds:r,canvasPageBounds:i}=this,{x:o,y:s}=this.getScreenPoint(e,t);return new Ei(i.minX+o*n.width/r.width,i.minY+s*n.height/r.height,1)})),s(this,"minimapScreenPointToPagePoint",(function(e,n){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const{editor:o}=t,{viewportPageBounds:s}=o;let{x:a,y:l}=t.getPagePoint(e,n);if(i){var c,u,d,h;const e=t.editor.currentPageBounds,n=s,r=(null!==(c=null===e||void 0===e?void 0:e.minX)&&void 0!==c?c:0)-n.width/2,i=(null!==(u=null===e||void 0===e?void 0:e.maxX)&&void 0!==u?u:0)+n.width/2,o=(null!==(d=null===e||void 0===e?void 0:e.minY)&&void 0!==d?d:0)-n.height/2,p=(null!==(h=null===e||void 0===e?void 0:e.maxY)&&void 0!==h?h:0)+n.height/2,f=Math.max(0,r+n.width-a),g=Math.max(0,-(i-n.width-a)),m=Math.max(0,o+n.height-l),y=Math.max(0,-(p-n.height-l)),v=Math.max(0,f-g),b=Math.max(0,g-f),w=Math.max(0,m-y),x=Math.max(0,y-m);v&&v>b?a+=v/2:b&&(a-=b/2),w&&w>x?l+=w/2:x&&(l-=x/2),a=Ni(a,r,i),l=Ni(l,o,p)}if(r){const{originPagePoint:e}=t;Math.abs(a-e.x)>Math.abs(l-e.y)?l=e.y:a=e.x}return new Ei(a,l)})),s(this,"render",(()=>{const{cvs:e,pageBounds:t}=this;this.updateCanvasPageBounds();const{editor:n,canvasScreenBounds:r,canvasPageBounds:i,contentPageBounds:o,contentScreenBounds:s}=this,{width:a,height:l}=r,{viewportPageBounds:c,selectedShapeIds:u}=n;if(!e||!t)return;const d=e.getContext("2d");if(!d)throw new Error("Minimap (shapes): Could not get context");d.resetTransform(),d.globalAlpha=1,d.clearRect(0,0,a,l);const h=s.width/o.width,p=s.height/o.height;d.translate((a-s.width)/2,(l-s.height)/2),d.scale(h,p),d.translate(-o.minX,-o.minY);const f=8/h,g=8/h,m=1/h,y=1/h,v=f/4,b=g/4,w=new Path2D,x=new Path2D,{shapeFill:S,selectFill:k,viewportFill:_}=this.colors;let P;for(let T=0,A=t.length;T<A;T++)P=t[T],SC.roundedRect(u.includes(P.id)?x:w,P.minX,P.minY,P.width,P.height,Ni(f,m,P.width/v),Ni(g,y,P.height/b));if(d.fillStyle=S,d.fill(w),d.fillStyle=k,d.fill(x),this.debug){const e=Ti.Common(t),{minX:n,minY:r,width:i,height:o}=e;d.strokeStyle="green",d.lineWidth=2/h,d.strokeRect(n+1/h,r+1/p,i-2/h,o-2/p)}{const{brush:e}=n.instanceState;if(e){const{x:t,y:n,w:r,h:i}=e;d.beginPath(),SC.sharpRect(d,t,n,r,i),d.closePath(),d.fillStyle=_,d.fill()}}{const{minX:e,minY:t,width:n,height:r}=c;d.beginPath();const i=12/h,o=12/h;SC.roundedRect(d,e,t,n,r,Math.min(n/4,i),Math.min(r/4,o)),d.closePath(),d.fillStyle=_,d.fill(),this.debug&&(d.strokeStyle="orange",d.strokeRect(e+1/h,t+1/p,n-2/h,r-2/p))}const C=2.5/h,E=2.5/p,{currentPageId:I}=n;let M;for(let T=0;T<this.collaborators.length;T++)M=this.collaborators[T],M.currentPageId===I&&(d.beginPath(),d.ellipse(Ni(M.cursor.x,i.minX+C,i.maxX-C),Ni(M.cursor.y,i.minY+E,i.maxY-E),5/h,5/p,0,0,zi),d.fillStyle=M.color,d.fill());if(this.debug){d.lineWidth=2/h;{const{minX:e,minY:t,width:n,height:r}=o;d.strokeStyle="red",d.strokeRect(e+1/h,t+1/p,n-2/h,r-2/p)}{const{minX:e,minY:t,width:n,height:r}=i;d.strokeStyle="blue",d.strokeRect(e+1/h,t+1/p,n-2/h,r-2/p)}}})),this.editor=e}setDpr(e){this.dpr=+e.toFixed(2)}static roundedRect(e,t,n,r,i,o,s){o<1&&s<1?e.rect(t,n,r,i):(e.moveTo(t+o,n),e.lineTo(t+r-o,n),e.quadraticCurveTo(t+r,n,t+r,n+s),e.lineTo(t+r,n+i-s),e.quadraticCurveTo(t+r,n+i,t+r-o,n+i),e.lineTo(t+o,n+i),e.quadraticCurveTo(t,n+i,t,n+i-s),e.lineTo(t,n+s),e.quadraticCurveTo(t,n,t+o,n))}static sharpRect(e,t,n,r,i,o,s){e.rect(t,n,r,i)}}function kC(e){let{shapeFill:n,selectFill:r,viewportFill:i}=e;const o=di(),s=t.useRef(null),a=t.useRef(!1),l=tu(),c=$("dpr",(()=>o.instanceState.devicePixelRatio),[o]),u=t.useMemo((()=>o.store.query.records("instance_presence")),[o]),d=t.useMemo((()=>new SC(o)),[o]);t.useEffect((()=>{const e=requestAnimationFrame((()=>{const e=getComputedStyle(o.getContainer());d.colors={shapeFill:e.getPropertyValue(n).trim(),selectFill:e.getPropertyValue(r).trim(),viewportFill:e.getPropertyValue(i).trim()},d.render()}));return()=>{cancelAnimationFrame(e)}}),[o,r,n,i,d,l]);const h=t.useCallback((e=>{if(!o.currentPageShapeIds.size)return;const t=d.minimapScreenPointToPagePoint(e.clientX,e.clientY,!1,!1),n=d.minimapScreenPointToPagePoint(e.clientX,e.clientY,!1,!0);d.originPagePoint.setTo(n),d.originPageCenter.setTo(o.viewportPageBounds.center),o.centerOnPoint(t,{duration:fo})}),[o,d]),p=t.useCallback((e=>{const t=e.currentTarget;if(si(t,e),!o.currentPageShapeIds.size)return;a.current=!0,d.isInViewport=!1;const n=d.minimapScreenPointToPagePoint(e.clientX,e.clientY,!1,!1),r=d.minimapScreenPointToPagePoint(e.clientX,e.clientY,!1,!0),i=o.viewportPageBounds;if(d.isInViewport=i.containsPoint(r),d.isInViewport)d.originPagePoint.setTo(r),d.originPageCenter.setTo(i.center);else{const e=Ei.Sub(i.center,i.point),t=Ei.Add(n,e);d.originPagePoint.setTo(t),d.originPageCenter.setTo(n),o.centerOnPoint(n,{duration:fo})}document.body.addEventListener("pointerup",(function e(n){t&&ai(t,n),a.current=!1,document.body.removeEventListener("pointerup",e)}))}),[o,d]),f=t.useCallback((e=>{const t=d.minimapScreenPointToPagePoint(e.clientX,e.clientY,e.shiftKey,!0);if(a.current){if(d.isInViewport){const e=d.originPagePoint.clone().sub(d.originPageCenter);return void o.centerOnPoint(Ei.Sub(t,e))}o.centerOnPoint(t)}const n=d.getPagePoint(e.clientX,e.clientY),r=o.pageToScreen(n),i={type:"pointer",target:"canvas",name:"pointer_move",...ci(e),point:r,isPen:o.instanceState.isPenMode};o.dispatch(i)}),[o,d]),g=t.useCallback((e=>{const t=Xs(e);o.dispatch({type:"wheel",name:"wheel",delta:t,point:new Ei(e.clientX,e.clientY),shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey})}),[o]);return Y("update when dpr changes",(()=>{const e=c.value;d.setDpr(e);const t=s.current,n=t.getBoundingClientRect(),r=n.width*e,i=n.height*e;t.width=r,t.height=i,d.canvasScreenBounds.set(n.x,n.y,r,i),d.cvs=s.current}),[c,d]),Y("minimap render when pagebounds or collaborators changes",(()=>{const{currentPageShapeIds:e,viewportPageBounds:t,currentPageBounds:n}=o;c.value;d.contentPageBounds=n?Ti.Expand(n,t):t,d.updateContentScreenBounds();const r=[];e.forEach((e=>{let t=o.getShapePageBounds(e);if(!t)return;const n=o.getShapeMask(e);if(n){const e=yl(n,t.corners);if(!e)return;t=Ti.FromPoints(e)}t&&(t.id=e,r.push(t))})),d.pageBounds=r,d.collaborators=u.value,d.render()}),[o,d]),(0,Zr.jsx)("div",{className:"tlui-minimap",children:(0,Zr.jsx)("canvas",{ref:s,className:"tlui-minimap__canvas",onDoubleClick:h,onPointerMove:f,onPointerDown:p,onWheel:g})})}const _C=W((function(){const e=di(),n=Oy(),r=Gw(),i=e.zoomLevel,o=e.currentPageShapeIds.size>0,s=e.selectedShapeIds.length>0,a=1===e.zoomLevel,l=t.useCallback((()=>{e.resetZoom(e.viewportScreenCenter,{duration:fo})}),[e]);return(0,Zr.jsxs)(pP,{id:"zoom",children:[(0,Zr.jsx)(fP,{children:(0,Zr.jsx)(Uy,{type:"icon",title:"".concat(n("navigation-zone.zoom")),"data-testid":"minimap.zoom-menu",className:r<5?"tlui-zoom-menu__button":"tlui-zoom-menu__button__pct",onDoubleClick:l,icon:r<4?"zoom-in":void 0,children:r<4?null:(0,Zr.jsxs)("span",{style:{flexGrow:0,textAlign:"center"},children:[Math.floor(100*i),"%"]})})}),(0,Zr.jsx)(gP,{side:"top",align:"start",alignOffset:0,children:(0,Zr.jsxs)(bP,{children:[(0,Zr.jsx)(PC,{action:"zoom-in","data-testid":"minimap.zoom-menu.zoom-in",noClose:!0}),(0,Zr.jsx)(PC,{action:"zoom-out","data-testid":"minimap.zoom-menu.zoom-out",noClose:!0}),(0,Zr.jsx)(PC,{action:"zoom-to-100","data-testid":"minimap.zoom-menu.zoom-to-100",noClose:!0,disabled:a}),(0,Zr.jsx)(PC,{action:"zoom-to-fit",disabled:!o,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0}),(0,Zr.jsx)(PC,{action:"zoom-to-selection",disabled:!s,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})]})})]})}));function PC(e){const{action:t,disabled:n=!1,noClose:r=!1}=e,i=Ow();return(0,Zr.jsx)(wP,{type:"menu",label:i[t].label,kbd:i[t].kbd,"data-testid":e["data-testid"],onClick:()=>i[t].onSelect("zoom-menu"),noClose:r,disabled:n})}const CC=(0,t.memo)((function(){const e=Ow(),n=Oy(),r=Gw(),[i,o]=function(e,n){const[r,i]=t.useState(n);return t.useLayoutEffect((()=>{const t=localStorage.getItem(e);if(t)try{i(JSON.parse(t))}catch(ZI){console.error("Could not restore value ".concat(e," from local storage."))}}),[e]),[r,t.useCallback((t=>{i((n=>{const r="function"===typeof t?t(n):t;return localStorage.setItem(e,JSON.stringify(r)),r}))}),[e])]}("minimap",!0),s=(0,t.useCallback)((()=>{o((e=>!e))}),[o]);return r<4?null:(0,Zr.jsxs)("div",{className:"tlui-navigation-zone",children:[(0,Zr.jsx)("div",{className:"tlui-buttons__horizontal",children:r<6?(0,Zr.jsx)(_C,{}):i?(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsx)(_C,{}),(0,Zr.jsx)(Uy,{type:"icon",icon:i?"chevrons-ne":"chevrons-sw","data-testid":"minimap.toggle",title:n("navigation-zone.toggle-minimap"),className:"tlui-navigation-zone__toggle",onClick:s})]}):(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsx)(Uy,{type:"icon",icon:"minus","data-testid":"minimap.zoom-out",title:"".concat(n(e["zoom-out"].label)," ").concat(Fy(e["zoom-out"].kbd)),onClick:()=>e["zoom-out"].onSelect("navigation-zone")}),(0,Zr.jsx)(_C,{}),(0,Zr.jsx)(Uy,{type:"icon",icon:"plus","data-testid":"minimap.zoom-in",title:"".concat(n(e["zoom-in"].label)," ").concat(Fy(e["zoom-in"].kbd)),onClick:()=>e["zoom-in"].onSelect("navigation-zone")}),(0,Zr.jsx)(Uy,{type:"icon",icon:i?"chevrons-ne":"chevrons-sw","data-testid":"minimap.toggle",title:n("navigation-zone.toggle-minimap"),className:"tlui-navigation-zone__toggle",onClick:s})]})}),r>=6&&!i&&(0,Zr.jsx)(kC,{viewportFill:"--color-muted-1",selectFill:"--color-selected",shapeFill:"--color-text-3"})]})})),EC=W((function(){const e=di().instanceState.isPenMode,t=Ow();if(!e)return null;const n=t["exit-pen-mode"];return(0,Zr.jsx)(Uy,{type:"normal",label:n.label,iconLeft:n.icon,onClick:()=>n.onSelect("helper-buttons")})})),IC=W((function(){const e=di(),t=Ow();if(!e.instanceState.followingUserId)return null;const n=t["stop-following"];return(0,Zr.jsx)(Uy,{type:"normal",label:n.label,iconLeft:n.icon,onClick:()=>n.onSelect("people-menu")})})),MC=[$n,qn,Gn,Zn];function TC(){const e=di();return q("getRelevantStyles",(()=>{var t;const n=new Al(e.sharedStyles),r=e.selectedShapeIds.length>0||!(null===(t=e.root.current.value)||void 0===t||!t.shapeType);if(0===n.size&&e.isIn("select")&&0===e.selectedShapeIds.length)for(const i of MC)n.applyValue(i,e.getStyleForNextShape(i));return 0!==n.size||r?{styles:n,opacity:e.sharedOpacity}:null}),[e])}const AC=t.memo((function(e){const{uiType:n,items:r,title:i,style:o,value:s,onValueChange:a}=e,l=di(),c=Oy(),u=(0,t.useRef)(!1),{handleButtonClick:d,handleButtonPointerDown:h,handleButtonPointerEnter:p,handleButtonPointerUp:f}=t.useMemo((()=>{const e=()=>{u.current=!1,window.removeEventListener("pointerup",e)};return{handleButtonClick:e=>{const{id:t}=e.currentTarget.dataset;"shared"===s.type&&s.value===t||(l.mark("point picker item"),a(o,t,!1))},handleButtonPointerDown:t=>{const{id:n}=t.currentTarget.dataset;l.mark("point picker item"),a(o,n,!0),u.current=!0,window.addEventListener("pointerup",e)},handleButtonPointerEnter:e=>{if(!u.current)return;const{id:t}=e.currentTarget.dataset;a(o,t,!0)},handleButtonPointerUp:e=>{const{id:t}=e.currentTarget.dataset;a(o,t,!1)}}}),[s,l,a,o]),g=q("theme",(()=>Wn({isDarkMode:l.user.isDarkMode})),[l]);return(0,Zr.jsx)("div",{className:Jr("tlui-buttons__grid"),children:r.map((e=>(0,Zr.jsx)(Uy,{type:"icon","data-id":e.value,"data-testid":"style.".concat(n,".").concat(e.value),"aria-label":e.value,"data-state":"shared"===s.type&&s.value===e.value?"hinted":void 0,title:i+" \u2014 "+c("".concat(n,"-style.").concat(e.value)),className:Jr("tlui-button-grid__button"),style:o===$n?{color:g[e.value].solid}:void 0,onPointerEnter:p,onPointerDown:h,onPointerUp:f,onClick:d,icon:e.icon},e.value)))})}));function jC(e,t){let[n,r]=t;return Math.min(r,Math.max(n,e))}const OC=["PageUp","PageDown"],LC=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],zC={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},RC="Slider",[DC,NC,FC]=gm(RC),[BC,UC]=lm(RC,[FC]),[HC,VC]=BC(RC),KC=(0,t.forwardRef)(((e,n)=>{const{name:r,min:i=0,max:o=100,step:s=1,orientation:a="horizontal",disabled:l=!1,minStepsBetweenThumbs:c=0,defaultValue:u=[i],value:d,onValueChange:h=(()=>{}),onValueCommit:p=(()=>{}),inverted:f=!1,...g}=e,[m,y]=(0,t.useState)(null),v=am(n,(e=>y(e))),b=(0,t.useRef)(new Set),w=(0,t.useRef)(0),x="horizontal"===a,S=!m||Boolean(m.closest("form")),k=x?YC:qC,[_=[],P]=Lm({prop:d,defaultProp:u,onChange:e=>{var t;null===(t=[...b.current][w.current])||void 0===t||t.focus(),h(e)}}),C=(0,t.useRef)(_);function E(e,t){let{commit:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{commit:!1};const r=function(e){return(String(e).split(".")[1]||"").length}(s),a=function(e,t){const n=Math.pow(10,t);return Math.round(e*n)/n}(Math.round((e-i)/s)*s+i,r),l=jC(a,[i,o]);P((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const r=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;const r=[...e];return r[n]=t,r.sort(((e,t)=>e-t))}(e,l,t);if(function(e,t){if(t>0){const n=function(e){return e.slice(0,-1).map(((t,n)=>e[n+1]-t))}(e);return Math.min(...n)>=t}return!0}(r,c*s)){w.current=r.indexOf(l);const t=String(r)!==String(e);return t&&n&&p(r),t?r:e}return e}))}return(0,t.createElement)(HC,{scope:e.__scopeSlider,disabled:l,min:i,max:o,valueIndexToChangeRef:w,thumbs:b.current,values:_,orientation:a},(0,t.createElement)(DC.Provider,{scope:e.__scopeSlider},(0,t.createElement)(DC.Slot,{scope:e.__scopeSlider},(0,t.createElement)(k,im({"aria-disabled":l,"data-disabled":l?"":void 0},g,{ref:v,onPointerDown:om(g.onPointerDown,(()=>{l||(C.current=_)})),min:i,max:o,inverted:f,onSlideStart:l?void 0:function(e){const t=function(e,t){if(1===e.length)return 0;const n=e.map((e=>Math.abs(e-t))),r=Math.min(...n);return n.indexOf(r)}(_,e);E(e,t)},onSlideMove:l?void 0:function(e){E(e,w.current)},onSlideEnd:l?void 0:function(){const e=C.current[w.current];_[w.current]!==e&&p(_)},onHomeKeyDown:()=>!l&&E(i,0,{commit:!0}),onEndKeyDown:()=>!l&&E(o,_.length-1,{commit:!0}),onStepKeyDown:e=>{let{event:t,direction:n}=e;if(!l){const e=OC.includes(t.key)||t.shiftKey&&LC.includes(t.key)?10:1,r=w.current;E(_[r]+s*e*n,r,{commit:!0})}}})))),S&&_.map(((e,n)=>(0,t.createElement)(rE,{key:n,name:r?r+(_.length>1?"[]":""):void 0,value:e}))))})),[WC,$C]=BC(RC,{startEdge:"left",endEdge:"right",size:"width",direction:1}),YC=(0,t.forwardRef)(((e,n)=>{const{min:r,max:i,dir:o,inverted:s,onSlideStart:a,onSlideMove:l,onSlideEnd:c,onStepKeyDown:u,...d}=e,[h,p]=(0,t.useState)(null),f=am(n,(e=>p(e))),g=(0,t.useRef)(),m=Cx(o),y="ltr"===m,v=y&&!s||!y&&s;function b(e){const t=g.current||h.getBoundingClientRect(),n=oE([0,t.width],v?[r,i]:[i,r]);return g.current=t,n(e-t.left)}return(0,t.createElement)(WC,{scope:e.__scopeSlider,startEdge:v?"left":"right",endEdge:v?"right":"left",direction:v?1:-1,size:"width"},(0,t.createElement)(GC,im({dir:m,"data-orientation":"horizontal"},d,{ref:f,style:{...d.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:e=>{const t=b(e.clientX);null===a||void 0===a||a(t)},onSlideMove:e=>{const t=b(e.clientX);null===l||void 0===l||l(t)},onSlideEnd:()=>{g.current=void 0,null===c||void 0===c||c()},onStepKeyDown:e=>{const t=zC[v?"from-left":"from-right"].includes(e.key);null===u||void 0===u||u({event:e,direction:t?-1:1})}})))})),qC=(0,t.forwardRef)(((e,n)=>{const{min:r,max:i,inverted:o,onSlideStart:s,onSlideMove:a,onSlideEnd:l,onStepKeyDown:c,...u}=e,d=(0,t.useRef)(null),h=am(n,d),p=(0,t.useRef)(),f=!o;function g(e){const t=p.current||d.current.getBoundingClientRect(),n=oE([0,t.height],f?[i,r]:[r,i]);return p.current=t,n(e-t.top)}return(0,t.createElement)(WC,{scope:e.__scopeSlider,startEdge:f?"bottom":"top",endEdge:f?"top":"bottom",size:"height",direction:f?1:-1},(0,t.createElement)(GC,im({"data-orientation":"vertical"},u,{ref:h,style:{...u.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:e=>{const t=g(e.clientY);null===s||void 0===s||s(t)},onSlideMove:e=>{const t=g(e.clientY);null===a||void 0===a||a(t)},onSlideEnd:()=>{p.current=void 0,null===l||void 0===l||l()},onStepKeyDown:e=>{const t=zC[f?"from-bottom":"from-top"].includes(e.key);null===c||void 0===c||c({event:e,direction:t?-1:1})}})))})),GC=(0,t.forwardRef)(((e,n)=>{const{__scopeSlider:r,onSlideStart:i,onSlideMove:o,onSlideEnd:s,onHomeKeyDown:a,onEndKeyDown:l,onStepKeyDown:c,...u}=e,d=VC(RC,r);return(0,t.createElement)(mm.span,im({},u,{ref:n,onKeyDown:om(e.onKeyDown,(e=>{"Home"===e.key?(a(e),e.preventDefault()):"End"===e.key?(l(e),e.preventDefault()):OC.concat(LC).includes(e.key)&&(c(e),e.preventDefault())})),onPointerDown:om(e.onPointerDown,(e=>{const t=e.target;t.setPointerCapture(e.pointerId),e.preventDefault(),d.thumbs.has(t)?t.focus():i(e)})),onPointerMove:om(e.onPointerMove,(e=>{e.target.hasPointerCapture(e.pointerId)&&o(e)})),onPointerUp:om(e.onPointerUp,(e=>{const t=e.target;t.hasPointerCapture(e.pointerId)&&(t.releasePointerCapture(e.pointerId),s(e))}))}))})),XC="SliderTrack",QC=(0,t.forwardRef)(((e,n)=>{const{__scopeSlider:r,...i}=e,o=VC(XC,r);return(0,t.createElement)(mm.span,im({"data-disabled":o.disabled?"":void 0,"data-orientation":o.orientation},i,{ref:n}))})),ZC="SliderRange",JC=(0,t.forwardRef)(((e,n)=>{const{__scopeSlider:r,...i}=e,o=VC(ZC,r),s=$C(ZC,r),a=am(n,(0,t.useRef)(null)),l=o.values.length,c=o.values.map((e=>iE(e,o.min,o.max))),u=l>1?Math.min(...c):0,d=100-Math.max(...c);return(0,t.createElement)(mm.span,im({"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0},i,{ref:a,style:{...e.style,[s.startEdge]:u+"%",[s.endEdge]:d+"%"}}))})),eE="SliderThumb",tE=(0,t.forwardRef)(((e,n)=>{const r=NC(e.__scopeSlider),[i,o]=(0,t.useState)(null),s=am(n,(e=>o(e))),a=(0,t.useMemo)((()=>i?r().findIndex((e=>e.ref.current===i)):-1),[r,i]);return(0,t.createElement)(nE,im({},e,{ref:s,index:a}))})),nE=(0,t.forwardRef)(((e,n)=>{const{__scopeSlider:r,index:i,...o}=e,s=VC(eE,r),a=$C(eE,r),[l,c]=(0,t.useState)(null),u=am(n,(e=>c(e))),d=HS(l),h=s.values[i],p=void 0===h?0:iE(h,s.min,s.max),f=function(e,t){return t>2?"Value ".concat(e+1," of ").concat(t):2===t?["Minimum","Maximum"][e]:void 0}(i,s.values.length),g=null===d||void 0===d?void 0:d[a.size],m=g?function(e,t,n){const r=e/2,i=oE([0,50],[0,r]);return(r-i(t)*n)*n}(g,p,a.direction):0;return(0,t.useEffect)((()=>{if(l)return s.thumbs.add(l),()=>{s.thumbs.delete(l)}}),[l,s.thumbs]),(0,t.createElement)("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:"calc(".concat(p,"% + ").concat(m,"px)")}},(0,t.createElement)(DC.ItemSlot,{scope:e.__scopeSlider},(0,t.createElement)(mm.span,im({role:"slider","aria-label":e["aria-label"]||f,"aria-valuemin":s.min,"aria-valuenow":h,"aria-valuemax":s.max,"aria-orientation":s.orientation,"data-orientation":s.orientation,"data-disabled":s.disabled?"":void 0,tabIndex:s.disabled?void 0:0},o,{ref:u,style:void 0===h?{display:"none"}:e.style,onFocus:om(e.onFocus,(()=>{s.valueIndexToChangeRef.current=i}))}))))})),rE=e=>{const{value:n,...r}=e,i=(0,t.useRef)(null),o=function(e){const n=(0,t.useRef)({value:e,previous:e});return(0,t.useMemo)((()=>(n.current.value!==e&&(n.current.previous=n.current.value,n.current.value=e),n.current.previous)),[e])}(n);return(0,t.useEffect)((()=>{const e=i.current,t=window.HTMLInputElement.prototype,r=Object.getOwnPropertyDescriptor(t,"value").set;if(o!==n&&r){const t=new Event("input",{bubbles:!0});r.call(e,n),e.dispatchEvent(t)}}),[o,n]),(0,t.createElement)("input",im({style:{display:"none"}},r,{ref:i,defaultValue:n}))};function iE(e,t,n){return jC(100/(n-t)*(e-t),[0,100])}function oE(e,t){return n=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const r=(t[1]-t[0])/(e[1]-e[0]);return t[0]+r*(n-e[0])}}const sE=KC,aE=QC,lE=JC,cE=tE,uE=(0,t.memo)((function(e){const{title:n,steps:r,value:i,label:o,onValueChange:s}=e,a=di(),l=Oy(),c=(0,t.useCallback)((e=>{s(e[0],!0)}),[s]),u=(0,t.useCallback)((()=>{a.mark("click slider")}),[a]),d=(0,t.useCallback)((()=>{i&&s(i,!1)}),[i,s]);return(0,Zr.jsx)("div",{className:"tlui-slider__container",children:(0,Zr.jsxs)(sE,{"data-testid":e["data-testid"],className:"tlui-slider","area-label":"Opacity",dir:"ltr",min:0,max:r,step:1,value:i?[i]:void 0,onPointerDown:u,onValueChange:c,onPointerUp:d,title:n+" \u2014 "+l(o),children:[(0,Zr.jsx)(aE,{className:"tlui-slider__track",dir:"ltr",children:null!==i&&(0,Zr.jsx)(lE,{className:"tlui-slider__range",dir:"ltr"})}),null!==i&&(0,Zr.jsx)(cE,{className:"tlui-slider__thumb",dir:"ltr"})]})})})),dE=t.memo((function(e){let{label:n,uiTypeA:r,uiTypeB:i,labelA:o,labelB:s,itemsA:a,itemsB:l,styleA:c,styleB:u,valueA:d,valueB:h,onValueChange:p}=e;const f=Oy(),g=t.useMemo((()=>{var e,t;return null!==(e=null===(t=a.find((e=>"shared"===d.type&&d.value===e.value)))||void 0===t?void 0:t.icon)&&void 0!==e?e:"mixed"}),[a,d]),m=t.useMemo((()=>{var e,t;return null!==(e=null===(t=l.find((e=>"shared"===h.type&&h.value===e.value)))||void 0===t?void 0:t.icon)&&void 0!==e?e:"mixed"}),[l,h]);return void 0===d&&void 0===h?null:(0,Zr.jsxs)("div",{className:"tlui-style-panel__double-select-picker",children:[(0,Zr.jsx)("div",{title:f(n),className:"tlui-style-panel__double-select-picker-label",children:f(n)}),(0,Zr.jsxs)("div",{className:"tlui-buttons__horizontal",children:[(0,Zr.jsxs)(pP,{id:"style panel ".concat(r," A"),children:[(0,Zr.jsx)(nP,{asChild:!0,onTouchEnd:e=>oi(e),children:(0,Zr.jsx)(Uy,{type:"icon","data-testid":"style.".concat(r),title:f(o)+" \u2014 "+(null===d||"mixed"===d.type?f("style-panel.mixed"):f("".concat(r,"-style.").concat(d.value))),icon:g,invertIcon:!0,smallIcon:!0})}),(0,Zr.jsx)(gP,{side:"bottom",align:"end",sideOffset:0,alignOffset:-2,children:(0,Zr.jsx)("div",{className:"tlui-buttons__grid",children:a.map((e=>(0,Zr.jsx)(wP,{type:"icon",title:f(o)+" \u2014 "+f("".concat(r,"-style.").concat(e.value)),"data-testid":"style.".concat(r,".").concat(e.value),icon:e.icon,onClick:()=>p(c,e.value,!1),invertIcon:!0},e.value)))})})]}),(0,Zr.jsxs)(pP,{id:"style panel ".concat(i),children:[(0,Zr.jsx)(nP,{asChild:!0,onTouchEnd:e=>oi(e),children:(0,Zr.jsx)(Uy,{type:"icon","data-testid":"style.".concat(i),title:f(s)+" \u2014 "+(null===h||"mixed"===h.type?f("style-panel.mixed"):f("".concat(i,"-style.").concat(h.value))),icon:m,smallIcon:!0})}),(0,Zr.jsx)(gP,{side:"bottom",align:"end",sideOffset:0,alignOffset:-2,children:(0,Zr.jsx)("div",{className:"tlui-buttons__grid",children:l.map((e=>(0,Zr.jsx)(wP,{type:"icon",title:f(s)+" \u2014 "+f("".concat(i,"-style.").concat(e.value)),"data-testid":"style.".concat(i,".").concat(e.value),icon:e.icon,onClick:()=>p(u,e.value,!1)},e.value)))})})]})]})]})})),hE=t.memo((function(e){let{id:n,label:r,uiType:i,style:o,items:s,type:a,value:l,onValueChange:c}=e;const u=Oy(),d=t.useMemo((()=>{var e;return null===(e=s.find((e=>"shared"===l.type&&e.value===l.value)))||void 0===e?void 0:e.icon}),[s,l]);return(0,Zr.jsxs)(pP,{id:"style panel ".concat(n),children:[(0,Zr.jsx)(nP,{asChild:!0,onTouchEnd:e=>oi(e),children:(0,Zr.jsx)(Uy,{type:a,"data-testid":"style.".concat(i),title:"mixed"===l.type?u("style-panel.mixed"):u("".concat(i,"-style.").concat(l.value)),label:r,icon:null!==d&&void 0!==d?d:"mixed"})}),(0,Zr.jsx)(gP,{side:"left",align:"center",alignOffset:0,children:(0,Zr.jsx)("div",{className:"tlui-buttons__grid",children:s.map((e=>(0,Zr.jsx)(wP,{type:"icon","data-testid":"style.".concat(i,".").concat(e.value),title:u("".concat(i,"-style.").concat(e.value)),icon:e.icon,onClick:()=>c(o,e.value,!1)},e.value)))})})]})})),pE={color:[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],fill:[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],dash:[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],size:[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],font:[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],horizontalAlign:[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],verticalAlign:[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-center"},{value:"end",icon:"vertical-align-end"}],geo:[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"cloud",icon:"geo-cloud"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"star",icon:"geo-star"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"}],arrowheadStart:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],arrowheadEnd:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],spline:[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}]},fE=function(e){let{isMobile:n}=e;const r=di(),i=TC(),o=(0,t.useCallback)((()=>{n||r.updateInstanceState({isChangingStyle:!1})}),[r,n]);if(!i)return null;const{styles:s,opacity:a}=i,l=s.get(_r),c=s.get(tr),u=s.get(er),d=void 0===l,h=void 0===c&&void 0===u,p=void 0===s.get(Rr),f=void 0===s.get(Xn);return(0,Zr.jsxs)("div",{className:"tlui-style-panel","data-ismobile":n,onPointerLeave:o,children:[(0,Zr.jsx)(yE,{styles:s,opacity:a}),!f&&(0,Zr.jsx)(vE,{styles:s}),!(d&&h&&p)&&(0,Zr.jsxs)("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[(0,Zr.jsx)(bE,{styles:s}),(0,Zr.jsx)(xE,{styles:s}),(0,Zr.jsx)(wE,{styles:s})]})]})};function gE(){const e=di();return t.useMemo((()=>function(t,n,r){e.batch((()=>{e.isIn("select")&&e.setStyleForSelectedShapes(t,n,{squashing:r}),e.setStyleForNextShapes(t,n,{squashing:r}),e.updateInstanceState({isChangingStyle:!0})}))}),[e])}const mE=[.1,.25,.5,.75,1];function yE(e){let{styles:n,opacity:r}=e;const i=di(),o=Oy(),s=gE(),a=t.useCallback(((e,t)=>{const n=mE[e];i.batch((()=>{i.isIn("select")&&i.setOpacityForSelectedShapes(n,{ephemeral:t}),i.setOpacityForNextShapes(n,{ephemeral:t}),i.updateInstanceState({isChangingStyle:!0})}))}),[i]),l=n.get($n),c=n.get(Gn),u=n.get(qn),d=n.get(Zn),h=void 0!==c||void 0!==u||void 0!==d,p="mixed"===r.type?-1:mE.indexOf(function(e,t){let n,r=1/0;for(const i of e){const e=t(i);e<r&&(n=i,r=e)}return n}(mE,(e=>Math.abs(e-r.value))));return(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsxs)("div",{tabIndex:-1,className:"tlui-style-panel__section__common","aria-label":"style panel styles",children:[void 0===l?null:(0,Zr.jsx)(AC,{title:o("style-panel.color"),uiType:"color",style:$n,items:pE.color,value:l,onValueChange:s}),void 0===r?null:(0,Zr.jsx)(uE,{"data-testid":"style.opacity",value:p>=0?p:mE.length-1,label:"mixed"===r.type?"style-panel.mixed":"opacity-style.".concat(r.value),onValueChange:a,steps:mE.length-1,title:o("style-panel.opacity")})]}),h&&(0,Zr.jsxs)("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[void 0===c?null:(0,Zr.jsx)(AC,{title:o("style-panel.fill"),uiType:"fill",style:Gn,items:pE.fill,value:c,onValueChange:s}),void 0===u?null:(0,Zr.jsx)(AC,{title:o("style-panel.dash"),uiType:"dash",style:qn,items:pE.dash,value:u,onValueChange:s}),void 0===d?null:(0,Zr.jsx)(AC,{title:o("style-panel.size"),uiType:"size",style:Zn,items:pE.size,value:d,onValueChange:s})]})]})}function vE(e){let{styles:t}=e;const n=Oy(),r=gE(),i=t.get(Xn),o=t.get(Sr),s=t.get(kr);return void 0===i&&void 0===o?null:(0,Zr.jsxs)("div",{className:"tlui-style-panel__section","aria-label":"style panel text",children:[void 0===i?null:(0,Zr.jsx)(AC,{title:n("style-panel.font"),uiType:"font",style:Xn,items:pE.font,value:i,onValueChange:r}),void 0===o?null:(0,Zr.jsxs)("div",{className:"tlui-style-panel__row",children:[(0,Zr.jsx)(AC,{title:n("style-panel.align"),uiType:"align",style:Sr,items:pE.horizontalAlign,value:o,onValueChange:r}),(0,Zr.jsx)("div",{className:"tlui-style-panel__row__extra-button",children:void 0===s?(0,Zr.jsx)(Uy,{type:"icon",title:n("style-panel.vertical-align"),"data-testid":"vertical-align",icon:"vertical-align-center",disabled:!0}):(0,Zr.jsx)(hE,{type:"icon",id:"geo-vertical-alignment",uiType:"verticalAlign",style:kr,items:pE.verticalAlign,value:s,onValueChange:r})})]})]})}function bE(e){let{styles:t}=e;const n=gE(),r=t.get(_r);return void 0===r?null:(0,Zr.jsx)(hE,{id:"geo",type:"menu",label:"style-panel.geo",uiType:"geo",style:_r,items:pE.geo,value:r,onValueChange:n})}function wE(e){let{styles:t}=e;const n=gE(),r=t.get(Rr);return void 0===r?null:(0,Zr.jsx)(hE,{id:"spline",type:"menu",label:"style-panel.spline",uiType:"spline",style:Rr,items:pE.spline,value:r,onValueChange:n})}function xE(e){let{styles:t}=e;const n=gE(),r=t.get(tr),i=t.get(er);return r&&i?(0,Zr.jsx)(dE,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:er,itemsA:pE.arrowheadStart,valueA:i,uiTypeB:"arrowheadEnd",styleB:tr,itemsB:pE.arrowheadEnd,valueB:r,onValueChange:n,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"}):null}function SE(e){var t,n;let{toast:r}=e;const{removeToast:i}=xw(),o=Oy(),s=r.actions&&r.actions.length>0;return(0,Zr.jsxs)(my,{onOpenChange:e=>{e||i(r.id)},className:"tlui-toast__container",duration:r.keepOpen?1/0:5e3,children:[r.icon&&(0,Zr.jsx)("div",{className:"tlui-toast__icon",children:(0,Zr.jsx)(zy,{icon:r.icon})}),(0,Zr.jsxs)("div",{className:"tlui-toast__main",children:[(0,Zr.jsxs)("div",{className:"tlui-toast__content",children:[r.title&&(0,Zr.jsx)(yy,{className:"tlui-toast__title",children:r.title}),r.description&&(0,Zr.jsx)(vy,{className:"tlui-toast__description",children:r.description})]}),r.actions&&(0,Zr.jsxs)("div",{className:"tlui-toast__actions",children:[r.actions.map(((e,t)=>(0,Zr.jsx)(by,{altText:e.label,asChild:!0,onClick:e.onClick,children:(0,Zr.jsx)(Uy,{type:e.type,children:e.label})},t))),(0,Zr.jsx)(wy,{asChild:!0,children:(0,Zr.jsx)(Uy,{type:"normal",className:"tlui-toast__close",style:{marginLeft:"auto"},children:null!==(t=r.closeLabel)&&void 0!==t?t:o("toast.close")})})]})]}),!s&&(0,Zr.jsx)(wy,{asChild:!0,children:(0,Zr.jsx)(Uy,{type:"normal",className:"tlui-toast__close",children:null!==(n=r.closeLabel)&&void 0!==n?n:o("toast.close")})})]})}const kE=t.memo((function(){const{toasts:e}=xw();return(0,Zr.jsx)(Zr.Fragment,{children:e.map((e=>(0,Zr.jsx)(SE,{toast:e},e.id)))})}));function _E(){const{toasts:e}=xw(),[n,r]=t.useState(!1);return t.useEffect((()=>{let t=!1;return e.length?r(!0):setTimeout((()=>{t||r(!1)}),1e3),()=>{t=!0}}),[e.length,r]),n?(0,Zr.jsx)(Gm,{className:"tlui-toast__viewport"}):null}function PE(){const e=di(),n=Oy(),r=TC(),i=null===r||void 0===r?void 0:r.styles.get($n),o=Wn({isDarkMode:e.user.isDarkMode}),s=("shared"===(null===i||void 0===i?void 0:i.type)?o[i.value]:o.black).solid,a=q("isHandOrEraserToolActive",(()=>e.isInAny("hand","zoom","eraser","laser")),[e]),l=(0,t.useCallback)((t=>{t||e.updateInstanceState({isChangingStyle:!1})}),[e]);return(0,Zr.jsxs)(aC,{id:"style menu",onOpenChange:l,children:[(0,Zr.jsx)(lC,{disabled:a,children:(0,Zr.jsx)(Uy,{type:"tool","data-testid":"mobile.styles",style:{color:a?"var(--color-muted-1)":s},title:n("style-panel.title"),children:(0,Zr.jsx)(zy,{icon:a?"blob":"mixed"===(null===i||void 0===i?void 0:i.type)?"mixed":"blob"})})}),(0,Zr.jsx)(cC,{side:"top",align:"end",children:(0,Zr.jsx)(fE,{isMobile:!0})})]})}const CE=["select","hand","draw","eraser","text","zoom","laser","highlight"];function EE(e){let{activeToolId:t}=e;const n=di(),r=Gw(),i=Oy(),o=q("is tool locked",(()=>n.instanceState.isToolLocked),[n]);return!t||CE.includes(t)?null:(0,Zr.jsx)(Uy,{type:"normal",title:i("action.toggle-tool-lock"),className:Jr("tlui-toolbar__lock-button",{"tlui-toolbar__lock-button__mobile":r<5}),icon:o?"lock":"unlock",onClick:()=>n.updateInstanceState({isToolLocked:!o}),smallIcon:!0})}const IE=(0,t.memo)((function(){const e=di(),n=Oy(),r=Gw(),i=t.useRef(void 0),o=Ld(),s=function(){const e=t.useContext(yx);if(!e)throw new Error("useToolbarSchema must be used within a ToolbarSchemaProvider");return e}(),a=s.find((e=>"laser"===e.toolItem.id)),l=q("current tool id",(()=>e.currentToolId),[e]),c=q("geo",(()=>e.sharedStyles.getAsKnownValue(_r)),[e]),u=!o,d=e=>e.label?"".concat(n(e.label)," ").concat(e.kbd?Fy(e.kbd):""):"",h=s.find((e=>AE(e.toolItem,l,c))),{itemsInPanel:p,itemsInDropdown:f,dropdownFirstItem:g}=t.useMemo((()=>{const e=[],t=[];let n;const o=Math.min(8,5+r);for(let r=4;r<s.length;r++){const i=s[r];r<o?e.push(i):(i===h&&(n=i),t.push(i))}return n||(i.current||(i.current=t[0]),n=i.current,t.includes(n)||(n=t[0])),i.current=n,t.length<=2&&(e.push(...t),t.length=0),{itemsInPanel:e,itemsInDropdown:t,dropdownFirstItem:n}}),[s,h,r]);return(0,Zr.jsx)("div",{className:"tlui-toolbar",children:(0,Zr.jsxs)("div",{className:"tlui-toolbar__inner",children:[(0,Zr.jsxs)("div",{className:"tlui-toolbar__left",children:[!o&&(0,Zr.jsxs)("div",{className:"tlui-toolbar__extras",children:[r<6&&!("hand"===l||"zoom"===l)&&(0,Zr.jsxs)("div",{className:"tlui-toolbar__extras__controls tlui-buttons__horizontal",children:[(0,Zr.jsx)(wC,{}),(0,Zr.jsx)(vC,{}),(0,Zr.jsx)(bC,{}),(0,Zr.jsx)(dC,{}),(0,Zr.jsx)(uC,{})]}),(0,Zr.jsx)(EE,{activeToolId:l})]}),(0,Zr.jsxs)("div",{className:Jr("tlui-toolbar__tools",{"tlui-toolbar__tools__mobile":r<5}),children:[s.slice(0,2).map((e=>{let{toolItem:t}=e;return(0,Zr.jsx)(TE,{item:t,title:d(t),isSelected:AE(t,l,c)},t.id)})),o&&a&&(0,Zr.jsx)(TE,{item:a.toolItem,title:d(a.toolItem),isSelected:AE(a.toolItem,l,c)},a.toolItem.id),u&&(0,Zr.jsxs)(Zr.Fragment,{children:[s.slice(2,4).map((e=>{let{toolItem:t}=e;return(0,Zr.jsx)(TE,{item:t,title:d(t),isSelected:AE(t,l,c)},t.id)})),p.map((e=>{let{toolItem:t}=e;return(0,Zr.jsx)(TE,{item:t,title:d(t),isSelected:AE(t,l,c)},t.id)})),f.length?(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsx)(TE,{item:g.toolItem,title:d(g.toolItem),isSelected:AE(g.toolItem,l,c)},g.toolItem.id),(0,Zr.jsxs)(pP,{id:"toolbar overflow",modal:!1,children:[(0,Zr.jsx)(fP,{children:(0,Zr.jsx)(Uy,{className:"tlui-toolbar__overflow",icon:"chevron-up",type:"tool","data-testid":"tools.more",title:n("tool-panel.more")})}),(0,Zr.jsx)(gP,{side:"top",align:"center",children:(0,Zr.jsx)(ME,{toolbarItems:f})})]})]}):null]})]})]}),r<5&&!o&&(0,Zr.jsx)("div",{className:"tlui-toolbar__tools",children:(0,Zr.jsx)(PE,{})})]})})})),ME=W((function(e){let{toolbarItems:t}=e;const n=Oy();return(0,Zr.jsx)("div",{className:"tlui-buttons__grid",children:t.map((e=>{var t;let{toolItem:{id:r,meta:i,kbd:o,label:s,onSelect:a,icon:l}}=e;return(0,Zr.jsx)(wP,{type:"icon",className:"tlui-button-grid__button","data-testid":"tools.more.".concat(r),"data-tool":r,"data-geo":null!==(t=null===i||void 0===i?void 0:i.geo)&&void 0!==t?t:"","aria-label":s,onClick:()=>a("toolbar"),title:s?"".concat(n(s)," ").concat(o?Fy(o):""):"",icon:l},r)}))})}));function TE(e){var t,n;let{item:r,title:i,isSelected:o}=e;return(0,Zr.jsx)(Uy,{type:"tool","data-testid":"tools.".concat(r.id),"data-tool":r.id,"data-geo":null!==(t=null===(n=r.meta)||void 0===n?void 0:n.geo)&&void 0!==t?t:"","aria-label":r.label,title:i,icon:r.icon,"data-state":o?"selected":void 0,onClick:()=>r.onSelect("toolbar"),onTouchStart:e=>{oi(e),r.onSelect("toolbar")}})}const AE=(e,t,n)=>{var r,i;return null!==(r=e.meta)&&void 0!==r&&r.geo?"geo"===t&&n===(null===(i=e.meta)||void 0===i?void 0:i.geo):t===e.id};var jE="undefined"!==typeof navigator&&navigator.userAgent.toLowerCase().indexOf("firefox")>0;function OE(e,t,n,r){e.addEventListener?e.addEventListener(t,n,r):e.attachEvent&&e.attachEvent("on".concat(t),(function(){n(window.event)}))}function LE(e,t){for(var n=t.slice(0,t.length-1),r=0;r<n.length;r++)n[r]=e[n[r].toLowerCase()];return n}function zE(e){"string"!==typeof e&&(e="");for(var t=(e=e.replace(/\s/g,"")).split(","),n=t.lastIndexOf("");n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}for(var RE={backspace:8,"\u232b":8,tab:9,clear:12,enter:13,"\u21a9":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"\u21ea":20,",":188,".":190,"/":191,"`":192,"-":jE?173:189,"=":jE?61:187,";":jE?59:186,"'":222,"[":219,"]":221,"\\":220},DE={"\u21e7":16,shift:16,"\u2325":18,alt:18,option:18,"\u2303":17,ctrl:17,control:17,"\u2318":91,cmd:91,command:91},NE={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},FE={16:!1,18:!1,17:!1,91:!1},BE={},UE=1;UE<20;UE++)RE["f".concat(UE)]=111+UE;var HE=[],VE=!1,KE="all",WE=[],$E=function(e){return RE[e.toLowerCase()]||DE[e.toLowerCase()]||e.toUpperCase().charCodeAt(0)};function YE(e){KE=e||"all"}function qE(){return KE||"all"}var GE=function(e){var t=e.key,n=e.scope,r=e.method,i=e.splitKey,o=void 0===i?"+":i;zE(t).forEach((function(e){var t=e.split(o),i=t.length,s=t[i-1],a="*"===s?"*":$E(s);if(BE[a]){n||(n=qE());var l=i>1?LE(DE,t):[];BE[a]=BE[a].filter((function(e){return!((!r||e.method===r)&&e.scope===n&&function(e,t){for(var n=e.length>=t.length?e:t,r=e.length>=t.length?t:e,i=!0,o=0;o<n.length;o++)-1===r.indexOf(n[o])&&(i=!1);return i}(e.mods,l))}))}}))};function XE(e,t,n,r){var i;if(t.element===r&&(t.scope===n||"all"===t.scope)){for(var o in i=t.mods.length>0,FE)Object.prototype.hasOwnProperty.call(FE,o)&&(!FE[o]&&t.mods.indexOf(+o)>-1||FE[o]&&-1===t.mods.indexOf(+o))&&(i=!1);(0!==t.mods.length||FE[16]||FE[18]||FE[17]||FE[91])&&!i&&"*"!==t.shortcut||(t.keys=[],t.keys=t.keys.concat(HE),!1===t.method(e,t)&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0)))}}function QE(e,t){var n=BE["*"],r=e.keyCode||e.which||e.charCode;if(ZE.filter.call(this,e)){if(93!==r&&224!==r||(r=91),-1===HE.indexOf(r)&&229!==r&&HE.push(r),["ctrlKey","altKey","shiftKey","metaKey"].forEach((function(t){var n=NE[t];e[t]&&-1===HE.indexOf(n)?HE.push(n):!e[t]&&HE.indexOf(n)>-1?HE.splice(HE.indexOf(n),1):"metaKey"===t&&e[t]&&3===HE.length&&(e.ctrlKey||e.shiftKey||e.altKey||(HE=HE.slice(HE.indexOf(n))))})),r in FE){for(var i in FE[r]=!0,DE)DE[i]===r&&(ZE[i]=!0);if(!n)return}for(var o in FE)Object.prototype.hasOwnProperty.call(FE,o)&&(FE[o]=e[NE[o]]);e.getModifierState&&(!e.altKey||e.ctrlKey)&&e.getModifierState("AltGraph")&&(-1===HE.indexOf(17)&&HE.push(17),-1===HE.indexOf(18)&&HE.push(18),FE[17]=!0,FE[18]=!0);var s=qE();if(n)for(var a=0;a<n.length;a++)n[a].scope===s&&("keydown"===e.type&&n[a].keydown||"keyup"===e.type&&n[a].keyup)&&XE(e,n[a],s,t);if(r in BE)for(var l=0;l<BE[r].length;l++)if(("keydown"===e.type&&BE[r][l].keydown||"keyup"===e.type&&BE[r][l].keyup)&&BE[r][l].key){for(var c=BE[r][l],u=c.splitKey,d=c.key.split(u),h=[],p=0;p<d.length;p++)h.push($E(d[p]));h.sort().join("")===HE.sort().join("")&&XE(e,c,s,t)}}}function ZE(e,t,n){HE=[];var r=zE(e),i=[],o="all",s=document,a=0,l=!1,c=!0,u="+",d=!1;for(void 0===n&&"function"===typeof t&&(n=t),"[object Object]"===Object.prototype.toString.call(t)&&(t.scope&&(o=t.scope),t.element&&(s=t.element),t.keyup&&(l=t.keyup),void 0!==t.keydown&&(c=t.keydown),void 0!==t.capture&&(d=t.capture),"string"===typeof t.splitKey&&(u=t.splitKey)),"string"===typeof t&&(o=t);a<r.length;a++)i=[],(e=r[a].split(u)).length>1&&(i=LE(DE,e)),(e="*"===(e=e[e.length-1])?"*":$E(e))in BE||(BE[e]=[]),BE[e].push({keyup:l,keydown:c,scope:o,mods:i,shortcut:r[a],method:n,key:r[a],splitKey:u,element:s});"undefined"!==typeof s&&!function(e){return WE.indexOf(e)>-1}(s)&&window&&(WE.push(s),OE(s,"keydown",(function(e){QE(e,s)}),d),VE||(VE=!0,OE(window,"focus",(function(){HE=[]}),d)),OE(s,"keyup",(function(e){QE(e,s),function(e){var t=e.keyCode||e.which||e.charCode,n=HE.indexOf(t);if(n>=0&&HE.splice(n,1),e.key&&"meta"===e.key.toLowerCase()&&HE.splice(0,HE.length),93!==t&&224!==t||(t=91),t in FE)for(var r in FE[t]=!1,DE)DE[r]===t&&(ZE[r]=!1)}(e)}),d))}var JE={getPressedKeyString:function(){return HE.map((function(e){return t=e,Object.keys(RE).find((function(e){return RE[e]===t}))||function(e){return Object.keys(DE).find((function(t){return DE[t]===e}))}(e)||String.fromCharCode(e);var t}))},setScope:YE,getScope:qE,deleteScope:function(e,t){var n,r;for(var i in e||(e=qE()),BE)if(Object.prototype.hasOwnProperty.call(BE,i))for(n=BE[i],r=0;r<n.length;)n[r].scope===e?n.splice(r,1):r++;qE()===e&&YE(t||"all")},getPressedKeyCodes:function(){return HE.slice(0)},getAllKeyCodes:function(){var e=[];return Object.keys(BE).forEach((function(t){BE[t].forEach((function(t){var n=t.key,r=t.scope,i=t.mods,o=t.shortcut;e.push({scope:r,shortcut:o,mods:i,keys:n.split("+").map((function(e){return $E(e)}))})}))})),e},isPressed:function(e){return"string"===typeof e&&(e=$E(e)),-1!==HE.indexOf(e)},filter:function(e){var t=e.target||e.srcElement,n=t.tagName,r=!0;return!t.isContentEditable&&("INPUT"!==n&&"TEXTAREA"!==n&&"SELECT"!==n||t.readOnly)||(r=!1),r},trigger:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";Object.keys(BE).forEach((function(n){BE[n].filter((function(n){return n.scope===t&&n.shortcut===e})).forEach((function(e){e&&e.method&&e.method()}))}))},unbind:function(e){if("undefined"===typeof e)Object.keys(BE).forEach((function(e){return delete BE[e]}));else if(Array.isArray(e))e.forEach((function(e){e.key&&GE(e)}));else if("object"===typeof e)e.key&&GE(e);else if("string"===typeof e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n[0],o=n[1];"function"===typeof i&&(o=i,i=""),GE({key:e,scope:i,method:o,splitKey:"+"})}},keyMap:RE,modifier:DE,modifierMap:NE};for(var eI in JE)Object.prototype.hasOwnProperty.call(JE,eI)&&(ZE[eI]=JE[eI]);if("undefined"!==typeof window){var tI=window.hotkeys;ZE.noConflict=function(e){return e&&window.hotkeys===ZE&&(window.hotkeys=tI),ZE},window.hotkeys=ZE}const nI=["copy","cut","paste","asset"];function rI(e){return function(e){"string"!==typeof e&&(e="");const t=(e=e.replace(/\s/g,"")).split(",");let n=t.lastIndexOf("");for(;n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}(e).map((e=>{let t="";const n=e.split("");return t=1===n.length?n[0]:"!"===n[0]?"shift+".concat(n[1]):"?"===n[0]?3===n.length&&"!"===n[1]?"alt+shift+".concat(n[2]):"alt+".concat(n[1]):"$"===n[0]?"!"===n[1]?"cmd+shift+".concat(n[2],",ctrl+shift+").concat(n[2]):"?"===n[1]?"cmd+\u2325+".concat(n[2],",ctrl+alt+").concat(n[2]):"cmd+".concat(n[1],",ctrl+").concat(n[1]):e,t})).join(",")}const iI=t.memo((function(e){let{shareZone:t,topZone:n,renderDebugMenuItems:r,children:i,hideUi:o,...s}=e;return(0,Zr.jsx)(Sx,{...s,children:(0,Zr.jsx)(oI,{hideUi:o,shareZone:t,topZone:n,renderDebugMenuItems:r,children:i})})})),oI=t.memo((function(e){let{children:t,hideUi:n,...r}=e;return(0,Zr.jsxs)(Zr.Fragment,{children:[t,n?null:(0,Zr.jsx)(sI,{...r})]})})),sI=t.memo((function(e){let{shareZone:n,topZone:r,renderDebugMenuItems:i}=e;const o=di(),s=Oy(),a=Gw(),l=q("isReadonlyMode",(()=>o.instanceState.isReadonly),[o]),c=q("focus",(()=>o.instanceState.isFocusMode),[o]),u=q("debug",(()=>o.instanceState.isDebugMode),[o]);!function(){const e=di(),n=Ld(),r=Ow(),i=ox(),o=q("is focused",(()=>e.instanceState.isFocused),[e]);(0,t.useEffect)((()=>{if(!o)return;const t=e.getContainer();ZE.setScope(e.store.id);const s=(n,r)=>{ZE(n,{element:t,scope:e.store.id},r)},a=()=>e.isMenuOpen||null!==e.editingShapeId||e.crashingError;for(const e of Object.values(r))e.kbd&&(n&&!e.readonlyOk||nI.includes(e.id)||s(rI(e.kbd),(t=>{a()||(oi(t),e.onSelect("kbd"))})));for(const n of Object.values(i))!n.kbd||!n.readonlyOk&&e.instanceState.isReadonly||nI.includes(n.id)||s(rI(n.kbd),(e=>{a()||(oi(e),n.onSelect("kbd"))}));return()=>{ZE.deleteScope(e.store.id)}}),[r,i,n,e,o])}(),fw(),function(){const e=di(),{addToast:n}=xw();(0,t.useEffect)((()=>{function t(e){let{name:t,count:r}=e;n({title:"Maximum Shapes Reached",description:"You've reached the maximum number of shapes allowed on ".concat(t," (").concat(r,"). Please delete some shapes or move to a different page to continue.")})}return e.addListener("max-shapes",t),()=>{e.removeListener("max-shapes",t)}}),[e,n])}();const{"toggle-focus-mode":d}=Ow();return(0,Zr.jsx)(Km,{children:(0,Zr.jsxs)("div",{className:Jr("tlui-layout",{"tlui-layout__mobile":a<5}),"data-breakpoint":a,children:[c?(0,Zr.jsx)("div",{className:"tlui-layout__top",children:(0,Zr.jsx)(Uy,{type:"icon",className:"tlui-focus-button",title:"".concat(s("focus-mode.toggle-focus-mode")),icon:"dot",onClick:()=>d.onSelect("menu")})}):(0,Zr.jsxs)(Zr.Fragment,{children:[(0,Zr.jsxs)("div",{className:"tlui-layout__top",children:[(0,Zr.jsxs)("div",{className:"tlui-layout__top__left",children:[(0,Zr.jsx)(xC,{}),(0,Zr.jsxs)("div",{className:"tlui-helper-buttons",children:[(0,Zr.jsx)(EC,{}),(0,Zr.jsx)(_x,{}),(0,Zr.jsx)(IC,{})]})]}),(0,Zr.jsx)("div",{className:"tlui-layout__top__center",children:r}),(0,Zr.jsxs)("div",{className:"tlui-layout__top__right",children:[n,a>=5&&!l&&(0,Zr.jsx)("div",{className:"tlui-style-panel__wrapper",children:(0,Zr.jsx)(fE,{})})]})]}),(0,Zr.jsxs)("div",{className:"tlui-layout__bottom",children:[(0,Zr.jsxs)("div",{className:"tlui-layout__bottom__main",children:[(0,Zr.jsx)(CC,{}),(0,Zr.jsx)(IE,{}),a>=4&&(0,Zr.jsx)(RP,{})]}),u&&(0,Zr.jsx)(_P,{renderDebugMenuItems:null!==i&&void 0!==i?i:null})]})]}),(0,Zr.jsx)(kE,{}),(0,Zr.jsx)(jP,{}),(0,Zr.jsx)(_E,{}),(0,Zr.jsx)(OP,{})]})})})),aI="ContextMenu",[lI,cI]=lm(aI,[zk]),uI=zk(),[dI,hI]=lI(aI),pI=e=>{const{__scopeContextMenu:n,children:r,onOpenChange:i,dir:o,modal:s=!0}=e,[a,l]=(0,t.useState)(!1),c=uI(n),u=vm(i),d=(0,t.useCallback)((e=>{l(e),u(e)}),[u]);return(0,t.createElement)(dI,{scope:n,open:a,onOpenChange:d,modal:s},(0,t.createElement)(C_,im({},c,{dir:o,open:a,onOpenChange:d,modal:s}),r))},fI="ContextMenuTrigger",gI=(0,t.forwardRef)(((e,n)=>{const{__scopeContextMenu:r,disabled:i=!1,...o}=e,s=hI(fI,r),a=uI(r),l=(0,t.useRef)({x:0,y:0}),c=(0,t.useRef)({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...l.current})}),u=(0,t.useRef)(0),d=(0,t.useCallback)((()=>window.clearTimeout(u.current)),[]),h=e=>{l.current={x:e.clientX,y:e.clientY},s.onOpenChange(!0)};return(0,t.useEffect)((()=>d),[d]),(0,t.useEffect)((()=>{i&&d()}),[i,d]),(0,t.createElement)(t.Fragment,null,(0,t.createElement)(E_,im({},a,{virtualRef:c})),(0,t.createElement)(mm.span,im({"data-state":s.open?"open":"closed","data-disabled":i?"":void 0},o,{ref:n,style:{WebkitTouchCallout:"none",...e.style},onContextMenu:i?e.onContextMenu:om(e.onContextMenu,(e=>{d(),h(e),e.preventDefault()})),onPointerDown:i?e.onPointerDown:om(e.onPointerDown,PI((e=>{d(),u.current=window.setTimeout((()=>h(e)),700)}))),onPointerMove:i?e.onPointerMove:om(e.onPointerMove,PI(d)),onPointerCancel:i?e.onPointerCancel:om(e.onPointerCancel,PI(d)),onPointerUp:i?e.onPointerUp:om(e.onPointerUp,PI(d))})))})),mI=e=>{const{__scopeContextMenu:n,...r}=e,i=uI(n);return(0,t.createElement)(I_,im({},i,r))},yI="ContextMenuContent",vI=(0,t.forwardRef)(((e,n)=>{const{__scopeContextMenu:r,...i}=e,o=hI(yI,r),s=uI(r),a=(0,t.useRef)(!1);return(0,t.createElement)(M_,im({},s,i,{ref:n,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:t=>{var n;null===(n=e.onCloseAutoFocus)||void 0===n||n.call(e,t),!t.defaultPrevented&&a.current&&t.preventDefault(),a.current=!1},onInteractOutside:t=>{var n;null===(n=e.onInteractOutside)||void 0===n||n.call(e,t),t.defaultPrevented||o.modal||(a.current=!0)},style:{...e.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))})),bI=(0,t.forwardRef)(((e,n)=>{const{__scopeContextMenu:r,...i}=e,o=uI(r);return(0,t.createElement)(T_,im({},o,i,{ref:n}))})),wI=(0,t.forwardRef)(((e,n)=>{const{__scopeContextMenu:r,...i}=e,o=uI(r);return(0,t.createElement)(A_,im({},o,i,{ref:n}))})),xI=(0,t.forwardRef)(((e,n)=>{const{__scopeContextMenu:r,...i}=e,o=uI(r);return(0,t.createElement)(j_,im({},o,i,{ref:n}))})),SI=e=>{const{__scopeContextMenu:n,children:r,onOpenChange:i,open:o,defaultOpen:s}=e,a=uI(n),[l,c]=Lm({prop:o,defaultProp:s,onChange:i});return(0,t.createElement)(L_,im({},a,{open:l,onOpenChange:c}),r)},kI=(0,t.forwardRef)(((e,n)=>{const{__scopeContextMenu:r,...i}=e,o=uI(r);return(0,t.createElement)(z_,im({},o,i,{ref:n}))})),_I=(0,t.forwardRef)(((e,n)=>{const{__scopeContextMenu:r,...i}=e,o=uI(r);return(0,t.createElement)(R_,im({},o,i,{ref:n,style:{...e.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}));function PI(e){return t=>"mouse"!==t.pointerType?e(t):void 0}const CI=pI,EI=gI,II=mI,MI=vI,TI=bI,AI=wI,jI=xI,OI=SI,LI=kI,zI=_I,RI=W((function(){const e=di(),t=fi(),n=e.pages,r=e.currentPageId,i=Oy(),{addToast:o}=xw();return(0,Zr.jsxs)(OI,{children:[(0,Zr.jsx)(LI,{dir:"ltr",asChild:!0,children:(0,Zr.jsx)(Uy,{type:"menu",label:"context-menu.move-to-page","data-testid":"menu-item.move-to-page",icon:"chevron-right"})}),(0,Zr.jsx)(II,{container:t,children:(0,Zr.jsxs)(zI,{className:"tlui-menu",sideOffset:-4,collisionPadding:4,children:[(0,Zr.jsx)(TI,{dir:"ltr",className:"tlui-menu__group","data-testid":"menu-item.pages",children:n.map((t=>(0,Zr.jsx)(AI,{disabled:r===t.id,onSelect:()=>{e.mark("move_shapes_to_page"),e.moveShapesToPage(e.selectedShapeIds,t.id);const n=e.getPage(t.id);n&&o({title:"Changed Page",description:"Moved to ".concat(n.name,"."),actions:[{label:"Go Back",type:"primary",onClick:()=>{e.mark("change-page"),e.setCurrentPage(r)}}]})},asChild:!0,children:(0,Zr.jsx)(Uy,{type:"menu",title:t.name,className:"tlui-context-menu__move-to-page__name",children:(0,Zr.jsx)("span",{className:"tlui-button__label",children:t.name})})},t.id)))},"pages"),(0,Zr.jsx)(TI,{dir:"ltr",className:"tlui-menu__group","data-testid":"menu-item.new-page",children:(0,Zr.jsx)(AI,{onSelect:()=>{const t=Vt.createId(),n=e.selectedShapeIds;e.batch((()=>{e.mark("move_shapes_to_page"),e.createPage({name:"Page",id:t}),e.moveShapesToPage(n,t)}))},asChild:!0,children:(0,Zr.jsx)(Uy,{type:"menu",title:i("context.pages.new-page"),className:"tlui-context-menu__move-to-page__name",children:(0,Zr.jsx)("span",{className:"tlui-button__label",children:i("context.pages.new-page")})})},"new-page")},"new-page")]})})]})})),DI=function(e){let{children:n}=e;const r=di(),i=nx(),o=(0,t.useCallback)((e=>{if(e){if(r.instanceState.isCoarsePointer){const{selectedShapes:e,inputs:{currentPagePoint:t}}=r,n=r.getShapesAtPoint(t);if(!r.selectedShapes.length||!n.some((t=>e.includes(t)))){const e=n.filter((e=>r.isShapeOrAncestorLocked(e)));e.length&&r.select(...e.map((e=>e.id)))}}}else{const{onlySelectedShape:e}=r;e&&r.isShapeOrAncestorLocked(e)&&r.setSelectedShapes([])}}),[r]),s=fi(),[a,l]=hP("context menu",o),c=Ld(),u=0===i.length||c&&i.every((e=>!e.readonlyOk)),d=!q("isSelectToolActive",(()=>"select"===r.currentToolId),[r])||u;return(0,Zr.jsxs)(CI,{dir:"ltr",onOpenChange:l,children:[(0,Zr.jsx)(EI,{onContextMenu:d?oi:void 0,dir:"ltr",disabled:d,children:n}),(0,Zr.jsx)(II,{container:s,children:(0,Zr.jsx)(NI,{})})]})},NI=(0,t.forwardRef)((function(){const e=di(),n=Oy(),r=nx(),[i,o]=hP("context menu sub"),s=Ld(),a=Gw(),l=fi(),[c,u]=(0,t.useState)(!1);function d(e,t,r,i){if(s&&!t.readonlyOk)return null;switch(t.type){case"custom":if("MOVE_TO_PAGE_MENU"===t.id)return(0,Zr.jsx)(RI,{},t.id);break;case"group":return(0,Zr.jsx)(TI,{dir:"ltr",className:Jr("tlui-menu__group",{"tlui-menu__group__small":"submenu"===(null===r||void 0===r?void 0:r.type)}),"data-testid":"menu-item.".concat(t.id),children:t.children.map((n=>d(e,n,t,i+1)))},t.id);case"submenu":return(0,Zr.jsxs)(OI,{onOpenChange:o,children:[(0,Zr.jsx)(LI,{dir:"ltr",disabled:t.disabled,asChild:!0,children:(0,Zr.jsx)(Uy,{type:"menu",label:t.label,"data-testid":"menu-item.".concat(t.id),icon:"chevron-right"})}),(0,Zr.jsx)(II,{container:l,children:(0,Zr.jsx)(zI,{className:"tlui-menu",sideOffset:-4,collisionPadding:4,children:t.children.map((n=>d(e,n,t,i+1)))})})]},t.id);case"item":{if(s&&!t.readonlyOk)return null;const{id:e,checkbox:r,contextMenuLabel:o,label:l,onSelect:d,kbd:h,icon:p}=t.actionItem,f=null!==o&&void 0!==o?o:l,g=f?n(f):void 0;return r?(0,Zr.jsxs)(jI,{className:"tlui-button tlui-button__menu tlui-button__checkbox",dir:"ltr",disabled:t.disabled,onSelect:e=>{d("context-menu"),oi(e)},title:g||void 0,checked:t.checked,children:[(0,Zr.jsx)(zy,{small:!0,icon:t.checked?"check":"checkbox-empty"}),g&&(0,Zr.jsx)("span",{className:"tlui-button__label",draggable:!1,children:g}),h&&(0,Zr.jsx)(By,{children:h})]},e):(0,Zr.jsx)(AI,{dir:"ltr",asChild:!0,children:(0,Zr.jsx)(Uy,{type:"menu","data-testid":"menu-item.".concat(e),kbd:h,label:f,disabled:t.disabled,iconLeft:a<3&&i>2?p:void 0,onClick:()=>{c?u(!1):d("context-menu")}})},e)}}}return(0,Zr.jsx)(II,{container:l,children:(0,Zr.jsx)(MI,{className:"tlui-menu scrollable",alignOffset:-4,collisionPadding:4,onContextMenu:oi,children:r.map((t=>d(e,t,null,0)))})})}));const FI=(e,n)=>{const[r,i]=(0,t.useState)(2);return(0,t.useEffect)((()=>{const{url:t,style:r="normal",weight:o="500",display:s,featureSettings:a,stretch:l,unicodeRange:c,variant:u}=n;let d=!1;i(2);const h={style:r,weight:o,display:s,featureSettings:a,stretch:l,unicodeRange:c,variant:u},p=new FontFace(e,"url(".concat(t,")"),h);return p.load().then((()=>{d||(document.fonts.add(p),i(0))})).catch((e=>{d||(console.error(e),i(1))})),p.$$_url=t,p.$$_fontface="\n@font-face {\n\tfont-family: ".concat(p.family,";\n\tfont-stretch: ").concat(p.stretch,";\n\tfont-weight: ").concat(p.weight,";\n\tfont-style: ").concat(p.style,';\n\tsrc: url("').concat(t,'") format("woff2")\n}'),()=>{document.fonts.delete(p),d=!0}}),[e,n]),r};function BI(e){const{children:n,maxImageDimension:r,maxAssetSize:i,acceptedImageMimeTypes:o,acceptedVideoMimeTypes:s,onMount:a,...l}=e,c={initialState:"select",...l,components:(0,t.useMemo)((()=>({Scribble:jd,CollaboratorScribble:jd,SelectionForeground:Rd,SelectionBackground:Od,Handles:xd,HoveredShapeIndicator:Sd,...l.components})),[l.components]),shapeUtils:(0,t.useMemo)((()=>{var e;return[...ag,...null!==(e=l.shapeUtils)&&void 0!==e?e:[]]}),[l.shapeUtils]),tools:(0,t.useMemo)((()=>{var e;return[...rm,...Gh,...null!==(e=l.tools)&&void 0!==e?e:[]]}),[l.tools])},u=(d=l.assetUrls,(0,t.useMemo)((()=>d?{fonts:{...Sy.fonts,...null===d||void 0===d?void 0:d.fonts}}:Sy),[d]));var d;const{done:h,error:p}=function(e){const n=(0,t.useMemo)((()=>function(e){return{draw:{url:e.fonts.draw},serif:{url:e.fonts.serif},sansSerif:{url:e.fonts.sansSerif},monospace:{url:e.fonts.monospace}}}(e)),[e]),r=[FI("tldraw_draw",n.draw),FI("tldraw_serif",n.serif),FI("tldraw_sans",n.sansSerif),FI("tldraw_mono",n.monospace)];return{error:r.some((e=>1===e)),done:!r.some((e=>2===e))}}(u);return p?(0,Zr.jsx)(nd,{children:"Could not load assets. Please refresh the page."}):h?(0,Zr.jsx)(Gu,{...c,children:(0,Zr.jsxs)(iI,{...c,children:[(0,Zr.jsx)(DI,{children:(0,Zr.jsx)(ba,{})}),(0,Zr.jsx)(UI,{maxImageDimension:r,maxAssetSize:i,acceptedImageMimeTypes:o,acceptedVideoMimeTypes:s,onMount:a}),n]})}):(0,Zr.jsx)(td,{children:"Loading assets..."})}function UI(e){let{maxImageDimension:n=1e3,maxAssetSize:r=10485760,acceptedImageMimeTypes:i=["image/jpeg","image/png","image/gif","image/svg+xml"],acceptedVideoMimeTypes:o=["video/mp4","video/quicktime"],onMount:s}=e;const a=di(),l=function(e){const n=(0,t.useRef)();return(0,t.useLayoutEffect)((()=>{n.current=e})),(0,t.useDebugValue)(e),(0,t.useCallback)((function(){const e=n.current;return te(e,"fn does not exist"),e(...arguments)}),[])}((e=>{const t=[];return t.push(...function(e){return[e.sideEffects.registerAfterChangeHandler("instance",((t,n)=>{t.isFocused!==n.isFocused&&(n.isFocused?(e.getContainer().focus(),e.updateViewportScreenBounds()):(e.complete(),e.getContainer().blur(),e.updateViewportScreenBounds()))})),e.sideEffects.registerAfterChangeHandler("instance_page_state",((t,n)=>{if(t.croppingShapeId!==n.croppingShapeId){const r=e.isInAny("select.crop","select.pointing_crop_handle","select.cropping");!t.croppingShapeId&&n.croppingShapeId?r||e.setCurrentTool("select.crop.idle"):t.croppingShapeId&&!n.croppingShapeId&&r&&e.setCurrentTool("select.idle")}t.editingShapeId!==n.editingShapeId&&(!t.editingShapeId&&n.editingShapeId?e.isIn("select.editing_shape")||e.setCurrentTool("select.editing_shape"):t.editingShapeId&&!n.editingShapeId&&e.isIn("select.editing_shape")&&e.setCurrentTool("select.idle"))}))]}(e)),Ph(e,{maxImageDimension:n,maxAssetSize:r,acceptedImageMimeTypes:i,acceptedVideoMimeTypes:o}),t.push(null===s||void 0===s?void 0:s(e)),()=>{t.forEach((e=>null===e||void 0===e?void 0:e()))}}));return(0,t.useLayoutEffect)((()=>{if(a)return null===l||void 0===l?void 0:l(a)}),[a,l]),null}gt({tldrawFileFormatVersion:ut,schema:gt({schemaVersion:ct,storeVersion:ct,recordVersions:vt(it,gt({version:ct,subTypeVersions:vt(it,ct).optional(),subTypeKey:it.optional()}))}),records:ft(gt({id:it,typeName:it}).allowUnknownProperties())});let HI=null;function VI(){return HI||(HI=async function(){const e=await ch.maxWidth({usePromise:!0}),t=await ch.maxHeight({usePromise:!0}),n=await ch.maxArea({usePromise:!0});return{maxWidth:e.width,maxHeight:t.height,maxArea:n.width*n.height}}()),HI}let KI=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];"undefined"!==typeof Int32Array&&(KI=new Int32Array(KI));class WI{static isPng(e,t){return 137===e.getUint8(t+0)&&80===e.getUint8(t+1)&&78===e.getUint8(t+2)&&71===e.getUint8(t+3)&&13===e.getUint8(t+4)&&10===e.getUint8(t+5)&&26===e.getUint8(t+6)&&10===e.getUint8(t+7)}static getChunkType(e,t){return[String.fromCharCode(e.getUint8(t)),String.fromCharCode(e.getUint8(t+1)),String.fromCharCode(e.getUint8(t+2)),String.fromCharCode(e.getUint8(t+3))].join("")}static readChunks(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n={};if(!WI.isPng(e,t))throw new Error("Not a PNG");for(t+=8;t<=e.buffer.byteLength;){const r=t,i=e.getInt32(t);t+=4;const o=WI.getChunkType(e,t);if("IDAT"===o&&n[o])t+=i+4+4;else{if("IEND"===o)break;n[o]={start:r,dataOffset:t+4,size:i},t+=i+4+4}}return n}static parsePhys(e,t){return{ppux:e.getUint32(t),ppuy:e.getUint32(t+4),unit:e.getUint8(t+4)}}static findChunk(e,t){return WI.readChunks(e)[t]}static setPhysChunk(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0,r=46,i=0;const o=WI.findChunk(e,"pHYs");o&&(r=o.start,i=o.size);const s=WI.findChunk(e,"IDAT");s&&(r=s.start,i=0);const a=new ArrayBuffer(21),l=new DataView(a);l.setUint32(0,9),l.setUint8(4,"p".charCodeAt(0)),l.setUint8(5,"H".charCodeAt(0)),l.setUint8(6,"Y".charCodeAt(0)),l.setUint8(7,"s".charCodeAt(0));const c=2835.5;l.setInt32(8,c*t),l.setInt32(12,c*t),l.setInt8(16,1);const u=new Uint8Array(a.slice(4,17));l.setInt32(17,((e,t)=>{let n=0===t?0:-1^~~t;for(let r=0;r<e.length;r++)n=KI[255&(n^e[r])]^n>>>8;return-1^n})(u));const d=e.buffer.slice(0,r),h=e.buffer.slice(r+i);return new Blob([d,a,h],n)}}async function $I(e,t){const{type:n,quality:r,scale:i}=t,o=+e.getAttribute("width"),s=+e.getAttribute("height");let a=o*i,l=s*i;const c=await async function(e){const t=e.cloneNode(!0);t.setAttribute("encoding",'UTF-8"');const n=new FileReader,r=Array.from(t.querySelectorAll("image"));for(const i of r){const e=i.getAttribute("xlink:href");if(e&&!e.startsWith("data:")){const t=await(await fetch(e)).blob(),r=await new Promise(((e,r)=>{n.onload=()=>e(n.result),n.onerror=()=>r(n.error),n.readAsDataURL(t)}));i.setAttribute("xlink:href",r)}}return function(e){const t=(new XMLSerializer).serializeToString(e),n=window.btoa(unescape(encodeURIComponent(t)));return"data:image/svg+xml;base64,".concat(n)}(t)}(e),u=await VI();if(o>u.maxWidth&&(a=u.maxWidth,l=a/o*s),s>u.maxHeight&&(l=u.maxHeight,a=l/s*o),a*l>u.maxArea){const e=Math.sqrt(u.maxArea/(a*l));a*=e,l*=e}a=Math.floor(a),l=Math.floor(l);const d=a/o,h=await new Promise((e=>{const t=new Image;t.onload=async()=>{await new Promise((e=>setTimeout(e,250)));const n=document.createElement("canvas"),r=n.getContext("2d");n.width=a,n.height=l,r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high",r.drawImage(t,0,0,a,l),URL.revokeObjectURL(c),e(n)},t.onerror=t=>{console.error(t),e(null)},t.src=c}));if(!h)return null;const p=await new Promise((e=>h.toBlob((t=>{t||e(null),e(t)}),"image/"+n,r)));if(!p)return null;const f=new DataView(await p.arrayBuffer());return WI.setPhysChunk(f,d,{type:"image/"+n})}const YI={actions:(e,t)=>(t["save-to-file-manager"]={id:"save-to-file-manager",label:"Save to File Manager (png)",readonlyOk:!0,kbd:"$u",async onSelect(t){const n=await e.getSvg(Array.from(e.currentPageShapeIds)),r=await $I(n,{type:"png",quality:1,scale:2});r?await globalThis.omniSDK.uploadFiles([r],"permanent"):alert("Export Failed")}},t),menu(e,t,n){let{actions:r}=n;const i=Vw(t,["menu","file"]);if("submenu"===i.type){const e=Nw(r["save-to-file-manager"]);i.children.unshift(e)}return t}};var qI,GI,XI,QI,ZI,JI,eM=Object.create,tM=Object.defineProperty,nM=Object.getOwnPropertyDescriptor,rM=Object.getOwnPropertyNames,iM=Object.getPrototypeOf,oM=Object.prototype.hasOwnProperty,sM=(qI=function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')},typeof require<"u"?require:typeof Proxy<"u"?new Proxy(qI,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):qI),aM=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),lM=(e,t,n)=>(((e,t,n)=>{t in e?tM(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n),cM=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},uM=(e,t,n)=>(((e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)})(e,t,"access private method"),n),dM=aM((e=>{e.__esModule=!0,e.extend=o,e.indexOf=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},e.escapeExpression=function(e){if("string"!=typeof e){if(e&&e.toHTML)return e.toHTML();if(null==e)return"";if(!e)return e+"";e=""+e}return r.test(e)?e.replace(n,i):e},e.isEmpty=function(e){return!e&&0!==e||!(!l(e)||0!==e.length)},e.createFrame=function(e){var t=o({},e);return t._parent=e,t},e.blockParams=function(e,t){return e.path=t,e},e.appendContextPath=function(e,t){return(e?e+".":"")+t};var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},n=/[&<>"'`=]/g,r=/[&<>"'`=]/;function i(e){return t[e]}function o(e){for(var t=1;t<arguments.length;t++)for(var n in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],n)&&(e[n]=arguments[t][n]);return e}var s=Object.prototype.toString;e.toString=s;var a=function(e){return"function"==typeof e};a(/x/)&&(e.isFunction=a=function(e){return"function"==typeof e&&"[object Function]"===s.call(e)}),e.isFunction=a;var l=Array.isArray||function(e){return!(!e||"object"!=typeof e)&&"[object Array]"===s.call(e)};e.isArray=l})),hM=aM(((e,t)=>{e.__esModule=!0;var n=["description","fileName","lineNumber","endLineNumber","message","name","number","stack"];function r(e,t){var i=t&&t.loc,o=void 0,s=void 0,a=void 0,l=void 0;i&&(o=i.start.line,s=i.end.line,a=i.start.column,l=i.end.column,e+=" - "+o+":"+a);for(var c=Error.prototype.constructor.call(this,e),u=0;u<n.length;u++)this[n[u]]=c[n[u]];Error.captureStackTrace&&Error.captureStackTrace(this,r);try{i&&(this.lineNumber=o,this.endLineNumber=s,Object.defineProperty?(Object.defineProperty(this,"column",{value:a,enumerable:!0}),Object.defineProperty(this,"endColumn",{value:l,enumerable:!0})):(this.column=a,this.endColumn=l))}catch{}}r.prototype=new Error,e.default=r,t.exports=e.default})),pM=aM(((e,t)=>{e.__esModule=!0;var n=dM();e.default=function(e){e.registerHelper("blockHelperMissing",(function(t,r){var i=r.inverse,o=r.fn;if(!0===t)return o(this);if(!1===t||null==t)return i(this);if(n.isArray(t))return t.length>0?(r.ids&&(r.ids=[r.name]),e.helpers.each(t,r)):i(this);if(r.data&&r.ids){var s=n.createFrame(r.data);s.contextPath=n.appendContextPath(r.data.contextPath,r.name),r={data:s}}return o(t,r)}))},t.exports=e.default})),fM=aM(((e,t)=>{e.__esModule=!0;var n=dM(),r=function(e){return e&&e.__esModule?e:{default:e}}(hM());e.default=function(e){e.registerHelper("each",(function(e,t){if(!t)throw new r.default("Must pass iterator to #each");var i=t.fn,o=t.inverse,s=0,a="",l=void 0,c=void 0;function u(t,r,o){l&&(l.key=t,l.index=r,l.first=0===r,l.last=!!o,c&&(l.contextPath=c+t)),a+=i(e[t],{data:l,blockParams:n.blockParams([e[t],t],[c+t,null])})}if(t.data&&t.ids&&(c=n.appendContextPath(t.data.contextPath,t.ids[0])+"."),n.isFunction(e)&&(e=e.call(this)),t.data&&(l=n.createFrame(t.data)),e&&"object"==typeof e)if(n.isArray(e))for(var d=e.length;s<d;s++)s in e&&u(s,s,s===e.length-1);else if("function"==typeof Symbol&&e[Symbol.iterator]){for(var h=[],p=e[Symbol.iterator](),f=p.next();!f.done;f=p.next())h.push(f.value);for(d=(e=h).length;s<d;s++)u(s,s,s===e.length-1)}else!function(){var t=void 0;Object.keys(e).forEach((function(e){void 0!==t&&u(t,s-1),t=e,s++})),void 0!==t&&u(t,s-1,!0)}();return 0===s&&(a=o(this)),a}))},t.exports=e.default})),gM=aM(((e,t)=>{e.__esModule=!0;var n=function(e){return e&&e.__esModule?e:{default:e}}(hM());e.default=function(e){e.registerHelper("helperMissing",(function(){if(1!==arguments.length)throw new n.default('Missing helper: "'+arguments[arguments.length-1].name+'"')}))},t.exports=e.default})),mM=aM(((e,t)=>{e.__esModule=!0;var n=dM(),r=function(e){return e&&e.__esModule?e:{default:e}}(hM());e.default=function(e){e.registerHelper("if",(function(e,t){if(2!=arguments.length)throw new r.default("#if requires exactly one argument");return n.isFunction(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||n.isEmpty(e)?t.inverse(this):t.fn(this)})),e.registerHelper("unless",(function(t,n){if(2!=arguments.length)throw new r.default("#unless requires exactly one argument");return e.helpers.if.call(this,t,{fn:n.inverse,inverse:n.fn,hash:n.hash})}))},t.exports=e.default})),yM=aM(((e,t)=>{e.__esModule=!0,e.default=function(e){e.registerHelper("log",(function(){for(var t=[void 0],n=arguments[arguments.length-1],r=0;r<arguments.length-1;r++)t.push(arguments[r]);var i=1;null!=n.hash.level?i=n.hash.level:n.data&&null!=n.data.level&&(i=n.data.level),t[0]=i,e.log.apply(e,t)}))},t.exports=e.default})),vM=aM(((e,t)=>{e.__esModule=!0,e.default=function(e){e.registerHelper("lookup",(function(e,t,n){return e&&n.lookupProperty(e,t)}))},t.exports=e.default})),bM=aM(((e,t)=>{e.__esModule=!0;var n=dM(),r=function(e){return e&&e.__esModule?e:{default:e}}(hM());e.default=function(e){e.registerHelper("with",(function(e,t){if(2!=arguments.length)throw new r.default("#with requires exactly one argument");n.isFunction(e)&&(e=e.call(this));var i=t.fn;if(n.isEmpty(e))return t.inverse(this);var o=t.data;return t.data&&t.ids&&((o=n.createFrame(t.data)).contextPath=n.appendContextPath(t.data.contextPath,t.ids[0])),i(e,{data:o,blockParams:n.blockParams([e],[o&&o.contextPath])})}))},t.exports=e.default})),wM=aM((e=>{function t(e){return e&&e.__esModule?e:{default:e}}e.__esModule=!0,e.registerDefaultHelpers=function(e){n.default(e),r.default(e),i.default(e),o.default(e),s.default(e),a.default(e),l.default(e)},e.moveHelperToHooks=function(e,t,n){e.helpers[t]&&(e.hooks[t]=e.helpers[t],n||delete e.helpers[t])};var n=t(pM()),r=t(fM()),i=t(gM()),o=t(mM()),s=t(yM()),a=t(vM()),l=t(bM())})),xM=aM(((e,t)=>{e.__esModule=!0;var n=dM();e.default=function(e){e.registerDecorator("inline",(function(e,t,r,i){var o=e;return t.partials||(t.partials={},o=function(i,o){var s=r.partials;r.partials=n.extend({},s,t.partials);var a=e(i,o);return r.partials=s,a}),t.partials[i.args[0]]=i.fn,o}))},t.exports=e.default})),SM=aM((e=>{e.__esModule=!0,e.registerDefaultDecorators=function(e){t.default(e)};var t=function(e){return e&&e.__esModule?e:{default:e}}(xM())})),kM=aM(((e,t)=>{e.__esModule=!0;var n=dM(),r={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(e){if("string"==typeof e){var t=n.indexOf(r.methodMap,e.toLowerCase());e=t>=0?t:parseInt(e,10)}return e},log:function(e){if(e=r.lookupLevel(e),typeof console<"u"&&r.lookupLevel(r.level)<=e){var t=r.methodMap[e];console[t]||(t="log");for(var n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];console[t].apply(console,i)}}};e.default=r,t.exports=e.default})),_M=aM((e=>{e.__esModule=!0,e.createNewLookupObject=function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return t.extend.apply(void 0,[Object.create(null)].concat(n))};var t=dM()})),PM=aM((e=>{e.__esModule=!0,e.createProtoAccessControl=function(e){var n=Object.create(null);n.constructor=!1,n.__defineGetter__=!1,n.__defineSetter__=!1,n.__lookupGetter__=!1;var r=Object.create(null);return r.__proto__=!1,{properties:{whitelist:t.createNewLookupObject(r,e.allowedProtoProperties),defaultValue:e.allowProtoPropertiesByDefault},methods:{whitelist:t.createNewLookupObject(n,e.allowedProtoMethods),defaultValue:e.allowProtoMethodsByDefault}}},e.resultIsAllowed=function(e,t,i){return function(e,t){return void 0!==e.whitelist[t]?!0===e.whitelist[t]:void 0!==e.defaultValue?e.defaultValue:(function(e){!0!==r[e]&&(r[e]=!0,n.default.log("error",'Handlebars: Access has been denied to resolve the property "'+e+'" because it is not an "own property" of its parent.\nYou can add a runtime option to disable the check or this warning:\nSee https://handlebarsjs.com/api-reference/runtime-options.html#options-to-control-prototype-access for details'))}(t),!1)}("function"==typeof e?t.methods:t.properties,i)},e.resetLoggedProperties=function(){Object.keys(r).forEach((function(e){delete r[e]}))};var t=_M(),n=function(e){return e&&e.__esModule?e:{default:e}}(kM()),r=Object.create(null)})),CM=aM((e=>{function t(e){return e&&e.__esModule?e:{default:e}}e.__esModule=!0,e.HandlebarsEnvironment=c;var n=dM(),r=t(hM()),i=wM(),o=SM(),s=t(kM()),a=PM();e.VERSION="4.7.8";e.COMPILER_REVISION=8;e.LAST_COMPATIBLE_COMPILER_REVISION=7;e.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0 <4.3.0",8:">= 4.3.0"};var l="[object Object]";function c(e,t,n){this.helpers=e||{},this.partials=t||{},this.decorators=n||{},i.registerDefaultHelpers(this),o.registerDefaultDecorators(this)}c.prototype={constructor:c,logger:s.default,log:s.default.log,registerHelper:function(e,t){if(n.toString.call(e)===l){if(t)throw new r.default("Arg not supported with multiple helpers");n.extend(this.helpers,e)}else this.helpers[e]=t},unregisterHelper:function(e){delete this.helpers[e]},registerPartial:function(e,t){if(n.toString.call(e)===l)n.extend(this.partials,e);else{if(typeof t>"u")throw new r.default('Attempting to register a partial called "'+e+'" as undefined');this.partials[e]=t}},unregisterPartial:function(e){delete this.partials[e]},registerDecorator:function(e,t){if(n.toString.call(e)===l){if(t)throw new r.default("Arg not supported with multiple decorators");n.extend(this.decorators,e)}else this.decorators[e]=t},unregisterDecorator:function(e){delete this.decorators[e]},resetLoggedPropertyAccesses:function(){a.resetLoggedProperties()}};var u=s.default.log;e.log=u,e.createFrame=n.createFrame,e.logger=s.default})),EM=aM(((e,t)=>{function n(e){this.string=e}e.__esModule=!0,n.prototype.toString=n.prototype.toHTML=function(){return""+this.string},e.default=n,t.exports=e.default})),IM=aM((e=>{e.__esModule=!0,e.wrapHelper=function(e,t){if("function"!=typeof e)return e;return function(){return arguments[arguments.length-1]=t(arguments[arguments.length-1]),e.apply(this,arguments)}}})),MM=aM((e=>{e.__esModule=!0,e.checkRevision=function(e){var t=e&&e[0]||1,i=r.COMPILER_REVISION;if(!(t>=r.LAST_COMPATIBLE_COMPILER_REVISION&&t<=r.COMPILER_REVISION)){if(t<r.LAST_COMPATIBLE_COMPILER_REVISION){var o=r.REVISION_CHANGES[i],s=r.REVISION_CHANGES[t];throw new n.default("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+o+") or downgrade your runtime to an older version ("+s+").")}throw new n.default("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")}},e.template=function(e,l){if(!l)throw new n.default("No environment passed to template");if(!e||!e.main)throw new n.default("Unknown template object: "+typeof e);e.main.decorator=e.main_d,l.VM.checkRevision(e.compiler);var u=e.compiler&&7===e.compiler[0];var d={strict:function(e,t,r){if(!e||!(t in e))throw new n.default('"'+t+'" not defined in '+e,{loc:r});return d.lookupProperty(e,t)},lookupProperty:function(e,t){var n=e[t];if(null==n||Object.prototype.hasOwnProperty.call(e,t)||s.resultIsAllowed(n,d.protoAccessControl,t))return n},lookup:function(e,t){for(var n=e.length,r=0;r<n;r++){if(null!=(e[r]&&d.lookupProperty(e[r],t)))return e[r][t]}},lambda:function(e,t){return"function"==typeof e?e.call(t):e},escapeExpression:t.escapeExpression,invokePartial:function(r,i,o){o.hash&&(i=t.extend({},i,o.hash),o.ids&&(o.ids[0]=!0)),r=l.VM.resolvePartial.call(this,r,i,o);var s=t.extend({},o,{hooks:this.hooks,protoAccessControl:this.protoAccessControl}),a=l.VM.invokePartial.call(this,r,i,s);if(null==a&&l.compile&&(o.partials[o.name]=l.compile(r,e.compilerOptions,l),a=o.partials[o.name](i,s)),null!=a){if(o.indent){for(var c=a.split("\n"),u=0,d=c.length;u<d&&(c[u]||u+1!==d);u++)c[u]=o.indent+c[u];a=c.join("\n")}return a}throw new n.default("The partial "+o.name+" could not be compiled when running in runtime-only mode")},fn:function(t){var n=e[t];return n.decorator=e[t+"_d"],n},programs:[],program:function(e,t,n,r,i){var o=this.programs[e],s=this.fn(e);return t||i||r||n?o=a(this,e,s,t,n,r,i):o||(o=this.programs[e]=a(this,e,s)),o},data:function(e,t){for(;e&&t--;)e=e._parent;return e},mergeIfNeeded:function(e,n){var r=e||n;return e&&n&&e!==n&&(r=t.extend({},n,e)),r},nullContext:Object.seal({}),noop:l.VM.noop,compilerInfo:e.compiler};function h(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=n.data;h._setup(n),!n.partial&&e.useData&&(i=function(e,t){return(!t||!("root"in t))&&(t=t?r.createFrame(t):{},t.root=e),t}(t,i));var o=void 0,s=e.useBlockParams?[]:void 0;function a(t){return""+e.main(d,t,d.helpers,d.partials,i,s,o)}return e.useDepths&&(o=n.depths?t!=n.depths[0]?[t].concat(n.depths):n.depths:[t]),(a=c(e.main,a,d,n.depths||[],i,s))(t,n)}return h.isTop=!0,h._setup=function(n){if(n.partial)d.protoAccessControl=n.protoAccessControl,d.helpers=n.helpers,d.partials=n.partials,d.decorators=n.decorators,d.hooks=n.hooks;else{var r=t.extend({},l.helpers,n.helpers);(function(e,n){Object.keys(e).forEach((function(r){var i=e[r];e[r]=function(e,n){var r=n.lookupProperty;return o.wrapHelper(e,(function(e){return t.extend({lookupProperty:r},e)}))}(i,n)}))})(r,d),d.helpers=r,e.usePartial&&(d.partials=d.mergeIfNeeded(n.partials,l.partials)),(e.usePartial||e.useDecorators)&&(d.decorators=t.extend({},l.decorators,n.decorators)),d.hooks={},d.protoAccessControl=s.createProtoAccessControl(n);var a=n.allowCallsToHelperMissing||u;i.moveHelperToHooks(d,"helperMissing",a),i.moveHelperToHooks(d,"blockHelperMissing",a)}},h._child=function(t,r,i,o){if(e.useBlockParams&&!i)throw new n.default("must pass block params");if(e.useDepths&&!o)throw new n.default("must pass parent depths");return a(d,t,e[t],r,0,i,o)},h},e.wrapProgram=a,e.resolvePartial=function(e,t,n){return e?!e.call&&!n.name&&(n.name=e,e=n.partials[e]):e="@partial-block"===n.name?n.data["partial-block"]:n.partials[n.name],e},e.invokePartial=function(e,i,o){var s=o.data&&o.data["partial-block"];o.partial=!0,o.ids&&(o.data.contextPath=o.ids[0]||o.data.contextPath);var a=void 0;if(o.fn&&o.fn!==l&&function(){o.data=r.createFrame(o.data);var e=o.fn;a=o.data["partial-block"]=function(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return n.data=r.createFrame(n.data),n.data["partial-block"]=s,e(t,n)},e.partials&&(o.partials=t.extend({},o.partials,e.partials))}(),void 0===e&&a&&(e=a),void 0===e)throw new n.default("The partial "+o.name+" could not be found");if(e instanceof Function)return e(i,o)},e.noop=l;var t=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(dM()),n=function(e){return e&&e.__esModule?e:{default:e}}(hM()),r=CM(),i=wM(),o=IM(),s=PM();function a(e,t,n,r,i,o,s){function a(t){var i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],a=s;return s&&t!=s[0]&&!(t===e.nullContext&&null===s[0])&&(a=[t].concat(s)),n(e,t,e.helpers,e.partials,i.data||r,o&&[i.blockParams].concat(o),a)}return(a=c(n,a,e,s,r,o)).program=t,a.depth=s?s.length:0,a.blockParams=i||0,a}function l(){return""}function c(e,n,r,i,o,s){if(e.decorator){var a={};n=e.decorator(n,a,r,i&&i[0],o,s,i),t.extend(n,a)}return n}})),TM=aM(((e,t)=>{e.__esModule=!0,e.default=function(e){"object"!=typeof globalThis&&(Object.prototype.__defineGetter__("__magic__",(function(){return this})),__magic__.globalThis=__magic__,delete Object.prototype.__magic__);var t=globalThis.Handlebars;e.noConflict=function(){return globalThis.Handlebars===e&&(globalThis.Handlebars=t),e}},t.exports=e.default})),AM=aM(((e,t)=>{function n(e){return e&&e.__esModule?e:{default:e}}function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}e.__esModule=!0;var i=r(CM()),o=n(EM()),s=n(hM()),a=r(dM()),l=r(MM()),c=n(TM());function u(){var e=new i.HandlebarsEnvironment;return a.extend(e,i),e.SafeString=o.default,e.Exception=s.default,e.Utils=a,e.escapeExpression=a.escapeExpression,e.VM=l,e.template=function(t){return l.template(t,e)},e}var d=u();d.create=u,c.default(d),d.default=d,e.default=d,t.exports=e.default})),jM=aM(((e,t)=>{e.__esModule=!0;var n={helpers:{helperExpression:function(e){return"SubExpression"===e.type||("MustacheStatement"===e.type||"BlockStatement"===e.type)&&!!(e.params&&e.params.length||e.hash)},scopedId:function(e){return/^\.|this\b/.test(e.original)},simpleId:function(e){return 1===e.parts.length&&!n.helpers.scopedId(e)&&!e.depth}}};e.default=n,t.exports=e.default})),OM=aM(((e,t)=>{e.__esModule=!0;var n=function(){var e={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,program_repetition0:6,statement:7,mustache:8,block:9,rawBlock:10,partial:11,partialBlock:12,content:13,COMMENT:14,CONTENT:15,openRawBlock:16,rawBlock_repetition0:17,END_RAW_BLOCK:18,OPEN_RAW_BLOCK:19,helperName:20,openRawBlock_repetition0:21,openRawBlock_option0:22,CLOSE_RAW_BLOCK:23,openBlock:24,block_option0:25,closeBlock:26,openInverse:27,block_option1:28,OPEN_BLOCK:29,openBlock_repetition0:30,openBlock_option0:31,openBlock_option1:32,CLOSE:33,OPEN_INVERSE:34,openInverse_repetition0:35,openInverse_option0:36,openInverse_option1:37,openInverseChain:38,OPEN_INVERSE_CHAIN:39,openInverseChain_repetition0:40,openInverseChain_option0:41,openInverseChain_option1:42,inverseAndProgram:43,INVERSE:44,inverseChain:45,inverseChain_option0:46,OPEN_ENDBLOCK:47,OPEN:48,mustache_repetition0:49,mustache_option0:50,OPEN_UNESCAPED:51,mustache_repetition1:52,mustache_option1:53,CLOSE_UNESCAPED:54,OPEN_PARTIAL:55,partialName:56,partial_repetition0:57,partial_option0:58,openPartialBlock:59,OPEN_PARTIAL_BLOCK:60,openPartialBlock_repetition0:61,openPartialBlock_option0:62,param:63,sexpr:64,OPEN_SEXPR:65,sexpr_repetition0:66,sexpr_option0:67,CLOSE_SEXPR:68,hash:69,hash_repetition_plus0:70,hashSegment:71,ID:72,EQUALS:73,blockParams:74,OPEN_BLOCK_PARAMS:75,blockParams_repetition_plus0:76,CLOSE_BLOCK_PARAMS:77,path:78,dataName:79,STRING:80,NUMBER:81,BOOLEAN:82,UNDEFINED:83,NULL:84,DATA:85,pathSegments:86,SEP:87,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"COMMENT",15:"CONTENT",18:"END_RAW_BLOCK",19:"OPEN_RAW_BLOCK",23:"CLOSE_RAW_BLOCK",29:"OPEN_BLOCK",33:"CLOSE",34:"OPEN_INVERSE",39:"OPEN_INVERSE_CHAIN",44:"INVERSE",47:"OPEN_ENDBLOCK",48:"OPEN",51:"OPEN_UNESCAPED",54:"CLOSE_UNESCAPED",55:"OPEN_PARTIAL",60:"OPEN_PARTIAL_BLOCK",65:"OPEN_SEXPR",68:"CLOSE_SEXPR",72:"ID",73:"EQUALS",75:"OPEN_BLOCK_PARAMS",77:"CLOSE_BLOCK_PARAMS",80:"STRING",81:"NUMBER",82:"BOOLEAN",83:"UNDEFINED",84:"NULL",85:"DATA",87:"SEP"},productions_:[0,[3,2],[4,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[13,1],[10,3],[16,5],[9,4],[9,4],[24,6],[27,6],[38,6],[43,2],[45,3],[45,1],[26,3],[8,5],[8,5],[11,5],[12,3],[59,5],[63,1],[63,1],[64,5],[69,1],[71,3],[74,3],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[56,1],[56,1],[79,2],[78,1],[86,3],[86,1],[6,0],[6,2],[17,0],[17,2],[21,0],[21,2],[22,0],[22,1],[25,0],[25,1],[28,0],[28,1],[30,0],[30,2],[31,0],[31,1],[32,0],[32,1],[35,0],[35,2],[36,0],[36,1],[37,0],[37,1],[40,0],[40,2],[41,0],[41,1],[42,0],[42,1],[46,0],[46,1],[49,0],[49,2],[50,0],[50,1],[52,0],[52,2],[53,0],[53,1],[57,0],[57,2],[58,0],[58,1],[61,0],[61,2],[62,0],[62,1],[66,0],[66,2],[67,0],[67,1],[70,1],[70,2],[76,1],[76,2]],performAction:function(e,t,n,r,i,o,s){var a=o.length-1;switch(i){case 1:return o[a-1];case 2:this.$=r.prepareProgram(o[a]);break;case 3:case 4:case 5:case 6:case 7:case 8:case 20:case 27:case 28:case 33:case 34:case 40:case 41:this.$=o[a];break;case 9:this.$={type:"CommentStatement",value:r.stripComment(o[a]),strip:r.stripFlags(o[a],o[a]),loc:r.locInfo(this._$)};break;case 10:this.$={type:"ContentStatement",original:o[a],value:o[a],loc:r.locInfo(this._$)};break;case 11:this.$=r.prepareRawBlock(o[a-2],o[a-1],o[a],this._$);break;case 12:this.$={path:o[a-3],params:o[a-2],hash:o[a-1]};break;case 13:this.$=r.prepareBlock(o[a-3],o[a-2],o[a-1],o[a],!1,this._$);break;case 14:this.$=r.prepareBlock(o[a-3],o[a-2],o[a-1],o[a],!0,this._$);break;case 15:this.$={open:o[a-5],path:o[a-4],params:o[a-3],hash:o[a-2],blockParams:o[a-1],strip:r.stripFlags(o[a-5],o[a])};break;case 16:case 17:this.$={path:o[a-4],params:o[a-3],hash:o[a-2],blockParams:o[a-1],strip:r.stripFlags(o[a-5],o[a])};break;case 18:this.$={strip:r.stripFlags(o[a-1],o[a-1]),program:o[a]};break;case 19:var l=r.prepareBlock(o[a-2],o[a-1],o[a],o[a],!1,this._$),c=r.prepareProgram([l],o[a-1].loc);c.chained=!0,this.$={strip:o[a-2].strip,program:c,chain:!0};break;case 21:this.$={path:o[a-1],strip:r.stripFlags(o[a-2],o[a])};break;case 22:case 23:this.$=r.prepareMustache(o[a-3],o[a-2],o[a-1],o[a-4],r.stripFlags(o[a-4],o[a]),this._$);break;case 24:this.$={type:"PartialStatement",name:o[a-3],params:o[a-2],hash:o[a-1],indent:"",strip:r.stripFlags(o[a-4],o[a]),loc:r.locInfo(this._$)};break;case 25:this.$=r.preparePartialBlock(o[a-2],o[a-1],o[a],this._$);break;case 26:this.$={path:o[a-3],params:o[a-2],hash:o[a-1],strip:r.stripFlags(o[a-4],o[a])};break;case 29:this.$={type:"SubExpression",path:o[a-3],params:o[a-2],hash:o[a-1],loc:r.locInfo(this._$)};break;case 30:this.$={type:"Hash",pairs:o[a],loc:r.locInfo(this._$)};break;case 31:this.$={type:"HashPair",key:r.id(o[a-2]),value:o[a],loc:r.locInfo(this._$)};break;case 32:this.$=r.id(o[a-1]);break;case 35:this.$={type:"StringLiteral",value:o[a],original:o[a],loc:r.locInfo(this._$)};break;case 36:this.$={type:"NumberLiteral",value:Number(o[a]),original:Number(o[a]),loc:r.locInfo(this._$)};break;case 37:this.$={type:"BooleanLiteral",value:"true"===o[a],original:"true"===o[a],loc:r.locInfo(this._$)};break;case 38:this.$={type:"UndefinedLiteral",original:void 0,value:void 0,loc:r.locInfo(this._$)};break;case 39:this.$={type:"NullLiteral",original:null,value:null,loc:r.locInfo(this._$)};break;case 42:this.$=r.preparePath(!0,o[a],this._$);break;case 43:this.$=r.preparePath(!1,o[a],this._$);break;case 44:o[a-2].push({part:r.id(o[a]),original:o[a],separator:o[a-1]}),this.$=o[a-2];break;case 45:this.$=[{part:r.id(o[a]),original:o[a]}];break;case 46:case 48:case 50:case 58:case 64:case 70:case 78:case 82:case 86:case 90:case 94:this.$=[];break;case 47:case 49:case 51:case 59:case 65:case 71:case 79:case 83:case 87:case 91:case 95:case 99:case 101:o[a-1].push(o[a]);break;case 98:case 100:this.$=[o[a]]}},table:[{3:1,4:2,5:[2,46],6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{1:[3]},{5:[1,4]},{5:[2,2],7:5,8:6,9:7,10:8,11:9,12:10,13:11,14:[1,12],15:[1,20],16:17,19:[1,23],24:15,27:16,29:[1,21],34:[1,22],39:[2,2],44:[2,2],47:[2,2],48:[1,13],51:[1,14],55:[1,18],59:19,60:[1,24]},{1:[2,1]},{5:[2,47],14:[2,47],15:[2,47],19:[2,47],29:[2,47],34:[2,47],39:[2,47],44:[2,47],47:[2,47],48:[2,47],51:[2,47],55:[2,47],60:[2,47]},{5:[2,3],14:[2,3],15:[2,3],19:[2,3],29:[2,3],34:[2,3],39:[2,3],44:[2,3],47:[2,3],48:[2,3],51:[2,3],55:[2,3],60:[2,3]},{5:[2,4],14:[2,4],15:[2,4],19:[2,4],29:[2,4],34:[2,4],39:[2,4],44:[2,4],47:[2,4],48:[2,4],51:[2,4],55:[2,4],60:[2,4]},{5:[2,5],14:[2,5],15:[2,5],19:[2,5],29:[2,5],34:[2,5],39:[2,5],44:[2,5],47:[2,5],48:[2,5],51:[2,5],55:[2,5],60:[2,5]},{5:[2,6],14:[2,6],15:[2,6],19:[2,6],29:[2,6],34:[2,6],39:[2,6],44:[2,6],47:[2,6],48:[2,6],51:[2,6],55:[2,6],60:[2,6]},{5:[2,7],14:[2,7],15:[2,7],19:[2,7],29:[2,7],34:[2,7],39:[2,7],44:[2,7],47:[2,7],48:[2,7],51:[2,7],55:[2,7],60:[2,7]},{5:[2,8],14:[2,8],15:[2,8],19:[2,8],29:[2,8],34:[2,8],39:[2,8],44:[2,8],47:[2,8],48:[2,8],51:[2,8],55:[2,8],60:[2,8]},{5:[2,9],14:[2,9],15:[2,9],19:[2,9],29:[2,9],34:[2,9],39:[2,9],44:[2,9],47:[2,9],48:[2,9],51:[2,9],55:[2,9],60:[2,9]},{20:25,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:36,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:37,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{4:38,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{15:[2,48],17:39,18:[2,48]},{20:41,56:40,64:42,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:44,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{5:[2,10],14:[2,10],15:[2,10],18:[2,10],19:[2,10],29:[2,10],34:[2,10],39:[2,10],44:[2,10],47:[2,10],48:[2,10],51:[2,10],55:[2,10],60:[2,10]},{20:45,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:46,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:47,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:41,56:48,64:42,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[2,78],49:49,65:[2,78],72:[2,78],80:[2,78],81:[2,78],82:[2,78],83:[2,78],84:[2,78],85:[2,78]},{23:[2,33],33:[2,33],54:[2,33],65:[2,33],68:[2,33],72:[2,33],75:[2,33],80:[2,33],81:[2,33],82:[2,33],83:[2,33],84:[2,33],85:[2,33]},{23:[2,34],33:[2,34],54:[2,34],65:[2,34],68:[2,34],72:[2,34],75:[2,34],80:[2,34],81:[2,34],82:[2,34],83:[2,34],84:[2,34],85:[2,34]},{23:[2,35],33:[2,35],54:[2,35],65:[2,35],68:[2,35],72:[2,35],75:[2,35],80:[2,35],81:[2,35],82:[2,35],83:[2,35],84:[2,35],85:[2,35]},{23:[2,36],33:[2,36],54:[2,36],65:[2,36],68:[2,36],72:[2,36],75:[2,36],80:[2,36],81:[2,36],82:[2,36],83:[2,36],84:[2,36],85:[2,36]},{23:[2,37],33:[2,37],54:[2,37],65:[2,37],68:[2,37],72:[2,37],75:[2,37],80:[2,37],81:[2,37],82:[2,37],83:[2,37],84:[2,37],85:[2,37]},{23:[2,38],33:[2,38],54:[2,38],65:[2,38],68:[2,38],72:[2,38],75:[2,38],80:[2,38],81:[2,38],82:[2,38],83:[2,38],84:[2,38],85:[2,38]},{23:[2,39],33:[2,39],54:[2,39],65:[2,39],68:[2,39],72:[2,39],75:[2,39],80:[2,39],81:[2,39],82:[2,39],83:[2,39],84:[2,39],85:[2,39]},{23:[2,43],33:[2,43],54:[2,43],65:[2,43],68:[2,43],72:[2,43],75:[2,43],80:[2,43],81:[2,43],82:[2,43],83:[2,43],84:[2,43],85:[2,43],87:[1,50]},{72:[1,35],86:51},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{52:52,54:[2,82],65:[2,82],72:[2,82],80:[2,82],81:[2,82],82:[2,82],83:[2,82],84:[2,82],85:[2,82]},{25:53,38:55,39:[1,57],43:56,44:[1,58],45:54,47:[2,54]},{28:59,43:60,44:[1,58],47:[2,56]},{13:62,15:[1,20],18:[1,61]},{33:[2,86],57:63,65:[2,86],72:[2,86],80:[2,86],81:[2,86],82:[2,86],83:[2,86],84:[2,86],85:[2,86]},{33:[2,40],65:[2,40],72:[2,40],80:[2,40],81:[2,40],82:[2,40],83:[2,40],84:[2,40],85:[2,40]},{33:[2,41],65:[2,41],72:[2,41],80:[2,41],81:[2,41],82:[2,41],83:[2,41],84:[2,41],85:[2,41]},{20:64,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:65,47:[1,66]},{30:67,33:[2,58],65:[2,58],72:[2,58],75:[2,58],80:[2,58],81:[2,58],82:[2,58],83:[2,58],84:[2,58],85:[2,58]},{33:[2,64],35:68,65:[2,64],72:[2,64],75:[2,64],80:[2,64],81:[2,64],82:[2,64],83:[2,64],84:[2,64],85:[2,64]},{21:69,23:[2,50],65:[2,50],72:[2,50],80:[2,50],81:[2,50],82:[2,50],83:[2,50],84:[2,50],85:[2,50]},{33:[2,90],61:70,65:[2,90],72:[2,90],80:[2,90],81:[2,90],82:[2,90],83:[2,90],84:[2,90],85:[2,90]},{20:74,33:[2,80],50:71,63:72,64:75,65:[1,43],69:73,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{72:[1,79]},{23:[2,42],33:[2,42],54:[2,42],65:[2,42],68:[2,42],72:[2,42],75:[2,42],80:[2,42],81:[2,42],82:[2,42],83:[2,42],84:[2,42],85:[2,42],87:[1,50]},{20:74,53:80,54:[2,84],63:81,64:75,65:[1,43],69:82,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:83,47:[1,66]},{47:[2,55]},{4:84,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{47:[2,20]},{20:85,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:86,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{26:87,47:[1,66]},{47:[2,57]},{5:[2,11],14:[2,11],15:[2,11],19:[2,11],29:[2,11],34:[2,11],39:[2,11],44:[2,11],47:[2,11],48:[2,11],51:[2,11],55:[2,11],60:[2,11]},{15:[2,49],18:[2,49]},{20:74,33:[2,88],58:88,63:89,64:75,65:[1,43],69:90,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{65:[2,94],66:91,68:[2,94],72:[2,94],80:[2,94],81:[2,94],82:[2,94],83:[2,94],84:[2,94],85:[2,94]},{5:[2,25],14:[2,25],15:[2,25],19:[2,25],29:[2,25],34:[2,25],39:[2,25],44:[2,25],47:[2,25],48:[2,25],51:[2,25],55:[2,25],60:[2,25]},{20:92,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,31:93,33:[2,60],63:94,64:75,65:[1,43],69:95,70:76,71:77,72:[1,78],75:[2,60],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,33:[2,66],36:96,63:97,64:75,65:[1,43],69:98,70:76,71:77,72:[1,78],75:[2,66],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,22:99,23:[2,52],63:100,64:75,65:[1,43],69:101,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,33:[2,92],62:102,63:103,64:75,65:[1,43],69:104,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,105]},{33:[2,79],65:[2,79],72:[2,79],80:[2,79],81:[2,79],82:[2,79],83:[2,79],84:[2,79],85:[2,79]},{33:[2,81]},{23:[2,27],33:[2,27],54:[2,27],65:[2,27],68:[2,27],72:[2,27],75:[2,27],80:[2,27],81:[2,27],82:[2,27],83:[2,27],84:[2,27],85:[2,27]},{23:[2,28],33:[2,28],54:[2,28],65:[2,28],68:[2,28],72:[2,28],75:[2,28],80:[2,28],81:[2,28],82:[2,28],83:[2,28],84:[2,28],85:[2,28]},{23:[2,30],33:[2,30],54:[2,30],68:[2,30],71:106,72:[1,107],75:[2,30]},{23:[2,98],33:[2,98],54:[2,98],68:[2,98],72:[2,98],75:[2,98]},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],73:[1,108],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{23:[2,44],33:[2,44],54:[2,44],65:[2,44],68:[2,44],72:[2,44],75:[2,44],80:[2,44],81:[2,44],82:[2,44],83:[2,44],84:[2,44],85:[2,44],87:[2,44]},{54:[1,109]},{54:[2,83],65:[2,83],72:[2,83],80:[2,83],81:[2,83],82:[2,83],83:[2,83],84:[2,83],85:[2,83]},{54:[2,85]},{5:[2,13],14:[2,13],15:[2,13],19:[2,13],29:[2,13],34:[2,13],39:[2,13],44:[2,13],47:[2,13],48:[2,13],51:[2,13],55:[2,13],60:[2,13]},{38:55,39:[1,57],43:56,44:[1,58],45:111,46:110,47:[2,76]},{33:[2,70],40:112,65:[2,70],72:[2,70],75:[2,70],80:[2,70],81:[2,70],82:[2,70],83:[2,70],84:[2,70],85:[2,70]},{47:[2,18]},{5:[2,14],14:[2,14],15:[2,14],19:[2,14],29:[2,14],34:[2,14],39:[2,14],44:[2,14],47:[2,14],48:[2,14],51:[2,14],55:[2,14],60:[2,14]},{33:[1,113]},{33:[2,87],65:[2,87],72:[2,87],80:[2,87],81:[2,87],82:[2,87],83:[2,87],84:[2,87],85:[2,87]},{33:[2,89]},{20:74,63:115,64:75,65:[1,43],67:114,68:[2,96],69:116,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,117]},{32:118,33:[2,62],74:119,75:[1,120]},{33:[2,59],65:[2,59],72:[2,59],75:[2,59],80:[2,59],81:[2,59],82:[2,59],83:[2,59],84:[2,59],85:[2,59]},{33:[2,61],75:[2,61]},{33:[2,68],37:121,74:122,75:[1,120]},{33:[2,65],65:[2,65],72:[2,65],75:[2,65],80:[2,65],81:[2,65],82:[2,65],83:[2,65],84:[2,65],85:[2,65]},{33:[2,67],75:[2,67]},{23:[1,123]},{23:[2,51],65:[2,51],72:[2,51],80:[2,51],81:[2,51],82:[2,51],83:[2,51],84:[2,51],85:[2,51]},{23:[2,53]},{33:[1,124]},{33:[2,91],65:[2,91],72:[2,91],80:[2,91],81:[2,91],82:[2,91],83:[2,91],84:[2,91],85:[2,91]},{33:[2,93]},{5:[2,22],14:[2,22],15:[2,22],19:[2,22],29:[2,22],34:[2,22],39:[2,22],44:[2,22],47:[2,22],48:[2,22],51:[2,22],55:[2,22],60:[2,22]},{23:[2,99],33:[2,99],54:[2,99],68:[2,99],72:[2,99],75:[2,99]},{73:[1,108]},{20:74,63:125,64:75,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,23],14:[2,23],15:[2,23],19:[2,23],29:[2,23],34:[2,23],39:[2,23],44:[2,23],47:[2,23],48:[2,23],51:[2,23],55:[2,23],60:[2,23]},{47:[2,19]},{47:[2,77]},{20:74,33:[2,72],41:126,63:127,64:75,65:[1,43],69:128,70:76,71:77,72:[1,78],75:[2,72],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,24],14:[2,24],15:[2,24],19:[2,24],29:[2,24],34:[2,24],39:[2,24],44:[2,24],47:[2,24],48:[2,24],51:[2,24],55:[2,24],60:[2,24]},{68:[1,129]},{65:[2,95],68:[2,95],72:[2,95],80:[2,95],81:[2,95],82:[2,95],83:[2,95],84:[2,95],85:[2,95]},{68:[2,97]},{5:[2,21],14:[2,21],15:[2,21],19:[2,21],29:[2,21],34:[2,21],39:[2,21],44:[2,21],47:[2,21],48:[2,21],51:[2,21],55:[2,21],60:[2,21]},{33:[1,130]},{33:[2,63]},{72:[1,132],76:131},{33:[1,133]},{33:[2,69]},{15:[2,12],18:[2,12]},{14:[2,26],15:[2,26],19:[2,26],29:[2,26],34:[2,26],47:[2,26],48:[2,26],51:[2,26],55:[2,26],60:[2,26]},{23:[2,31],33:[2,31],54:[2,31],68:[2,31],72:[2,31],75:[2,31]},{33:[2,74],42:134,74:135,75:[1,120]},{33:[2,71],65:[2,71],72:[2,71],75:[2,71],80:[2,71],81:[2,71],82:[2,71],83:[2,71],84:[2,71],85:[2,71]},{33:[2,73],75:[2,73]},{23:[2,29],33:[2,29],54:[2,29],65:[2,29],68:[2,29],72:[2,29],75:[2,29],80:[2,29],81:[2,29],82:[2,29],83:[2,29],84:[2,29],85:[2,29]},{14:[2,15],15:[2,15],19:[2,15],29:[2,15],34:[2,15],39:[2,15],44:[2,15],47:[2,15],48:[2,15],51:[2,15],55:[2,15],60:[2,15]},{72:[1,137],77:[1,136]},{72:[2,100],77:[2,100]},{14:[2,16],15:[2,16],19:[2,16],29:[2,16],34:[2,16],44:[2,16],47:[2,16],48:[2,16],51:[2,16],55:[2,16],60:[2,16]},{33:[1,138]},{33:[2,75]},{33:[2,32]},{72:[2,101],77:[2,101]},{14:[2,17],15:[2,17],19:[2,17],29:[2,17],34:[2,17],39:[2,17],44:[2,17],47:[2,17],48:[2,17],51:[2,17],55:[2,17],60:[2,17]}],defaultActions:{4:[2,1],54:[2,55],56:[2,20],60:[2,57],73:[2,81],82:[2,85],86:[2,18],90:[2,89],101:[2,53],104:[2,93],110:[2,19],111:[2,77],116:[2,97],119:[2,63],122:[2,69],135:[2,75],136:[2,32]},parseError:function(e,t){throw new Error(e)},parse:function(e){var t=this,n=[0],r=[null],i=[],o=this.table,s="",a=0,l=0,c=0;this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,typeof this.lexer.yylloc>"u"&&(this.lexer.yylloc={});var u=this.lexer.yylloc;i.push(u);var d=this.lexer.options&&this.lexer.options.ranges;function h(){var e;return"number"!=typeof(e=t.lexer.lex()||1)&&(e=t.symbols_[e]||e),e}"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var p,f,g,m,y,v,b,w,x,S={};;){if(g=n[n.length-1],this.defaultActions[g]?m=this.defaultActions[g]:((null===p||typeof p>"u")&&(p=h()),m=o[g]&&o[g][p]),typeof m>"u"||!m.length||!m[0]){var k="";if(!c){for(v in x=[],o[g])this.terminals_[v]&&v>2&&x.push("'"+this.terminals_[v]+"'");k=this.lexer.showPosition?"Parse error on line "+(a+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+x.join(", ")+", got '"+(this.terminals_[p]||p)+"'":"Parse error on line "+(a+1)+": Unexpected "+(1==p?"end of input":"'"+(this.terminals_[p]||p)+"'"),this.parseError(k,{text:this.lexer.match,token:this.terminals_[p]||p,line:this.lexer.yylineno,loc:u,expected:x})}}if(m[0]instanceof Array&&m.length>1)throw new Error("Parse Error: multiple actions possible at state: "+g+", token: "+p);switch(m[0]){case 1:n.push(p),r.push(this.lexer.yytext),i.push(this.lexer.yylloc),n.push(m[1]),p=null,f?(p=f,f=null):(l=this.lexer.yyleng,s=this.lexer.yytext,a=this.lexer.yylineno,u=this.lexer.yylloc,c>0&&c--);break;case 2:if(b=this.productions_[m[1]][1],S.$=r[r.length-b],S._$={first_line:i[i.length-(b||1)].first_line,last_line:i[i.length-1].last_line,first_column:i[i.length-(b||1)].first_column,last_column:i[i.length-1].last_column},d&&(S._$.range=[i[i.length-(b||1)].range[0],i[i.length-1].range[1]]),typeof(y=this.performAction.call(S,s,l,a,this.yy,m[1],r,i))<"u")return y;b&&(n=n.slice(0,-1*b*2),r=r.slice(0,-1*b),i=i.slice(0,-1*b)),n.push(this.productions_[m[1]][0]),r.push(S.$),i.push(S._$),w=o[n[n.length-2]][n[n.length-1]],n.push(w);break;case 3:return!0}}return!0}},t=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e,e.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t-1),this.offset-=t;var r=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var i=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===r.length?this.yylloc.first_column:0)+r[r.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[i[0],i[0]+this.yyleng-t]),this},more:function(){return this._more=!0,this},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;var e,t,n,r,i;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var o=this._currentRules(),s=0;s<o.length&&(!(n=this._input.match(this.rules[o[s]]))||t&&!(n[0].length>t[0].length)||(t=n,r=s,this.options.flex));s++);return t?((i=t[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=i.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:i?i[i.length-1].length-i[i.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,o[r],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),e||void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return typeof e<"u"?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(e){this.begin(e)},options:{},performAction:function(e,t,n,r){function i(e,n){return t.yytext=t.yytext.substring(e,t.yyleng-n+e)}switch(n){case 0:if("\\\\"===t.yytext.slice(-2)?(i(0,1),this.begin("mu")):"\\"===t.yytext.slice(-1)?(i(0,1),this.begin("emu")):this.begin("mu"),t.yytext)return 15;break;case 1:case 5:return 15;case 2:return this.popState(),15;case 3:return this.begin("raw"),15;case 4:return this.popState(),"raw"===this.conditionStack[this.conditionStack.length-1]?15:(i(5,9),"END_RAW_BLOCK");case 6:case 22:return this.popState(),14;case 7:return 65;case 8:return 68;case 9:return 19;case 10:return this.popState(),this.begin("raw"),23;case 11:return 55;case 12:return 60;case 13:return 29;case 14:return 47;case 15:case 16:return this.popState(),44;case 17:return 34;case 18:return 39;case 19:return 51;case 20:case 23:return 48;case 21:this.unput(t.yytext),this.popState(),this.begin("com");break;case 24:return 73;case 25:case 26:case 41:return 72;case 27:return 87;case 28:break;case 29:return this.popState(),54;case 30:return this.popState(),33;case 31:return t.yytext=i(1,2).replace(/\\"/g,'"'),80;case 32:return t.yytext=i(1,2).replace(/\\'/g,"'"),80;case 33:return 85;case 34:case 35:return 82;case 36:return 83;case 37:return 84;case 38:return 81;case 39:return 75;case 40:return 77;case 42:return t.yytext=t.yytext.replace(/\\([\\\]])/g,"$1"),72;case 43:return"INVALID";case 44:return 5}},rules:[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:\{\{\{\{(?=[^/]))/,/^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/,/^(?:[^\x00]+?(?=(\{\{\{\{)))/,/^(?:[\s\S]*?--(~)?\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{\{\{)/,/^(?:\}\}\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#>)/,/^(?:\{\{(~)?#\*?)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^\s*(~)?\}\})/,/^(?:\{\{(~)?\s*else\s*(~)?\}\})/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{(~)?!--)/,/^(?:\{\{(~)?![\s\S]*?\}\})/,/^(?:\{\{(~)?\*?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)|])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:undefined(?=([~}\s)])))/,/^(?:null(?=([~}\s)])))/,/^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/,/^(?:as\s+\|)/,/^(?:\|)/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)|]))))/,/^(?:\[(\\\]|[^\]])*\])/,/^(?:.)/,/^(?:$)/],conditions:{mu:{rules:[7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[6],inclusive:!1},raw:{rules:[3,4,5],inclusive:!1},INITIAL:{rules:[0,1,44],inclusive:!0}}};return e}();function n(){this.yy={}}return e.lexer=t,n.prototype=e,e.Parser=n,new n}();e.default=n,t.exports=e.default})),LM=aM(((e,t)=>{e.__esModule=!0;var n=function(e){return e&&e.__esModule?e:{default:e}}(hM());function r(){this.parents=[]}function i(e){this.acceptRequired(e,"path"),this.acceptArray(e.params),this.acceptKey(e,"hash")}function o(e){i.call(this,e),this.acceptKey(e,"program"),this.acceptKey(e,"inverse")}function s(e){this.acceptRequired(e,"name"),this.acceptArray(e.params),this.acceptKey(e,"hash")}r.prototype={constructor:r,mutating:!1,acceptKey:function(e,t){var i=this.accept(e[t]);if(this.mutating){if(i&&!r.prototype[i.type])throw new n.default('Unexpected node type "'+i.type+'" found when accepting '+t+" on "+e.type);e[t]=i}},acceptRequired:function(e,t){if(this.acceptKey(e,t),!e[t])throw new n.default(e.type+" requires "+t)},acceptArray:function(e){for(var t=0,n=e.length;t<n;t++)this.acceptKey(e,t),e[t]||(e.splice(t,1),t--,n--)},accept:function(e){if(e){if(!this[e.type])throw new n.default("Unknown type: "+e.type,e);this.current&&this.parents.unshift(this.current),this.current=e;var t=this[e.type](e);if(this.current=this.parents.shift(),!this.mutating||t)return t;if(!1!==t)return e}},Program:function(e){this.acceptArray(e.body)},MustacheStatement:i,Decorator:i,BlockStatement:o,DecoratorBlock:o,PartialStatement:s,PartialBlockStatement:function(e){s.call(this,e),this.acceptKey(e,"program")},ContentStatement:function(){},CommentStatement:function(){},SubExpression:i,PathExpression:function(){},StringLiteral:function(){},NumberLiteral:function(){},BooleanLiteral:function(){},UndefinedLiteral:function(){},NullLiteral:function(){},Hash:function(e){this.acceptArray(e.pairs)},HashPair:function(e){this.acceptRequired(e,"value")}},e.default=r,t.exports=e.default})),zM=aM(((e,t)=>{e.__esModule=!0;var n=function(e){return e&&e.__esModule?e:{default:e}}(LM());function r(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.options=e}function i(e,t,n){void 0===t&&(t=e.length);var r=e[t-1],i=e[t-2];return r?"ContentStatement"===r.type?(i||!n?/\r?\n\s*?$/:/(^|\r?\n)\s*?$/).test(r.original):void 0:n}function o(e,t,n){void 0===t&&(t=-1);var r=e[t+1],i=e[t+2];return r?"ContentStatement"===r.type?(i||!n?/^\s*?\r?\n/:/^\s*?(\r?\n|$)/).test(r.original):void 0:n}function s(e,t,n){var r=e[null==t?0:t+1];if(r&&"ContentStatement"===r.type&&(n||!r.rightStripped)){var i=r.value;r.value=r.value.replace(n?/^\s+/:/^[ \t]*\r?\n?/,""),r.rightStripped=r.value!==i}}function a(e,t,n){var r=e[null==t?e.length-1:t-1];if(r&&"ContentStatement"===r.type&&(n||!r.leftStripped)){var i=r.value;return r.value=r.value.replace(n?/\s+$/:/[ \t]+$/,""),r.leftStripped=r.value!==i,r.leftStripped}}r.prototype=new n.default,r.prototype.Program=function(e){var t=!this.options.ignoreStandalone,n=!this.isRootSeen;this.isRootSeen=!0;for(var r=e.body,l=0,c=r.length;l<c;l++){var u=r[l],d=this.accept(u);if(d){var h=i(r,l,n),p=o(r,l,n),f=d.openStandalone&&h,g=d.closeStandalone&&p,m=d.inlineStandalone&&h&&p;d.close&&s(r,l,!0),d.open&&a(r,l,!0),t&&m&&(s(r,l),a(r,l)&&"PartialStatement"===u.type&&(u.indent=/([ \t]+$)/.exec(r[l-1].original)[1])),t&&f&&(s((u.program||u.inverse).body),a(r,l)),t&&g&&(s(r,l),a((u.inverse||u.program).body))}}return e},r.prototype.BlockStatement=r.prototype.DecoratorBlock=r.prototype.PartialBlockStatement=function(e){this.accept(e.program),this.accept(e.inverse);var t=e.program||e.inverse,n=e.program&&e.inverse,r=n,l=n;if(n&&n.chained)for(r=n.body[0].program;l.chained;)l=l.body[l.body.length-1].program;var c={open:e.openStrip.open,close:e.closeStrip.close,openStandalone:o(t.body),closeStandalone:i((r||t).body)};if(e.openStrip.close&&s(t.body,null,!0),n){var u=e.inverseStrip;u.open&&a(t.body,null,!0),u.close&&s(r.body,null,!0),e.closeStrip.open&&a(l.body,null,!0),!this.options.ignoreStandalone&&i(t.body)&&o(r.body)&&(a(t.body),s(r.body))}else e.closeStrip.open&&a(t.body,null,!0);return c},r.prototype.Decorator=r.prototype.MustacheStatement=function(e){return e.strip},r.prototype.PartialStatement=r.prototype.CommentStatement=function(e){var t=e.strip||{};return{inlineStandalone:!0,open:t.open,close:t.close}},e.default=r,t.exports=e.default})),RM=aM((e=>{e.__esModule=!0,e.SourceLocation=function(e,t){this.source=e,this.start={line:t.first_line,column:t.first_column},this.end={line:t.last_line,column:t.last_column}},e.id=function(e){return/^\[.*\]$/.test(e)?e.substring(1,e.length-1):e},e.stripFlags=function(e,t){return{open:"~"===e.charAt(2),close:"~"===t.charAt(t.length-3)}},e.stripComment=function(e){return e.replace(/^\{\{~?!-?-?/,"").replace(/-?-?~?\}\}$/,"")},e.preparePath=function(e,n,r){r=this.locInfo(r);for(var i=e?"@":"",o=[],s=0,a=0,l=n.length;a<l;a++){var c=n[a].part,u=n[a].original!==c;if(i+=(n[a].separator||"")+c,u||".."!==c&&"."!==c&&"this"!==c)o.push(c);else{if(o.length>0)throw new t.default("Invalid path: "+i,{loc:r});".."===c&&s++}}return{type:"PathExpression",data:e,depth:s,parts:o,original:i,loc:r}},e.prepareMustache=function(e,t,n,r,i,o){var s=r.charAt(3)||r.charAt(2),a="{"!==s&&"&"!==s;return{type:/\*/.test(r)?"Decorator":"MustacheStatement",path:e,params:t,hash:n,escaped:a,strip:i,loc:this.locInfo(o)}},e.prepareRawBlock=function(e,t,r,i){n(e,r),i=this.locInfo(i);var o={type:"Program",body:t,strip:{},loc:i};return{type:"BlockStatement",path:e.path,params:e.params,hash:e.hash,program:o,openStrip:{},inverseStrip:{},closeStrip:{},loc:i}},e.prepareBlock=function(e,r,i,o,s,a){o&&o.path&&n(e,o);var l=/\*/.test(e.open);r.blockParams=e.blockParams;var c=void 0,u=void 0;if(i){if(l)throw new t.default("Unexpected inverse block on decorator",i);i.chain&&(i.program.body[0].closeStrip=o.strip),u=i.strip,c=i.program}return s&&(s=c,c=r,r=s),{type:l?"DecoratorBlock":"BlockStatement",path:e.path,params:e.params,hash:e.hash,program:r,inverse:c,openStrip:e.strip,inverseStrip:u,closeStrip:o&&o.strip,loc:this.locInfo(a)}},e.prepareProgram=function(e,t){if(!t&&e.length){var n=e[0].loc,r=e[e.length-1].loc;n&&r&&(t={source:n.source,start:{line:n.start.line,column:n.start.column},end:{line:r.end.line,column:r.end.column}})}return{type:"Program",body:e,strip:{},loc:t}},e.preparePartialBlock=function(e,t,r,i){return n(e,r),{type:"PartialBlockStatement",name:e.path,params:e.params,hash:e.hash,program:t,openStrip:e.strip,closeStrip:r&&r.strip,loc:this.locInfo(i)}};var t=function(e){return e&&e.__esModule?e:{default:e}}(hM());function n(e,n){if(n=n.path?n.path.original:n,e.path.original!==n){var r={loc:e.path.loc};throw new t.default(e.path.original+" doesn't match "+n,r)}}})),DM=aM((e=>{function t(e){return e&&e.__esModule?e:{default:e}}e.__esModule=!0,e.parseWithoutProcessing=a,e.parse=function(e,t){var n=a(e,t);return new r.default(t).accept(n)};var n=t(OM()),r=t(zM()),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(RM()),o=dM();e.parser=n.default;var s={};function a(e,t){return"Program"===e.type?e:(n.default.yy=s,s.locInfo=function(e){return new s.SourceLocation(t&&t.srcName,e)},n.default.parse(e))}o.extend(s,i)})),NM=aM((e=>{function t(e){return e&&e.__esModule?e:{default:e}}e.__esModule=!0,e.Compiler=s,e.precompile=function(e,t,r){if(null==e||"string"!=typeof e&&"Program"!==e.type)throw new n.default("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+e);"data"in(t=t||{})||(t.data=!0),t.compat&&(t.useDepths=!0);var i=r.parse(e,t),o=(new r.Compiler).compile(i,t);return(new r.JavaScriptCompiler).compile(o,t)},e.compile=function(e,t,i){if(void 0===t&&(t={}),null==e||"string"!=typeof e&&"Program"!==e.type)throw new n.default("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+e);"data"in(t=r.extend({},t))||(t.data=!0),t.compat&&(t.useDepths=!0);var o=void 0;function s(){var n=i.parse(e,t),r=(new i.Compiler).compile(n,t),o=(new i.JavaScriptCompiler).compile(r,t,void 0,!0);return i.template(o)}function a(e,t){return o||(o=s()),o.call(this,e,t)}return a._setup=function(e){return o||(o=s()),o._setup(e)},a._child=function(e,t,n,r){return o||(o=s()),o._child(e,t,n,r)},a};var n=t(hM()),r=dM(),i=t(jM()),o=[].slice;function s(){}function a(e,t){if(e===t)return!0;if(r.isArray(e)&&r.isArray(t)&&e.length===t.length){for(var n=0;n<e.length;n++)if(!a(e[n],t[n]))return!1;return!0}}function l(e){if(!e.path.parts){var t=e.path;e.path={type:"PathExpression",data:!1,depth:0,parts:[t.original+""],original:t.original+"",loc:t.loc}}}s.prototype={compiler:s,equals:function(e){var t=this.opcodes.length;if(e.opcodes.length!==t)return!1;for(var n=0;n<t;n++){var r=this.opcodes[n],i=e.opcodes[n];if(r.opcode!==i.opcode||!a(r.args,i.args))return!1}t=this.children.length;for(n=0;n<t;n++)if(!this.children[n].equals(e.children[n]))return!1;return!0},guid:0,compile:function(e,t){return this.sourceNode=[],this.opcodes=[],this.children=[],this.options=t,this.stringParams=t.stringParams,this.trackIds=t.trackIds,t.blockParams=t.blockParams||[],t.knownHelpers=r.extend(Object.create(null),{helperMissing:!0,blockHelperMissing:!0,each:!0,if:!0,unless:!0,with:!0,log:!0,lookup:!0},t.knownHelpers),this.accept(e)},compileProgram:function(e){var t=(new this.compiler).compile(e,this.options),n=this.guid++;return this.usePartial=this.usePartial||t.usePartial,this.children[n]=t,this.useDepths=this.useDepths||t.useDepths,n},accept:function(e){if(!this[e.type])throw new n.default("Unknown type: "+e.type,e);this.sourceNode.unshift(e);var t=this[e.type](e);return this.sourceNode.shift(),t},Program:function(e){this.options.blockParams.unshift(e.blockParams);for(var t=e.body,n=t.length,r=0;r<n;r++)this.accept(t[r]);return this.options.blockParams.shift(),this.isSimple=1===n,this.blockParams=e.blockParams?e.blockParams.length:0,this},BlockStatement:function(e){l(e);var t=e.program,n=e.inverse;t=t&&this.compileProgram(t),n=n&&this.compileProgram(n);var r=this.classifySexpr(e);"helper"===r?this.helperSexpr(e,t,n):"simple"===r?(this.simpleSexpr(e),this.opcode("pushProgram",t),this.opcode("pushProgram",n),this.opcode("emptyHash"),this.opcode("blockValue",e.path.original)):(this.ambiguousSexpr(e,t,n),this.opcode("pushProgram",t),this.opcode("pushProgram",n),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},DecoratorBlock:function(e){var t=e.program&&this.compileProgram(e.program),n=this.setupFullMustacheParams(e,t,void 0),r=e.path;this.useDecorators=!0,this.opcode("registerDecorator",n.length,r.original)},PartialStatement:function(e){this.usePartial=!0;var t=e.program;t&&(t=this.compileProgram(e.program));var r=e.params;if(r.length>1)throw new n.default("Unsupported number of partial arguments: "+r.length,e);r.length||(this.options.explicitPartialContext?this.opcode("pushLiteral","undefined"):r.push({type:"PathExpression",parts:[],depth:0}));var i=e.name.original,o="SubExpression"===e.name.type;o&&this.accept(e.name),this.setupFullMustacheParams(e,t,void 0,!0);var s=e.indent||"";this.options.preventIndent&&s&&(this.opcode("appendContent",s),s=""),this.opcode("invokePartial",o,i,s),this.opcode("append")},PartialBlockStatement:function(e){this.PartialStatement(e)},MustacheStatement:function(e){this.SubExpression(e),e.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},Decorator:function(e){this.DecoratorBlock(e)},ContentStatement:function(e){e.value&&this.opcode("appendContent",e.value)},CommentStatement:function(){},SubExpression:function(e){l(e);var t=this.classifySexpr(e);"simple"===t?this.simpleSexpr(e):"helper"===t?this.helperSexpr(e):this.ambiguousSexpr(e)},ambiguousSexpr:function(e,t,n){var r=e.path,i=r.parts[0],o=null!=t||null!=n;this.opcode("getContext",r.depth),this.opcode("pushProgram",t),this.opcode("pushProgram",n),r.strict=!0,this.accept(r),this.opcode("invokeAmbiguous",i,o)},simpleSexpr:function(e){var t=e.path;t.strict=!0,this.accept(t),this.opcode("resolvePossibleLambda")},helperSexpr:function(e,t,r){var o=this.setupFullMustacheParams(e,t,r),s=e.path,a=s.parts[0];if(this.options.knownHelpers[a])this.opcode("invokeKnownHelper",o.length,a);else{if(this.options.knownHelpersOnly)throw new n.default("You specified knownHelpersOnly, but used the unknown helper "+a,e);s.strict=!0,s.falsy=!0,this.accept(s),this.opcode("invokeHelper",o.length,s.original,i.default.helpers.simpleId(s))}},PathExpression:function(e){this.addDepth(e.depth),this.opcode("getContext",e.depth);var t=e.parts[0],n=i.default.helpers.scopedId(e),r=!e.depth&&!n&&this.blockParamIndex(t);r?this.opcode("lookupBlockParam",r,e.parts):t?e.data?(this.options.data=!0,this.opcode("lookupData",e.depth,e.parts,e.strict)):this.opcode("lookupOnContext",e.parts,e.falsy,e.strict,n):this.opcode("pushContext")},StringLiteral:function(e){this.opcode("pushString",e.value)},NumberLiteral:function(e){this.opcode("pushLiteral",e.value)},BooleanLiteral:function(e){this.opcode("pushLiteral",e.value)},UndefinedLiteral:function(){this.opcode("pushLiteral","undefined")},NullLiteral:function(){this.opcode("pushLiteral","null")},Hash:function(e){var t=e.pairs,n=0,r=t.length;for(this.opcode("pushHash");n<r;n++)this.pushParam(t[n].value);for(;n--;)this.opcode("assignToHash",t[n].key);this.opcode("popHash")},opcode:function(e){this.opcodes.push({opcode:e,args:o.call(arguments,1),loc:this.sourceNode[0].loc})},addDepth:function(e){e&&(this.useDepths=!0)},classifySexpr:function(e){var t=i.default.helpers.simpleId(e.path),n=t&&!!this.blockParamIndex(e.path.parts[0]),r=!n&&i.default.helpers.helperExpression(e),o=!n&&(r||t);if(o&&!r){var s=e.path.parts[0],a=this.options;a.knownHelpers[s]?r=!0:a.knownHelpersOnly&&(o=!1)}return r?"helper":o?"ambiguous":"simple"},pushParams:function(e){for(var t=0,n=e.length;t<n;t++)this.pushParam(e[t])},pushParam:function(e){var t=null!=e.value?e.value:e.original||"";if(this.stringParams)t.replace&&(t=t.replace(/^(\.?\.\/)*/g,"").replace(/\//g,".")),e.depth&&this.addDepth(e.depth),this.opcode("getContext",e.depth||0),this.opcode("pushStringParam",t,e.type),"SubExpression"===e.type&&this.accept(e);else{if(this.trackIds){var n=void 0;if(e.parts&&!i.default.helpers.scopedId(e)&&!e.depth&&(n=this.blockParamIndex(e.parts[0])),n){var r=e.parts.slice(1).join(".");this.opcode("pushId","BlockParam",n,r)}else(t=e.original||t).replace&&(t=t.replace(/^this(?:\.|$)/,"").replace(/^\.\//,"").replace(/^\.$/,"")),this.opcode("pushId",e.type,t)}this.accept(e)}},setupFullMustacheParams:function(e,t,n,r){var i=e.params;return this.pushParams(i),this.opcode("pushProgram",t),this.opcode("pushProgram",n),e.hash?this.accept(e.hash):this.opcode("emptyHash",r),i},blockParamIndex:function(e){for(var t=0,n=this.options.blockParams.length;t<n;t++){var i=this.options.blockParams[t],o=i&&r.indexOf(i,e);if(i&&o>=0)return[t,o]}}}})),FM=aM((e=>{var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");e.encode=function(e){if(0<=e&&e<t.length)return t[e];throw new TypeError("Must be between 0 and 63: "+e)},e.decode=function(e){return 65<=e&&e<=90?e-65:97<=e&&e<=122?e-97+26:48<=e&&e<=57?e-48+52:43==e?62:47==e?63:-1}})),BM=aM((e=>{var t=FM();e.encode=function(e){var n,r="",i=function(e){return e<0?1+(-e<<1):0+(e<<1)}(e);do{n=31&i,(i>>>=5)>0&&(n|=32),r+=t.encode(n)}while(i>0);return r},e.decode=function(e,n,r){var i,o,s=e.length,a=0,l=0;do{if(n>=s)throw new Error("Expected more digits in base 64 VLQ value.");if(-1===(o=t.decode(e.charCodeAt(n++))))throw new Error("Invalid base64 digit: "+e.charAt(n-1));i=!!(32&o),a+=(o&=31)<<l,l+=5}while(i);r.value=function(e){var t=e>>1;return 1===(1&e)?-t:t}(a),r.rest=n}})),UM=aM((e=>{e.getArg=function(e,t,n){if(t in e)return e[t];if(3===arguments.length)return n;throw new Error('"'+t+'" is a required argument.')};var t=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,n=/^data:.+\,.+$/;function r(e){var n=e.match(t);return n?{scheme:n[1],auth:n[2],host:n[3],port:n[4],path:n[5]}:null}function i(e){var t="";return e.scheme&&(t+=e.scheme+":"),t+="//",e.auth&&(t+=e.auth+"@"),e.host&&(t+=e.host),e.port&&(t+=":"+e.port),e.path&&(t+=e.path),t}function o(t){var n=t,o=r(t);if(o){if(!o.path)return t;n=o.path}for(var s,a=e.isAbsolute(n),l=n.split(/\/+/),c=0,u=l.length-1;u>=0;u--)"."===(s=l[u])?l.splice(u,1):".."===s?c++:c>0&&(""===s?(l.splice(u+1,c),c=0):(l.splice(u,2),c--));return""===(n=l.join("/"))&&(n=a?"/":"."),o?(o.path=n,i(o)):n}function s(e,t){""===e&&(e="."),""===t&&(t=".");var s=r(t),a=r(e);if(a&&(e=a.path||"/"),s&&!s.scheme)return a&&(s.scheme=a.scheme),i(s);if(s||t.match(n))return t;if(a&&!a.host&&!a.path)return a.host=t,i(a);var l="/"===t.charAt(0)?t:o(e.replace(/\/+$/,"")+"/"+t);return a?(a.path=l,i(a)):l}e.urlParse=r,e.urlGenerate=i,e.normalize=o,e.join=s,e.isAbsolute=function(e){return"/"===e.charAt(0)||t.test(e)},e.relative=function(e,t){""===e&&(e="."),e=e.replace(/\/$/,"");for(var n=0;0!==t.indexOf(e+"/");){var r=e.lastIndexOf("/");if(r<0||(e=e.slice(0,r)).match(/^([^\/]+:\/)?\/*$/))return t;++n}return Array(n+1).join("../")+t.substr(e.length+1)};var a=!("__proto__"in Object.create(null));function l(e){return e}function c(e){if(!e)return!1;var t=e.length;if(t<9||95!==e.charCodeAt(t-1)||95!==e.charCodeAt(t-2)||111!==e.charCodeAt(t-3)||116!==e.charCodeAt(t-4)||111!==e.charCodeAt(t-5)||114!==e.charCodeAt(t-6)||112!==e.charCodeAt(t-7)||95!==e.charCodeAt(t-8)||95!==e.charCodeAt(t-9))return!1;for(var n=t-10;n>=0;n--)if(36!==e.charCodeAt(n))return!1;return!0}function u(e,t){return e===t?0:null===e?1:null===t?-1:e>t?1:-1}e.toSetString=a?l:function(e){return c(e)?"$"+e:e},e.fromSetString=a?l:function(e){return c(e)?e.slice(1):e},e.compareByOriginalPositions=function(e,t,n){var r=u(e.source,t.source);return 0!==r||0!==(r=e.originalLine-t.originalLine)||(0!==(r=e.originalColumn-t.originalColumn)||n)||0!==(r=e.generatedColumn-t.generatedColumn)||0!==(r=e.generatedLine-t.generatedLine)?r:u(e.name,t.name)},e.compareByGeneratedPositionsDeflated=function(e,t,n){var r=e.generatedLine-t.generatedLine;return 0!==r||(0!==(r=e.generatedColumn-t.generatedColumn)||n)||0!==(r=u(e.source,t.source))||0!==(r=e.originalLine-t.originalLine)||0!==(r=e.originalColumn-t.originalColumn)?r:u(e.name,t.name)},e.compareByGeneratedPositionsInflated=function(e,t){var n=e.generatedLine-t.generatedLine;return 0!==n||0!==(n=e.generatedColumn-t.generatedColumn)||0!==(n=u(e.source,t.source))||0!==(n=e.originalLine-t.originalLine)||0!==(n=e.originalColumn-t.originalColumn)?n:u(e.name,t.name)},e.parseSourceMapInput=function(e){return JSON.parse(e.replace(/^\)]}'[^\n]*\n/,""))},e.computeSourceURL=function(e,t,n){if(t=t||"",e&&("/"!==e[e.length-1]&&"/"!==t[0]&&(e+="/"),t=e+t),n){var a=r(n);if(!a)throw new Error("sourceMapURL could not be parsed");if(a.path){var l=a.path.lastIndexOf("/");l>=0&&(a.path=a.path.substring(0,l+1))}t=s(i(a),t)}return o(t)}})),HM=aM((e=>{var t=UM(),n=Object.prototype.hasOwnProperty,r=typeof Map<"u";function i(){this._array=[],this._set=r?new Map:Object.create(null)}i.fromArray=function(e,t){for(var n=new i,r=0,o=e.length;r<o;r++)n.add(e[r],t);return n},i.prototype.size=function(){return r?this._set.size:Object.getOwnPropertyNames(this._set).length},i.prototype.add=function(e,i){var o=r?e:t.toSetString(e),s=r?this.has(e):n.call(this._set,o),a=this._array.length;(!s||i)&&this._array.push(e),s||(r?this._set.set(e,a):this._set[o]=a)},i.prototype.has=function(e){if(r)return this._set.has(e);var i=t.toSetString(e);return n.call(this._set,i)},i.prototype.indexOf=function(e){if(r){var i=this._set.get(e);if(i>=0)return i}else{var o=t.toSetString(e);if(n.call(this._set,o))return this._set[o]}throw new Error('"'+e+'" is not in the set.')},i.prototype.at=function(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)},i.prototype.toArray=function(){return this._array.slice()},e.ArraySet=i})),VM=aM((e=>{var t=UM();function n(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}n.prototype.unsortedForEach=function(e,t){this._array.forEach(e,t)},n.prototype.add=function(e){!function(e,n){var r=e.generatedLine,i=n.generatedLine,o=e.generatedColumn,s=n.generatedColumn;return i>r||i==r&&s>=o||t.compareByGeneratedPositionsInflated(e,n)<=0}(this._last,e)?(this._sorted=!1,this._array.push(e)):(this._last=e,this._array.push(e))},n.prototype.toArray=function(){return this._sorted||(this._array.sort(t.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},e.MappingList=n})),KM=aM((e=>{var t=BM(),n=UM(),r=HM().ArraySet,i=VM().MappingList;function o(e){e||(e={}),this._file=n.getArg(e,"file",null),this._sourceRoot=n.getArg(e,"sourceRoot",null),this._skipValidation=n.getArg(e,"skipValidation",!1),this._sources=new r,this._names=new r,this._mappings=new i,this._sourcesContents=null}o.prototype._version=3,o.fromSourceMap=function(e){var t=e.sourceRoot,r=new o({file:e.file,sourceRoot:t});return e.eachMapping((function(e){var i={generated:{line:e.generatedLine,column:e.generatedColumn}};null!=e.source&&(i.source=e.source,null!=t&&(i.source=n.relative(t,i.source)),i.original={line:e.originalLine,column:e.originalColumn},null!=e.name&&(i.name=e.name)),r.addMapping(i)})),e.sources.forEach((function(i){var o=i;null!==t&&(o=n.relative(t,i)),r._sources.has(o)||r._sources.add(o);var s=e.sourceContentFor(i);null!=s&&r.setSourceContent(i,s)})),r},o.prototype.addMapping=function(e){var t=n.getArg(e,"generated"),r=n.getArg(e,"original",null),i=n.getArg(e,"source",null),o=n.getArg(e,"name",null);this._skipValidation||this._validateMapping(t,r,i,o),null!=i&&(i=String(i),this._sources.has(i)||this._sources.add(i)),null!=o&&(o=String(o),this._names.has(o)||this._names.add(o)),this._mappings.add({generatedLine:t.line,generatedColumn:t.column,originalLine:null!=r&&r.line,originalColumn:null!=r&&r.column,source:i,name:o})},o.prototype.setSourceContent=function(e,t){var r=e;null!=this._sourceRoot&&(r=n.relative(this._sourceRoot,r)),null!=t?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[n.toSetString(r)]=t):this._sourcesContents&&(delete this._sourcesContents[n.toSetString(r)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))},o.prototype.applySourceMap=function(e,t,i){var o=t;if(null==t){if(null==e.file)throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');o=e.file}var s=this._sourceRoot;null!=s&&(o=n.relative(s,o));var a=new r,l=new r;this._mappings.unsortedForEach((function(t){if(t.source===o&&null!=t.originalLine){var r=e.originalPositionFor({line:t.originalLine,column:t.originalColumn});null!=r.source&&(t.source=r.source,null!=i&&(t.source=n.join(i,t.source)),null!=s&&(t.source=n.relative(s,t.source)),t.originalLine=r.line,t.originalColumn=r.column,null!=r.name&&(t.name=r.name))}var c=t.source;null!=c&&!a.has(c)&&a.add(c);var u=t.name;null!=u&&!l.has(u)&&l.add(u)}),this),this._sources=a,this._names=l,e.sources.forEach((function(t){var r=e.sourceContentFor(t);null!=r&&(null!=i&&(t=n.join(i,t)),null!=s&&(t=n.relative(s,t)),this.setSourceContent(t,r))}),this)},o.prototype._validateMapping=function(e,t,n,r){if(t&&"number"!=typeof t.line&&"number"!=typeof t.column)throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0)||t||n||r){if(e&&"line"in e&&"column"in e&&t&&"line"in t&&"column"in t&&e.line>0&&e.column>=0&&t.line>0&&t.column>=0&&n)return;throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:n,original:t,name:r}))}},o.prototype._serializeMappings=function(){for(var e,r,i,o,s=0,a=1,l=0,c=0,u=0,d=0,h="",p=this._mappings.toArray(),f=0,g=p.length;f<g;f++){if(e="",(r=p[f]).generatedLine!==a)for(s=0;r.generatedLine!==a;)e+=";",a++;else if(f>0){if(!n.compareByGeneratedPositionsInflated(r,p[f-1]))continue;e+=","}e+=t.encode(r.generatedColumn-s),s=r.generatedColumn,null!=r.source&&(o=this._sources.indexOf(r.source),e+=t.encode(o-d),d=o,e+=t.encode(r.originalLine-1-c),c=r.originalLine-1,e+=t.encode(r.originalColumn-l),l=r.originalColumn,null!=r.name&&(i=this._names.indexOf(r.name),e+=t.encode(i-u),u=i)),h+=e}return h},o.prototype._generateSourcesContent=function(e,t){return e.map((function(e){if(!this._sourcesContents)return null;null!=t&&(e=n.relative(t,e));var r=n.toSetString(e);return Object.prototype.hasOwnProperty.call(this._sourcesContents,r)?this._sourcesContents[r]:null}),this)},o.prototype.toJSON=function(){var e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(e.file=this._file),null!=this._sourceRoot&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e},o.prototype.toString=function(){return JSON.stringify(this.toJSON())},e.SourceMapGenerator=o})),WM=aM((e=>{function t(n,r,i,o,s,a){var l=Math.floor((r-n)/2)+n,c=s(i,o[l],!0);return 0===c?l:c>0?r-l>1?t(l,r,i,o,s,a):a==e.LEAST_UPPER_BOUND?r<o.length?r:-1:l:l-n>1?t(n,l,i,o,s,a):a==e.LEAST_UPPER_BOUND?l:n<0?-1:n}e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2,e.search=function(n,r,i,o){if(0===r.length)return-1;var s=t(-1,r.length,n,r,i,o||e.GREATEST_LOWER_BOUND);if(s<0)return-1;for(;s-1>=0&&0===i(r[s],r[s-1],!0);)--s;return s}})),$M=aM((e=>{function t(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function n(e,r,i,o){if(i<o){var s=function(e,t){return Math.round(e+Math.random()*(t-e))}(i,o),a=i-1;t(e,s,o);for(var l=e[o],c=i;c<o;c++)r(e[c],l)<=0&&t(e,a+=1,c);t(e,a+1,c);var u=a+1;n(e,r,i,u-1),n(e,r,u+1,o)}}e.quickSort=function(e,t){n(e,t,0,e.length-1)}})),YM=aM((e=>{var t=UM(),n=WM(),r=HM().ArraySet,i=BM(),o=$M().quickSort;function s(e,n){var r=e;return"string"==typeof e&&(r=t.parseSourceMapInput(e)),null!=r.sections?new c(r,n):new a(r,n)}function a(e,n){var i=e;"string"==typeof e&&(i=t.parseSourceMapInput(e));var o=t.getArg(i,"version"),s=t.getArg(i,"sources"),a=t.getArg(i,"names",[]),l=t.getArg(i,"sourceRoot",null),c=t.getArg(i,"sourcesContent",null),u=t.getArg(i,"mappings"),d=t.getArg(i,"file",null);if(o!=this._version)throw new Error("Unsupported version: "+o);l&&(l=t.normalize(l)),s=s.map(String).map(t.normalize).map((function(e){return l&&t.isAbsolute(l)&&t.isAbsolute(e)?t.relative(l,e):e})),this._names=r.fromArray(a.map(String),!0),this._sources=r.fromArray(s,!0),this._absoluteSources=this._sources.toArray().map((function(e){return t.computeSourceURL(l,e,n)})),this.sourceRoot=l,this.sourcesContent=c,this._mappings=u,this._sourceMapURL=n,this.file=d}function l(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}function c(e,n){var i=e;"string"==typeof e&&(i=t.parseSourceMapInput(e));var o=t.getArg(i,"version"),a=t.getArg(i,"sections");if(o!=this._version)throw new Error("Unsupported version: "+o);this._sources=new r,this._names=new r;var l={line:-1,column:0};this._sections=a.map((function(e){if(e.url)throw new Error("Support for url field in sections not implemented.");var r=t.getArg(e,"offset"),i=t.getArg(r,"line"),o=t.getArg(r,"column");if(i<l.line||i===l.line&&o<l.column)throw new Error("Section offsets must be ordered and non-overlapping.");return l=r,{generatedOffset:{generatedLine:i+1,generatedColumn:o+1},consumer:new s(t.getArg(e,"map"),n)}}))}s.fromSourceMap=function(e,t){return a.fromSourceMap(e,t)},s.prototype._version=3,s.prototype.__generatedMappings=null,Object.defineProperty(s.prototype,"_generatedMappings",{configurable:!0,enumerable:!0,get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),s.prototype.__originalMappings=null,Object.defineProperty(s.prototype,"_originalMappings",{configurable:!0,enumerable:!0,get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),s.prototype._charIsMappingSeparator=function(e,t){var n=e.charAt(t);return";"===n||","===n},s.prototype._parseMappings=function(e,t){throw new Error("Subclasses must implement _parseMappings")},s.GENERATED_ORDER=1,s.ORIGINAL_ORDER=2,s.GREATEST_LOWER_BOUND=1,s.LEAST_UPPER_BOUND=2,s.prototype.eachMapping=function(e,n,r){var i,o=n||null;switch(r||s.GENERATED_ORDER){case s.GENERATED_ORDER:i=this._generatedMappings;break;case s.ORIGINAL_ORDER:i=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var a=this.sourceRoot;i.map((function(e){var n=null===e.source?null:this._sources.at(e.source);return{source:n=t.computeSourceURL(a,n,this._sourceMapURL),generatedLine:e.generatedLine,generatedColumn:e.generatedColumn,originalLine:e.originalLine,originalColumn:e.originalColumn,name:null===e.name?null:this._names.at(e.name)}}),this).forEach(e,o)},s.prototype.allGeneratedPositionsFor=function(e){var r=t.getArg(e,"line"),i={source:t.getArg(e,"source"),originalLine:r,originalColumn:t.getArg(e,"column",0)};if(i.source=this._findSourceIndex(i.source),i.source<0)return[];var o=[],s=this._findMapping(i,this._originalMappings,"originalLine","originalColumn",t.compareByOriginalPositions,n.LEAST_UPPER_BOUND);if(s>=0){var a=this._originalMappings[s];if(void 0===e.column)for(var l=a.originalLine;a&&a.originalLine===l;)o.push({line:t.getArg(a,"generatedLine",null),column:t.getArg(a,"generatedColumn",null),lastColumn:t.getArg(a,"lastGeneratedColumn",null)}),a=this._originalMappings[++s];else for(var c=a.originalColumn;a&&a.originalLine===r&&a.originalColumn==c;)o.push({line:t.getArg(a,"generatedLine",null),column:t.getArg(a,"generatedColumn",null),lastColumn:t.getArg(a,"lastGeneratedColumn",null)}),a=this._originalMappings[++s]}return o},e.SourceMapConsumer=s,a.prototype=Object.create(s.prototype),a.prototype.consumer=s,a.prototype._findSourceIndex=function(e){var n,r=e;if(null!=this.sourceRoot&&(r=t.relative(this.sourceRoot,r)),this._sources.has(r))return this._sources.indexOf(r);for(n=0;n<this._absoluteSources.length;++n)if(this._absoluteSources[n]==e)return n;return-1},a.fromSourceMap=function(e,n){var i=Object.create(a.prototype),s=i._names=r.fromArray(e._names.toArray(),!0),c=i._sources=r.fromArray(e._sources.toArray(),!0);i.sourceRoot=e._sourceRoot,i.sourcesContent=e._generateSourcesContent(i._sources.toArray(),i.sourceRoot),i.file=e._file,i._sourceMapURL=n,i._absoluteSources=i._sources.toArray().map((function(e){return t.computeSourceURL(i.sourceRoot,e,n)}));for(var u=e._mappings.toArray().slice(),d=i.__generatedMappings=[],h=i.__originalMappings=[],p=0,f=u.length;p<f;p++){var g=u[p],m=new l;m.generatedLine=g.generatedLine,m.generatedColumn=g.generatedColumn,g.source&&(m.source=c.indexOf(g.source),m.originalLine=g.originalLine,m.originalColumn=g.originalColumn,g.name&&(m.name=s.indexOf(g.name)),h.push(m)),d.push(m)}return o(i.__originalMappings,t.compareByOriginalPositions),i},a.prototype._version=3,Object.defineProperty(a.prototype,"sources",{get:function(){return this._absoluteSources.slice()}}),a.prototype._parseMappings=function(e,n){for(var r,s,a,c,u,d=1,h=0,p=0,f=0,g=0,m=0,y=e.length,v=0,b={},w={},x=[],S=[];v<y;)if(";"===e.charAt(v))d++,v++,h=0;else if(","===e.charAt(v))v++;else{for((r=new l).generatedLine=d,c=v;c<y&&!this._charIsMappingSeparator(e,c);c++);if(a=b[s=e.slice(v,c)])v+=s.length;else{for(a=[];v<c;)i.decode(e,v,w),u=w.value,v=w.rest,a.push(u);if(2===a.length)throw new Error("Found a source, but no line and column");if(3===a.length)throw new Error("Found a source and line, but no column");b[s]=a}r.generatedColumn=h+a[0],h=r.generatedColumn,a.length>1&&(r.source=g+a[1],g+=a[1],r.originalLine=p+a[2],p=r.originalLine,r.originalLine+=1,r.originalColumn=f+a[3],f=r.originalColumn,a.length>4&&(r.name=m+a[4],m+=a[4])),S.push(r),"number"==typeof r.originalLine&&x.push(r)}o(S,t.compareByGeneratedPositionsDeflated),this.__generatedMappings=S,o(x,t.compareByOriginalPositions),this.__originalMappings=x},a.prototype._findMapping=function(e,t,r,i,o,s){if(e[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[r]);if(e[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[i]);return n.search(e,t,o,s)},a.prototype.computeColumnSpans=function(){for(var e=0;e<this._generatedMappings.length;++e){var t=this._generatedMappings[e];if(e+1<this._generatedMappings.length){var n=this._generatedMappings[e+1];if(t.generatedLine===n.generatedLine){t.lastGeneratedColumn=n.generatedColumn-1;continue}}t.lastGeneratedColumn=1/0}},a.prototype.originalPositionFor=function(e){var n={generatedLine:t.getArg(e,"line"),generatedColumn:t.getArg(e,"column")},r=this._findMapping(n,this._generatedMappings,"generatedLine","generatedColumn",t.compareByGeneratedPositionsDeflated,t.getArg(e,"bias",s.GREATEST_LOWER_BOUND));if(r>=0){var i=this._generatedMappings[r];if(i.generatedLine===n.generatedLine){var o=t.getArg(i,"source",null);null!==o&&(o=this._sources.at(o),o=t.computeSourceURL(this.sourceRoot,o,this._sourceMapURL));var a=t.getArg(i,"name",null);return null!==a&&(a=this._names.at(a)),{source:o,line:t.getArg(i,"originalLine",null),column:t.getArg(i,"originalColumn",null),name:a}}}return{source:null,line:null,column:null,name:null}},a.prototype.hasContentsOfAllSources=function(){return!!this.sourcesContent&&(this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some((function(e){return null==e})))},a.prototype.sourceContentFor=function(e,n){if(!this.sourcesContent)return null;var r=this._findSourceIndex(e);if(r>=0)return this.sourcesContent[r];var i,o=e;if(null!=this.sourceRoot&&(o=t.relative(this.sourceRoot,o)),null!=this.sourceRoot&&(i=t.urlParse(this.sourceRoot))){var s=o.replace(/^file:\/\//,"");if("file"==i.scheme&&this._sources.has(s))return this.sourcesContent[this._sources.indexOf(s)];if((!i.path||"/"==i.path)&&this._sources.has("/"+o))return this.sourcesContent[this._sources.indexOf("/"+o)]}if(n)return null;throw new Error('"'+o+'" is not in the SourceMap.')},a.prototype.generatedPositionFor=function(e){var n=t.getArg(e,"source");if((n=this._findSourceIndex(n))<0)return{line:null,column:null,lastColumn:null};var r={source:n,originalLine:t.getArg(e,"line"),originalColumn:t.getArg(e,"column")},i=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",t.compareByOriginalPositions,t.getArg(e,"bias",s.GREATEST_LOWER_BOUND));if(i>=0){var o=this._originalMappings[i];if(o.source===r.source)return{line:t.getArg(o,"generatedLine",null),column:t.getArg(o,"generatedColumn",null),lastColumn:t.getArg(o,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},e.BasicSourceMapConsumer=a,c.prototype=Object.create(s.prototype),c.prototype.constructor=s,c.prototype._version=3,Object.defineProperty(c.prototype,"sources",{get:function(){for(var e=[],t=0;t<this._sections.length;t++)for(var n=0;n<this._sections[t].consumer.sources.length;n++)e.push(this._sections[t].consumer.sources[n]);return e}}),c.prototype.originalPositionFor=function(e){var r={generatedLine:t.getArg(e,"line"),generatedColumn:t.getArg(e,"column")},i=n.search(r,this._sections,(function(e,t){return e.generatedLine-t.generatedOffset.generatedLine||e.generatedColumn-t.generatedOffset.generatedColumn})),o=this._sections[i];return o?o.consumer.originalPositionFor({line:r.generatedLine-(o.generatedOffset.generatedLine-1),column:r.generatedColumn-(o.generatedOffset.generatedLine===r.generatedLine?o.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}},c.prototype.hasContentsOfAllSources=function(){return this._sections.every((function(e){return e.consumer.hasContentsOfAllSources()}))},c.prototype.sourceContentFor=function(e,t){for(var n=0;n<this._sections.length;n++){var r=this._sections[n].consumer.sourceContentFor(e,!0);if(r)return r}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},c.prototype.generatedPositionFor=function(e){for(var n=0;n<this._sections.length;n++){var r=this._sections[n];if(-1!==r.consumer._findSourceIndex(t.getArg(e,"source"))){var i=r.consumer.generatedPositionFor(e);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}}return{line:null,column:null}},c.prototype._parseMappings=function(e,n){this.__generatedMappings=[],this.__originalMappings=[];for(var r=0;r<this._sections.length;r++)for(var i=this._sections[r],s=i.consumer._generatedMappings,a=0;a<s.length;a++){var l=s[a],c=i.consumer._sources.at(l.source);c=t.computeSourceURL(i.consumer.sourceRoot,c,this._sourceMapURL),this._sources.add(c),c=this._sources.indexOf(c);var u=null;l.name&&(u=i.consumer._names.at(l.name),this._names.add(u),u=this._names.indexOf(u));var d={source:c,generatedLine:l.generatedLine+(i.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(i.generatedOffset.generatedLine===l.generatedLine?i.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:u};this.__generatedMappings.push(d),"number"==typeof d.originalLine&&this.__originalMappings.push(d)}o(this.__generatedMappings,t.compareByGeneratedPositionsDeflated),o(this.__originalMappings,t.compareByOriginalPositions)},e.IndexedSourceMapConsumer=c})),qM=aM((e=>{var t=KM().SourceMapGenerator,n=UM(),r=/(\r?\n)/,i="$$$isSourceNode$$$";function o(e,t,n,r,o){this.children=[],this.sourceContents={},this.line=null!==e&&void 0!==e?e:null,this.column=null!==t&&void 0!==t?t:null,this.source=null!==n&&void 0!==n?n:null,this.name=null!==o&&void 0!==o?o:null,this[i]=!0,null!=r&&this.add(r)}o.fromStringWithSourceMap=function(e,t,i){var s=new o,a=e.split(r),l=0,c=function(){return e()+(e()||"");function e(){return l<a.length?a[l++]:void 0}},u=1,d=0,h=null;return t.eachMapping((function(e){if(null!==h){if(!(u<e.generatedLine)){var t=(n=a[l]||"").substr(0,e.generatedColumn-d);return a[l]=n.substr(e.generatedColumn-d),d=e.generatedColumn,p(h,t),void(h=e)}p(h,c()),u++,d=0}for(;u<e.generatedLine;)s.add(c()),u++;if(d<e.generatedColumn){var n=a[l]||"";s.add(n.substr(0,e.generatedColumn)),a[l]=n.substr(e.generatedColumn),d=e.generatedColumn}h=e}),this),l<a.length&&(h&&p(h,c()),s.add(a.splice(l).join(""))),t.sources.forEach((function(e){var r=t.sourceContentFor(e);null!=r&&(null!=i&&(e=n.join(i,e)),s.setSourceContent(e,r))})),s;function p(e,t){if(null===e||void 0===e.source)s.add(t);else{var r=i?n.join(i,e.source):e.source;s.add(new o(e.originalLine,e.originalColumn,r,t,e.name))}}},o.prototype.add=function(e){if(Array.isArray(e))e.forEach((function(e){this.add(e)}),this);else{if(!e[i]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);e&&this.children.push(e)}return this},o.prototype.prepend=function(e){if(Array.isArray(e))for(var t=e.length-1;t>=0;t--)this.prepend(e[t]);else{if(!e[i]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);this.children.unshift(e)}return this},o.prototype.walk=function(e){for(var t,n=0,r=this.children.length;n<r;n++)(t=this.children[n])[i]?t.walk(e):""!==t&&e(t,{source:this.source,line:this.line,column:this.column,name:this.name})},o.prototype.join=function(e){var t,n,r=this.children.length;if(r>0){for(t=[],n=0;n<r-1;n++)t.push(this.children[n]),t.push(e);t.push(this.children[n]),this.children=t}return this},o.prototype.replaceRight=function(e,t){var n=this.children[this.children.length-1];return n[i]?n.replaceRight(e,t):"string"==typeof n?this.children[this.children.length-1]=n.replace(e,t):this.children.push("".replace(e,t)),this},o.prototype.setSourceContent=function(e,t){this.sourceContents[n.toSetString(e)]=t},o.prototype.walkSourceContents=function(e){for(var t=0,r=this.children.length;t<r;t++)this.children[t][i]&&this.children[t].walkSourceContents(e);var o=Object.keys(this.sourceContents);for(t=0,r=o.length;t<r;t++)e(n.fromSetString(o[t]),this.sourceContents[o[t]])},o.prototype.toString=function(){var e="";return this.walk((function(t){e+=t})),e},o.prototype.toStringWithSourceMap=function(e){var n={code:"",line:1,column:0},r=new t(e),i=!1,o=null,s=null,a=null,l=null;return this.walk((function(e,t){n.code+=e,null!==t.source&&null!==t.line&&null!==t.column?((o!==t.source||s!==t.line||a!==t.column||l!==t.name)&&r.addMapping({source:t.source,original:{line:t.line,column:t.column},generated:{line:n.line,column:n.column},name:t.name}),o=t.source,s=t.line,a=t.column,l=t.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),o=null,i=!1);for(var c=0,u=e.length;c<u;c++)10===e.charCodeAt(c)?(n.line++,n.column=0,c+1===u?(o=null,i=!1):i&&r.addMapping({source:t.source,original:{line:t.line,column:t.column},generated:{line:n.line,column:n.column},name:t.name})):n.column++})),this.walkSourceContents((function(e,t){r.setSourceContent(e,t)})),{code:n.code,map:r}},e.SourceNode=o})),GM=aM((e=>{e.SourceMapGenerator=KM().SourceMapGenerator,e.SourceMapConsumer=YM().SourceMapConsumer,e.SourceNode=qM().SourceNode})),XM=aM(((e,t)=>{e.__esModule=!0;var n,r=dM(),i=void 0;try{("function"!=typeof define||!define.amd)&&(n=GM(),i=n.SourceNode)}catch{}function o(e,t,n){if(r.isArray(e)){for(var i=[],o=0,s=e.length;o<s;o++)i.push(t.wrap(e[o],n));return i}return"boolean"==typeof e||"number"==typeof e?e+"":e}function s(e){this.srcFile=e,this.source=[]}i||((i=function(e,t,n,r){this.src="",r&&this.add(r)}).prototype={add:function(e){r.isArray(e)&&(e=e.join("")),this.src+=e},prepend:function(e){r.isArray(e)&&(e=e.join("")),this.src=e+this.src},toStringWithSourceMap:function(){return{code:this.toString()}},toString:function(){return this.src}}),s.prototype={isEmpty:function(){return!this.source.length},prepend:function(e,t){this.source.unshift(this.wrap(e,t))},push:function(e,t){this.source.push(this.wrap(e,t))},merge:function(){var e=this.empty();return this.each((function(t){e.add(["  ",t,"\n"])})),e},each:function(e){for(var t=0,n=this.source.length;t<n;t++)e(this.source[t])},empty:function(){var e=this.currentLocation||{start:{}};return new i(e.start.line,e.start.column,this.srcFile)},wrap:function(e){var t=arguments.length<=1||void 0===arguments[1]?this.currentLocation||{start:{}}:arguments[1];return e instanceof i?e:(e=o(e,this,t),new i(t.start.line,t.start.column,this.srcFile,e))},functionCall:function(e,t,n){return n=this.generateList(n),this.wrap([e,t?"."+t+"(":"(",n,")"])},quotedString:function(e){return'"'+(e+"").replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},objectLiteral:function(e){var t=this,n=[];Object.keys(e).forEach((function(r){var i=o(e[r],t);"undefined"!==i&&n.push([t.quotedString(r),":",i])}));var r=this.generateList(n);return r.prepend("{"),r.add("}"),r},generateList:function(e){for(var t=this.empty(),n=0,r=e.length;n<r;n++)n&&t.add(","),t.add(o(e[n],this));return t},generateArray:function(e){var t=this.generateList(e);return t.prepend("["),t.add("]"),t}},e.default=s,t.exports=e.default})),QM=aM(((e,t)=>{function n(e){return e&&e.__esModule?e:{default:e}}e.__esModule=!0;var r=CM(),i=n(hM()),o=dM(),s=n(XM());function a(e){this.value=e}function l(){}l.prototype={nameLookup:function(e,t){return this.internalNameLookup(e,t)},depthedLookup:function(e){return[this.aliasable("container.lookup"),"(depths, ",JSON.stringify(e),")"]},compilerInfo:function(){var e=r.COMPILER_REVISION;return[e,r.REVISION_CHANGES[e]]},appendToBuffer:function(e,t,n){return o.isArray(e)||(e=[e]),e=this.source.wrap(e,t),this.environment.isSimple?["return ",e,";"]:n?["buffer += ",e,";"]:(e.appendToBuffer=!0,e)},initializeBuffer:function(){return this.quotedString("")},internalNameLookup:function(e,t){return this.lookupPropertyFunctionIsUsed=!0,["lookupProperty(",e,",",JSON.stringify(t),")"]},lookupPropertyFunctionIsUsed:!1,compile:function(e,t,n,r){this.environment=e,this.options=t,this.stringParams=this.options.stringParams,this.trackIds=this.options.trackIds,this.precompile=!r,this.name=this.environment.name,this.isChild=!!n,this.context=n||{decorators:[],programs:[],environments:[]},this.preamble(),this.stackSlot=0,this.stackVars=[],this.aliases={},this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.blockParams=[],this.compileChildren(e,t),this.useDepths=this.useDepths||e.useDepths||e.useDecorators||this.options.compat,this.useBlockParams=this.useBlockParams||e.useBlockParams;var o=e.opcodes,s=void 0,a=void 0,l=void 0,c=void 0;for(l=0,c=o.length;l<c;l++)s=o[l],this.source.currentLocation=s.loc,a=a||s.loc,this[s.opcode].apply(this,s.args);if(this.source.currentLocation=a,this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new i.default("Compile completed with content left on stack");this.decorators.isEmpty()?this.decorators=void 0:(this.useDecorators=!0,this.decorators.prepend(["var decorators = container.decorators, ",this.lookupPropertyFunctionVarDeclaration(),";\n"]),this.decorators.push("return fn;"),r?this.decorators=Function.apply(this,["fn","props","container","depth0","data","blockParams","depths",this.decorators.merge()]):(this.decorators.prepend("function(fn, props, container, depth0, data, blockParams, depths) {\n"),this.decorators.push("}\n"),this.decorators=this.decorators.merge()));var u=this.createFunctionContext(r);if(this.isChild)return u;var d={compiler:this.compilerInfo(),main:u};this.decorators&&(d.main_d=this.decorators,d.useDecorators=!0);var h=this.context,p=h.programs,f=h.decorators;for(l=0,c=p.length;l<c;l++)p[l]&&(d[l]=p[l],f[l]&&(d[l+"_d"]=f[l],d.useDecorators=!0));return this.environment.usePartial&&(d.usePartial=!0),this.options.data&&(d.useData=!0),this.useDepths&&(d.useDepths=!0),this.useBlockParams&&(d.useBlockParams=!0),this.options.compat&&(d.compat=!0),r?d.compilerOptions=this.options:(d.compiler=JSON.stringify(d.compiler),this.source.currentLocation={start:{line:1,column:0}},d=this.objectLiteral(d),t.srcName?(d=d.toStringWithSourceMap({file:t.destName})).map=d.map&&d.map.toString():d=d.toString()),d},preamble:function(){this.lastContext=0,this.source=new s.default(this.options.srcName),this.decorators=new s.default(this.options.srcName)},createFunctionContext:function(e){var t=this,n="",r=this.stackVars.concat(this.registers.list);r.length>0&&(n+=", "+r.join(", "));var i=0;Object.keys(this.aliases).forEach((function(e){var r=t.aliases[e];r.children&&r.referenceCount>1&&(n+=", alias"+ ++i+"="+e,r.children[0]="alias"+i)})),this.lookupPropertyFunctionIsUsed&&(n+=", "+this.lookupPropertyFunctionVarDeclaration());var o=["container","depth0","helpers","partials","data"];(this.useBlockParams||this.useDepths)&&o.push("blockParams"),this.useDepths&&o.push("depths");var s=this.mergeSource(n);return e?(o.push(s),Function.apply(this,o)):this.source.wrap(["function(",o.join(","),") {\n  ",s,"}"])},mergeSource:function(e){var t=this.environment.isSimple,n=!this.forceBuffer,r=void 0,i=void 0,o=void 0,s=void 0;return this.source.each((function(e){e.appendToBuffer?(o?e.prepend("  + "):o=e,s=e):(o&&(i?o.prepend("buffer += "):r=!0,s.add(";"),o=s=void 0),i=!0,t||(n=!1))})),n?o?(o.prepend("return "),s.add(";")):i||this.source.push('return "";'):(e+=", buffer = "+(r?"":this.initializeBuffer()),o?(o.prepend("return buffer + "),s.add(";")):this.source.push("return buffer;")),e&&this.source.prepend("var "+e.substring(2)+(r?"":";\n")),this.source.merge()},lookupPropertyFunctionVarDeclaration:function(){return"\n      lookupProperty = container.lookupProperty || function(parent, propertyName) {\n        if (Object.prototype.hasOwnProperty.call(parent, propertyName)) {\n          return parent[propertyName];\n        }\n        return undefined\n    }\n    ".trim()},blockValue:function(e){var t=this.aliasable("container.hooks.blockHelperMissing"),n=[this.contextName(0)];this.setupHelperArgs(e,0,n);var r=this.popStack();n.splice(1,0,r),this.push(this.source.functionCall(t,"call",n))},ambiguousBlockValue:function(){var e=this.aliasable("container.hooks.blockHelperMissing"),t=[this.contextName(0)];this.setupHelperArgs("",0,t,!0),this.flushInline();var n=this.topStack();t.splice(1,0,n),this.pushSource(["if (!",this.lastHelper,") { ",n," = ",this.source.functionCall(e,"call",t),"}"])},appendContent:function(e){this.pendingContent?e=this.pendingContent+e:this.pendingLocation=this.source.currentLocation,this.pendingContent=e},append:function(){if(this.isInline())this.replaceStack((function(e){return[" != null ? ",e,' : ""']})),this.pushSource(this.appendToBuffer(this.popStack()));else{var e=this.popStack();this.pushSource(["if (",e," != null) { ",this.appendToBuffer(e,void 0,!0)," }"]),this.environment.isSimple&&this.pushSource(["else { ",this.appendToBuffer("''",void 0,!0)," }"])}},appendEscaped:function(){this.pushSource(this.appendToBuffer([this.aliasable("container.escapeExpression"),"(",this.popStack(),")"]))},getContext:function(e){this.lastContext=e},pushContext:function(){this.pushStackLiteral(this.contextName(this.lastContext))},lookupOnContext:function(e,t,n,r){var i=0;r||!this.options.compat||this.lastContext?this.pushContext():this.push(this.depthedLookup(e[i++])),this.resolvePath("context",e,i,t,n)},lookupBlockParam:function(e,t){this.useBlockParams=!0,this.push(["blockParams[",e[0],"][",e[1],"]"]),this.resolvePath("context",t,1)},lookupData:function(e,t,n){e?this.pushStackLiteral("container.data(data, "+e+")"):this.pushStackLiteral("data"),this.resolvePath("data",t,0,!0,n)},resolvePath:function(e,t,n,r,i){var o=this;if(this.options.strict||this.options.assumeObjects)this.push(function(e,t,n,r,i){var o=t.popStack(),s=n.length;for(e&&s--;r<s;r++)o=t.nameLookup(o,n[r],i);return e?[t.aliasable("container.strict"),"(",o,", ",t.quotedString(n[r]),", ",JSON.stringify(t.source.currentLocation)," )"]:o}(this.options.strict&&i,this,t,n,e));else for(var s=t.length;n<s;n++)this.replaceStack((function(i){var s=o.nameLookup(i,t[n],e);return r?[" && ",s]:[" != null ? ",s," : ",i]}))},resolvePossibleLambda:function(){this.push([this.aliasable("container.lambda"),"(",this.popStack(),", ",this.contextName(0),")"])},pushStringParam:function(e,t){this.pushContext(),this.pushString(t),"SubExpression"!==t&&("string"==typeof e?this.pushString(e):this.pushStackLiteral(e))},emptyHash:function(e){this.trackIds&&this.push("{}"),this.stringParams&&(this.push("{}"),this.push("{}")),this.pushStackLiteral(e?"undefined":"{}")},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:{},types:[],contexts:[],ids:[]}},popHash:function(){var e=this.hash;this.hash=this.hashes.pop(),this.trackIds&&this.push(this.objectLiteral(e.ids)),this.stringParams&&(this.push(this.objectLiteral(e.contexts)),this.push(this.objectLiteral(e.types))),this.push(this.objectLiteral(e.values))},pushString:function(e){this.pushStackLiteral(this.quotedString(e))},pushLiteral:function(e){this.pushStackLiteral(e)},pushProgram:function(e){null!=e?this.pushStackLiteral(this.programExpression(e)):this.pushStackLiteral(null)},registerDecorator:function(e,t){var n=this.nameLookup("decorators",t,"decorator"),r=this.setupHelperArgs(t,e);this.decorators.push(["fn = ",this.decorators.functionCall(n,"",["fn","props","container",r])," || fn;"])},invokeHelper:function(e,t,n){var r=this.popStack(),i=this.setupHelper(e,t),o=[];n&&o.push(i.name),o.push(r),this.options.strict||o.push(this.aliasable("container.hooks.helperMissing"));var s=["(",this.itemsSeparatedBy(o,"||"),")"],a=this.source.functionCall(s,"call",i.callParams);this.push(a)},itemsSeparatedBy:function(e,t){var n=[];n.push(e[0]);for(var r=1;r<e.length;r++)n.push(t,e[r]);return n},invokeKnownHelper:function(e,t){var n=this.setupHelper(e,t);this.push(this.source.functionCall(n.name,"call",n.callParams))},invokeAmbiguous:function(e,t){this.useRegister("helper");var n=this.popStack();this.emptyHash();var r=this.setupHelper(0,e,t),i=["(","(helper = ",this.lastHelper=this.nameLookup("helpers",e,"helper")," || ",n,")"];this.options.strict||(i[0]="(helper = ",i.push(" != null ? helper : ",this.aliasable("container.hooks.helperMissing"))),this.push(["(",i,r.paramsInit?["),(",r.paramsInit]:[],"),","(typeof helper === ",this.aliasable('"function"')," ? ",this.source.functionCall("helper","call",r.callParams)," : helper))"])},invokePartial:function(e,t,n){var r=[],i=this.setupParams(t,1,r);e&&(t=this.popStack(),delete i.name),n&&(i.indent=JSON.stringify(n)),i.helpers="helpers",i.partials="partials",i.decorators="container.decorators",e?r.unshift(t):r.unshift(this.nameLookup("partials",t,"partial")),this.options.compat&&(i.depths="depths"),i=this.objectLiteral(i),r.push(i),this.push(this.source.functionCall("container.invokePartial","",r))},assignToHash:function(e){var t=this.popStack(),n=void 0,r=void 0,i=void 0;this.trackIds&&(i=this.popStack()),this.stringParams&&(r=this.popStack(),n=this.popStack());var o=this.hash;n&&(o.contexts[e]=n),r&&(o.types[e]=r),i&&(o.ids[e]=i),o.values[e]=t},pushId:function(e,t,n){"BlockParam"===e?this.pushStackLiteral("blockParams["+t[0]+"].path["+t[1]+"]"+(n?" + "+JSON.stringify("."+n):"")):"PathExpression"===e?this.pushString(t):"SubExpression"===e?this.pushStackLiteral("true"):this.pushStackLiteral("null")},compiler:l,compileChildren:function(e,t){for(var n=e.children,r=void 0,i=void 0,o=0,s=n.length;o<s;o++){r=n[o],i=new this.compiler;var a=this.matchExistingProgram(r);if(null==a){this.context.programs.push("");var l=this.context.programs.length;r.index=l,r.name="program"+l,this.context.programs[l]=i.compile(r,t,this.context,!this.precompile),this.context.decorators[l]=i.decorators,this.context.environments[l]=r,this.useDepths=this.useDepths||i.useDepths,this.useBlockParams=this.useBlockParams||i.useBlockParams,r.useDepths=this.useDepths,r.useBlockParams=this.useBlockParams}else r.index=a.index,r.name="program"+a.index,this.useDepths=this.useDepths||a.useDepths,this.useBlockParams=this.useBlockParams||a.useBlockParams}},matchExistingProgram:function(e){for(var t=0,n=this.context.environments.length;t<n;t++){var r=this.context.environments[t];if(r&&r.equals(e))return r}},programExpression:function(e){var t=this.environment.children[e],n=[t.index,"data",t.blockParams];return(this.useBlockParams||this.useDepths)&&n.push("blockParams"),this.useDepths&&n.push("depths"),"container.program("+n.join(", ")+")"},useRegister:function(e){this.registers[e]||(this.registers[e]=!0,this.registers.list.push(e))},push:function(e){return e instanceof a||(e=this.source.wrap(e)),this.inlineStack.push(e),e},pushStackLiteral:function(e){this.push(new a(e))},pushSource:function(e){this.pendingContent&&(this.source.push(this.appendToBuffer(this.source.quotedString(this.pendingContent),this.pendingLocation)),this.pendingContent=void 0),e&&this.source.push(e)},replaceStack:function(e){var t=["("],n=void 0,r=void 0,o=void 0;if(!this.isInline())throw new i.default("replaceStack on non-inline");var s=this.popStack(!0);if(s instanceof a)t=["(",n=[s.value]],o=!0;else{r=!0;var l=this.incrStack();t=["((",this.push(l)," = ",s,")"],n=this.topStack()}var c=e.call(this,n);o||this.popStack(),r&&this.stackSlot--,this.push(t.concat(c,")"))},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var e=this.inlineStack;this.inlineStack=[];for(var t=0,n=e.length;t<n;t++){var r=e[t];if(r instanceof a)this.compileStack.push(r);else{var i=this.incrStack();this.pushSource([i," = ",r,";"]),this.compileStack.push(i)}}},isInline:function(){return this.inlineStack.length},popStack:function(e){var t=this.isInline(),n=(t?this.inlineStack:this.compileStack).pop();if(!e&&n instanceof a)return n.value;if(!t){if(!this.stackSlot)throw new i.default("Invalid stack pop");this.stackSlot--}return n},topStack:function(){var e=this.isInline()?this.inlineStack:this.compileStack,t=e[e.length-1];return t instanceof a?t.value:t},contextName:function(e){return this.useDepths&&e?"depths["+e+"]":"depth"+e},quotedString:function(e){return this.source.quotedString(e)},objectLiteral:function(e){return this.source.objectLiteral(e)},aliasable:function(e){var t=this.aliases[e];return t?(t.referenceCount++,t):((t=this.aliases[e]=this.source.wrap(e)).aliasable=!0,t.referenceCount=1,t)},setupHelper:function(e,t,n){var r=[];return{params:r,paramsInit:this.setupHelperArgs(t,e,r,n),name:this.nameLookup("helpers",t,"helper"),callParams:[this.aliasable(this.contextName(0)+" != null ? "+this.contextName(0)+" : (container.nullContext || {})")].concat(r)}},setupParams:function(e,t,n){var r={},i=[],o=[],s=[],a=!n,l=void 0;a&&(n=[]),r.name=this.quotedString(e),r.hash=this.popStack(),this.trackIds&&(r.hashIds=this.popStack()),this.stringParams&&(r.hashTypes=this.popStack(),r.hashContexts=this.popStack());var c=this.popStack(),u=this.popStack();(u||c)&&(r.fn=u||"container.noop",r.inverse=c||"container.noop");for(var d=t;d--;)l=this.popStack(),n[d]=l,this.trackIds&&(s[d]=this.popStack()),this.stringParams&&(o[d]=this.popStack(),i[d]=this.popStack());return a&&(r.args=this.source.generateArray(n)),this.trackIds&&(r.ids=this.source.generateArray(s)),this.stringParams&&(r.types=this.source.generateArray(o),r.contexts=this.source.generateArray(i)),this.options.data&&(r.data="data"),this.useBlockParams&&(r.blockParams="blockParams"),r},setupHelperArgs:function(e,t,n,r){var i=this.setupParams(e,t,n);return i.loc=JSON.stringify(this.source.currentLocation),i=this.objectLiteral(i),r?(this.useRegister("options"),n.push("options"),["options=",i]):n?(n.push(i),""):i}},function(){for(var e="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield await null true false".split(" "),t=l.RESERVED_WORDS={},n=0,r=e.length;n<r;n++)t[e[n]]=!0}(),l.isValidJavaScriptVariableName=function(e){return!l.RESERVED_WORDS[e]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(e)},e.default=l,t.exports=e.default})),ZM=aM(((e,t)=>{function n(e){return e&&e.__esModule?e:{default:e}}e.__esModule=!0;var r=n(AM()),i=n(jM()),o=DM(),s=NM(),a=n(QM()),l=n(LM()),c=n(TM()),u=r.default.create;function d(){var e=u();return e.compile=function(t,n){return s.compile(t,n,e)},e.precompile=function(t,n){return s.precompile(t,n,e)},e.AST=i.default,e.Compiler=s.Compiler,e.JavaScriptCompiler=a.default,e.Parser=o.parser,e.parse=o.parse,e.parseWithoutProcessing=o.parseWithoutProcessing,e}var h=d();h.create=d,c.default(h),h.Visitor=l.default,h.default=h,e.default=h,t.exports=e.default})),JM=aM((e=>{e.__esModule=!0,e.print=function(e){return(new n).accept(e)},e.PrintVisitor=n;var t=function(e){return e&&e.__esModule?e:{default:e}}(LM());function n(){this.padding=0}n.prototype=new t.default,n.prototype.pad=function(e){for(var t="",n=0,r=this.padding;n<r;n++)t+="  ";return t+=e+"\n"},n.prototype.Program=function(e){var t="",n=e.body,r=void 0,i=void 0;if(e.blockParams){var o="BLOCK PARAMS: [";for(r=0,i=e.blockParams.length;r<i;r++)o+=" "+e.blockParams[r];o+=" ]",t+=this.pad(o)}for(r=0,i=n.length;r<i;r++)t+=this.accept(n[r]);return this.padding--,t},n.prototype.MustacheStatement=function(e){return this.pad("{{ "+this.SubExpression(e)+" }}")},n.prototype.Decorator=function(e){return this.pad("{{ DIRECTIVE "+this.SubExpression(e)+" }}")},n.prototype.BlockStatement=n.prototype.DecoratorBlock=function(e){var t="";return t+=this.pad(("DecoratorBlock"===e.type?"DIRECTIVE ":"")+"BLOCK:"),this.padding++,t+=this.pad(this.SubExpression(e)),e.program&&(t+=this.pad("PROGRAM:"),this.padding++,t+=this.accept(e.program),this.padding--),e.inverse&&(e.program&&this.padding++,t+=this.pad("{{^}}"),this.padding++,t+=this.accept(e.inverse),this.padding--,e.program&&this.padding--),this.padding--,t},n.prototype.PartialStatement=function(e){var t="PARTIAL:"+e.name.original;return e.params[0]&&(t+=" "+this.accept(e.params[0])),e.hash&&(t+=" "+this.accept(e.hash)),this.pad("{{> "+t+" }}")},n.prototype.PartialBlockStatement=function(e){var t="PARTIAL BLOCK:"+e.name.original;return e.params[0]&&(t+=" "+this.accept(e.params[0])),e.hash&&(t+=" "+this.accept(e.hash)),t+=" "+this.pad("PROGRAM:"),this.padding++,t+=this.accept(e.program),this.padding--,this.pad("{{> "+t+" }}")},n.prototype.ContentStatement=function(e){return this.pad("CONTENT[ '"+e.value+"' ]")},n.prototype.CommentStatement=function(e){return this.pad("{{! '"+e.value+"' }}")},n.prototype.SubExpression=function(e){for(var t,n=e.params,r=[],i=0,o=n.length;i<o;i++)r.push(this.accept(n[i]));return n="["+r.join(", ")+"]",t=e.hash?" "+this.accept(e.hash):"",this.accept(e.path)+" "+n+t},n.prototype.PathExpression=function(e){var t=e.parts.join("/");return(e.data?"@":"")+"PATH:"+t},n.prototype.StringLiteral=function(e){return'"'+e.value+'"'},n.prototype.NumberLiteral=function(e){return"NUMBER{"+e.value+"}"},n.prototype.BooleanLiteral=function(e){return"BOOLEAN{"+e.value+"}"},n.prototype.UndefinedLiteral=function(){return"UNDEFINED"},n.prototype.NullLiteral=function(){return"NULL"},n.prototype.Hash=function(e){for(var t=e.pairs,n=[],r=0,i=t.length;r<i;r++)n.push(this.accept(t[r]));return"HASH{"+n.join(", ")+"}"},n.prototype.HashPair=function(e){return e.key+"="+this.accept(e.value)}})),eT=aM(((e,t)=>{var n=ZM().default,r=JM();function i(e,t){var r=sM("fs").readFileSync(t,"utf8");e.exports=n.compile(r)}n.PrintVisitor=r.PrintVisitor,n.print=r.print,t.exports=n,typeof sM<"u"&&sM.extensions&&(sM.extensions[".handlebars"]=i,sM.extensions[".hbs"]=i)})),tT=class e{static isPlaceholder(e){return null!=(null===e||void 0===e?void 0:e.onclick)}static isAudio(t){var n;return t&&!e.isPlaceholder(t)&&(null===t||void 0===t||null===(n=t.mimeType)||void 0===n?void 0:n.startsWith("audio/"))||"application/ogg"==t.mimeType}static isImage(t){var n;return t&&!e.isPlaceholder(t)&&(null===t||void 0===t||null===(n=t.mimeType)||void 0===n?void 0:n.startsWith("image/"))}static isDocument(t){var n,r;return t&&!e.isPlaceholder(t)&&((null===t||void 0===t||null===(n=t.mimeType)||void 0===n?void 0:n.startsWith("text/"))||(null===t||void 0===t||null===(r=t.mimeType)||void 0===r?void 0:r.startsWith("application/pdf")))}},nT=((JI=nT||{}).REGISTRATION="client_registration",JI.DEREGISTRATION="client_deregistration",JI.SEND_CHAT_MESSAGE="client_send_chat",JI.RUN_CLIENT_SCRIPT="client_run_cscript",JI.SIGNAL_INTENT="client_signal_intent",JI.WINDOW_MESSAGE="client_window_message",JI.SHOW_TOAST="client_show_toast",JI.SHOW_EXTENSION="client_show_extension",JI.LOAD_RECIPE="client_load_recipe",JI.SHOW_TOP_BANNER="client_show_top_banner",JI),rT=((ZI=rT||{}).INTENT_MAP="omni-intentMap",ZI),iT=((QI=iT||{}).DATA_UPDATED="data_updated",QI.CUSTOM_EVENT="custom_event",QI.CHAT_MESSAGE_RECEIVED="chat_message_received",QI),oT=((XI=oT||{}).ACKNOWLEDGE="host_acknowledge",XI.CLIENT_SCRIPT_RESPONSE="host_cscript_response",XI.SYNC_DATA="host_sync_data",XI.CHAT_COMMAND="host_chat_command",XI.CHAT_MESSAGE_RECEIVED="host_chat_message_received",XI.CUSTOM_EVENT="custom_extension_event",XI),sT=((GI=sT||{}).image="image",GI.audio="audio",GI.document="document",GI.video="video",GI.file="file",GI),aT=class e{constructor(t){var n;if(this.fid=t.fid||(null===(n=t.ticket)||void 0===n?void 0:n.fid),!this.fid)throw new Error("Invalid resource, fid missing");this.ticket=t.ticket,this.fileName=t.fileName,this.size=t.size,this.data=t.data,this.url=t.url,this.mimeType=t.mimeType,this.expires=t.expires,this.meta=t.meta||{},this.meta.created=this.meta.created||Date.now();let r=this.fileName.split(".").pop();this.furl="fid://".concat(this.fid,".").concat(r),this.fileType=e.determineFileTypeFromMimeType(this.mimeType)||t.fileType||"file"}static determineFileTypeFromMimeType(e){let t=["audio","document","image","video","file"];if(e){let n=e.split("/")[0];if(t.includes(n))return n;if(n.startsWith("text/"))return"document";if("application/ogg"===n)return"audio";if("application/pdf"===n)return"document";if("video/"===n)return"video"}}isAudio(){var e,t;return"audio"===this.fileType||!!this.mimeType&&((null===(e=this.mimeType)||void 0===e?void 0:e.startsWith("audio/"))||(null===(t=this.mimeType)||void 0===t?void 0:t.startsWith("application/ogg")))}isVideo(){var e;return"video"===this.fileType||!!this.mimeType&&(null===(e=this.mimeType)||void 0===e?void 0:e.startsWith("video/"))}isImage(){var e;return"image"===this.fileType||!!this.mimeType&&(null===(e=this.mimeType)||void 0===e?void 0:e.startsWith("image/"))}isDocument(){var e,t;return"document"===this.fileType||!!this.mimeType&&((null===(e=this.mimeType)||void 0===e?void 0:e.startsWith("text/"))||(null===(t=this.mimeType)||void 0===t?void 0:t.startsWith("application/pdf")))}asBase64(e){return this.data instanceof Buffer?e?"data:".concat(this.mimeType,";base64,").concat(this.data.toString("base64")):this.data.toString("base64"):"string"==typeof this.data?this.data:void 0}},lT=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(e,t)=>window.fetch(e,t);this.fetch=e}async executeRequest(e,t){return await this.fetch(e,t)}},cT=new WeakMap,uT=new WeakMap,dT=new WeakMap,hT=Symbol("anyProducer"),pT=Promise.resolve(),fT=Symbol("listenerAdded"),gT=Symbol("listenerRemoved"),mT=!1,yT=!1;function vT(e){if("string"!=typeof e&&"symbol"!=typeof e&&"number"!=typeof e)throw new TypeError("`eventName` must be a string, symbol, or number")}function bT(e){if("function"!=typeof e)throw new TypeError("listener must be a function")}function wT(e,t){let n=uT.get(e);if(n.has(t))return n.get(t)}function xT(e,t){let n="string"==typeof t||"symbol"==typeof t||"number"==typeof t?t:hT,r=dT.get(e);if(r.has(n))return r.get(n)}function ST(e,t){t=Array.isArray(t)?t:[t];let n=!1,r=()=>{},i=[],o={enqueue(e){i.push(e),r()},finish(){n=!0,r()}};for(let s of t){let t=xT(e,s);t||(t=new Set,dT.get(e).set(s,t)),t.add(o)}return{async next(){return i?0===i.length?n?(i=void 0,this.next()):(await new Promise((e=>{r=e})),this.next()):{done:!1,value:await i.shift()}:{done:!0}},async return(n){i=void 0;for(let r of t){let t=xT(e,r);t&&(t.delete(o),0===t.size&&dT.get(e).delete(r))}return r(),arguments.length>0?{done:!0,value:await n}:{done:!0}},[Symbol.asyncIterator](){return this}}}function kT(e){if(void 0===e)return ET;if(!Array.isArray(e))throw new TypeError("`methodNames` must be an array of strings");for(let t of e)if(!ET.includes(t))throw"string"!=typeof t?new TypeError("`methodNames` element must be a string"):new Error("".concat(t," is not Emittery method"));return e}var _T=e=>e===fT||e===gT;function PT(e,t,n){if(_T(t))try{mT=!0,e.emit(t,n)}finally{mT=!1}}var CT=class e{static mixin(t,n){return n=kT(n),r=>{if("function"!=typeof r)throw new TypeError("`target` must be function");for(let e of n)if(void 0!==r.prototype[e])throw new Error("The property `".concat(e,"` already exists on `target`"));Object.defineProperty(r.prototype,t,{enumerable:!1,get:function(){return Object.defineProperty(this,t,{enumerable:!1,value:new e}),this[t]}});let i=e=>function(){return this[t][e](...arguments)};for(let e of n)Object.defineProperty(r.prototype,e,{enumerable:!1,value:i(e)});return r}}static get isDebugEnabled(){var e,t;if("object"!=typeof(null===(e=globalThis.process)||void 0===e?void 0:e.env))return yT;let{env:n}=null!==(t=globalThis.process)&&void 0!==t?t:{env:{}};return"emittery"===n.DEBUG||"*"===n.DEBUG||yT}static set isDebugEnabled(e){yT=e}constructor(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};cT.set(this,new Set),uT.set(this,new Map),dT.set(this,new Map),dT.get(this).set(hT,new Set),this.debug=null!==(e=t.debug)&&void 0!==e?e:{},void 0===this.debug.enabled&&(this.debug.enabled=!1),this.debug.logger||(this.debug.logger=(e,t,n,r)=>{try{r=JSON.stringify(r)}catch{r="Object with the following keys failed to stringify: ".concat(Object.keys(r).join(","))}("symbol"==typeof n||"number"==typeof n)&&(n=n.toString());let i=new Date,o="".concat(i.getHours(),":").concat(i.getMinutes(),":").concat(i.getSeconds(),".").concat(i.getMilliseconds());console.log("[".concat(o,"][emittery:").concat(e,"][").concat(t,"] Event Name: ").concat(n,"\n\tdata: ").concat(r))})}logIfDebugEnabled(t,n,r){(e.isDebugEnabled||this.debug.enabled)&&this.debug.logger(t,this.debug.name,n,r)}on(e,t){bT(t),e=Array.isArray(e)?e:[e];for(let n of e){vT(n);let e=wT(this,n);e||(e=new Set,uT.get(this).set(n,e)),e.add(t),this.logIfDebugEnabled("subscribe",n,void 0),_T(n)||PT(this,fT,{eventName:n,listener:t})}return this.off.bind(this,e,t)}off(e,t){bT(t),e=Array.isArray(e)?e:[e];for(let n of e){vT(n);let e=wT(this,n);e&&(e.delete(t),0===e.size&&uT.get(this).delete(n)),this.logIfDebugEnabled("unsubscribe",n,void 0),_T(n)||PT(this,gT,{eventName:n,listener:t})}}once(e){let t,n=new Promise((n=>{t=this.on(e,(e=>{t(),n(e)}))}));return n.off=t,n}events(e){e=Array.isArray(e)?e:[e];for(let t of e)vT(t);return ST(this,e)}async emit(e,t){var n;if(vT(e),_T(e)&&!mT)throw new TypeError("`eventName` cannot be meta event `listenerAdded` or `listenerRemoved`");this.logIfDebugEnabled("emit",e,t),function(e,t,n){let r=dT.get(e);if(r.has(t))for(let i of r.get(t))i.enqueue(n);if(r.has(hT)){let e=Promise.all([t,n]);for(let t of r.get(hT))t.enqueue(e)}}(this,e,t);let r=null!==(n=wT(this,e))&&void 0!==n?n:new Set,i=cT.get(this),o=[...r],s=_T(e)?[]:[...i];await pT,await Promise.all([...o.map((async e=>{if(r.has(e))return e(t)})),...s.map((async n=>{if(i.has(n))return n(e,t)}))])}async emitSerial(e,t){var n;if(vT(e),_T(e)&&!mT)throw new TypeError("`eventName` cannot be meta event `listenerAdded` or `listenerRemoved`");this.logIfDebugEnabled("emitSerial",e,t);let r=null!==(n=wT(this,e))&&void 0!==n?n:new Set,i=cT.get(this),o=[...r],s=[...i];await pT;for(let a of o)r.has(a)&&await a(t);for(let a of s)i.has(a)&&await a(e,t)}onAny(e){return bT(e),this.logIfDebugEnabled("subscribeAny",void 0,void 0),cT.get(this).add(e),PT(this,fT,{listener:e}),this.offAny.bind(this,e)}anyEvent(){return ST(this)}offAny(e){bT(e),this.logIfDebugEnabled("unsubscribeAny",void 0,void 0),PT(this,gT,{listener:e}),cT.get(this).delete(e)}clearListeners(e){e=Array.isArray(e)?e:[e];for(let t of e)if(this.logIfDebugEnabled("clear",t,void 0),"string"==typeof t||"symbol"==typeof t||"number"==typeof t){let e=wT(this,t);e&&e.clear();let n=xT(this,t);if(n){for(let e of n)e.finish();n.clear()}}else{cT.get(this).clear();for(let[e,t]of uT.get(this).entries())t.clear(),uT.get(this).delete(e);for(let[e,t]of dT.get(this).entries()){for(let e of t)e.finish();t.clear(),dT.get(this).delete(e)}}}listenerCount(e){e=Array.isArray(e)?e:[e];let t=0;for(let l of e)if("string"!=typeof l){typeof l<"u"&&vT(l),t+=cT.get(this).size;for(let e of uT.get(this).values())t+=e.size;for(let e of dT.get(this).values())t+=e.size}else{var n,r,i,o,s,a;t+=cT.get(this).size+(null!==(n=null===(r=wT(this,l))||void 0===r?void 0:r.size)&&void 0!==n?n:0)+(null!==(i=null===(o=xT(this,l))||void 0===o?void 0:o.size)&&void 0!==i?i:0)+(null!==(s=null===(a=xT(this))||void 0===a?void 0:a.size)&&void 0!==s?s:0)}return t}bindMethods(e,t){if("object"!=typeof e||null===e)throw new TypeError("`target` must be an object");t=kT(t);for(let n of t){if(void 0!==e[n])throw new Error("The property `".concat(n,"` already exists on `target`"));Object.defineProperty(e,n,{enumerable:!1,value:this[n].bind(this)})}}},ET=Object.getOwnPropertyNames(CT.prototype).filter((e=>"constructor"!==e));Object.defineProperty(CT,"listenerAdded",{value:fT,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(CT,"listenerRemoved",{value:gT,writable:!1,enumerable:!0,configurable:!1});var IT=class{constructor(){this.messageHandlers={},this._isClient=!1,this.Resource=tT,this.events=new CT,this.intentMap=new Map,this._messageListenerHandler=e=>{if(e.origin===window.location.origin)try{let t=e.data,n=this.messageHandlers[t.type];n?n.call(this,t,e.source):console.warn("No handler found for message type: ".concat(t.type))}catch(kP){console.error("Error processing the message:",kP)}else console.warn("Dropping Message received from an unknown origin: ".concat(e.origin))},this._initMessageListener(),this._httpClient=new lT}unload(){window.removeEventListener("message",this._messageListenerHandler),console.log("Message listener removed.")}_initMessageListener(){window.addEventListener("message",this._messageListenerHandler,!1),console.log("Message listener initialized.")}addMessageHandler(e,t){this.messageHandlers[e]=t}getLocalValue(e,t){let n=e;n=this._isClient?"omni/"+this._extensionId+"/"+e:"omni/host/"+e;let r=globalThis.localStorage.getItem(n);if(null!==r){let t=JSON.parse(r),n=t.value;switch(t.type){case"boolean":n="true"===n;break;case"object":case"number":case"string":break;default:return console.warn("Unsupported value type",t.type,"on",e),null}return n}return null}setLocalValue(e,t){if(null==e||0==e.length)throw new Error("Invalid null Key passed into setLocalValue");let n=e;if(n=this._isClient?"omni/"+this._extensionId+"/"+e:"omni/host/"+e,null==t)return void globalThis.localStorage.removeItem(n);let r=typeof t,i=t;switch(r){case"number":case"string":case"object":break;case"boolean":i=t?"true":"false";break;default:return void console.warn("Unsupported value type",r,"on",e)}globalThis.localStorage.setItem(n,JSON.stringify({type:r,value:t}))}send(e,t){this._isClient?(console.log("Sending message from client:",e),e.token=this.token,e=JSON.parse(JSON.stringify(e)),window.parent.postMessage(e,"*")):console.warn("Attempted to send a message from the host without specifying a target.")}async runServerScript(e,t){return await(await this._httpClient.executeRequest("/api/v1/mercenaries/runscript/"+e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()}canEditFile(e){return!!e&&this.intentMap.has("file:edit:".concat(e.mimeType))}canViewFile(e){return!!e&&this.intentMap.has("file:show:".concat(e.mimeType))}async getFileObject(e){try{let t=await(await this._httpClient.executeRequest("/fid/"+e+"?obj=true",{method:"GET",headers:{"Content-Type":"application/json"}})).json();return t?(console.log("getFileObject",t),new aT(t)):(console.warn("No valid file object found for fid ".concat(e)),null)}catch(kP){return console.error(kP),null}}async getFileBlob(e){try{return await(await this._httpClient.executeRequest("/fid/"+e+"?download=true")).blob()}catch(kP){return console.error(kP),null}}async uploadFiles(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"temporary";if((null===e||void 0===e?void 0:e.length)>0){let n=await Promise.all(Array.from(e).map((async e=>{let n=new FormData;n.append("storageType",t),n.append("file",e,e.name||Date.now().toString());try{let t=await fetch("/fid",{method:"POST",body:n});if(t.ok){let n=await t.json();return n.length>0&&n[0].ticket&&n[0].fid?n[0]:(console.warn("Failed to upload file",{data:n,file:e}),null)}return console.warn("Failed to upload file",{response:t,file:e}),null}catch(XI){return console.error("Failed to upload file",{error:XI,file:e}),null}})));return n=n.filter((e=>e)),n}return[]}async startRecipe(e,t){let n=await(await fetch("/api/v1/workflow/exec",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({workflow:e,args:t})})).json();if("JOB_STARTED"===n.status)return{...n}}async downloadFile(e,t){let n=e.fid,r=t||e.fileName;fetch("/fid/"+n+"?download=true").then((e=>e.blob())).then((e=>{let t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download=r,document.body.appendChild(n),n.click(),document.body.removeChild(n)})).catch((e=>console.error(e)))}};IT.Resource=tT;((e,t,n)=>{n=null!=e?eM(iM(e)):{},((e,t,n,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let i of rM(t))!oM.call(e,i)&&i!==n&&tM(e,i,{get:()=>t[i],enumerable:!(r=nM(t,i))||r.enumerable})})(!t&&e&&e.__esModule?n:tM(n,"default",{value:e,enumerable:!0}),e)})(eT(),1);function MT(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var TT={async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null};function AT(e){TT=e}var jT=/[&<>"']/,OT=new RegExp(jT.source,"g"),LT=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,zT=new RegExp(LT.source,"g"),RT={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},DT=e=>RT[e];function NT(e,t){if(t){if(jT.test(e))return e.replace(OT,DT)}else if(LT.test(e))return e.replace(zT,DT);return e}var FT=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi;function BT(e){return e.replace(FT,((e,t)=>"colon"===(t=t.toLowerCase())?":":"#"===t.charAt(0)?"x"===t.charAt(1)?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""))}var UT=/(^|[^\[])\^/g;function HT(e,t){e="string"==typeof e?e:e.source,t=t||"";let n={replace:(t,r)=>(r=(r="object"==typeof r&&"source"in r?r.source:r).replace(UT,"$1"),e=e.replace(t,r),n),getRegex:()=>new RegExp(e,t)};return n}function VT(e){try{e=encodeURI(e).replace(/%25/g,"%")}catch{return null}return e}var KT={exec:()=>null};function WT(e,t){let n=e.replace(/\|/g,((e,t,n)=>{let r=!1,i=t;for(;--i>=0&&"\\"===n[i];)r=!r;return r?"|":" |"})),r=n.split(/ \|/),i=0;if(r[0].trim()||r.shift(),r.length>0&&!r[r.length-1].trim()&&r.pop(),t)if(r.length>t)r.splice(t);else for(;r.length<t;)r.push("");for(;i<r.length;i++)r[i]=r[i].trim().replace(/\\\|/g,"|");return r}function $T(e,t,n){let r=e.length;if(0===r)return"";let i=0;for(;i<r;){let o=e.charAt(r-i-1);if(o!==t||n){if(o===t||!n)break;i++}else i++}return e.slice(0,r-i)}function YT(e,t,n,r){let i=t.href,o=t.title?NT(t.title):null,s=e[1].replace(/\\([\[\]])/g,"$1");if("!"!==e[0].charAt(0)){r.state.inLink=!0;let e={type:"link",raw:n,href:i,title:o,text:s,tokens:r.inlineTokens(s)};return r.state.inLink=!1,e}return{type:"image",raw:n,href:i,title:o,text:NT(s)}}var qT=class{constructor(e){lM(this,"options"),lM(this,"rules"),lM(this,"lexer"),this.options=e||TT}space(e){let t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){let t=this.rules.block.code.exec(e);if(t){let e=t[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?e:$T(e,"\n")}}}fences(e){let t=this.rules.block.fences.exec(e);if(t){let e=t[0],n=function(e,t){let n=e.match(/^(\s+)(?:```)/);if(null===n)return t;let r=n[1];return t.split("\n").map((e=>{let t=e.match(/^\s+/);if(null===t)return e;let[n]=t;return n.length>=r.length?e.slice(r.length):e})).join("\n")}(e,t[3]||"");return{type:"code",raw:e,lang:t[2]?t[2].trim().replace(this.rules.inline._escapes,"$1"):t[2],text:n}}}heading(e){let t=this.rules.block.heading.exec(e);if(t){let e=t[2].trim();if(/#$/.test(e)){let t=$T(e,"#");(this.options.pedantic||!t||/ $/.test(t))&&(e=t.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:e,tokens:this.lexer.inline(e)}}}hr(e){let t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:t[0]}}blockquote(e){let t=this.rules.block.blockquote.exec(e);if(t){let e=$T(t[0].replace(/^ *>[ \t]?/gm,""),"\n"),n=this.lexer.state.top;this.lexer.state.top=!0;let r=this.lexer.blockTokens(e);return this.lexer.state.top=n,{type:"blockquote",raw:t[0],tokens:r,text:e}}}list(e){let t=this.rules.block.list.exec(e);if(t){let n=t[1].trim(),r=n.length>1,i={type:"list",raw:"",ordered:r,start:r?+n.slice(0,-1):"",loose:!1,items:[]};n=r?"\\d{1,9}\\".concat(n.slice(-1)):"\\".concat(n),this.options.pedantic&&(n=r?n:"[*+-]");let o=new RegExp("^( {0,3}".concat(n,")((?:[\t ][^\\n]*)?(?:\\n|$))")),s="",a="",l=!1;for(;e;){let n=!1;if(!(t=o.exec(e))||this.rules.block.hr.test(e))break;s=t[0],e=e.substring(s.length);let r=t[2].split("\n",1)[0].replace(/^\t+/,(e=>" ".repeat(3*e.length))),c=e.split("\n",1)[0],u=0;this.options.pedantic?(u=2,a=r.trimStart()):(u=t[2].search(/[^ ]/),u=u>4?1:u,a=r.slice(u),u+=t[1].length);let d=!1;if(!r&&/^ *$/.test(c)&&(s+=c+"\n",e=e.substring(c.length+1),n=!0),!n){let t=new RegExp("^ {0,".concat(Math.min(3,u-1),"}(?:[*+-]|\\d{1,9}[.)])((?:[ \t][^\\n]*)?(?:\\n|$))")),n=new RegExp("^ {0,".concat(Math.min(3,u-1),"}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)")),i=new RegExp("^ {0,".concat(Math.min(3,u-1),"}(?:```|~~~)")),o=new RegExp("^ {0,".concat(Math.min(3,u-1),"}#"));for(;e;){let l=e.split("\n",1)[0];if(c=l,this.options.pedantic&&(c=c.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),i.test(c)||o.test(c)||t.test(c)||n.test(e))break;if(c.search(/[^ ]/)>=u||!c.trim())a+="\n"+c.slice(u);else{if(d||r.search(/[^ ]/)>=4||i.test(r)||o.test(r)||n.test(r))break;a+="\n"+c}!d&&!c.trim()&&(d=!0),s+=l+"\n",e=e.substring(l.length+1),r=c.slice(u)}}i.loose||(l?i.loose=!0:/\n *\n *$/.test(s)&&(l=!0));let h,p=null;this.options.gfm&&(p=/^\[[ xX]\] /.exec(a),p&&(h="[ ] "!==p[0],a=a.replace(/^\[[ xX]\] +/,""))),i.items.push({type:"list_item",raw:s,task:!!p,checked:h,loose:!1,text:a,tokens:[]}),i.raw+=s}i.items[i.items.length-1].raw=s.trimEnd(),i.items[i.items.length-1].text=a.trimEnd(),i.raw=i.raw.trimEnd();for(let e=0;e<i.items.length;e++)if(this.lexer.state.top=!1,i.items[e].tokens=this.lexer.blockTokens(i.items[e].text,[]),!i.loose){let t=i.items[e].tokens.filter((e=>"space"===e.type)),n=t.length>0&&t.some((e=>/\n.*\n/.test(e.raw)));i.loose=n}if(i.loose)for(let e=0;e<i.items.length;e++)i.items[e].loose=!0;return i}}html(e){let t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:"pre"===t[1]||"script"===t[1]||"style"===t[1],text:t[0]}}def(e){let t=this.rules.block.def.exec(e);if(t){let e=t[1].toLowerCase().replace(/\s+/g," "),n=t[2]?t[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline._escapes,"$1"):"",r=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline._escapes,"$1"):t[3];return{type:"def",tag:e,raw:t[0],href:n,title:r}}}table(e){let t=this.rules.block.table.exec(e);if(t){if(!/[:|]/.test(t[2]))return;let e={type:"table",raw:t[0],header:WT(t[1]).map((e=>({text:e,tokens:[]}))),align:t[2].replace(/^\||\| *$/g,"").split("|"),rows:t[3]&&t[3].trim()?t[3].replace(/\n[ \t]*$/,"").split("\n"):[]};if(e.header.length===e.align.length){let t,n,r,i,o=e.align.length;for(t=0;t<o;t++){let n=e.align[t];n&&(/^ *-+: *$/.test(n)?e.align[t]="right":/^ *:-+: *$/.test(n)?e.align[t]="center":/^ *:-+ *$/.test(n)?e.align[t]="left":e.align[t]=null)}for(o=e.rows.length,t=0;t<o;t++)e.rows[t]=WT(e.rows[t],e.header.length).map((e=>({text:e,tokens:[]})));for(o=e.header.length,n=0;n<o;n++)e.header[n].tokens=this.lexer.inline(e.header[n].text);for(o=e.rows.length,n=0;n<o;n++)for(i=e.rows[n],r=0;r<i.length;r++)i[r].tokens=this.lexer.inline(i[r].text);return e}}}lheading(e){let t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:"="===t[2].charAt(0)?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){let t=this.rules.block.paragraph.exec(e);if(t){let e="\n"===t[1].charAt(t[1].length-1)?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:e,tokens:this.lexer.inline(e)}}}text(e){let t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){let t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:NT(t[1])}}tag(e){let t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&/^<a /i.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){let t=this.rules.inline.link.exec(e);if(t){let e=t[2].trim();if(!this.options.pedantic&&/^</.test(e)){if(!/>$/.test(e))return;let t=$T(e.slice(0,-1),"\\");if((e.length-t.length)%2===0)return}else{let e=function(e,t){if(-1===e.indexOf(t[1]))return-1;let n=0;for(let r=0;r<e.length;r++)if("\\"===e[r])r++;else if(e[r]===t[0])n++;else if(e[r]===t[1]&&(n--,n<0))return r;return-1}(t[2],"()");if(e>-1){let n=(0===t[0].indexOf("!")?5:4)+t[1].length+e;t[2]=t[2].substring(0,e),t[0]=t[0].substring(0,n).trim(),t[3]=""}}let n=t[2],r="";if(this.options.pedantic){let e=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(n);e&&(n=e[1],r=e[3])}else r=t[3]?t[3].slice(1,-1):"";return n=n.trim(),/^</.test(n)&&(n=this.options.pedantic&&!/>$/.test(e)?n.slice(1):n.slice(1,-1)),YT(t,{href:n&&n.replace(this.rules.inline._escapes,"$1"),title:r&&r.replace(this.rules.inline._escapes,"$1")},t[0],this.lexer)}}reflink(e,t){let n;if((n=this.rules.inline.reflink.exec(e))||(n=this.rules.inline.nolink.exec(e))){let e=(n[2]||n[1]).replace(/\s+/g," ");if(e=t[e.toLowerCase()],!e){let e=n[0].charAt(0);return{type:"text",raw:e,text:e}}return YT(n,e,n[0],this.lexer)}}emStrong(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=this.rules.inline.emStrong.lDelim.exec(e);if(!(!r||r[3]&&n.match(/[\p{L}\p{N}]/u))&&(!r[1]&&!r[2]||!n||this.rules.inline.punctuation.exec(n))){let n,i,o=[...r[0]].length-1,s=o,a=0,l="*"===r[0][0]?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(l.lastIndex=0,t=t.slice(-1*e.length+o);null!=(r=l.exec(t));){if(n=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!n)continue;if(i=[...n].length,r[3]||r[4]){s+=i;continue}if((r[5]||r[6])&&o%3&&!((o+i)%3)){a+=i;continue}if(s-=i,s>0)continue;i=Math.min(i,i+s+a);let t=[...r[0]][0].length,l=e.slice(0,o+r.index+t+i);if(Math.min(o,i)%2){let e=l.slice(1,-1);return{type:"em",raw:l,text:e,tokens:this.lexer.inlineTokens(e)}}let c=l.slice(2,-2);return{type:"strong",raw:l,text:c,tokens:this.lexer.inlineTokens(c)}}}}codespan(e){let t=this.rules.inline.code.exec(e);if(t){let e=t[2].replace(/\n/g," "),n=/[^ ]/.test(e),r=/^ /.test(e)&&/ $/.test(e);return n&&r&&(e=e.substring(1,e.length-1)),e=NT(e,!0),{type:"codespan",raw:t[0],text:e}}}br(e){let t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){let t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){let t=this.rules.inline.autolink.exec(e);if(t){let e,n;return"@"===t[2]?(e=NT(t[1]),n="mailto:"+e):(e=NT(t[1]),n=e),{type:"link",raw:t[0],text:e,href:n,tokens:[{type:"text",raw:e,text:e}]}}}url(e){let t;if(t=this.rules.inline.url.exec(e)){let e,n;if("@"===t[2])e=NT(t[0]),n="mailto:"+e;else{let r;do{r=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])[0]}while(r!==t[0]);e=NT(t[0]),n="www."===t[1]?"http://"+t[0]:t[0]}return{type:"link",raw:t[0],text:e,href:n,tokens:[{type:"text",raw:e,text:e}]}}}inlineText(e){let t=this.rules.inline.text.exec(e);if(t){let e;return e=this.lexer.state.inRawBlock?t[0]:NT(t[0]),{type:"text",raw:t[0],text:e}}}},GT={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:KT,lheading:/^(?!bull )((?:.|\n(?!\s*?\n|bull ))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/,_label:/(?!\s*\])(?:\\.|[^\[\]\\])+/,_title:/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/};GT.def=HT(GT.def).replace("label",GT._label).replace("title",GT._title).getRegex(),GT.bullet=/(?:[*+-]|\d{1,9}[.)])/,GT.listItemStart=HT(/^( *)(bull) */).replace("bull",GT.bullet).getRegex(),GT.list=HT(GT.list).replace(/bull/g,GT.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+GT.def.source+")").getRegex(),GT._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",GT._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/,GT.html=HT(GT.html,"i").replace("comment",GT._comment).replace("tag",GT._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),GT.lheading=HT(GT.lheading).replace(/bull/g,GT.bullet).getRegex(),GT.paragraph=HT(GT._paragraph).replace("hr",GT.hr).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",GT._tag).getRegex(),GT.blockquote=HT(GT.blockquote).replace("paragraph",GT.paragraph).getRegex(),GT.normal={...GT},GT.gfm={...GT.normal,table:"^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"},GT.gfm.table=HT(GT.gfm.table).replace("hr",GT.hr).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",GT._tag).getRegex(),GT.gfm.paragraph=HT(GT._paragraph).replace("hr",GT.hr).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",GT.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",GT._tag).getRegex(),GT.pedantic={...GT.normal,html:HT("^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:\"[^\"]*\"|'[^']*'|\\s[^'\"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))").replace("comment",GT._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:KT,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:HT(GT.normal._paragraph).replace("hr",GT.hr).replace("heading"," *#{1,6} *[^\n]").replace("lheading",GT.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()};var XT={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:KT,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:((?!\*)[punct])|[^\s*]))|^_+(?:((?!_)[punct])|([^\s_]))/,rDelimAst:/^[^_*]*?__[^_*]*?\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\*)[punct](\*+)(?=[\s]|$)|[^punct\s](\*+)(?!\*)(?=[punct\s]|$)|(?!\*)[punct\s](\*+)(?=[^punct\s])|[\s](\*+)(?!\*)(?=[punct])|(?!\*)[punct](\*+)(?!\*)(?=[punct])|[^punct\s](\*+)(?=[^punct\s])/,rDelimUnd:/^[^_*]*?\*\*[^_*]*?_[^_*]*?(?=\*\*)|[^_]+(?=[^_])|(?!_)[punct](_+)(?=[\s]|$)|[^punct\s](_+)(?!_)(?=[punct\s]|$)|(?!_)[punct\s](_+)(?=[^punct\s])|[\s](_+)(?!_)(?=[punct])|(?!_)[punct](_+)(?!_)(?=[punct])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:KT,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^((?![*_])[\spunctuation])/,_punctuation:"\\p{P}$+<=>`^|~"};XT.punctuation=HT(XT.punctuation,"u").replace(/punctuation/g,XT._punctuation).getRegex(),XT.blockSkip=/\[[^[\]]*?\]\([^\(\)]*?\)|`[^`]*?`|<[^<>]*?>/g,XT.anyPunctuation=/\\[punct]/g,XT._escapes=/\\([punct])/g,XT._comment=HT(GT._comment).replace("(?:--\x3e|$)","--\x3e").getRegex(),XT.emStrong.lDelim=HT(XT.emStrong.lDelim,"u").replace(/punct/g,XT._punctuation).getRegex(),XT.emStrong.rDelimAst=HT(XT.emStrong.rDelimAst,"gu").replace(/punct/g,XT._punctuation).getRegex(),XT.emStrong.rDelimUnd=HT(XT.emStrong.rDelimUnd,"gu").replace(/punct/g,XT._punctuation).getRegex(),XT.anyPunctuation=HT(XT.anyPunctuation,"gu").replace(/punct/g,XT._punctuation).getRegex(),XT._escapes=HT(XT._escapes,"gu").replace(/punct/g,XT._punctuation).getRegex(),XT._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/,XT._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/,XT.autolink=HT(XT.autolink).replace("scheme",XT._scheme).replace("email",XT._email).getRegex(),XT._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/,XT.tag=HT(XT.tag).replace("comment",XT._comment).replace("attribute",XT._attribute).getRegex(),XT._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,XT._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/,XT._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/,XT.link=HT(XT.link).replace("label",XT._label).replace("href",XT._href).replace("title",XT._title).getRegex(),XT.reflink=HT(XT.reflink).replace("label",XT._label).replace("ref",GT._label).getRegex(),XT.nolink=HT(XT.nolink).replace("ref",GT._label).getRegex(),XT.reflinkSearch=HT(XT.reflinkSearch,"g").replace("reflink",XT.reflink).replace("nolink",XT.nolink).getRegex(),XT.normal={...XT},XT.pedantic={...XT.normal,strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:HT(/^!?\[(label)\]\((.*?)\)/).replace("label",XT._label).getRegex(),reflink:HT(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",XT._label).getRegex()},XT.gfm={...XT.normal,escape:HT(XT.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},XT.gfm.url=HT(XT.gfm.url,"i").replace("email",XT.gfm._extended_email).getRegex(),XT.breaks={...XT.gfm,br:HT(XT.br).replace("{2,}","*").getRegex(),text:HT(XT.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()};var QT=class e{constructor(e){lM(this,"tokens"),lM(this,"options"),lM(this,"state"),lM(this,"tokenizer"),lM(this,"inlineQueue"),this.tokens=[],this.tokens.links=Object.create(null),this.options=e||TT,this.options.tokenizer=this.options.tokenizer||new qT,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let t={block:GT.normal,inline:XT.normal};this.options.pedantic?(t.block=GT.pedantic,t.inline=XT.pedantic):this.options.gfm&&(t.block=GT.gfm,this.options.breaks?t.inline=XT.breaks:t.inline=XT.gfm),this.tokenizer.rules=t}static get rules(){return{block:GT,inline:XT}}static lex(t,n){return new e(n).lex(t)}static lexInline(t,n){return new e(n).inlineTokens(t)}lex(e){let t;for(e=e.replace(/\r\n|\r/g,"\n"),this.blockTokens(e,this.tokens);t=this.inlineQueue.shift();)this.inlineTokens(t.src,t.tokens);return this.tokens}blockTokens(e){let t,n,r,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];for(e=this.options.pedantic?e.replace(/\t/g,"    ").replace(/^ +$/gm,""):e.replace(/^( *)(\t+)/gm,((e,t,n)=>t+"    ".repeat(n.length)));e;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some((n=>!!(t=n.call({lexer:this},e,o))&&(e=e.substring(t.raw.length),o.push(t),!0))))){if(t=this.tokenizer.space(e)){e=e.substring(t.raw.length),1===t.raw.length&&o.length>0?o[o.length-1].raw+="\n":o.push(t);continue}if(t=this.tokenizer.code(e)){e=e.substring(t.raw.length),n=o[o.length-1],!n||"paragraph"!==n.type&&"text"!==n.type?o.push(t):(n.raw+="\n"+t.raw,n.text+="\n"+t.text,this.inlineQueue[this.inlineQueue.length-1].src=n.text);continue}if(t=this.tokenizer.fences(e)){e=e.substring(t.raw.length),o.push(t);continue}if(t=this.tokenizer.heading(e)){e=e.substring(t.raw.length),o.push(t);continue}if(t=this.tokenizer.hr(e)){e=e.substring(t.raw.length),o.push(t);continue}if(t=this.tokenizer.blockquote(e)){e=e.substring(t.raw.length),o.push(t);continue}if(t=this.tokenizer.list(e)){e=e.substring(t.raw.length),o.push(t);continue}if(t=this.tokenizer.html(e)){e=e.substring(t.raw.length),o.push(t);continue}if(t=this.tokenizer.def(e)){e=e.substring(t.raw.length),n=o[o.length-1],!n||"paragraph"!==n.type&&"text"!==n.type?this.tokens.links[t.tag]||(this.tokens.links[t.tag]={href:t.href,title:t.title}):(n.raw+="\n"+t.raw,n.text+="\n"+t.raw,this.inlineQueue[this.inlineQueue.length-1].src=n.text);continue}if(t=this.tokenizer.table(e)){e=e.substring(t.raw.length),o.push(t);continue}if(t=this.tokenizer.lheading(e)){e=e.substring(t.raw.length),o.push(t);continue}if(r=e,this.options.extensions&&this.options.extensions.startBlock){let t,n=1/0,i=e.slice(1);this.options.extensions.startBlock.forEach((e=>{t=e.call({lexer:this},i),"number"==typeof t&&t>=0&&(n=Math.min(n,t))})),n<1/0&&n>=0&&(r=e.substring(0,n+1))}if(this.state.top&&(t=this.tokenizer.paragraph(r))){n=o[o.length-1],i&&"paragraph"===n.type?(n.raw+="\n"+t.raw,n.text+="\n"+t.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=n.text):o.push(t),i=r.length!==e.length,e=e.substring(t.raw.length);continue}if(t=this.tokenizer.text(e)){e=e.substring(t.raw.length),n=o[o.length-1],n&&"text"===n.type?(n.raw+="\n"+t.raw,n.text+="\n"+t.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=n.text):o.push(t);continue}if(e){let t="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(t);break}throw new Error(t)}}return this.state.top=!0,o}inline(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e){let t,n,r,i,o,s,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],l=e;if(this.tokens.links){let e=Object.keys(this.tokens.links);if(e.length>0)for(;null!=(i=this.tokenizer.rules.inline.reflinkSearch.exec(l));)e.includes(i[0].slice(i[0].lastIndexOf("[")+1,-1))&&(l=l.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+l.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;null!=(i=this.tokenizer.rules.inline.blockSkip.exec(l));)l=l.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+l.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;null!=(i=this.tokenizer.rules.inline.anyPunctuation.exec(l));)l=l.slice(0,i.index)+"++"+l.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;e;)if(o||(s=""),o=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some((n=>!!(t=n.call({lexer:this},e,a))&&(e=e.substring(t.raw.length),a.push(t),!0))))){if(t=this.tokenizer.escape(e)){e=e.substring(t.raw.length),a.push(t);continue}if(t=this.tokenizer.tag(e)){e=e.substring(t.raw.length),n=a[a.length-1],n&&"text"===t.type&&"text"===n.type?(n.raw+=t.raw,n.text+=t.text):a.push(t);continue}if(t=this.tokenizer.link(e)){e=e.substring(t.raw.length),a.push(t);continue}if(t=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(t.raw.length),n=a[a.length-1],n&&"text"===t.type&&"text"===n.type?(n.raw+=t.raw,n.text+=t.text):a.push(t);continue}if(t=this.tokenizer.emStrong(e,l,s)){e=e.substring(t.raw.length),a.push(t);continue}if(t=this.tokenizer.codespan(e)){e=e.substring(t.raw.length),a.push(t);continue}if(t=this.tokenizer.br(e)){e=e.substring(t.raw.length),a.push(t);continue}if(t=this.tokenizer.del(e)){e=e.substring(t.raw.length),a.push(t);continue}if(t=this.tokenizer.autolink(e)){e=e.substring(t.raw.length),a.push(t);continue}if(!this.state.inLink&&(t=this.tokenizer.url(e))){e=e.substring(t.raw.length),a.push(t);continue}if(r=e,this.options.extensions&&this.options.extensions.startInline){let t,n=1/0,i=e.slice(1);this.options.extensions.startInline.forEach((e=>{t=e.call({lexer:this},i),"number"==typeof t&&t>=0&&(n=Math.min(n,t))})),n<1/0&&n>=0&&(r=e.substring(0,n+1))}if(t=this.tokenizer.inlineText(r)){e=e.substring(t.raw.length),"_"!==t.raw.slice(-1)&&(s=t.raw.slice(-1)),o=!0,n=a[a.length-1],n&&"text"===n.type?(n.raw+=t.raw,n.text+=t.text):a.push(t);continue}if(e){let t="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(t);break}throw new Error(t)}}return a}},ZT=class{constructor(e){lM(this,"options"),this.options=e||TT}code(e,t,n){var r;let i=null===(r=(t||"").match(/^\S*/))||void 0===r?void 0:r[0];return e=e.replace(/\n$/,"")+"\n",i?'<pre><code class="language-'+NT(i)+'">'+(n?e:NT(e,!0))+"</code></pre>\n":"<pre><code>"+(n?e:NT(e,!0))+"</code></pre>\n"}blockquote(e){return"<blockquote>\n".concat(e,"</blockquote>\n")}html(e,t){return e}heading(e,t,n){return"<h".concat(t,">").concat(e,"</h").concat(t,">\n")}hr(){return"<hr>\n"}list(e,t,n){let r=t?"ol":"ul";return"<"+r+(t&&1!==n?' start="'+n+'"':"")+">\n"+e+"</"+r+">\n"}listitem(e,t,n){return"<li>".concat(e,"</li>\n")}checkbox(e){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph(e){return"<p>".concat(e,"</p>\n")}table(e,t){return t&&(t="<tbody>".concat(t,"</tbody>")),"<table>\n<thead>\n"+e+"</thead>\n"+t+"</table>\n"}tablerow(e){return"<tr>\n".concat(e,"</tr>\n")}tablecell(e,t){let n=t.header?"th":"td";return(t.align?"<".concat(n,' align="').concat(t.align,'">'):"<".concat(n,">"))+e+"</".concat(n,">\n")}strong(e){return"<strong>".concat(e,"</strong>")}em(e){return"<em>".concat(e,"</em>")}codespan(e){return"<code>".concat(e,"</code>")}br(){return"<br>"}del(e){return"<del>".concat(e,"</del>")}link(e,t,n){let r=VT(e);if(null===r)return n;let i='<a href="'+(e=r)+'"';return t&&(i+=' title="'+t+'"'),i+=">"+n+"</a>",i}image(e,t,n){let r=VT(e);if(null===r)return n;let i='<img src="'.concat(e=r,'" alt="').concat(n,'"');return t&&(i+=' title="'.concat(t,'"')),i+=">",i}text(e){return e}},JT=class{strong(e){return e}em(e){return e}codespan(e){return e}del(e){return e}html(e){return e}text(e){return e}link(e,t,n){return""+n}image(e,t,n){return""+n}br(){return""}},eA=class e{constructor(e){lM(this,"options"),lM(this,"renderer"),lM(this,"textRenderer"),this.options=e||TT,this.options.renderer=this.options.renderer||new ZT,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new JT}static parse(t,n){return new e(n).parse(t)}static parseInline(t,n){return new e(n).parseInline(t)}parse(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n="";for(let r=0;r<e.length;r++){let i=e[r];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[i.type]){let e=i,t=this.options.extensions.renderers[e.type].call({parser:this},e);if(!1!==t||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(e.type)){n+=t||"";continue}}switch(i.type){case"space":continue;case"hr":n+=this.renderer.hr();continue;case"heading":{let e=i;n+=this.renderer.heading(this.parseInline(e.tokens),e.depth,BT(this.parseInline(e.tokens,this.textRenderer)));continue}case"code":{let e=i;n+=this.renderer.code(e.text,e.lang,!!e.escaped);continue}case"table":{let e=i,t="",r="";for(let n=0;n<e.header.length;n++)r+=this.renderer.tablecell(this.parseInline(e.header[n].tokens),{header:!0,align:e.align[n]});t+=this.renderer.tablerow(r);let o="";for(let n=0;n<e.rows.length;n++){let t=e.rows[n];r="";for(let n=0;n<t.length;n++)r+=this.renderer.tablecell(this.parseInline(t[n].tokens),{header:!1,align:e.align[n]});o+=this.renderer.tablerow(r)}n+=this.renderer.table(t,o);continue}case"blockquote":{let e=i,t=this.parse(e.tokens);n+=this.renderer.blockquote(t);continue}case"list":{let e=i,t=e.ordered,r=e.start,o=e.loose,s="";for(let n=0;n<e.items.length;n++){let t=e.items[n],r=t.checked,i=t.task,a="";if(t.task){let e=this.renderer.checkbox(!!r);o?t.tokens.length>0&&"paragraph"===t.tokens[0].type?(t.tokens[0].text=e+" "+t.tokens[0].text,t.tokens[0].tokens&&t.tokens[0].tokens.length>0&&"text"===t.tokens[0].tokens[0].type&&(t.tokens[0].tokens[0].text=e+" "+t.tokens[0].tokens[0].text)):t.tokens.unshift({type:"text",text:e+" "}):a+=e+" "}a+=this.parse(t.tokens,o),s+=this.renderer.listitem(a,i,!!r)}n+=this.renderer.list(s,t,r);continue}case"html":{let e=i;n+=this.renderer.html(e.text,e.block);continue}case"paragraph":{let e=i;n+=this.renderer.paragraph(this.parseInline(e.tokens));continue}case"text":{let o=i,s=o.tokens?this.parseInline(o.tokens):o.text;for(;r+1<e.length&&"text"===e[r+1].type;)o=e[++r],s+="\n"+(o.tokens?this.parseInline(o.tokens):o.text);n+=t?this.renderer.paragraph(s):s;continue}default:{let e='Token with "'+i.type+'" type was not found.';if(this.options.silent)return console.error(e),"";throw new Error(e)}}}return n}parseInline(e,t){t=t||this.renderer;let n="";for(let r=0;r<e.length;r++){let i=e[r];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[i.type]){let e=this.options.extensions.renderers[i.type].call({parser:this},i);if(!1!==e||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(i.type)){n+=e||"";continue}}switch(i.type){case"escape":{let e=i;n+=t.text(e.text);break}case"html":{let e=i;n+=t.html(e.text);break}case"link":{let e=i;n+=t.link(e.href,e.title,this.parseInline(e.tokens,t));break}case"image":{let e=i;n+=t.image(e.href,e.title,e.text);break}case"strong":{let e=i;n+=t.strong(this.parseInline(e.tokens,t));break}case"em":{let e=i;n+=t.em(this.parseInline(e.tokens,t));break}case"codespan":{let e=i;n+=t.codespan(e.text);break}case"br":n+=t.br();break;case"del":{let e=i;n+=t.del(this.parseInline(e.tokens,t));break}case"text":{let e=i;n+=t.text(e.text);break}default:{let e='Token with "'+i.type+'" type was not found.';if(this.options.silent)return console.error(e),"";throw new Error(e)}}}return n}},tA=class{constructor(e){lM(this,"options"),this.options=e||TT}preprocess(e){return e}postprocess(e){return e}};lM(tA,"passThroughHooks",new Set(["preprocess","postprocess"]));var nA,rA,iA,oA;nA=new WeakSet,rA=function(e,t){return(n,r)=>{let i={...r},o={...this.defaults,...i};!0===this.defaults.async&&!1===i.async&&(o.silent||console.warn("marked(): The async option was set to true by an extension. The async: false option sent to parse will be ignored."),o.async=!0);let s=uM(this,iA,oA).call(this,!!o.silent,!!o.async);if(typeof n>"u"||null===n)return s(new Error("marked(): input parameter is undefined or null"));if("string"!=typeof n)return s(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(n)+", string expected"));if(o.hooks&&(o.hooks.options=o),o.async)return Promise.resolve(o.hooks?o.hooks.preprocess(n):n).then((t=>e(t,o))).then((e=>o.walkTokens?Promise.all(this.walkTokens(e,o.walkTokens)).then((()=>e)):e)).then((e=>t(e,o))).then((e=>o.hooks?o.hooks.postprocess(e):e)).catch(s);try{o.hooks&&(n=o.hooks.preprocess(n));let r=e(n,o);o.walkTokens&&this.walkTokens(r,o.walkTokens);let i=t(r,o);return o.hooks&&(i=o.hooks.postprocess(i)),i}catch(a){return s(a)}}},iA=new WeakSet,oA=function(e,t){return n=>{if(n.message+="\nPlease report this to https://github.com/markedjs/marked.",e){let e="<p>An error occurred:</p><pre>"+NT(n.message+"",!0)+"</pre>";return t?Promise.resolve(e):e}if(t)return Promise.reject(n);throw n}};var sA=new class{constructor(){cM(this,nA),cM(this,iA),lM(this,"defaults",{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}),lM(this,"options",this.setOptions),lM(this,"parse",uM(this,nA,rA).call(this,QT.lex,eA.parse)),lM(this,"parseInline",uM(this,nA,rA).call(this,QT.lexInline,eA.parseInline)),lM(this,"Parser",eA),lM(this,"parser",eA.parse),lM(this,"Renderer",ZT),lM(this,"TextRenderer",JT),lM(this,"Lexer",QT),lM(this,"lexer",QT.lex),lM(this,"Tokenizer",qT),lM(this,"Hooks",tA),this.use(...arguments)}walkTokens(e,t){let n=[];for(let i of e)switch(n=n.concat(t.call(this,i)),i.type){case"table":{let e=i;for(let r of e.header)n=n.concat(this.walkTokens(r.tokens,t));for(let r of e.rows)for(let e of r)n=n.concat(this.walkTokens(e.tokens,t));break}case"list":{let e=i;n=n.concat(this.walkTokens(e.items,t));break}default:{var r;let e=i;null!==(r=this.defaults.extensions)&&void 0!==r&&null!==(r=r.childTokens)&&void 0!==r&&r[e.type]?this.defaults.extensions.childTokens[e.type].forEach((r=>{n=n.concat(this.walkTokens(e[r],t))})):e.tokens&&(n=n.concat(this.walkTokens(e.tokens,t)))}}return n}use(){let e=this.defaults.extensions||{renderers:{},childTokens:{}};for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach((t=>{let n={...t};if(n.async=this.defaults.async||n.async||!1,t.extensions&&(t.extensions.forEach((t=>{if(!t.name)throw new Error("extension name required");if("renderer"in t){let n=e.renderers[t.name];e.renderers[t.name]=n?function(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];let o=t.renderer.apply(this,r);return!1===o&&(o=n.apply(this,r)),o}:t.renderer}if("tokenizer"in t){if(!t.level||"block"!==t.level&&"inline"!==t.level)throw new Error("extension level must be 'block' or 'inline'");let n=e[t.level];n?n.unshift(t.tokenizer):e[t.level]=[t.tokenizer],t.start&&("block"===t.level?e.startBlock?e.startBlock.push(t.start):e.startBlock=[t.start]:"inline"===t.level&&(e.startInline?e.startInline.push(t.start):e.startInline=[t.start]))}"childTokens"in t&&t.childTokens&&(e.childTokens[t.name]=t.childTokens)})),n.extensions=e),t.renderer){let e=this.defaults.renderer||new ZT(this.defaults);for(let n in t.renderer){let r=t.renderer[n],i=n,o=e[i];e[i]=function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];let s=r.apply(e,n);return!1===s&&(s=o.apply(e,n)),s||""}}n.renderer=e}if(t.tokenizer){let e=this.defaults.tokenizer||new qT(this.defaults);for(let n in t.tokenizer){let r=t.tokenizer[n],i=n,o=e[i];e[i]=function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];let s=r.apply(e,n);return!1===s&&(s=o.apply(e,n)),s}}n.tokenizer=e}if(t.hooks){let e=this.defaults.hooks||new tA;for(let n in t.hooks){let r=t.hooks[n],i=n,o=e[i];tA.passThroughHooks.has(n)?e[i]=t=>{if(this.defaults.async)return Promise.resolve(r.call(e,t)).then((t=>o.call(e,t)));let n=r.call(e,t);return o.call(e,n)}:e[i]=function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];let s=r.apply(e,n);return!1===s&&(s=o.apply(e,n)),s}}n.hooks=e}if(t.walkTokens){let e=this.defaults.walkTokens,r=t.walkTokens;n.walkTokens=function(t){let n=[];return n.push(r.call(this,t)),e&&(n=n.concat(e.call(this,t))),n}}this.defaults={...this.defaults,...n}})),this}setOptions(e){return this.defaults={...this.defaults,...e},this}};function aA(e,t){return sA.parse(e,t)}aA.options=aA.setOptions=function(e){return sA.setOptions(e),aA.defaults=sA.defaults,AT(aA.defaults),aA},aA.getDefaults=MT,aA.defaults=TT,aA.use=function(){return sA.use(...arguments),aA.defaults=sA.defaults,AT(aA.defaults),aA},aA.walkTokens=function(e,t){return sA.walkTokens(e,t)},aA.parseInline=sA.parseInline,aA.Parser=eA,aA.parser=eA.parse,aA.Renderer=ZT,aA.TextRenderer=JT,aA.Lexer=QT,aA.lexer=QT.lex,aA.Tokenizer=qT,aA.Hooks=tA,aA.parse=aA;aA.options,aA.setOptions,aA.use,aA.walkTokens,aA.parseInline;var lA=new aA.Renderer;lA.link=function(e,t,n){return aA.Renderer.prototype.link.apply(this,arguments).replace("<a","<a target='_blank'")};const cA=new class extends IT{constructor(e){super(),this._isClient=!0,this._extensionId=e;let t=new URLSearchParams(location.search);this.options=JSON.parse(t.get("o")||"{}"),this.args=JSON.parse(t.get("q")||"{}"),t.has("omniHash")?this.token=t.get("omniHash"):(console.warn("No omniHash found in the query string, this is not a window opened by OmniHost"),this.token=e+(new Date).getTime().toString())}get extensionId(){return this._extensionId}init(){let{subscriptions:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subscriptions:[]};console.log("OmniSDKClient initialized for "+this.extensionId+".");let t=window.localStorage.getItem("omni-intentMap");if(t){let e=JSON.parse(t);e&&e.length>0&&(this.intentMap=new Map(e))}return this.addMessageHandler("host_cscript_response",this._handleClientScriptResponse),this.addMessageHandler("host_sync_data",this._handleSyncData),e.includes("custom_extension_event")&&this.addMessageHandler("custom_extension_event",this._handleCustomEvent),e.includes("host_chat_message_received")&&this.addMessageHandler("host_chat_message_received",this._handleChatMessageReceived),this.register(),this}register(){this.token&&this.send({type:"client_registration",token:this.token})}deregister(e){this.send({type:"client_deregistration",token:e})}sendChatMessage(e){let t={type:"client_send_chat",message:{content:e,type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text/markdown",attachments:arguments.length>2?arguments[2]:void 0,flags:arguments.length>3?arguments[3]:void 0}};this.send(t)}async runClientScript(e,t){let n={type:"client_run_cscript",script:e,args:t,invokeId:this.extensionId+(new Date).getTime().toString()};return new Promise(((e,t)=>{this.send(n),this.events.once("host_cscript_response:"+n.invokeId).then((t=>{e(t)}))}))}async _handleCustomEvent(e){if("custom_extension_event"!==e.type)return;let t=e;t.extensionId===this.extensionId&&await this.events.emit("custom_event",{eventId:t.eventId,eventArgs:t.eventArgs})}async _handleSyncData(e){if("host_sync_data"!==e.type)return;let t=e;this.intentMap=new Map(t.frame),await this.events.emit("data_updated",[{property:"intentMap"}])}async _handleChatMessageReceived(e){if("host_chat_message_received"!==e.type)return;let t=e;await this.events.emit("chat_message_received",[t.message])}async _handleClientScriptResponse(e){if("host_cscript_response"!==e.type)return;let t=e;await this.events.emit("host_cscript_response:"+t.invokeId,t.result)}showExtension(e,t){let n={type:"client_show_extension",extensionId:e,action:arguments.length>4&&void 0!==arguments[4]?arguments[4]:"open",args:t,page:arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",opts:arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}};this.send(n)}hide(){this.send({type:"client_window_message",action:"hide",args:{}})}show(){this.send({type:"client_window_message",action:"show",args:{}})}close(){this.send({type:"client_window_message",action:"close",args:{}})}signalIntent(e,t,n){let r={type:"client_signal_intent",intent:e,target:t,opts:(arguments.length>3&&void 0!==arguments[3]?arguments[3]:{})||{},payload:n};this.send(r)}showToast(e,t){let n={type:"client_show_toast",message:e,options:t};this.send(n)}showTopBanner(e,t,n){let r={type:"client_show_top_banner",bannerTitle:e,bannerDescription:t,options:n};this.send(r)}openRecipeInEditor(e,t){let n={type:"client_load_recipe",recipeId:e,recipeVersion:t};this.send(n)}async runExtensionScript(e,t){let n=await this._httpClient.executeRequest("/api/v1/mercenaries/runscript/".concat(this.extensionId,":")+e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)throw new Error("Server error: HTTP status "+n.status);return await n.json()}}("omni-extension-tldraw").init();function uA(){return(0,Zr.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh"},children:(0,Zr.jsx)(BI,{id:"tldraw-example",onMount:e=>{},overrides:YI})})}globalThis.omniSDK=cA;const dA=document.getElementById("root");(0,e.render)((0,Zr.jsx)(uA,{}),dA)})()})();
//# sourceMappingURL=main.66391050.js.map